{
    "sourceFile": "app/login_and_reg/plogin.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 47,
            "patches": [
                {
                    "date": 1743947071878,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1743948754537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,97 +1,164 @@\n import React, { useState } from \"react\";\r\n-import { View, Text, TouchableOpacity, StyleSheet, Dimensions, TextInput, StatusBar } from \"react-native\";\r\n-import { MaterialIcons } from \"@expo/vector-icons\"; \r\n+import {\r\n+  View,\r\n+  Text,\r\n+  TouchableOpacity,\r\n+  StyleSheet,\r\n+  Dimensions,\r\n+  TextInput,\r\n+  StatusBar,\r\n+} from \"react-native\";\r\n+import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n-export default function welcome() {\r\n-  const [email, setEmail] = useState(\"\"); // Store user email\r\n-  const [pass, setPass] = useState(\"\"); // Store user password\r\n-  const [isEditing, setIsEditing] = useState(false); \r\n+export default function PLogin() {\r\n+  const [email, setEmail] = useState(\"\");\r\n+  const [pass, setPass] = useState(\"\");\r\n+  const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n+\r\n   return (\r\n     <View style={styles.container}>\r\n-      <View style={{paddingTop: 40}}>\r\n-        <StatusBar barStyle=\"dark-content\" translucent={true} backgroundColor=\"transparent\" />\r\n-      </View>\r\n-      <View style={styles.content}>\r\n-        <TouchableOpacity onPress={() => router.push(\"/location/welcome\")}>\r\n-          <Text style={styles.back}>Back</Text>\r\n+      <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n+      <View style={styles.inner}>\r\n+        <TouchableOpacity onPress={() => router.back()}>\r\n+          <Text style={styles.back}>‚Üê Back</Text>\r\n         </TouchableOpacity>\r\n+\r\n         <Text style={styles.title}>Sign in with your registered email or phone number</Text>\r\n+\r\n         <View style={styles.inputContainer}>\r\n           <TextInput\r\n             style={styles.input}\r\n             placeholder=\"Email or Phone Number\"\r\n             placeholderTextColor=\"#A0A0A0\"\r\n             value={email}\r\n             onChangeText={setEmail}\r\n-            editable={isEditing}\r\n           />\r\n         </View>\r\n+\r\n         <View style={styles.inputContainer}>\r\n           <TextInput\r\n             style={styles.input}\r\n             placeholder=\"Enter Your Password\"\r\n             placeholderTextColor=\"#A0A0A0\"\r\n+            secureTextEntry={!isPasswordVisible}\r\n             value={pass}\r\n             onChangeText={setPass}\r\n-            editable={isEditing}\r\n           />\r\n-          <TouchableOpacity onPress={() => setIsEditing(true)}>\r\n-            <MaterialIcons name=\"edit\" size={20} color=\"#5089A3\" />\r\n+          <TouchableOpacity onPress={() => setIsPasswordVisible(prev => !prev)}>\r\n+            <MaterialIcons\r\n+              name={isPasswordVisible ? \"visibility\" : \"visibility-off\"}\r\n+              size={20}\r\n+              color=\"#A0A0A0\"\r\n+            />\r\n           </TouchableOpacity>\r\n         </View>\r\n+\r\n+        <TouchableOpacity style={styles.forgot}>\r\n+          <Text style={styles.forgotText}>Forget password?</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <TouchableOpacity style={styles.signInBtn}>\r\n+          <Text style={styles.signInText}>Sign In</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <View style={styles.divider}>\r\n+          <View style={styles.line} />\r\n+          <Text style={styles.orText}>or</Text>\r\n+          <View style={styles.line} />\r\n+        </View>\r\n+\r\n+        <Text style={styles.signupPrompt}>\r\n+          Don't have an account?{\" \"}\r\n+          <Text style={styles.signupLink} onPress={() => router.push(\"/register\")}>\r\n+            Sign Up\r\n+          </Text>\r\n+        </Text>\r\n       </View>\r\n     </View>\r\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n   container: {\r\n     flex: 1,\r\n-    backgroundColor: \"white\",\r\n+    backgroundColor: \"#fff\",\r\n     alignItems: \"center\",\r\n   },\r\n-  content: {\r\n-    width: width * 0.8,\r\n-    alignItems: \"center\",\r\n+  inner: {\r\n+    width: width * 0.85,\r\n+    paddingTop: 60,\r\n   },\r\n   back: {\r\n-    padding: 10,\r\n-    fontSize: 18,\r\n-    fontFamily: \"Poppins-Regular\",\r\n+    fontSize: 16,\r\n     color: \"#414141\",\r\n-    letterSpacing: 1,\r\n-    marginLeft: -20,\r\n+    marginBottom: 20,\r\n   },\r\n   title: {\r\n-    fontSize: 22,\r\n+    fontSize: 20,\r\n+    color: \"#414141\",\r\n     fontWeight: \"600\",\r\n-    color: \"#414141\",\r\n-    marginLeft: -20,\r\n+    marginBottom: 30,\r\n   },\r\n-  subtitle: {\r\n-    fontSize: 16,\r\n-    color: \"#A0A0A0\",\r\n-    textAlign: \"center\",\r\n-    marginTop: 5,\r\n-  },\r\n   inputContainer: {\r\n     flexDirection: \"row\",\r\n     alignItems: \"center\",\r\n     borderWidth: 1,\r\n     borderColor: \"#D1D1D1\",\r\n     borderRadius: 8,\r\n     paddingHorizontal: 10,\r\n-    width: \"100%\",\r\n-    marginTop: 20,\r\n+    height: 48,\r\n+    marginBottom: 15,\r\n   },\r\n   input: {\r\n     flex: 1,\r\n-    height: 40,\r\n     fontSize: 16,\r\n     color: \"#414141\",\r\n   },\r\n+  forgot: {\r\n+    alignSelf: \"flex-end\",\r\n+    marginBottom: 30,\r\n+  },\r\n+  forgotText: {\r\n+    color: \"#DD1F1F\",\r\n+    fontSize: 13,\r\n+  },\r\n+  signInBtn: {\r\n+    backgroundColor: \"#5089A3\",\r\n+    borderRadius: 8,\r\n+    paddingVertical: 14,\r\n+    alignItems: \"center\",\r\n+    marginBottom: 25,\r\n+  },\r\n+  signInText: {\r\n+    color: \"#fff\",\r\n+    fontSize: 16,\r\n+    fontWeight: \"bold\",\r\n+  },\r\n+  divider: {\r\n+    flexDirection: \"row\",\r\n+    alignItems: \"center\",\r\n+    marginBottom: 25,\r\n+  },\r\n+  line: {\r\n+    flex: 1,\r\n+    height: 1,\r\n+    backgroundColor: \"#D1D1D1\",\r\n+  },\r\n+  orText: {\r\n+    marginHorizontal: 10,\r\n+    color: \"#A0A0A0\",\r\n+  },\r\n+  signupPrompt: {\r\n+    textAlign: \"center\",\r\n+    fontSize: 14,\r\n+    color: \"#414141\",\r\n+  },\r\n+  signupLink: {\r\n+    color: \"#5089A3\",\r\n+    fontWeight: \"600\",\r\n+  },\r\n });\r\n"
                },
                {
                    "date": 1743948762181,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -71,9 +71,9 @@\n           <View style={styles.line} />\r\n         </View>\r\n \r\n         <Text style={styles.signupPrompt}>\r\n-          Don't have an account?{\" \"}\r\n+          Dont have an account?{\" \"}\r\n           <Text style={styles.signupLink} onPress={() => router.push(\"/register\")}>\r\n             Sign Up\r\n           </Text>\r\n         </Text>\r\n"
                },
                {
                    "date": 1743948789215,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -71,10 +71,10 @@\n           <View style={styles.line} />\r\n         </View>\r\n \r\n         <Text style={styles.signupPrompt}>\r\n-          Dont have an account?{\" \"}\r\n-          <Text style={styles.signupLink} onPress={() => router.push(\"/register\")}>\r\n+          Don't have an account?{\" \"}\r\n+          <Text style={styles.signupLink} onPress={() => router.push(\"/login_and_reg/pregister\")}>\r\n             Sign Up\r\n           </Text>\r\n         </Text>\r\n       </View>\r\n"
                },
                {
                    "date": 1743948823634,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     <View style={styles.container}>\r\n       <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n       <View style={styles.inner}>\r\n         <TouchableOpacity onPress={() => router.back()}>\r\n-          <Text style={styles.back}>‚Üê Back</Text>\r\n+          <Text style={styles.back}>Back</Text>\r\n         </TouchableOpacity>\r\n \r\n         <Text style={styles.title}>Sign in with your registered email or phone number</Text>\r\n \r\n"
                },
                {
                    "date": 1743953377471,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,12 @@\n   StyleSheet,\r\n   Dimensions,\r\n   TextInput,\r\n   StatusBar,\r\n+  Alert, // To show alerts on login failure\r\n } from \"react-native\";\r\n+import { auth } from \"../database/firebase-config\";\r\n+import { signInWithEmailAndPassword } from \"firebase/auth\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n@@ -18,8 +21,21 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n+  // Login function\r\n+  const loginUser = async () => {\r\n+    try {\r\n+      const userCredential = await signInWithEmailAndPassword(auth, email, pass);\r\n+      console.log(\"Logged in user:\", userCredential.user);\r\n+      // Navigate to the home screen or dashboard after successful login\r\n+      router.push(\"/home\"); // Replace with your actual home route\r\n+    } catch (error) {\r\n+      console.error(\"Login error:\", error.message);\r\n+      Alert.alert(\"Login Failed\", error.message); // Show error message if login fails\r\n+    }\r\n+  };\r\n+\r\n   return (\r\n     <View style={styles.container}>\r\n       <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n       <View style={styles.inner}>\r\n@@ -60,9 +76,9 @@\n         <TouchableOpacity style={styles.forgot}>\r\n           <Text style={styles.forgotText}>Forget password?</Text>\r\n         </TouchableOpacity>\r\n \r\n-        <TouchableOpacity style={styles.signInBtn}>\r\n+        <TouchableOpacity style={styles.signInBtn} onPress={loginUser}>\r\n           <Text style={styles.signInText}>Sign In</Text>\r\n         </TouchableOpacity>\r\n \r\n         <View style={styles.divider}>\r\n"
                },
                {
                    "date": 1743953466232,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,13 +27,14 @@\n     try {\r\n       const userCredential = await signInWithEmailAndPassword(auth, email, pass);\r\n       console.log(\"Logged in user:\", userCredential.user);\r\n       // Navigate to the home screen or dashboard after successful login\r\n-      router.push(\"/home\"); // Replace with your actual home route\r\n-    } catch (error) {\r\n-      console.error(\"Login error:\", error.message);\r\n-      Alert.alert(\"Login Failed\", error.message); // Show error message if login fails\r\n-    }\r\n+      router.push(\"../index\"); // Replace with your actual home route\r\n+    } catch (error: any) {\r\n+      console.error(\"Login error:\", error);\r\n+      const errorMessage = error?.message || \"An error occurred during login\";\r\n+      Alert.alert(\"Login Failed\", errorMessage); // Show error message if login fails\r\n+    }    \r\n   };\r\n \r\n   return (\r\n     <View style={styles.container}>\r\n"
                },
                {
                    "date": 1745770233911,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,14 +6,13 @@\n   StyleSheet,\r\n   Dimensions,\r\n   TextInput,\r\n   StatusBar,\r\n-  Alert, // To show alerts on login failure\r\n+  Alert,\r\n } from \"react-native\";\r\n-import { auth } from \"../database/firebase-config\";\r\n-import { signInWithEmailAndPassword } from \"firebase/auth\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n+import API_BASE_URL from \"../../config\"; // üî• make sure you have this\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -21,20 +20,34 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n-  // Login function\r\n   const loginUser = async () => {\r\n     try {\r\n-      const userCredential = await signInWithEmailAndPassword(auth, email, pass);\r\n-      console.log(\"Logged in user:\", userCredential.user);\r\n-      // Navigate to the home screen or dashboard after successful login\r\n-      router.push(\"../index\"); // Replace with your actual home route\r\n+      const response = await fetch(`${API_BASE_URL}/api/auth/passenger/login`, {\r\n+        method: \"POST\",\r\n+        headers: { \"Content-Type\": \"application/json\" },\r\n+        body: JSON.stringify({ email, password: pass }),\r\n+      });\r\n+\r\n+      const data = await response.json();\r\n+\r\n+      if (response.ok) {\r\n+        Alert.alert(\"Login Successful\", \"Welcome!\");\r\n+        console.log(\"Passenger ID:\", data.userId);\r\n+\r\n+        // TODO: Save passenger ID if you want (AsyncStorage or Context)\r\n+\r\n+        router.push(\"../index\"); // Replace with your real homepage later\r\n+      } else {\r\n+        Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n+      }\r\n+\r\n     } catch (error: any) {\r\n       console.error(\"Login error:\", error);\r\n       const errorMessage = error?.message || \"An error occurred during login\";\r\n-      Alert.alert(\"Login Failed\", errorMessage); // Show error message if login fails\r\n-    }    \r\n+      Alert.alert(\"Login Failed\", errorMessage);\r\n+    }\r\n   };\r\n \r\n   return (\r\n     <View style={styles.container}>\r\n@@ -43,14 +56,14 @@\n         <TouchableOpacity onPress={() => router.back()}>\r\n           <Text style={styles.back}>Back</Text>\r\n         </TouchableOpacity>\r\n \r\n-        <Text style={styles.title}>Sign in with your registered email or phone number</Text>\r\n+        <Text style={styles.title}>Sign in with your email or phone</Text>\r\n \r\n         <View style={styles.inputContainer}>\r\n           <TextInput\r\n             style={styles.input}\r\n-            placeholder=\"Email or Phone Number\"\r\n+            placeholder=\"Email or Phone\"\r\n             placeholderTextColor=\"#A0A0A0\"\r\n             value={email}\r\n             onChangeText={setEmail}\r\n           />\r\n@@ -99,28 +112,12 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: {\r\n-    flex: 1,\r\n-    backgroundColor: \"#fff\",\r\n-    alignItems: \"center\",\r\n-  },\r\n-  inner: {\r\n-    width: width * 0.85,\r\n-    paddingTop: 60,\r\n-  },\r\n-  back: {\r\n-    fontSize: 16,\r\n-    color: \"#414141\",\r\n-    marginBottom: 20,\r\n-  },\r\n-  title: {\r\n-    fontSize: 20,\r\n-    color: \"#414141\",\r\n-    fontWeight: \"600\",\r\n-    marginBottom: 30,\r\n-  },\r\n+  container: { flex: 1, backgroundColor: \"#fff\", alignItems: \"center\" },\r\n+  inner: { width: width * 0.85, paddingTop: 60 },\r\n+  back: { fontSize: 16, color: \"#414141\", marginBottom: 20 },\r\n+  title: { fontSize: 20, color: \"#414141\", fontWeight: \"600\", marginBottom: 30 },\r\n   inputContainer: {\r\n     flexDirection: \"row\",\r\n     alignItems: \"center\",\r\n     borderWidth: 1,\r\n@@ -129,53 +126,21 @@\n     paddingHorizontal: 10,\r\n     height: 48,\r\n     marginBottom: 15,\r\n   },\r\n-  input: {\r\n-    flex: 1,\r\n-    fontSize: 16,\r\n-    color: \"#414141\",\r\n-  },\r\n-  forgot: {\r\n-    alignSelf: \"flex-end\",\r\n-    marginBottom: 30,\r\n-  },\r\n-  forgotText: {\r\n-    color: \"#DD1F1F\",\r\n-    fontSize: 13,\r\n-  },\r\n+  input: { flex: 1, fontSize: 16, color: \"#414141\" },\r\n+  forgot: { alignSelf: \"flex-end\", marginBottom: 30 },\r\n+  forgotText: { color: \"#DD1F1F\", fontSize: 13 },\r\n   signInBtn: {\r\n     backgroundColor: \"#5089A3\",\r\n     borderRadius: 8,\r\n     paddingVertical: 14,\r\n     alignItems: \"center\",\r\n     marginBottom: 25,\r\n   },\r\n-  signInText: {\r\n-    color: \"#fff\",\r\n-    fontSize: 16,\r\n-    fontWeight: \"bold\",\r\n-  },\r\n-  divider: {\r\n-    flexDirection: \"row\",\r\n-    alignItems: \"center\",\r\n-    marginBottom: 25,\r\n-  },\r\n-  line: {\r\n-    flex: 1,\r\n-    height: 1,\r\n-    backgroundColor: \"#D1D1D1\",\r\n-  },\r\n-  orText: {\r\n-    marginHorizontal: 10,\r\n-    color: \"#A0A0A0\",\r\n-  },\r\n-  signupPrompt: {\r\n-    textAlign: \"center\",\r\n-    fontSize: 14,\r\n-    color: \"#414141\",\r\n-  },\r\n-  signupLink: {\r\n-    color: \"#5089A3\",\r\n-    fontWeight: \"600\",\r\n-  },\r\n+  signInText: { color: \"#fff\", fontSize: 16, fontWeight: \"bold\" },\r\n+  divider: { flexDirection: \"row\", alignItems: \"center\", marginBottom: 25 },\r\n+  line: { flex: 1, height: 1, backgroundColor: \"#D1D1D1\" },\r\n+  orText: { marginHorizontal: 10, color: \"#A0A0A0\" },\r\n+  signupPrompt: { textAlign: \"center\", fontSize: 14, color: \"#414141\" },\r\n+  signupLink: { color: \"#5089A3\", fontWeight: \"600\" },\r\n });\r\n"
                },
                {
                    "date": 1745770397238,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n         console.log(\"Passenger ID:\", data.userId);\r\n \r\n         // TODO: Save passenger ID if you want (AsyncStorage or Context)\r\n \r\n-        router.push(\"../index\"); // Replace with your real homepage later\r\n+        router.push(\"../homepassenger/phome\"); // Replace with your real homepage later\r\n       } else {\r\n         Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n       }\r\n \r\n"
                },
                {
                    "date": 1745770971239,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,28 +27,35 @@\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n       });\r\n-\r\n-      const data = await response.json();\r\n-\r\n+  \r\n+      const text = await response.text();  // üî• Read it as plain text first\r\n+  \r\n+      console.log(\"Raw server response:\", text);  // üî• Debug print to see what server replied\r\n+  \r\n+      let data;\r\n+      try {\r\n+        data = JSON.parse(text);  // üî• Then try to parse it safely\r\n+      } catch (jsonError) {\r\n+        console.error(\"Server did not return JSON:\", text);\r\n+        throw new Error(\"Invalid server response: not JSON\");\r\n+      }\r\n+  \r\n       if (response.ok) {\r\n         Alert.alert(\"Login Successful\", \"Welcome!\");\r\n         console.log(\"Passenger ID:\", data.userId);\r\n-\r\n-        // TODO: Save passenger ID if you want (AsyncStorage or Context)\r\n-\r\n-        router.push(\"../homepassenger/phome\"); // Replace with your real homepage later\r\n+        router.push(\"../homepassenger/phome\");\r\n       } else {\r\n         Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n       }\r\n-\r\n+  \r\n     } catch (error: any) {\r\n-      console.error(\"Login error:\", error);\r\n+      console.error(\"Login error (catch block):\", error);\r\n       const errorMessage = error?.message || \"An error occurred during login\";\r\n       Alert.alert(\"Login Failed\", errorMessage);\r\n     }\r\n-  };\r\n+  };  \r\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n"
                },
                {
                    "date": 1745800418315,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   const router = useRouter();\r\n \r\n   const loginUser = async () => {\r\n     try {\r\n-      const response = await fetch(`${API_BASE_URL}/api/auth/passenger/login`, {\r\n+      const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n       });\r\n"
                },
                {
                    "date": 1746361788613,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,9 +10,9 @@\n   Alert,\r\n } from \"react-native\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n-import API_BASE_URL from \"../../config\"; // üî• make sure you have this\r\n+import {API_BASE_URL} from \"../../config\"; // üî• make sure you have this\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -22,8 +22,9 @@\n   const router = useRouter();\r\n \r\n   const loginUser = async () => {\r\n     try {\r\n+      console.log(\"API_BASE_URL is\", API_BASE_URL);\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n"
                },
                {
                    "date": 1747658850148,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,9 +10,10 @@\n   Alert,\r\n } from \"react-native\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n-import {API_BASE_URL} from \"../../config\"; // üî• make sure you have this\r\n+import {API_BASE_URL} from \"../../config\";\r\n+import AsyncStorage from '@react-native-async-storage/async-storage';\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -40,8 +41,17 @@\n       } catch (jsonError) {\r\n         console.error(\"Server did not return JSON:\", text);\r\n         throw new Error(\"Invalid server response: not JSON\");\r\n       }\r\n+\r\n+      if (response.ok && data.userId) {\r\n+        await AsyncStorage.setItem(\"passengerId\", data.userId);\r\n+        Alert.alert(\"Login Successful\", \"Welcome!\");\r\n+        router.push(\"../homepassenger/phome\");\r\n+      } else {\r\n+        Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n+      }\r\n+\r\n   \r\n       if (response.ok) {\r\n         Alert.alert(\"Login Successful\", \"Welcome!\");\r\n         console.log(\"Passenger ID:\", data.userId);\r\n"
                },
                {
                    "date": 1747658870388,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,19 +43,19 @@\n         throw new Error(\"Invalid server response: not JSON\");\r\n       }\r\n \r\n       if (response.ok && data.userId) {\r\n-        await AsyncStorage.setItem(\"passengerId\", data.userId);\r\n+        \r\n         Alert.alert(\"Login Successful\", \"Welcome!\");\r\n         router.push(\"../homepassenger/phome\");\r\n       } else {\r\n         Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n       }\r\n \r\n   \r\n       if (response.ok) {\r\n+        await AsyncStorage.setItem(\"passengerId\", data.userId);\r\n         Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-        console.log(\"Passenger ID:\", data.userId);\r\n         router.push(\"../homepassenger/phome\");\r\n       } else {\r\n         Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n       }\r\n"
                },
                {
                    "date": 1747658881827,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,17 +41,8 @@\n       } catch (jsonError) {\r\n         console.error(\"Server did not return JSON:\", text);\r\n         throw new Error(\"Invalid server response: not JSON\");\r\n       }\r\n-\r\n-      if (response.ok && data.userId) {\r\n-        \r\n-        Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-        router.push(\"../homepassenger/phome\");\r\n-      } else {\r\n-        Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n-      }\r\n-\r\n   \r\n       if (response.ok) {\r\n         await AsyncStorage.setItem(\"passengerId\", data.userId);\r\n         Alert.alert(\"Login Successful\", \"Welcome!\");\r\n"
                },
                {
                    "date": 1748322049915,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,8 +7,9 @@\n   Dimensions,\r\n   TextInput,\r\n   StatusBar,\r\n   Alert,\r\n+  Keyboard\r\n } from \"react-native\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n import {API_BASE_URL} from \"../../config\";\r\n"
                },
                {
                    "date": 1748322066185,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,8 +23,9 @@\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n   const loginUser = async () => {\r\n+    Keyboard.dismiss();\r\n     try {\r\n       console.log(\"API_BASE_URL is\", API_BASE_URL);\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n"
                },
                {
                    "date": 1748456714264,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,9 +63,9 @@\n   return (\r\n     <View style={styles.container}>\r\n       <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n       <View style={styles.inner}>\r\n-        <TouchableOpacity onPress={() => router.back()}>\r\n+        <TouchableOpacity onPress={() => router.push(\"../location/welcome\")}>\r\n           <Text style={styles.back}>Back</Text>\r\n         </TouchableOpacity>\r\n \r\n         <Text style={styles.title}>Sign in with your email or phone</Text>\r\n"
                },
                {
                    "date": 1760956538395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,8 +13,9 @@\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n import {API_BASE_URL} from \"../../config\";\r\n import AsyncStorage from '@react-native-async-storage/async-storage';\r\n+import { saveAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -22,45 +23,108 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n+  async function wakeBackend(BASE: string) {\r\n+    const healthUrl = `${BASE}/health`;\r\n+    const warmUrl   = `${BASE}/warmup`;\r\n+\r\n+    // Try health quickly a few times\r\n+    for (let i = 0; i < 5; i++) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise(r => setTimeout(r, 1000));\r\n+    }\r\n+\r\n+    // Kick warmup and poll until ready (cap ~60s)\r\n+    await fetch(warmUrl).catch(()=>{});\r\n+    const started = Date.now();\r\n+    while (Date.now() - started < 60000) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise(r => setTimeout(r, 1500));\r\n+    }\r\n+    return false; // still starting, but don‚Äôt block forever\r\n+  }\r\n+\r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n+\r\n+    // simple timing helper\r\n+    const t0 = Date.now();\r\n+    const lap = (label: string) => console.log(`[login] +${(Date.now() - t0)}ms ${label}`);\r\n+\r\n     try {\r\n-      console.log(\"API_BASE_URL is\", API_BASE_URL);\r\n+      console.time(\"login\");\r\n+      console.log(\"[login] start fetch\");\r\n+\r\n+      // NEW: wake first\r\n+      await wakeBackend(API_BASE_URL);\r\n+\r\n+      const controller = new AbortController();\r\n+      const to = setTimeout(()=>controller.abort(), 20000); // 20s cap\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n+        signal: controller.signal,\r\n       });\r\n-  \r\n-      const text = await response.text();  // üî• Read it as plain text first\r\n-  \r\n-      console.log(\"Raw server response:\", text);  // üî• Debug print to see what server replied\r\n-  \r\n-      let data;\r\n+      clearTimeout(to);\r\n+      lap(`after fetch (status ${response.status})`);\r\n+\r\n+      // parse JSON directly (faster than text()+JSON.parse)\r\n+      let data: any;\r\n       try {\r\n-        data = JSON.parse(text);  // üî• Then try to parse it safely\r\n-      } catch (jsonError) {\r\n-        console.error(\"Server did not return JSON:\", text);\r\n+        data = await response.json();\r\n+        lap(\"after response.json\");\r\n+      } catch (e) {\r\n+        // fallback to read body for debugging\r\n+        const body = await response.text();\r\n+        console.log(\"[login] non-JSON body:\", body.slice(0, 400));\r\n         throw new Error(\"Invalid server response: not JSON\");\r\n       }\r\n-  \r\n-      if (response.ok) {\r\n-        await AsyncStorage.setItem(\"passengerId\", data.userId);\r\n-        Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-        router.push(\"../homepassenger/phome\");\r\n-      } else {\r\n-        Alert.alert(\"Login Failed\", data.error || \"Invalid credentials\");\r\n+\r\n+      if (!response.ok) {\r\n+        throw new Error(data?.error || \"Invalid credentials\");\r\n       }\r\n-  \r\n+\r\n+      // accept multiple shapes\r\n+      const passengerId =\r\n+        data?.userId ||\r\n+        data?.passenger?._id ||\r\n+        data?.user?._id ||\r\n+        data?._id;\r\n+\r\n+      if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n+\r\n+      // save auth\r\n+      // === DEBUG GUARDS START ===\r\n+      console.log(\"GUARD saveAuth:\", typeof saveAuth);\r\n+      console.log(\"GUARD AsyncStorage.setItem:\", typeof AsyncStorage?.setItem);\r\n+      console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n+      // === DEBUG GUARDS END ===\r\n+      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n+      await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n+      lap(\"after saveAuth + AsyncStorage\");\r\n+\r\n+      lap(\"DONE\");\r\n+      Alert.alert(\"Login Successful\", \"Welcome!\");\r\n+      router.replace(\"../homepassenger/phome\");\r\n     } catch (error: any) {\r\n-      console.error(\"Login error (catch block):\", error);\r\n-      const errorMessage = error?.message || \"An error occurred during login\";\r\n-      Alert.alert(\"Login Failed\", errorMessage);\r\n+      if (error?.name === \"AbortError\") {\r\n+        console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n+      }\r\n+      console.error(\"Login error (passenger):\", error);\r\n+      Alert.alert(\"Login Failed\", error?.message || \"Network/server error\");\r\n     }\r\n-  };  \r\n+  };\r\n \r\n+\r\n+\r\n   return (\r\n     <View style={styles.container}>\r\n       <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n       <View style={styles.inner}>\r\n"
                },
                {
                    "date": 1760956563955,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -105,9 +105,10 @@\n       console.log(\"GUARD saveAuth:\", typeof saveAuth);\r\n       console.log(\"GUARD AsyncStorage.setItem:\", typeof AsyncStorage?.setItem);\r\n       console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n       // === DEBUG GUARDS END ===\r\n-      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n+      console.log(\"STEP A: calling saveAuth\");\r\n+      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token }); \r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n       lap(\"after saveAuth + AsyncStorage\");\r\n \r\n       lap(\"DONE\");\r\n"
                },
                {
                    "date": 1760956575443,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,8 +107,9 @@\n       console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n       // === DEBUG GUARDS END ===\r\n       console.log(\"STEP A: calling saveAuth\");\r\n       await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token }); \r\n+      console.log(\"STEP B: calling AsyncStorage.setItem\");\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n       lap(\"after saveAuth + AsyncStorage\");\r\n \r\n       lap(\"DONE\");\r\n"
                },
                {
                    "date": 1760956641696,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -72,15 +72,13 @@\n         body: JSON.stringify({ email, password: pass }),\r\n         signal: controller.signal,\r\n       });\r\n       clearTimeout(to);\r\n-      lap(`after fetch (status ${response.status})`);\r\n \r\n       // parse JSON directly (faster than text()+JSON.parse)\r\n       let data: any;\r\n       try {\r\n         data = await response.json();\r\n-        lap(\"after response.json\");\r\n       } catch (e) {\r\n         // fallback to read body for debugging\r\n         const body = await response.text();\r\n         console.log(\"[login] non-JSON body:\", body.slice(0, 400));\r\n@@ -109,13 +107,14 @@\n       console.log(\"STEP A: calling saveAuth\");\r\n       await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token }); \r\n       console.log(\"STEP B: calling AsyncStorage.setItem\");\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n-      lap(\"after saveAuth + AsyncStorage\");\r\n \r\n-      lap(\"DONE\");\r\n+      console.log(\"STEP C: showing success alert\");\r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-      router.replace(\"../homepassenger/phome\");\r\n+      \r\n+      console.log(\"STEP D: navigating to home\");\r\n+      router.replace(\"/homepassenger/phome\");\r\n     } catch (error: any) {\r\n       if (error?.name === \"AbortError\") {\r\n         console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n       }\r\n"
                },
                {
                    "date": 1760956797876,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,33 +23,33 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n-  async function wakeBackend(BASE: string) {\r\n-    const healthUrl = `${BASE}/health`;\r\n-    const warmUrl   = `${BASE}/warmup`;\r\n+  // async function wakeBackend(BASE: string) {\r\n+  //   const healthUrl = `${BASE}/health`;\r\n+  //   const warmUrl   = `${BASE}/warmup`;\r\n \r\n-    // Try health quickly a few times\r\n-    for (let i = 0; i < 5; i++) {\r\n-      try {\r\n-        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-        if (r.ok) return true;\r\n-      } catch {}\r\n-      await new Promise(r => setTimeout(r, 1000));\r\n-    }\r\n+  //   // Try health quickly a few times\r\n+  //   for (let i = 0; i < 5; i++) {\r\n+  //     try {\r\n+  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+  //       if (r.ok) return true;\r\n+  //     } catch {}\r\n+  //     await new Promise(r => setTimeout(r, 1000));\r\n+  //   }\r\n \r\n-    // Kick warmup and poll until ready (cap ~60s)\r\n-    await fetch(warmUrl).catch(()=>{});\r\n-    const started = Date.now();\r\n-    while (Date.now() - started < 60000) {\r\n-      try {\r\n-        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-        if (r.ok) return true;\r\n-      } catch {}\r\n-      await new Promise(r => setTimeout(r, 1500));\r\n-    }\r\n-    return false; // still starting, but don‚Äôt block forever\r\n-  }\r\n+  //   // Kick warmup and poll until ready (cap ~60s)\r\n+  //   await fetch(warmUrl).catch(()=>{});\r\n+  //   const started = Date.now();\r\n+  //   while (Date.now() - started < 60000) {\r\n+  //     try {\r\n+  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+  //       if (r.ok) return true;\r\n+  //     } catch {}\r\n+  //     await new Promise(r => setTimeout(r, 1500));\r\n+  //   }\r\n+  //   return false; // still starting, but don‚Äôt block forever\r\n+  // }\r\n \r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n \r\n@@ -61,9 +61,9 @@\n       console.time(\"login\");\r\n       console.log(\"[login] start fetch\");\r\n \r\n       // NEW: wake first\r\n-      await wakeBackend(API_BASE_URL);\r\n+      // await wakeBackend(API_BASE_URL);\r\n \r\n       const controller = new AbortController();\r\n       const to = setTimeout(()=>controller.abort(), 20000); // 20s cap\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n"
                },
                {
                    "date": 1760960089816,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,9 +13,8 @@\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n import {API_BASE_URL} from \"../../config\";\r\n import AsyncStorage from '@react-native-async-storage/async-storage';\r\n-import { saveAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -99,15 +98,12 @@\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n       // save auth\r\n       // === DEBUG GUARDS START ===\r\n-      console.log(\"GUARD saveAuth:\", typeof saveAuth);\r\n       console.log(\"GUARD AsyncStorage.setItem:\", typeof AsyncStorage?.setItem);\r\n       console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n       // === DEBUG GUARDS END ===\r\n       console.log(\"STEP A: calling saveAuth\");\r\n-      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token }); \r\n-      console.log(\"STEP B: calling AsyncStorage.setItem\");\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n \r\n       console.log(\"STEP C: showing success alert\");\r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n"
                },
                {
                    "date": 1760960538189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,8 +13,9 @@\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n import {API_BASE_URL} from \"../../config\";\r\n import AsyncStorage from '@react-native-async-storage/async-storage';\r\n+import { saveAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -22,33 +23,33 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n-  // async function wakeBackend(BASE: string) {\r\n-  //   const healthUrl = `${BASE}/health`;\r\n-  //   const warmUrl   = `${BASE}/warmup`;\r\n+  async function wakeBackend(BASE: string) {\r\n+    const healthUrl = `${BASE}/health`;\r\n+    const warmUrl   = `${BASE}/warmup`;\r\n \r\n-  //   // Try health quickly a few times\r\n-  //   for (let i = 0; i < 5; i++) {\r\n-  //     try {\r\n-  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-  //       if (r.ok) return true;\r\n-  //     } catch {}\r\n-  //     await new Promise(r => setTimeout(r, 1000));\r\n-  //   }\r\n+    // Try health quickly a few times\r\n+    for (let i = 0; i < 5; i++) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise(r => setTimeout(r, 1000));\r\n+    }\r\n \r\n-  //   // Kick warmup and poll until ready (cap ~60s)\r\n-  //   await fetch(warmUrl).catch(()=>{});\r\n-  //   const started = Date.now();\r\n-  //   while (Date.now() - started < 60000) {\r\n-  //     try {\r\n-  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-  //       if (r.ok) return true;\r\n-  //     } catch {}\r\n-  //     await new Promise(r => setTimeout(r, 1500));\r\n-  //   }\r\n-  //   return false; // still starting, but don‚Äôt block forever\r\n-  // }\r\n+    // Kick warmup and poll until ready (cap ~60s)\r\n+    await fetch(warmUrl).catch(()=>{});\r\n+    const started = Date.now();\r\n+    while (Date.now() - started < 60000) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise(r => setTimeout(r, 1500));\r\n+    }\r\n+    return false; // still starting, but don‚Äôt block forever\r\n+  }\r\n \r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n \r\n@@ -60,9 +61,9 @@\n       console.time(\"login\");\r\n       console.log(\"[login] start fetch\");\r\n \r\n       // NEW: wake first\r\n-      // await wakeBackend(API_BASE_URL);\r\n+      await wakeBackend(API_BASE_URL);\r\n \r\n       const controller = new AbortController();\r\n       const to = setTimeout(()=>controller.abort(), 20000); // 20s cap\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n@@ -71,13 +72,15 @@\n         body: JSON.stringify({ email, password: pass }),\r\n         signal: controller.signal,\r\n       });\r\n       clearTimeout(to);\r\n+      lap(`after fetch (status ${response.status})`);\r\n \r\n       // parse JSON directly (faster than text()+JSON.parse)\r\n       let data: any;\r\n       try {\r\n         data = await response.json();\r\n+        lap(\"after response.json\");\r\n       } catch (e) {\r\n         // fallback to read body for debugging\r\n         const body = await response.text();\r\n         console.log(\"[login] non-JSON body:\", body.slice(0, 400));\r\n@@ -97,20 +100,15 @@\n \r\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n       // save auth\r\n-      // === DEBUG GUARDS START ===\r\n-      console.log(\"GUARD AsyncStorage.setItem:\", typeof AsyncStorage?.setItem);\r\n-      console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n-      // === DEBUG GUARDS END ===\r\n-      console.log(\"STEP A: calling saveAuth\");\r\n+      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n+      lap(\"after saveAuth + AsyncStorage\");\r\n \r\n-      console.log(\"STEP C: showing success alert\");\r\n+      lap(\"DONE\");\r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-      \r\n-      console.log(\"STEP D: navigating to home\");\r\n-      router.replace(\"/homepassenger/phome\");\r\n+      router.replace(\"../homepassenger/phome\");\r\n     } catch (error: any) {\r\n       if (error?.name === \"AbortError\") {\r\n         console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n       }\r\n"
                },
                {
                    "date": 1760960745912,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,11 +11,10 @@\n   Keyboard\r\n } from \"react-native\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n-import {API_BASE_URL} from \"../../config\";\r\n-import AsyncStorage from '@react-native-async-storage/async-storage';\r\n-import { saveAuth } from \"../utils/authStorage\";\r\n+import { API_BASE_URL } from \"../../config\";\r\n+import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -23,66 +22,32 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n-  async function wakeBackend(BASE: string) {\r\n-    const healthUrl = `${BASE}/health`;\r\n-    const warmUrl   = `${BASE}/warmup`;\r\n-\r\n-    // Try health quickly a few times\r\n-    for (let i = 0; i < 5; i++) {\r\n-      try {\r\n-        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-        if (r.ok) return true;\r\n-      } catch {}\r\n-      await new Promise(r => setTimeout(r, 1000));\r\n-    }\r\n-\r\n-    // Kick warmup and poll until ready (cap ~60s)\r\n-    await fetch(warmUrl).catch(()=>{});\r\n-    const started = Date.now();\r\n-    while (Date.now() - started < 60000) {\r\n-      try {\r\n-        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-        if (r.ok) return true;\r\n-      } catch {}\r\n-      await new Promise(r => setTimeout(r, 1500));\r\n-    }\r\n-    return false; // still starting, but don‚Äôt block forever\r\n-  }\r\n-\r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n \r\n-    // simple timing helper\r\n-    const t0 = Date.now();\r\n-    const lap = (label: string) => console.log(`[login] +${(Date.now() - t0)}ms ${label}`);\r\n-\r\n     try {\r\n       console.time(\"login\");\r\n       console.log(\"[login] start fetch\");\r\n \r\n-      // NEW: wake first\r\n-      await wakeBackend(API_BASE_URL);\r\n+      // NOTE: removed wakeBackend for simplicity/reliability on prod builds\r\n \r\n       const controller = new AbortController();\r\n-      const to = setTimeout(()=>controller.abort(), 20000); // 20s cap\r\n+      const to = setTimeout(() => controller.abort(), 20000); // 20s cap\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n         signal: controller.signal,\r\n       });\r\n       clearTimeout(to);\r\n-      lap(`after fetch (status ${response.status})`);\r\n \r\n-      // parse JSON directly (faster than text()+JSON.parse)\r\n+      // Try to parse JSON\r\n       let data: any;\r\n       try {\r\n         data = await response.json();\r\n-        lap(\"after response.json\");\r\n       } catch (e) {\r\n-        // fallback to read body for debugging\r\n         const body = await response.text();\r\n         console.log(\"[login] non-JSON body:\", body.slice(0, 400));\r\n         throw new Error(\"Invalid server response: not JSON\");\r\n       }\r\n@@ -90,127 +55,20 @@\n       if (!response.ok) {\r\n         throw new Error(data?.error || \"Invalid credentials\");\r\n       }\r\n \r\n-      // accept multiple shapes\r\n+      // Accept multiple shapes\r\n       const passengerId =\r\n         data?.userId ||\r\n         data?.passenger?._id ||\r\n         data?.user?._id ||\r\n         data?._id;\r\n \r\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n-      // save auth\r\n-      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n-      await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n-      lap(\"after saveAuth + AsyncStorage\");\r\n-\r\n-      lap(\"DONE\");\r\n-      Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-      router.replace(\"../homepassenger/phome\");\r\n-    } catch (error: any) {\r\n-      if (error?.name === \"AbortError\") {\r\n-        console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n-      }\r\n-      console.error(\"Login error (passenger):\", error);\r\n-      Alert.alert(\"Login Failed\", error?.message || \"Network/server error\");\r\n-    }\r\n-  };\r\n-\r\n-\r\n-\r\n-  return (\r\n-    <View style={styles.container}>\r\n-      <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n-      <View style={styles.inner}>\r\n-        <TouchableOpacity onPress={() => router.push(\"../location/welcome\")}>\r\n-          <Text style={styles.back}>Back</Text>\r\n-        </TouchableOpacity>\r\n-\r\n-        <Text style={styles.title}>Sign in with your email or phone</Text>\r\n-\r\n-        <View style={styles.inputContainer}>\r\n-          <TextInput\r\n-            style={styles.input}\r\n-            placeholder=\"Email or Phone\"\r\n-            placeholderTextColor=\"#A0A0A0\"\r\n-            value={email}\r\n-            onChangeText={setEmail}\r\n-          />\r\n-        </View>\r\n-\r\n-        <View style={styles.inputContainer}>\r\n-          <TextInput\r\n-            style={styles.input}\r\n-            placeholder=\"Enter Your Password\"\r\n-            placeholderTextColor=\"#A0A0A0\"\r\n-            secureTextEntry={!isPasswordVisible}\r\n-            value={pass}\r\n-            onChangeText={setPass}\r\n-          />\r\n-          <TouchableOpacity onPress={() => setIsPasswordVisible(prev => !prev)}>\r\n-            <MaterialIcons\r\n-              name={isPasswordVisible ? \"visibility\" : \"visibility-off\"}\r\n-              size={20}\r\n-              color=\"#A0A0A0\"\r\n-            />\r\n-          </TouchableOpacity>\r\n-        </View>\r\n-\r\n-        <TouchableOpacity style={styles.forgot}>\r\n-          <Text style={styles.forgotText}>Forget password?</Text>\r\n-        </TouchableOpacity>\r\n-\r\n-        <TouchableOpacity style={styles.signInBtn} onPress={loginUser}>\r\n-          <Text style={styles.signInText}>Sign In</Text>\r\n-        </TouchableOpacity>\r\n-\r\n-        <View style={styles.divider}>\r\n-          <View style={styles.line} />\r\n-          <Text style={styles.orText}>or</Text>\r\n-          <View style={styles.line} />\r\n-        </View>\r\n-\r\n-        <Text style={styles.signupPrompt}>\r\n-          Don't have an account?{\" \"}\r\n-          <Text style={styles.signupLink} onPress={() => router.push(\"/login_and_reg/pregister\")}>\r\n-            Sign Up\r\n-          </Text>\r\n-        </Text>\r\n-      </View>\r\n-    </View>\r\n-  );\r\n-}\r\n-\r\n-const styles = StyleSheet.create({\r\n-  container: { flex: 1, backgroundColor: \"#fff\", alignItems: \"center\" },\r\n-  inner: { width: width * 0.85, paddingTop: 60 },\r\n-  back: { fontSize: 16, color: \"#414141\", marginBottom: 20 },\r\n-  title: { fontSize: 20, color: \"#414141\", fontWeight: \"600\", marginBottom: 30 },\r\n-  inputContainer: {\r\n-    flexDirection: \"row\",\r\n-    alignItems: \"center\",\r\n-    borderWidth: 1,\r\n-    borderColor: \"#D1D1D1\",\r\n-    borderRadius: 8,\r\n-    paddingHorizontal: 10,\r\n-    height: 48,\r\n-    marginBottom: 15,\r\n-  },\r\n-  input: { flex: 1, fontSize: 16, color: \"#414141\" },\r\n-  forgot: { alignSelf: \"flex-end\", marginBottom: 30 },\r\n-  forgotText: { color: \"#DD1F1F\", fontSize: 13 },\r\n-  signInBtn: {\r\n-    backgroundColor: \"#5089A3\",\r\n-    borderRadius: 8,\r\n-    paddingVertical: 14,\r\n-    alignItems: \"center\",\r\n-    marginBottom: 25,\r\n-  },\r\n-  signInText: { color: \"#fff\", fontSize: 16, fontWeight: \"bold\" },\r\n-  divider: { flexDirection: \"row\", alignItems: \"center\", marginBottom: 25 },\r\n-  line: { flex: 1, height: 1, backgroundColor: \"#D1D1D1\" },\r\n-  orText: { marginHorizontal: 10, color: \"#A0A0A0\" },\r\n-  signupPrompt: { textAlign: \"center\", fontSize: 14, color: \"#414141\" },\r\n-  signupLink: { color: \"#5089A3\", fontWeight: \"600\" },\r\n-});\r\n+      // ‚úÖ Persist minimal auth WITHOUT saveAuth\r\n+      await AsyncStorage.multiSet([\r\n+        [\"role\", \"passenger\"],\r\n+        [\"userId\", String(passengerId)],   // for useAuth\r\n+        [\"passengerId\", String(passengerId)], // for legacy reads\r\n+        [\"token\", data?.token || \"\"],\r\n+      ])\r\n"
                },
                {
                    "date": 1760960752191,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,10 +11,11 @@\n   Keyboard\r\n } from \"react-native\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n-import { API_BASE_URL } from \"../../config\";\r\n-import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n+import {API_BASE_URL} from \"../../config\";\r\n+import AsyncStorage from '@react-native-async-storage/async-storage';\r\n+import { saveAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -22,32 +23,64 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n+  // async function wakeBackend(BASE: string) {\r\n+  //   const healthUrl = `${BASE}/health`;\r\n+  //   const warmUrl   = `${BASE}/warmup`;\r\n+\r\n+  //   // Try health quickly a few times\r\n+  //   for (let i = 0; i < 5; i++) {\r\n+  //     try {\r\n+  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+  //       if (r.ok) return true;\r\n+  //     } catch {}\r\n+  //     await new Promise(r => setTimeout(r, 1000));\r\n+  //   }\r\n+\r\n+  //   // Kick warmup and poll until ready (cap ~60s)\r\n+  //   await fetch(warmUrl).catch(()=>{});\r\n+  //   const started = Date.now();\r\n+  //   while (Date.now() - started < 60000) {\r\n+  //     try {\r\n+  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+  //       if (r.ok) return true;\r\n+  //     } catch {}\r\n+  //     await new Promise(r => setTimeout(r, 1500));\r\n+  //   }\r\n+  //   return false; // still starting, but don‚Äôt block forever\r\n+  // }\r\n+\r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n \r\n+    // simple timing helper\r\n+    const t0 = Date.now();\r\n+    const lap = (label: string) => console.log(`[login] +${(Date.now() - t0)}ms ${label}`);\r\n+\r\n     try {\r\n       console.time(\"login\");\r\n       console.log(\"[login] start fetch\");\r\n \r\n-      // NOTE: removed wakeBackend for simplicity/reliability on prod builds\r\n+      // NEW: wake first\r\n+      // await wakeBackend(API_BASE_URL);\r\n \r\n       const controller = new AbortController();\r\n-      const to = setTimeout(() => controller.abort(), 20000); // 20s cap\r\n+      const to = setTimeout(()=>controller.abort(), 20000); // 20s cap\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n         signal: controller.signal,\r\n       });\r\n       clearTimeout(to);\r\n \r\n-      // Try to parse JSON\r\n+      // parse JSON directly (faster than text()+JSON.parse)\r\n       let data: any;\r\n       try {\r\n         data = await response.json();\r\n       } catch (e) {\r\n+        // fallback to read body for debugging\r\n         const body = await response.text();\r\n         console.log(\"[login] non-JSON body:\", body.slice(0, 400));\r\n         throw new Error(\"Invalid server response: not JSON\");\r\n       }\r\n@@ -55,20 +88,135 @@\n       if (!response.ok) {\r\n         throw new Error(data?.error || \"Invalid credentials\");\r\n       }\r\n \r\n-      // Accept multiple shapes\r\n+      // accept multiple shapes\r\n       const passengerId =\r\n         data?.userId ||\r\n         data?.passenger?._id ||\r\n         data?.user?._id ||\r\n         data?._id;\r\n \r\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n-      // ‚úÖ Persist minimal auth WITHOUT saveAuth\r\n-      await AsyncStorage.multiSet([\r\n-        [\"role\", \"passenger\"],\r\n-        [\"userId\", String(passengerId)],   // for useAuth\r\n-        [\"passengerId\", String(passengerId)], // for legacy reads\r\n-        [\"token\", data?.token || \"\"],\r\n-      ])\r\n+      // save auth\r\n+      // === DEBUG GUARDS START ===\r\n+      console.log(\"GUARD saveAuth:\", typeof saveAuth);\r\n+      console.log(\"GUARD AsyncStorage.setItem:\", typeof AsyncStorage?.setItem);\r\n+      console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n+      // === DEBUG GUARDS END ===\r\n+      console.log(\"STEP A: calling saveAuth\");\r\n+      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token }); \r\n+      console.log(\"STEP B: calling AsyncStorage.setItem\");\r\n+      await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n+\r\n+      console.log(\"STEP C: showing success alert\");\r\n+      Alert.alert(\"Login Successful\", \"Welcome!\");\r\n+      \r\n+      console.log(\"STEP D: navigating to home\");\r\n+      router.replace(\"/homepassenger/phome\");\r\n+    } catch (error: any) {\r\n+      if (error?.name === \"AbortError\") {\r\n+        console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n+      }\r\n+      console.error(\"Login error (passenger):\", error);\r\n+      Alert.alert(\"Login Failed\", error?.message || \"Network/server error\");\r\n+    }\r\n+  };\r\n+\r\n+\r\n+\r\n+  return (\r\n+    <View style={styles.container}>\r\n+      <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n+      <View style={styles.inner}>\r\n+        <TouchableOpacity onPress={() => router.push(\"../location/welcome\")}>\r\n+          <Text style={styles.back}>Back</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <Text style={styles.title}>Sign in with your email or phone</Text>\r\n+\r\n+        <View style={styles.inputContainer}>\r\n+          <TextInput\r\n+            style={styles.input}\r\n+            placeholder=\"Email or Phone\"\r\n+            placeholderTextColor=\"#A0A0A0\"\r\n+            value={email}\r\n+            onChangeText={setEmail}\r\n+          />\r\n+        </View>\r\n+\r\n+        <View style={styles.inputContainer}>\r\n+          <TextInput\r\n+            style={styles.input}\r\n+            placeholder=\"Enter Your Password\"\r\n+            placeholderTextColor=\"#A0A0A0\"\r\n+            secureTextEntry={!isPasswordVisible}\r\n+            value={pass}\r\n+            onChangeText={setPass}\r\n+          />\r\n+          <TouchableOpacity onPress={() => setIsPasswordVisible(prev => !prev)}>\r\n+            <MaterialIcons\r\n+              name={isPasswordVisible ? \"visibility\" : \"visibility-off\"}\r\n+              size={20}\r\n+              color=\"#A0A0A0\"\r\n+            />\r\n+          </TouchableOpacity>\r\n+        </View>\r\n+\r\n+        <TouchableOpacity style={styles.forgot}>\r\n+          <Text style={styles.forgotText}>Forget password?</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <TouchableOpacity style={styles.signInBtn} onPress={loginUser}>\r\n+          <Text style={styles.signInText}>Sign In</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <View style={styles.divider}>\r\n+          <View style={styles.line} />\r\n+          <Text style={styles.orText}>or</Text>\r\n+          <View style={styles.line} />\r\n+        </View>\r\n+\r\n+        <Text style={styles.signupPrompt}>\r\n+          Don't have an account?{\" \"}\r\n+          <Text style={styles.signupLink} onPress={() => router.push(\"/login_and_reg/pregister\")}>\r\n+            Sign Up\r\n+          </Text>\r\n+        </Text>\r\n+      </View>\r\n+    </View>\r\n+  );\r\n+}\r\n+\r\n+const styles = StyleSheet.create({\r\n+  container: { flex: 1, backgroundColor: \"#fff\", alignItems: \"center\" },\r\n+  inner: { width: width * 0.85, paddingTop: 60 },\r\n+  back: { fontSize: 16, color: \"#414141\", marginBottom: 20 },\r\n+  title: { fontSize: 20, color: \"#414141\", fontWeight: \"600\", marginBottom: 30 },\r\n+  inputContainer: {\r\n+    flexDirection: \"row\",\r\n+    alignItems: \"center\",\r\n+    borderWidth: 1,\r\n+    borderColor: \"#D1D1D1\",\r\n+    borderRadius: 8,\r\n+    paddingHorizontal: 10,\r\n+    height: 48,\r\n+    marginBottom: 15,\r\n+  },\r\n+  input: { flex: 1, fontSize: 16, color: \"#414141\" },\r\n+  forgot: { alignSelf: \"flex-end\", marginBottom: 30 },\r\n+  forgotText: { color: \"#DD1F1F\", fontSize: 13 },\r\n+  signInBtn: {\r\n+    backgroundColor: \"#5089A3\",\r\n+    borderRadius: 8,\r\n+    paddingVertical: 14,\r\n+    alignItems: \"center\",\r\n+    marginBottom: 25,\r\n+  },\r\n+  signInText: { color: \"#fff\", fontSize: 16, fontWeight: \"bold\" },\r\n+  divider: { flexDirection: \"row\", alignItems: \"center\", marginBottom: 25 },\r\n+  line: { flex: 1, height: 1, backgroundColor: \"#D1D1D1\" },\r\n+  orText: { marginHorizontal: 10, color: \"#A0A0A0\" },\r\n+  signupPrompt: { textAlign: \"center\", fontSize: 14, color: \"#414141\" },\r\n+  signupLink: { color: \"#5089A3\", fontWeight: \"600\" },\r\n+});\r\n"
                },
                {
                    "date": 1760960777092,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,11 +11,10 @@\n   Keyboard\r\n } from \"react-native\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n-import {API_BASE_URL} from \"../../config\";\r\n-import AsyncStorage from '@react-native-async-storage/async-storage';\r\n-import { saveAuth } from \"../utils/authStorage\";\r\n+import { API_BASE_URL } from \"../../config\";\r\n+import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -23,64 +22,32 @@\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n \r\n-  // async function wakeBackend(BASE: string) {\r\n-  //   const healthUrl = `${BASE}/health`;\r\n-  //   const warmUrl   = `${BASE}/warmup`;\r\n-\r\n-  //   // Try health quickly a few times\r\n-  //   for (let i = 0; i < 5; i++) {\r\n-  //     try {\r\n-  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-  //       if (r.ok) return true;\r\n-  //     } catch {}\r\n-  //     await new Promise(r => setTimeout(r, 1000));\r\n-  //   }\r\n-\r\n-  //   // Kick warmup and poll until ready (cap ~60s)\r\n-  //   await fetch(warmUrl).catch(()=>{});\r\n-  //   const started = Date.now();\r\n-  //   while (Date.now() - started < 60000) {\r\n-  //     try {\r\n-  //       const r = await fetch(healthUrl, { cache: 'no-store' });\r\n-  //       if (r.ok) return true;\r\n-  //     } catch {}\r\n-  //     await new Promise(r => setTimeout(r, 1500));\r\n-  //   }\r\n-  //   return false; // still starting, but don‚Äôt block forever\r\n-  // }\r\n-\r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n \r\n-    // simple timing helper\r\n-    const t0 = Date.now();\r\n-    const lap = (label: string) => console.log(`[login] +${(Date.now() - t0)}ms ${label}`);\r\n-\r\n     try {\r\n       console.time(\"login\");\r\n       console.log(\"[login] start fetch\");\r\n \r\n-      // NEW: wake first\r\n-      // await wakeBackend(API_BASE_URL);\r\n+      // NOTE: removed wakeBackend for simplicity/reliability on prod builds\r\n \r\n       const controller = new AbortController();\r\n-      const to = setTimeout(()=>controller.abort(), 20000); // 20s cap\r\n+      const to = setTimeout(() => controller.abort(), 20000); // 20s cap\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n         signal: controller.signal,\r\n       });\r\n       clearTimeout(to);\r\n \r\n-      // parse JSON directly (faster than text()+JSON.parse)\r\n+      // Try to parse JSON\r\n       let data: any;\r\n       try {\r\n         data = await response.json();\r\n       } catch (e) {\r\n-        // fallback to read body for debugging\r\n         const body = await response.text();\r\n         console.log(\"[login] non-JSON body:\", body.slice(0, 400));\r\n         throw new Error(\"Invalid server response: not JSON\");\r\n       }\r\n@@ -88,44 +55,36 @@\n       if (!response.ok) {\r\n         throw new Error(data?.error || \"Invalid credentials\");\r\n       }\r\n \r\n-      // accept multiple shapes\r\n+      // Accept multiple shapes\r\n       const passengerId =\r\n         data?.userId ||\r\n         data?.passenger?._id ||\r\n         data?.user?._id ||\r\n         data?._id;\r\n \r\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n-      // save auth\r\n-      // === DEBUG GUARDS START ===\r\n-      console.log(\"GUARD saveAuth:\", typeof saveAuth);\r\n-      console.log(\"GUARD AsyncStorage.setItem:\", typeof AsyncStorage?.setItem);\r\n-      console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n-      // === DEBUG GUARDS END ===\r\n-      console.log(\"STEP A: calling saveAuth\");\r\n-      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token }); \r\n-      console.log(\"STEP B: calling AsyncStorage.setItem\");\r\n-      await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n+      // ‚úÖ Persist minimal auth WITHOUT saveAuth\r\n+      await AsyncStorage.multiSet([\r\n+        [\"role\", \"passenger\"],\r\n+        [\"userId\", String(passengerId)],   // for useAuth\r\n+        [\"passengerId\", String(passengerId)], // for legacy reads\r\n+        [\"token\", data?.token || \"\"],\r\n+      ]);\r\n \r\n-      console.log(\"STEP C: showing success alert\");\r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-      \r\n-      console.log(\"STEP D: navigating to home\");\r\n       router.replace(\"/homepassenger/phome\");\r\n     } catch (error: any) {\r\n       if (error?.name === \"AbortError\") {\r\n-        console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n+        console.log(\"[login] fetch aborted (backend slow or cold start?)\");\r\n       }\r\n       console.error(\"Login error (passenger):\", error);\r\n       Alert.alert(\"Login Failed\", error?.message || \"Network/server error\");\r\n     }\r\n   };\r\n \r\n-\r\n-\r\n   return (\r\n     <View style={styles.container}>\r\n       <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n       <View style={styles.inner}>\r\n@@ -141,8 +100,9 @@\n             placeholder=\"Email or Phone\"\r\n             placeholderTextColor=\"#A0A0A0\"\r\n             value={email}\r\n             onChangeText={setEmail}\r\n+            autoCapitalize=\"none\"\r\n           />\r\n         </View>\r\n \r\n         <View style={styles.inputContainer}>\r\n@@ -171,11 +131,11 @@\n           <Text style={styles.signInText}>Sign In</Text>\r\n         </TouchableOpacity>\r\n \r\n         <View style={styles.divider}>\r\n-          <View style={styles.line} />\r\n+          <View className=\"line\" style={styles.line} />\r\n           <Text style={styles.orText}>or</Text>\r\n-          <View style={styles.line} />\r\n+          <View className=\"line\" style={styles.line} />\r\n         </View>\r\n \r\n         <Text style={styles.signupPrompt}>\r\n           Don't have an account?{\" \"}\r\n"
                },
                {
                    "date": 1760970638467,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -64,16 +64,16 @@\n         data?._id;\r\n \r\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n-      // ‚úÖ Persist minimal auth WITHOUT saveAuth\r\n-      await AsyncStorage.multiSet([\r\n-        [\"role\", \"passenger\"],\r\n-        [\"userId\", String(passengerId)],   // for useAuth\r\n-        [\"passengerId\", String(passengerId)], // for legacy reads\r\n-        [\"token\", data?.token || \"\"],\r\n+      await Promise.all([\r\n+        AsyncStorage.setItem(\"role\", \"passenger\"),\r\n+        AsyncStorage.setItem(\"userId\", String(passengerId)),\r\n+        AsyncStorage.setItem(\"passengerId\", String(passengerId)),\r\n+        AsyncStorage.setItem(\"token\", data?.token || \"\"),\r\n       ]);\r\n \r\n+\r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n       router.replace(\"/homepassenger/phome\");\r\n     } catch (error: any) {\r\n       if (error?.name === \"AbortError\") {\r\n"
                },
                {
                    "date": 1760970779445,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -71,9 +71,10 @@\n         AsyncStorage.setItem(\"passengerId\", String(passengerId)),\r\n         AsyncStorage.setItem(\"token\", data?.token || \"\"),\r\n       ]);\r\n \r\n-\r\n+      console.log(\"GUARD setItem:\", typeof AsyncStorage?.setItem);\r\n+      console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n       router.replace(\"/homepassenger/phome\");\r\n     } catch (error: any) {\r\n       if (error?.name === \"AbortError\") {\r\n"
                },
                {
                    "date": 1760976569951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,10 +26,8 @@\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n \r\n     try {\r\n-      console.time(\"login\");\r\n-      console.log(\"[login] start fetch\");\r\n \r\n       // NOTE: removed wakeBackend for simplicity/reliability on prod builds\r\n \r\n       const controller = new AbortController();\r\n"
                },
                {
                    "date": 1760976669268,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,18 +28,13 @@\n \r\n     try {\r\n \r\n       // NOTE: removed wakeBackend for simplicity/reliability on prod builds\r\n-\r\n-      const controller = new AbortController();\r\n-      const to = setTimeout(() => controller.abort(), 20000); // 20s cap\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n-        signal: controller.signal,\r\n       });\r\n-      clearTimeout(to);\r\n \r\n       // Try to parse JSON\r\n       let data: any;\r\n       try {\r\n"
                },
                {
                    "date": 1760983746797,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,196 @@\n+import React, { useState } from \"react\";\r\n+import {\r\n+  View,\r\n+  Text,\r\n+  TouchableOpacity,\r\n+  StyleSheet,\r\n+  Dimensions,\r\n+  TextInput,\r\n+  StatusBar,\r\n+  Alert,\r\n+  Keyboard\r\n+} from \"react-native\";\r\n+import { MaterialIcons } from \"@expo/vector-icons\";\r\n+import { useRouter } from \"expo-router\";\r\n+import {API_BASE_URL} from \"../../config\";\r\n+import AsyncStorage from '@react-native-async-storage/async-storage';\r\n+import { saveAuth } from \"../utils/authStorage\";\r\n+\r\n+const { width } = Dimensions.get(\"window\");\r\n+\r\n+export default function PLogin() {\r\n+  const [email, setEmail] = useState(\"\");\r\n+  const [pass, setPass] = useState(\"\");\r\n+  const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n+  const router = useRouter();\r\n+\r\n+  async function wakeBackend(BASE: string) {\r\n+    const healthUrl = `${BASE}/health`;\r\n+    const warmUrl   = `${BASE}/warmup`;\r\n+\r\n+    // Try health quickly a few times\r\n+    for (let i = 0; i < 5; i++) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise(r => setTimeout(r, 1000));\r\n+    }\r\n+\r\n+    // Kick warmup and poll until ready (cap ~60s)\r\n+    await fetch(warmUrl).catch(()=>{});\r\n+    const started = Date.now();\r\n+    while (Date.now() - started < 60000) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise(r => setTimeout(r, 1500));\r\n+    }\r\n+    return false; // still starting, but don‚Äôt block forever\r\n+  }\r\n+  wakeBackend(API_BASE_URL);\r\n+\r\n+  const loginUser = async () => {\r\n+    Keyboard.dismiss();\r\n+\r\n+    try {\r\n+      const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n+        method: \"POST\",\r\n+        headers: { \"Content-Type\": \"application/json\" },\r\n+        body: JSON.stringify({ email, password: pass }),\r\n+      });\r\n+\r\n+      // parse JSON directly (faster than text()+JSON.parse)\r\n+      let data: any;\r\n+      try {\r\n+        data = await response.json();\r\n+      } catch (e) {\r\n+        throw new Error(\"Invalid server response: not JSON\");\r\n+      }\r\n+\r\n+      if (!response.ok) {\r\n+        throw new Error(data?.error || \"Invalid credentials\");\r\n+      }\r\n+\r\n+      // accept multiple shapes\r\n+      const passengerId =\r\n+        data?.userId ||\r\n+        data?.passenger?._id ||\r\n+        data?.user?._id ||\r\n+        data?._id;\r\n+\r\n+      if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n+\r\n+      // save auth\r\n+      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n+      await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n+\r\n+      Alert.alert(\"Login Successful\", \"Welcome!\");\r\n+      router.replace(\"../homepassenger/phome\");\r\n+    } catch (error: any) {\r\n+      if (error?.name === \"AbortError\") {\r\n+        console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n+      }\r\n+      console.error(\"Login error (passenger):\", error);\r\n+      Alert.alert(\"Login Failed\", error?.message || \"Network/server error\");\r\n+    }\r\n+  };\r\n+\r\n+\r\n+\r\n+  return (\r\n+    <View style={styles.container}>\r\n+      <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n+      <View style={styles.inner}>\r\n+        <TouchableOpacity onPress={() => router.push(\"../location/welcome\")}>\r\n+          <Text style={styles.back}>Back</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <Text style={styles.title}>Sign in with your email or phone</Text>\r\n+\r\n+        <View style={styles.inputContainer}>\r\n+          <TextInput\r\n+            style={styles.input}\r\n+            placeholder=\"Email or Phone\"\r\n+            placeholderTextColor=\"#A0A0A0\"\r\n+            value={email}\r\n+            onChangeText={setEmail}\r\n+          />\r\n+        </View>\r\n+\r\n+        <View style={styles.inputContainer}>\r\n+          <TextInput\r\n+            style={styles.input}\r\n+            placeholder=\"Enter Your Password\"\r\n+            placeholderTextColor=\"#A0A0A0\"\r\n+            secureTextEntry={!isPasswordVisible}\r\n+            value={pass}\r\n+            onChangeText={setPass}\r\n+          />\r\n+          <TouchableOpacity onPress={() => setIsPasswordVisible(prev => !prev)}>\r\n+            <MaterialIcons\r\n+              name={isPasswordVisible ? \"visibility\" : \"visibility-off\"}\r\n+              size={20}\r\n+              color=\"#A0A0A0\"\r\n+            />\r\n+          </TouchableOpacity>\r\n+        </View>\r\n+\r\n+        <TouchableOpacity style={styles.forgot}>\r\n+          <Text style={styles.forgotText}>Forget password?</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <TouchableOpacity style={styles.signInBtn} onPress={loginUser}>\r\n+          <Text style={styles.signInText}>Sign In</Text>\r\n+        </TouchableOpacity>\r\n+\r\n+        <View style={styles.divider}>\r\n+          <View style={styles.line} />\r\n+          <Text style={styles.orText}>or</Text>\r\n+          <View style={styles.line} />\r\n+        </View>\r\n+\r\n+        <Text style={styles.signupPrompt}>\r\n+          Don't have an account?{\" \"}\r\n+          <Text style={styles.signupLink} onPress={() => router.push(\"/login_and_reg/pregister\")}>\r\n+            Sign Up\r\n+          </Text>\r\n+        </Text>\r\n+      </View>\r\n+    </View>\r\n+  );\r\n+}\r\n+\r\n+const styles = StyleSheet.create({\r\n+  container: { flex: 1, backgroundColor: \"#fff\", alignItems: \"center\" },\r\n+  inner: { width: width * 0.85, paddingTop: 60 },\r\n+  back: { fontSize: 16, color: \"#414141\", marginBottom: 20 },\r\n+  title: { fontSize: 20, color: \"#414141\", fontWeight: \"600\", marginBottom: 30 },\r\n+  inputContainer: {\r\n+    flexDirection: \"row\",\r\n+    alignItems: \"center\",\r\n+    borderWidth: 1,\r\n+    borderColor: \"#D1D1D1\",\r\n+    borderRadius: 8,\r\n+    paddingHorizontal: 10,\r\n+    height: 48,\r\n+    marginBottom: 15,\r\n+  },\r\n+  input: { flex: 1, fontSize: 16, color: \"#414141\" },\r\n+  forgot: { alignSelf: \"flex-end\", marginBottom: 30 },\r\n+  forgotText: { color: \"#DD1F1F\", fontSize: 13 },\r\n+  signInBtn: {\r\n+    backgroundColor: \"#5089A3\",\r\n+    borderRadius: 8,\r\n+    paddingVertical: 14,\r\n+    alignItems: \"center\",\r\n+    marginBottom: 25,\r\n+  },\r\n+  signInText: { color: \"#fff\", fontSize: 16, fontWeight: \"bold\" },\r\n+  divider: { flexDirection: \"row\", alignItems: \"center\", marginBottom: 25 },\r\n+  line: { flex: 1, height: 1, backgroundColor: \"#D1D1D1\" },\r\n+  orText: { marginHorizontal: 10, color: \"#A0A0A0\" },\r\n+  signupPrompt: { textAlign: \"center\", fontSize: 14, color: \"#414141\" },\r\n+  signupLink: { color: \"#5089A3\", fontWeight: \"600\" },\r\n+});\r\n"
                },
                {
                    "date": 1760983768388,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,9 +52,8 @@\n   wakeBackend(API_BASE_URL);\r\n \r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n-\r\n     try {\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n@@ -193,180 +192,4 @@\n   orText: { marginHorizontal: 10, color: \"#A0A0A0\" },\r\n   signupPrompt: { textAlign: \"center\", fontSize: 14, color: \"#414141\" },\r\n   signupLink: { color: \"#5089A3\", fontWeight: \"600\" },\r\n });\r\n-import React, { useState } from \"react\";\r\n-import {\r\n-  View,\r\n-  Text,\r\n-  TouchableOpacity,\r\n-  StyleSheet,\r\n-  Dimensions,\r\n-  TextInput,\r\n-  StatusBar,\r\n-  Alert,\r\n-  Keyboard\r\n-} from \"react-native\";\r\n-import { MaterialIcons } from \"@expo/vector-icons\";\r\n-import { useRouter } from \"expo-router\";\r\n-import { API_BASE_URL } from \"../../config\";\r\n-import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n-\r\n-const { width } = Dimensions.get(\"window\");\r\n-\r\n-export default function PLogin() {\r\n-  const [email, setEmail] = useState(\"\");\r\n-  const [pass, setPass] = useState(\"\");\r\n-  const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n-  const router = useRouter();\r\n-\r\n-  const loginUser = async () => {\r\n-    Keyboard.dismiss();\r\n-\r\n-    try {\r\n-\r\n-      // NOTE: removed wakeBackend for simplicity/reliability on prod builds\r\n-      const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n-        method: \"POST\",\r\n-        headers: { \"Content-Type\": \"application/json\" },\r\n-        body: JSON.stringify({ email, password: pass }),\r\n-      });\r\n-\r\n-      // Try to parse JSON\r\n-      let data: any;\r\n-      try {\r\n-        data = await response.json();\r\n-      } catch (e) {\r\n-        const body = await response.text();\r\n-        console.log(\"[login] non-JSON body:\", body.slice(0, 400));\r\n-        throw new Error(\"Invalid server response: not JSON\");\r\n-      }\r\n-\r\n-      if (!response.ok) {\r\n-        throw new Error(data?.error || \"Invalid credentials\");\r\n-      }\r\n-\r\n-      // Accept multiple shapes\r\n-      const passengerId =\r\n-        data?.userId ||\r\n-        data?.passenger?._id ||\r\n-        data?.user?._id ||\r\n-        data?._id;\r\n-\r\n-      if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n-\r\n-      await Promise.all([\r\n-        AsyncStorage.setItem(\"role\", \"passenger\"),\r\n-        AsyncStorage.setItem(\"userId\", String(passengerId)),\r\n-        AsyncStorage.setItem(\"passengerId\", String(passengerId)),\r\n-        AsyncStorage.setItem(\"token\", data?.token || \"\"),\r\n-      ]);\r\n-\r\n-      console.log(\"GUARD setItem:\", typeof AsyncStorage?.setItem);\r\n-      console.log(\"GUARD router.replace:\", typeof router?.replace);\r\n-      Alert.alert(\"Login Successful\", \"Welcome!\");\r\n-      router.replace(\"/homepassenger/phome\");\r\n-    } catch (error: any) {\r\n-      if (error?.name === \"AbortError\") {\r\n-        console.log(\"[login] fetch aborted (backend slow or cold start?)\");\r\n-      }\r\n-      console.error(\"Login error (passenger):\", error);\r\n-      Alert.alert(\"Login Failed\", error?.message || \"Network/server error\");\r\n-    }\r\n-  };\r\n-\r\n-  return (\r\n-    <View style={styles.container}>\r\n-      <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n-      <View style={styles.inner}>\r\n-        <TouchableOpacity onPress={() => router.push(\"../location/welcome\")}>\r\n-          <Text style={styles.back}>Back</Text>\r\n-        </TouchableOpacity>\r\n-\r\n-        <Text style={styles.title}>Sign in with your email or phone</Text>\r\n-\r\n-        <View style={styles.inputContainer}>\r\n-          <TextInput\r\n-            style={styles.input}\r\n-            placeholder=\"Email or Phone\"\r\n-            placeholderTextColor=\"#A0A0A0\"\r\n-            value={email}\r\n-            onChangeText={setEmail}\r\n-            autoCapitalize=\"none\"\r\n-          />\r\n-        </View>\r\n-\r\n-        <View style={styles.inputContainer}>\r\n-          <TextInput\r\n-            style={styles.input}\r\n-            placeholder=\"Enter Your Password\"\r\n-            placeholderTextColor=\"#A0A0A0\"\r\n-            secureTextEntry={!isPasswordVisible}\r\n-            value={pass}\r\n-            onChangeText={setPass}\r\n-          />\r\n-          <TouchableOpacity onPress={() => setIsPasswordVisible(prev => !prev)}>\r\n-            <MaterialIcons\r\n-              name={isPasswordVisible ? \"visibility\" : \"visibility-off\"}\r\n-              size={20}\r\n-              color=\"#A0A0A0\"\r\n-            />\r\n-          </TouchableOpacity>\r\n-        </View>\r\n-\r\n-        <TouchableOpacity style={styles.forgot}>\r\n-          <Text style={styles.forgotText}>Forget password?</Text>\r\n-        </TouchableOpacity>\r\n-\r\n-        <TouchableOpacity style={styles.signInBtn} onPress={loginUser}>\r\n-          <Text style={styles.signInText}>Sign In</Text>\r\n-        </TouchableOpacity>\r\n-\r\n-        <View style={styles.divider}>\r\n-          <View className=\"line\" style={styles.line} />\r\n-          <Text style={styles.orText}>or</Text>\r\n-          <View className=\"line\" style={styles.line} />\r\n-        </View>\r\n-\r\n-        <Text style={styles.signupPrompt}>\r\n-          Don't have an account?{\" \"}\r\n-          <Text style={styles.signupLink} onPress={() => router.push(\"/login_and_reg/pregister\")}>\r\n-            Sign Up\r\n-          </Text>\r\n-        </Text>\r\n-      </View>\r\n-    </View>\r\n-  );\r\n-}\r\n-\r\n-const styles = StyleSheet.create({\r\n-  container: { flex: 1, backgroundColor: \"#fff\", alignItems: \"center\" },\r\n-  inner: { width: width * 0.85, paddingTop: 60 },\r\n-  back: { fontSize: 16, color: \"#414141\", marginBottom: 20 },\r\n-  title: { fontSize: 20, color: \"#414141\", fontWeight: \"600\", marginBottom: 30 },\r\n-  inputContainer: {\r\n-    flexDirection: \"row\",\r\n-    alignItems: \"center\",\r\n-    borderWidth: 1,\r\n-    borderColor: \"#D1D1D1\",\r\n-    borderRadius: 8,\r\n-    paddingHorizontal: 10,\r\n-    height: 48,\r\n-    marginBottom: 15,\r\n-  },\r\n-  input: { flex: 1, fontSize: 16, color: \"#414141\" },\r\n-  forgot: { alignSelf: \"flex-end\", marginBottom: 30 },\r\n-  forgotText: { color: \"#DD1F1F\", fontSize: 13 },\r\n-  signInBtn: {\r\n-    backgroundColor: \"#5089A3\",\r\n-    borderRadius: 8,\r\n-    paddingVertical: 14,\r\n-    alignItems: \"center\",\r\n-    marginBottom: 25,\r\n-  },\r\n-  signInText: { color: \"#fff\", fontSize: 16, fontWeight: \"bold\" },\r\n-  divider: { flexDirection: \"row\", alignItems: \"center\", marginBottom: 25 },\r\n-  line: { flex: 1, height: 1, backgroundColor: \"#D1D1D1\" },\r\n-  orText: { marginHorizontal: 10, color: \"#A0A0A0\" },\r\n-  signupPrompt: { textAlign: \"center\", fontSize: 14, color: \"#414141\" },\r\n-  signupLink: { color: \"#5089A3\", fontWeight: \"600\" },\r\n-});\r\n"
                },
                {
                    "date": 1760983832660,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,9 +13,8 @@\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n import {API_BASE_URL} from \"../../config\";\r\n import AsyncStorage from '@react-native-async-storage/async-storage';\r\n-import { saveAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n@@ -81,9 +80,8 @@\n \r\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n       // save auth\r\n-      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n \r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n       router.replace(\"../homepassenger/phome\");\r\n"
                },
                {
                    "date": 1760984040430,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import React, { useState } from \"react\";\r\n+import React, { useState, useEffect} from \"react\";\r\n import {\r\n   View,\r\n   Text,\r\n   TouchableOpacity,\r\n@@ -21,9 +21,19 @@\n   const [email, setEmail] = useState(\"\");\r\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n+  const warmedRef = { current: false };\r\n \r\n+  useEffect(() => {\r\n+    if (warmedRef.current) return;\r\n+    warmedRef.current = true;\r\n+    (async () => {\r\n+      try { await wakeBackend(API_BASE_URL); } catch {}\r\n+    })();\r\n+  }, []);\r\n+\r\n+\r\n   async function wakeBackend(BASE: string) {\r\n     const healthUrl = `${BASE}/health`;\r\n     const warmUrl   = `${BASE}/warmup`;\r\n \r\n"
                },
                {
                    "date": 1760984405728,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-import React, { useState, useEffect} from \"react\";\r\n+import React, { useState } from \"react\";\r\n import {\r\n   View,\r\n   Text,\r\n   TouchableOpacity,\r\n@@ -13,27 +13,18 @@\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n import {API_BASE_URL} from \"../../config\";\r\n import AsyncStorage from '@react-native-async-storage/async-storage';\r\n+import { saveAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n   const [email, setEmail] = useState(\"\");\r\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n-  const warmedRef = { current: false };\r\n \r\n-  useEffect(() => {\r\n-    if (warmedRef.current) return;\r\n-    warmedRef.current = true;\r\n-    (async () => {\r\n-      try { await wakeBackend(API_BASE_URL); } catch {}\r\n-    })();\r\n-  }, []);\r\n-\r\n-\r\n   async function wakeBackend(BASE: string) {\r\n     const healthUrl = `${BASE}/health`;\r\n     const warmUrl   = `${BASE}/warmup`;\r\n \r\n@@ -57,13 +48,15 @@\n       await new Promise(r => setTimeout(r, 1500));\r\n     }\r\n     return false; // still starting, but don‚Äôt block forever\r\n   }\r\n-  wakeBackend(API_BASE_URL);\r\n \r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n+\r\n     try {\r\n+      // NEW: wake first\r\n+      await wakeBackend(API_BASE_URL);\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n@@ -90,8 +83,9 @@\n \r\n       if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n       // save auth\r\n+      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n \r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n       router.replace(\"../homepassenger/phome\");\r\n"
                },
                {
                    "date": 1760985120726,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,9 @@\n         if (r.ok) return true;\r\n       } catch {}\r\n       await new Promise(r => setTimeout(r, 1500));\r\n     }\r\n-    return false; // still starting, but don‚Äôt block forever\r\n+    return false; \r\n   }\r\n \r\n   const loginUser = async () => {\r\n     Keyboard.dismiss();\r\n"
                },
                {
                    "date": 1760986348223,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,9 +54,9 @@\n     Keyboard.dismiss();\r\n \r\n     try {\r\n       // NEW: wake first\r\n-      await wakeBackend(API_BASE_URL);\r\n+      if (__DEV__) {await wakeBackend(API_BASE_URL)};\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n"
                },
                {
                    "date": 1760986445608,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,9 @@\n   const [email, setEmail] = useState(\"\");\r\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n+  const [busy, setBusy] = useState(false);\r\n \r\n   async function wakeBackend(BASE: string) {\r\n     const healthUrl = `${BASE}/health`;\r\n     const warmUrl   = `${BASE}/warmup`;\r\n"
                },
                {
                    "date": 1760986544094,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,8 @@\n   const [email, setEmail] = useState(\"\");\r\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const router = useRouter();\r\n-  const [busy, setBusy] = useState(false);\r\n \r\n   async function wakeBackend(BASE: string) {\r\n     const healthUrl = `${BASE}/health`;\r\n     const warmUrl   = `${BASE}/warmup`;\r\n"
                },
                {
                    "date": 1760986927888,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,106 +1,104 @@\n import React, { useState } from \"react\";\r\n import {\r\n-  View,\r\n-  Text,\r\n-  TouchableOpacity,\r\n-  StyleSheet,\r\n-  Dimensions,\r\n-  TextInput,\r\n-  StatusBar,\r\n-  Alert,\r\n-  Keyboard\r\n+  View, Text, TouchableOpacity, StyleSheet, Dimensions,\r\n+  TextInput, StatusBar, Alert, Keyboard\r\n } from \"react-native\";\r\n import { MaterialIcons } from \"@expo/vector-icons\";\r\n import { useRouter } from \"expo-router\";\r\n-import {API_BASE_URL} from \"../../config\";\r\n-import AsyncStorage from '@react-native-async-storage/async-storage';\r\n+import { API_BASE_URL } from \"../../config\";\r\n+import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n import { saveAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n export default function PLogin() {\r\n   const [email, setEmail] = useState(\"\");\r\n   const [pass, setPass] = useState(\"\");\r\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n+  const [busy, setBusy] = useState(false); // (4) prevent double taps\r\n   const router = useRouter();\r\n \r\n   async function wakeBackend(BASE: string) {\r\n     const healthUrl = `${BASE}/health`;\r\n-    const warmUrl   = `${BASE}/warmup`;\r\n+    const warmUrl = `${BASE}/warmup`;\r\n \r\n-    // Try health quickly a few times\r\n     for (let i = 0; i < 5; i++) {\r\n       try {\r\n-        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n         if (r.ok) return true;\r\n       } catch {}\r\n-      await new Promise(r => setTimeout(r, 1000));\r\n+      await new Promise((r) => setTimeout(r, 1000));\r\n     }\r\n \r\n-    // Kick warmup and poll until ready (cap ~60s)\r\n-    await fetch(warmUrl).catch(()=>{});\r\n+    await fetch(warmUrl).catch(() => {});\r\n     const started = Date.now();\r\n     while (Date.now() - started < 60000) {\r\n       try {\r\n-        const r = await fetch(healthUrl, { cache: 'no-store' });\r\n+        const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n         if (r.ok) return true;\r\n       } catch {}\r\n-      await new Promise(r => setTimeout(r, 1500));\r\n+      await new Promise((r) => setTimeout(r, 1500));\r\n     }\r\n-    return false; \r\n+    return false;\r\n   }\r\n \r\n   const loginUser = async () => {\r\n+    if (busy) return;            // (4) bail if already logging in\r\n+    setBusy(true);               // (4) lock the button\r\n+\r\n     Keyboard.dismiss();\r\n \r\n     try {\r\n-      // NEW: wake first\r\n-      if (__DEV__) {await wakeBackend(API_BASE_URL)};\r\n+      if (__DEV__) { await wakeBackend(API_BASE_URL); }\r\n+\r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({ email, password: pass }),\r\n       });\r\n \r\n-      // parse JSON directly (faster than text()+JSON.parse)\r\n-      let data: any;\r\n+      // (5) defensive JSON parsing\r\n+      const text = await response.text();\r\n+      let data: any = null;\r\n       try {\r\n-        data = await response.json();\r\n-      } catch (e) {\r\n-        throw new Error(\"Invalid server response: not JSON\");\r\n+        data = text ? JSON.parse(text) : null;\r\n+      } catch {\r\n+        console.log(\"[plogin] non-JSON body (first 200):\", text.slice(0, 200));\r\n       }\r\n \r\n       if (!response.ok) {\r\n-        throw new Error(data?.error || \"Invalid credentials\");\r\n+        throw new Error(\r\n+          data?.error || data?.message || `HTTP ${response.status}`\r\n+        );\r\n       }\r\n \r\n-      // accept multiple shapes\r\n       const passengerId =\r\n-        data?.userId ||\r\n-        data?.passenger?._id ||\r\n-        data?.user?._id ||\r\n-        data?._id;\r\n+        data?.userId || data?.passenger?._id || data?.user?._id || data?._id;\r\n \r\n-      if (!passengerId) throw new Error(\"Login succeeded but no passengerId returned\");\r\n+      if (!passengerId)\r\n+        throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n-      // save auth\r\n-      await saveAuth({ role: \"passenger\", userId: String(passengerId), token: data?.token });\r\n+      await saveAuth({\r\n+        role: \"passenger\",\r\n+        userId: String(passengerId),\r\n+        token: data?.token,\r\n+      });\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n \r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n       router.replace(\"../homepassenger/phome\");\r\n     } catch (error: any) {\r\n       if (error?.name === \"AbortError\") {\r\n-        console.log(\"[login] fetch aborted after 10s (backend slow or cold start?)\");\r\n+        console.log(\"[login] fetch aborted (backend slow or cold start?)\");\r\n       }\r\n-      console.error(\"Login error (passenger):\", error);\r\n+      console.error(\"Login error (passenger):\", error, error?.stack);\r\n       Alert.alert(\"Login Failed\", error?.message || \"Network/server error\");\r\n+    } finally {\r\n+      setBusy(false);            // (4) unlock the button\r\n     }\r\n   };\r\n \r\n-\r\n-\r\n   return (\r\n     <View style={styles.container}>\r\n       <StatusBar barStyle=\"dark-content\" translucent backgroundColor=\"transparent\" />\r\n       <View style={styles.inner}>\r\n@@ -137,25 +135,28 @@\n             />\r\n           </TouchableOpacity>\r\n         </View>\r\n \r\n-        <TouchableOpacity style={styles.forgot}>\r\n-          <Text style={styles.forgotText}>Forget password?</Text>\r\n+        <TouchableOpacity\r\n+          style={[styles.signInBtn, busy && styles.signInBtnDisabled]} // (4) visual + disabled\r\n+          onPress={loginUser}\r\n+          disabled={busy}\r\n+        >\r\n+          <Text style={styles.signInText}>{busy ? \"Signing in...\" : \"Sign In\"}</Text>\r\n         </TouchableOpacity>\r\n \r\n-        <TouchableOpacity style={styles.signInBtn} onPress={loginUser}>\r\n-          <Text style={styles.signInText}>Sign In</Text>\r\n-        </TouchableOpacity>\r\n-\r\n-        <View style={styles.divider}>\r\n+        <View className=\"divider\" style={styles.divider}>\r\n           <View style={styles.line} />\r\n           <Text style={styles.orText}>or</Text>\r\n           <View style={styles.line} />\r\n         </View>\r\n \r\n         <Text style={styles.signupPrompt}>\r\n           Don't have an account?{\" \"}\r\n-          <Text style={styles.signupLink} onPress={() => router.push(\"/login_and_reg/pregister\")}>\r\n+          <Text\r\n+            style={styles.signupLink}\r\n+            onPress={() => router.push(\"/login_and_reg/pregister\")}\r\n+          >\r\n             Sign Up\r\n           </Text>\r\n         </Text>\r\n       </View>\r\n@@ -187,8 +188,9 @@\n     paddingVertical: 14,\r\n     alignItems: \"center\",\r\n     marginBottom: 25,\r\n   },\r\n+  signInBtnDisabled: { opacity: 0.6 }, // (4)\r\n   signInText: { color: \"#fff\", fontSize: 16, fontWeight: \"bold\" },\r\n   divider: { flexDirection: \"row\", alignItems: \"center\", marginBottom: 25 },\r\n   line: { flex: 1, height: 1, backgroundColor: \"#D1D1D1\" },\r\n   orText: { marginHorizontal: 10, color: \"#A0A0A0\" },\r\n"
                },
                {
                    "date": 1762379117397,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,31 +17,31 @@\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const [busy, setBusy] = useState(false); // (4) prevent double taps\r\n   const router = useRouter();\r\n \r\n-  async function wakeBackend(BASE: string) {\r\n-    const healthUrl = `${BASE}/health`;\r\n-    const warmUrl = `${BASE}/warmup`;\r\n+  // async function wakeBackend(BASE: string) {\r\n+  //   const healthUrl = `${BASE}/health`;\r\n+  //   const warmUrl = `${BASE}/warmup`;\r\n \r\n-    for (let i = 0; i < 5; i++) {\r\n-      try {\r\n-        const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n-        if (r.ok) return true;\r\n-      } catch {}\r\n-      await new Promise((r) => setTimeout(r, 1000));\r\n-    }\r\n+  //   for (let i = 0; i < 5; i++) {\r\n+  //     try {\r\n+  //       const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n+  //       if (r.ok) return true;\r\n+  //     } catch {}\r\n+  //     await new Promise((r) => setTimeout(r, 1000));\r\n+  //   }\r\n \r\n-    await fetch(warmUrl).catch(() => {});\r\n-    const started = Date.now();\r\n-    while (Date.now() - started < 60000) {\r\n-      try {\r\n-        const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n-        if (r.ok) return true;\r\n-      } catch {}\r\n-      await new Promise((r) => setTimeout(r, 1500));\r\n-    }\r\n-    return false;\r\n-  }\r\n+  //   await fetch(warmUrl).catch(() => {});\r\n+  //   const started = Date.now();\r\n+  //   while (Date.now() - started < 60000) {\r\n+  //     try {\r\n+  //       const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n+  //       if (r.ok) return true;\r\n+  //     } catch {}\r\n+  //     await new Promise((r) => setTimeout(r, 1500));\r\n+  //   }\r\n+  //   return false;\r\n+  // }\r\n \r\n   const loginUser = async () => {\r\n     if (busy) return;            // (4) bail if already logging in\r\n     setBusy(true);               // (4) lock the button\r\n"
                },
                {
                    "date": 1762379125561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,9 +48,9 @@\n \r\n     Keyboard.dismiss();\r\n \r\n     try {\r\n-      if (__DEV__) { await wakeBackend(API_BASE_URL); }\r\n+      // if (__DEV__) { await wakeBackend(API_BASE_URL); }\r\n \r\n       const response = await fetch(`${API_BASE_URL}/api/login/passenger/login`, {\r\n         method: \"POST\",\r\n         headers: { \"Content-Type\": \"application/json\" },\r\n"
                },
                {
                    "date": 1762379171888,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,13 +77,13 @@\n \r\n       if (!passengerId)\r\n         throw new Error(\"Login succeeded but no passengerId returned\");\r\n \r\n-      await saveAuth({\r\n-        role: \"passenger\",\r\n-        userId: String(passengerId),\r\n-        token: data?.token,\r\n-      });\r\n+      // await saveAuth({\r\n+      //   role: \"passenger\",\r\n+      //   userId: String(passengerId),\r\n+      //   token: data?.token,\r\n+      // });\r\n       await AsyncStorage.setItem(\"passengerId\", String(passengerId));\r\n \r\n       Alert.alert(\"Login Successful\", \"Welcome!\");\r\n       router.replace(\"../homepassenger/phome\");\r\n"
                },
                {
                    "date": 1762384105890,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,10 +42,10 @@\n   //   return false;\r\n   // }\r\n \r\n   const loginUser = async () => {\r\n-    if (busy) return;            // (4) bail if already logging in\r\n-    setBusy(true);               // (4) lock the button\r\n+    // if (busy) return;            // (4) bail if already logging in\r\n+    // setBusy(true);               // (4) lock the button\r\n \r\n     Keyboard.dismiss();\r\n \r\n     try {\r\n"
                },
                {
                    "date": 1762384126447,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,10 +42,10 @@\n   //   return false;\r\n   // }\r\n \r\n   const loginUser = async () => {\r\n-    // if (busy) return;            // (4) bail if already logging in\r\n-    // setBusy(true);               // (4) lock the button\r\n+    if (busy) return;            // (4) bail if already logging in\r\n+    setBusy(true);               // (4) lock the button\r\n \r\n     Keyboard.dismiss();\r\n \r\n     try {\r\n"
                },
                {
                    "date": 1762384145955,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,31 +17,31 @@\n   const [isPasswordVisible, setIsPasswordVisible] = useState(false);\r\n   const [busy, setBusy] = useState(false); // (4) prevent double taps\r\n   const router = useRouter();\r\n \r\n-  // async function wakeBackend(BASE: string) {\r\n-  //   const healthUrl = `${BASE}/health`;\r\n-  //   const warmUrl = `${BASE}/warmup`;\r\n+  async function wakeBackend(BASE: string) {\r\n+    const healthUrl = `${BASE}/health`;\r\n+    const warmUrl = `${BASE}/warmup`;\r\n \r\n-  //   for (let i = 0; i < 5; i++) {\r\n-  //     try {\r\n-  //       const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n-  //       if (r.ok) return true;\r\n-  //     } catch {}\r\n-  //     await new Promise((r) => setTimeout(r, 1000));\r\n-  //   }\r\n+    for (let i = 0; i < 5; i++) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise((r) => setTimeout(r, 1000));\r\n+    }\r\n \r\n-  //   await fetch(warmUrl).catch(() => {});\r\n-  //   const started = Date.now();\r\n-  //   while (Date.now() - started < 60000) {\r\n-  //     try {\r\n-  //       const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n-  //       if (r.ok) return true;\r\n-  //     } catch {}\r\n-  //     await new Promise((r) => setTimeout(r, 1500));\r\n-  //   }\r\n-  //   return false;\r\n-  // }\r\n+    await fetch(warmUrl).catch(() => {});\r\n+    const started = Date.now();\r\n+    while (Date.now() - started < 60000) {\r\n+      try {\r\n+        const r = await fetch(healthUrl, { cache: \"no-store\" });\r\n+        if (r.ok) return true;\r\n+      } catch {}\r\n+      await new Promise((r) => setTimeout(r, 1500));\r\n+    }\r\n+    return false;\r\n+  }\r\n \r\n   const loginUser = async () => {\r\n     if (busy) return;            // (4) bail if already logging in\r\n     setBusy(true);               // (4) lock the button\r\n"
                }
            ],
            "date": 1743947071878,
            "name": "Commit-0",
            "content": "import React, { useState } from \"react\";\r\nimport { View, Text, TouchableOpacity, StyleSheet, Dimensions, TextInput, StatusBar } from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\"; \r\nimport { useRouter } from \"expo-router\";\r\n\r\nconst { width } = Dimensions.get(\"window\");\r\n\r\nexport default function welcome() {\r\n  const [email, setEmail] = useState(\"\"); // Store user email\r\n  const [pass, setPass] = useState(\"\"); // Store user password\r\n  const [isEditing, setIsEditing] = useState(false); \r\n  const router = useRouter();\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={{paddingTop: 40}}>\r\n        <StatusBar barStyle=\"dark-content\" translucent={true} backgroundColor=\"transparent\" />\r\n      </View>\r\n      <View style={styles.content}>\r\n        <TouchableOpacity onPress={() => router.push(\"/location/welcome\")}>\r\n          <Text style={styles.back}>Back</Text>\r\n        </TouchableOpacity>\r\n        <Text style={styles.title}>Sign in with your registered email or phone number</Text>\r\n        <View style={styles.inputContainer}>\r\n          <TextInput\r\n            style={styles.input}\r\n            placeholder=\"Email or Phone Number\"\r\n            placeholderTextColor=\"#A0A0A0\"\r\n            value={email}\r\n            onChangeText={setEmail}\r\n            editable={isEditing}\r\n          />\r\n        </View>\r\n        <View style={styles.inputContainer}>\r\n          <TextInput\r\n            style={styles.input}\r\n            placeholder=\"Enter Your Password\"\r\n            placeholderTextColor=\"#A0A0A0\"\r\n            value={pass}\r\n            onChangeText={setPass}\r\n            editable={isEditing}\r\n          />\r\n          <TouchableOpacity onPress={() => setIsEditing(true)}>\r\n            <MaterialIcons name=\"edit\" size={20} color=\"#5089A3\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: \"white\",\r\n    alignItems: \"center\",\r\n  },\r\n  content: {\r\n    width: width * 0.8,\r\n    alignItems: \"center\",\r\n  },\r\n  back: {\r\n    padding: 10,\r\n    fontSize: 18,\r\n    fontFamily: \"Poppins-Regular\",\r\n    color: \"#414141\",\r\n    letterSpacing: 1,\r\n    marginLeft: -20,\r\n  },\r\n  title: {\r\n    fontSize: 22,\r\n    fontWeight: \"600\",\r\n    color: \"#414141\",\r\n    marginLeft: -20,\r\n  },\r\n  subtitle: {\r\n    fontSize: 16,\r\n    color: \"#A0A0A0\",\r\n    textAlign: \"center\",\r\n    marginTop: 5,\r\n  },\r\n  inputContainer: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    borderWidth: 1,\r\n    borderColor: \"#D1D1D1\",\r\n    borderRadius: 8,\r\n    paddingHorizontal: 10,\r\n    width: \"100%\",\r\n    marginTop: 20,\r\n  },\r\n  input: {\r\n    flex: 1,\r\n    height: 40,\r\n    fontSize: 16,\r\n    color: \"#414141\",\r\n  },\r\n});\r\n"
        }
    ]
}