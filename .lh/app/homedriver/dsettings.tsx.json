{
    "sourceFile": "app/homedriver/dsettings.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 9,
            "patches": [
                {
                    "date": 1762443366698,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762443398456,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -387,9 +387,9 @@\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.profileContainer}>\r\n-        <View style={styles.row}>\r\n+        <View style={{}}>\r\n           <TouchableOpacity onPress={pickSelfieImage}>\r\n             <Image\r\n               key={(selfieUri || \"empty\") + \"\"}     \r\n               source={\r\n"
                },
                {
                    "date": 1762443414374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -387,9 +387,9 @@\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.profileContainer}>\r\n-        <View style={{}}>\r\n+        <View style={{alignContent: \"center\"}}>\r\n           <TouchableOpacity onPress={pickSelfieImage}>\r\n             <Image\r\n               key={(selfieUri || \"empty\") + \"\"}     \r\n               source={\r\n"
                },
                {
                    "date": 1762443424037,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -387,9 +387,9 @@\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.profileContainer}>\r\n-        <View style={{alignContent: \"center\"}}>\r\n+        <View style={{alignContent: \"center\", justifyContent: \"center\"}}>\r\n           <TouchableOpacity onPress={pickSelfieImage}>\r\n             <Image\r\n               key={(selfieUri || \"empty\") + \"\"}     \r\n               source={\r\n"
                },
                {
                    "date": 1762443433574,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -387,9 +387,9 @@\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.profileContainer}>\r\n-        <View style={{alignContent: \"center\", justifyContent: \"center\"}}>\r\n+        <View style={{alignItems: \"center\", justifyContent: \"center\"}}>\r\n           <TouchableOpacity onPress={pickSelfieImage}>\r\n             <Image\r\n               key={(selfieUri || \"empty\") + \"\"}     \r\n               source={\r\n"
                },
                {
                    "date": 1762443459067,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -387,9 +387,9 @@\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.profileContainer}>\r\n-        <View style={{alignItems: \"center\", justifyContent: \"center\"}}>\r\n+        <View style={{width: width ,alignItems: \"center\", justifyContent: \"center\"}}>\r\n           <TouchableOpacity onPress={pickSelfieImage}>\r\n             <Image\r\n               key={(selfieUri || \"empty\") + \"\"}     \r\n               source={\r\n"
                },
                {
                    "date": 1762443483625,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -387,9 +387,9 @@\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.profileContainer}>\r\n-        <View style={{width: width ,alignItems: \"center\", justifyContent: \"center\"}}>\r\n+        <View style={{width: width-20 ,alignItems: \"center\", justifyContent: \"center\"}}>\r\n           <TouchableOpacity onPress={pickSelfieImage}>\r\n             <Image\r\n               key={(selfieUri || \"empty\") + \"\"}     \r\n               source={\r\n"
                },
                {
                    "date": 1762443507112,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -811,9 +811,9 @@\n const styles = StyleSheet.create({\r\n   container: { flex: 1, backgroundColor: \"#fff\" },\r\n   profileContainer: { alignItems: \"center\", paddingTop: 50, flexDirection:\"row\", marginHorizontal:20, justifyContent: \"space-between\"},\r\n   profileImage: { width: 100, height: 100, borderRadius: 50},\r\n-  username: { fontSize: 18, fontWeight: \"bold\", paddingLeft:20 },\r\n+  username: { fontSize: 18, fontWeight: \"bold\" },\r\n   lagout: { fontSize: 14, fontWeight: \"bold\"},\r\n   uploadButton: { backgroundColor: \"#5089A3\", borderRadius: 8, padding: 10, marginTop: 10 },\r\n   accountContainer: { marginTop: 10, paddingHorizontal: 20 },\r\n   sectionTitle: { fontWeight: \"bold\", fontSize: 16, marginVertical: 10 },\r\n"
                },
                {
                    "date": 1762443539179,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -402,9 +402,9 @@\n             />\r\n           </TouchableOpacity>\r\n           <View>\r\n             <Text style={styles.username}>\r\n-              {[profile?.driverFirstName, profile?.driverLastName].filter(Boolean).join(\" \")}\r\n+              {[profile?.driverFirstName, profile?.driverMiddleName, profile?.driverLastName].filter(Boolean).join(\" \")}\r\n             </Text>\r\n             {selfieImage && (\r\n               <TouchableOpacity style={styles.uploadButton} onPress={handleUploadSelfie}>\r\n                 <Text style={{ color: \"#fff\" }}>Upload Profile Pic</Text>\r\n"
                },
                {
                    "date": 1762462171648,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -402,9 +402,9 @@\n             />\r\n           </TouchableOpacity>\r\n           <View>\r\n             <Text style={styles.username}>\r\n-              {[profile?.driverFirstName, profile?.driverMiddleName, profile?.driverLastName].filter(Boolean).join(\" \")}\r\n+              {[profile?.driverFirstName, profile?.driverMiddleName , profile?.driverLastName].filter(Boolean).join(\" \")}\r\n             </Text>\r\n             {selfieImage && (\r\n               <TouchableOpacity style={styles.uploadButton} onPress={handleUploadSelfie}>\r\n                 <Text style={{ color: \"#fff\" }}>Upload Profile Pic</Text>\r\n"
                }
            ],
            "date": 1762443366698,
            "name": "Commit-0",
            "content": "import React, { useState } from \"react\";\r\nimport {\r\n  View, Text, StyleSheet, Dimensions, TouchableOpacity, Image, Alert,\r\n  Platform, ActionSheetIOS, Modal, TextInput, ActivityIndicator, ScrollView\r\n} from \"react-native\";\r\nimport { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\nimport { router } from 'expo-router';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport * as ImagePicker from \"expo-image-picker\";\r\nimport { ImagePickerAsset } from \"expo-image-picker\";\r\nimport { API_BASE_URL } from \"../../config\";\r\nimport { useFocusEffect } from \"@react-navigation/native\";\r\nimport DateTimePicker from \"@react-native-community/datetimepicker\";\r\nimport { clearAuth } from \"../utils/authStorage\";\r\nimport { useNavigation } from \"@react-navigation/native\";\r\n\r\n\r\nconst { width } = Dimensions.get(\"window\");\r\n\r\nconst asFile = (a: ImagePickerAsset | null, fallback = \"photo.jpg\") =>\r\n  a\r\n    ? ({\r\n        uri: a.uri,\r\n        name: (a as any).fileName || fallback,\r\n        type: (a as any).mimeType || \"image/jpeg\",\r\n      } as any)\r\n    : null;\r\n\r\n\r\n// enums (mirror backend)\r\nconst SECTORS = [\"East\", \"West\", \"North\", \"South\", \"Other\"] as const;\r\nconst EXP_YEARS = [\"1-5 taon\", \"6-10 taon\", \"16-20 taon\", \"20 taon pataas\"] as const;\r\n\r\nexport default function DProfile() {\r\n  const navigation = useNavigation<any>();\r\n  const [profile, setProfile] = useState<any>(null);\r\n  const [selfieImage, setProfileImage] = useState<ImagePickerAsset | null>(null);\r\n  const [emailSending, setEmailSending] = useState(false);\r\n\r\n  // Modals state\r\n  const [nameOpen, setNameOpen] = useState(false);\r\n  const [firstNameEdit, setFirstNameEdit] = useState(\"\");\r\n  const [middleNameEdit, setMiddleNameEdit] = useState(\"\");\r\n  const [lastNameEdit, setLastNameEdit] = useState(\"\");\r\n  const [savingName, setSavingName] = useState(false);\r\n\r\n  const [genderOpen, setGenderOpen] = useState(false);\r\n  const [genderChoice, setGenderChoice] = useState<string>(\"\");\r\n  const [genderOther, setGenderOther] = useState(\"\");\r\n  const [savingGender, setSavingGender] = useState(false);\r\n\r\n  const [bdayOpen, setBdayOpen] = useState(false);           // if you don’t already have it\r\n  const [bdayValue, setBdayValue] = useState<Date | null>(null);\r\n  const [savingBday, setSavingBday] = useState(false);\r\n  const [showAndroidBday, setShowAndroidBday] = useState(false);\r\n  const [androidBdayConfirmOpen, setAndroidBdayConfirmOpen] = useState(false);\r\n\r\n  const [phoneOpen, setPhoneOpen] = useState(false);\r\n  const [phoneValue, setPhoneValue] = useState(\"\");\r\n  const [savingPhone, setSavingPhone] = useState(false);\r\n\r\n  const [addrOpen, setAddrOpen] = useState(false);\r\n  const [addrValue, setAddrValue] = useState(\"\");\r\n  const [savingAddr, setSavingAddr] = useState(false);\r\n\r\n  const [vehOpen, setVehOpen] = useState(false);\r\n  const [franchiseValue, setFranchiseValue] = useState(\"\");\r\n  const [todaValue, setTodaValue] = useState(\"\");\r\n  const [sectorValue, setSectorValue] = useState<string>(\"\");\r\n  const [expValue, setExpValue] = useState<string>(\"\");\r\n  const [licenseValue, setLicenseValue] = useState(\"\");\r\n  const [savingVeh, setSavingVeh] = useState(false);\r\n\r\n  const resendDriverEmail = async () => {\r\n    if (!profile?.email) return Alert.alert(\"Error\", \"No email on file.\");\r\n    try {\r\n      setEmailSending(true);\r\n      const r = await fetch(`${API_BASE_URL}/api/auth/driver/resend-verification`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email: profile.email }),\r\n      });\r\n      const j = await r.json();\r\n      if (r.ok) Alert.alert(\"Sent\", j.message || \"Verification email sent. Check your Spam Mail\");\r\n      else Alert.alert(\"Error\", j.message || j.error || \"Failed to send email.\");\r\n    } catch (e:any) {\r\n      Alert.alert(\"Error\", e.message || \"Network error\");\r\n    } finally {\r\n      setEmailSending(false);\r\n    }\r\n  };\r\n\r\n  const fetchProfile = async () => {\r\n    try {\r\n      const driverId = await AsyncStorage.getItem(\"driverId\");\r\n      if (!driverId) return;\r\n\r\n      const res = await fetch(`${API_BASE_URL}/api/driver/${driverId}`, {\r\n        headers: { Accept: \"application/json\" },\r\n      });\r\n      const j = await res.json();\r\n\r\n      if (res.ok && j?.driver) {\r\n        const d = j.driver;\r\n        // normalize selfie field for UI\r\n        setProfile({\r\n          ...d,\r\n          selfieImage: (d.selfieImage || d.selfie || null)?.toString().trim() || null,\r\n        });\r\n      } else {\r\n        console.warn(\"⚠️ fetchProfile not ok:\", j);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"❌ Failed to fetch driver profile:\", e);\r\n    }\r\n  };\r\n\r\n\r\n  useFocusEffect(\r\n    React.useCallback(() => {\r\n      fetchProfile();\r\n    }, [])\r\n  );\r\n\r\n  // ---- Selfie upload (unchanged) ----\r\n  const pickSelfieImage = async () => {\r\n    if (Platform.OS === \"ios\") {\r\n      ActionSheetIOS.showActionSheetWithOptions(\r\n        { options: [\"Take a Photo\", \"Choose from Gallery\", \"Cancel\"], cancelButtonIndex: 2 },\r\n        async (buttonIndex) => {\r\n          if (buttonIndex === 0) {\r\n            const result = await ImagePicker.launchCameraAsync({ mediaTypes: ImagePicker.MediaTypeOptions.Images, allowsEditing: true, quality: 1 });\r\n            if (!result.canceled && result.assets.length > 0) setProfileImage(result.assets[0]);\r\n          } else if (buttonIndex === 1) {\r\n            const result = await ImagePicker.launchImageLibraryAsync({ mediaTypes: ImagePicker.MediaTypeOptions.Images, allowsEditing: true, quality: 1 });\r\n            if (!result.canceled && result.assets.length > 0) setProfileImage(result.assets[0]);\r\n          }\r\n        }\r\n      );\r\n    } else {\r\n      Alert.alert(\"Select Option\", \"\", [\r\n        { text: \"Take a Photo\", onPress: async () => {\r\n          const result = await ImagePicker.launchCameraAsync({ mediaTypes: ImagePicker.MediaTypeOptions.Images, allowsEditing: true, quality: 1 });\r\n          if (!result.canceled && result.assets.length > 0) setProfileImage(result.assets[0]);\r\n        }},\r\n        { text: \"Choose from Gallery\", onPress: async () => {\r\n          const result = await ImagePicker.launchImageLibraryAsync({ mediaTypes: ImagePicker.MediaTypeOptions.Images, allowsEditing: true, quality: 1 });\r\n          if (!result.canceled && result.assets.length > 0) setProfileImage(result.assets[0]);\r\n        }},\r\n        { text: \"Cancel\", style: \"cancel\" },\r\n      ]);\r\n    }\r\n  };\r\n\r\n  const handleUploadSelfie = async () => {\r\n    if (!selfieImage) {\r\n      Alert.alert(\"Error\", \"Please select an image first.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const driverId = await AsyncStorage.getItem(\"driverId\");\r\n      if (!driverId) {\r\n        Alert.alert(\"Error\", \"Missing driver ID.\");\r\n        return;\r\n      }\r\n\r\n      const fd = new FormData();\r\n      const S = asFile(selfieImage, \"selfie.jpg\");\r\n      if (S) fd.append(\"selfie\", S); // backend expects \"selfie\"\r\n\r\n      const res = await fetch(`${API_BASE_URL}/api/driver/${driverId}/photo/selfie`, {\r\n        method: \"POST\",\r\n        headers: { Accept: \"application/json\" }, // let RN set the multipart boundary\r\n        body: fd,\r\n      });\r\n\r\n      const text = await res.text();\r\n      let j: any;\r\n      try { j = JSON.parse(text); } catch { throw new Error(text || \"Non-JSON response\"); }\r\n\r\n      if (!res.ok) throw new Error(j?.error || j?.message || \"Upload failed\");\r\n\r\n      // Update local profile with the returned driver doc (now has new Cloudinary URL)\r\n      setProfile(j.driver);\r\n      setProfileImage(null);\r\n      Alert.alert(\"Success\", \"Profile image updated!\");\r\n    } catch (e: any) {\r\n      console.error(\"❌ Upload error:\", e);\r\n      Alert.alert(\"Error\", e.message || \"Something went wrong. Try again.\");\r\n    }\r\n  };\r\n\r\n\r\n  // ---- Helpers ----\r\n  const fmtDate = (iso?: string) => {\r\n    if (!iso) return null;\r\n    const d = new Date(iso);\r\n    if (Number.isNaN(d.getTime())) return null;\r\n    return d.toLocaleDateString(undefined, { year: \"numeric\", month: \"short\", day: \"2-digit\" });\r\n  };\r\n\r\n  const patchDriver = async (payload: Record<string, any>) => {\r\n    const driverId = await AsyncStorage.getItem(\"driverId\");\r\n    if (!driverId) throw new Error(\"Missing driverId\");\r\n    const res = await fetch(`${API_BASE_URL}/api/driver/${driverId}`, {\r\n      method: \"PATCH\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(payload),\r\n    });\r\n    const j = await res.json();\r\n    if (!res.ok) throw new Error(j?.message || \"Update failed\");\r\n    setProfile(j.driver);\r\n  };\r\n\r\n  // ---- Name modal ----\r\n  const openName = () => {\r\n    setFirstNameEdit(profile?.driverFirstName || \"\");\r\n    setMiddleNameEdit(profile?.driverMiddleName || \"\");\r\n    setLastNameEdit(profile?.driverLastName || \"\");\r\n    setNameOpen(true);\r\n  };\r\n  const saveName = async () => {\r\n    try {\r\n      setSavingName(true);\r\n      await patchDriver({\r\n        driverFirstName: firstNameEdit.trim(),\r\n        driverMiddleName: middleNameEdit.trim(),\r\n        driverLastName: lastNameEdit.trim(),\r\n      });\r\n      setNameOpen(false);\r\n    } catch (e:any) {\r\n      Alert.alert(\"Error\", e.message || \"Failed to save name\");\r\n    } finally {\r\n      setSavingName(false);\r\n    }\r\n  };\r\n  const selfieUri =\r\n    selfieImage?.uri ??\r\n    profile?.selfieImage ??\r\n    profile?.selfie ??\r\n    null;\r\n\r\n  // ---- Gender modal ----\r\n  const openGender = () => {\r\n    const current = profile?.gender || \"\";\r\n    const known = [\"Male\",\"Female\",\"Nonbinary\",\"Prefer not to say\"];\r\n    if (known.includes(current)) {\r\n      setGenderChoice(current);\r\n      setGenderOther(\"\");\r\n    } else if (current) {\r\n      setGenderChoice(\"Other\");\r\n      setGenderOther(current);\r\n    } else {\r\n      setGenderChoice(\"\");\r\n      setGenderOther(\"\");\r\n    }\r\n    setGenderOpen(true);\r\n  };\r\n  const saveGender = async () => {\r\n    const value = genderChoice === \"Other\" ? genderOther.trim() : genderChoice;\r\n    if (!value) return Alert.alert(\"Gender\", \"Please choose an option.\");\r\n    if (genderChoice === \"Other\" && !genderOther.trim()) {\r\n      return Alert.alert(\"Gender\", \"Please enter a custom gender.\");\r\n    }\r\n    try {\r\n      setSavingGender(true);\r\n      await patchDriver({ gender: value });\r\n      setGenderOpen(false);\r\n    } catch (e:any) {\r\n      Alert.alert(\"Error\", e.message || \"Failed to save gender\");\r\n    } finally {\r\n      setSavingGender(false);\r\n    }\r\n  };\r\n\r\n  // ---- Birthday modal / picker ----\r\n  const openBday = () => {\r\n    const d = profile?.driverBirthdate ? new Date(profile.driverBirthdate) : null;\r\n    const initial = d && !Number.isNaN(d.getTime()) ? d : new Date();\r\n    setBdayValue(initial);\r\n\r\n    if (Platform.OS === \"android\") {\r\n      setShowAndroidBday(true);               \r\n    } else {\r\n      setBdayOpen(true);                      \r\n    }\r\n  };\r\n\r\n\r\n  const saveBday = async () => {\r\n    if (!bdayValue) return;\r\n    const yyyy = bdayValue.getFullYear();\r\n    const mm = String(bdayValue.getMonth()+1).padStart(2,\"0\");\r\n    const dd = String(bdayValue.getDate()).padStart(2,\"0\");\r\n    const iso = `${yyyy}-${mm}-${dd}`;\r\n    try {\r\n      setSavingBday(true);\r\n      await patchDriver({ driverBirthdate: iso });\r\n      setBdayOpen(false);\r\n    } catch (e:any) {\r\n      Alert.alert(\"Error\", e.message || \"Failed to save birthday\");\r\n    } finally {\r\n      setSavingBday(false);\r\n    }\r\n  };\r\n\r\n  // ---- Phone ----\r\n  const openPhone = () => {\r\n    setPhoneValue(profile?.driverPhone || \"\");\r\n    setPhoneOpen(true);\r\n  };\r\n  const savePhone = async () => {\r\n    if (!phoneValue.trim()) return Alert.alert(\"Phone\", \"Enter a phone number.\");\r\n    try {\r\n      setSavingPhone(true);\r\n      await patchDriver({ driverPhone: phoneValue.trim() });\r\n      setPhoneOpen(false);\r\n    } catch (e:any) {\r\n      Alert.alert(\"Error\", e.message || \"Failed to save phone\");\r\n    } finally {\r\n      setSavingPhone(false);\r\n    }\r\n  };\r\n\r\n  // ---- Address ----\r\n  const openAddr = () => {\r\n    setAddrValue(profile?.homeAddress || \"\");\r\n    setAddrOpen(true);\r\n  };\r\n  const saveAddr = async () => {\r\n    try {\r\n      setSavingAddr(true);\r\n      await patchDriver({ homeAddress: addrValue.trim() });\r\n      setAddrOpen(false);\r\n    } catch (e:any) {\r\n      Alert.alert(\"Error\", e.message || \"Failed to save address\");\r\n    } finally {\r\n      setSavingAddr(false);\r\n    }\r\n  };\r\n\r\n  // ---- Vehicle block (franchise/toda/sector/experience/licenseId) ----\r\n  const openVeh = () => {\r\n    setFranchiseValue(profile?.franchiseNumber || \"\");\r\n    setTodaValue(profile?.todaName || \"\");\r\n    setSectorValue(profile?.sector || \"\");\r\n    setExpValue(profile?.experienceYears || \"\");\r\n    setLicenseValue(profile?.licenseId || \"\");\r\n    setVehOpen(true);\r\n  };\r\n  const saveVeh = async () => {\r\n    if (sectorValue && !SECTORS.includes(sectorValue as any)) {\r\n      return Alert.alert(\"Sector\", \"Please select a valid sector.\");\r\n    }\r\n    if (expValue && !EXP_YEARS.includes(expValue as any)) {\r\n      return Alert.alert(\"Experience\", \"Please select a valid experience range.\");\r\n    }\r\n    try {\r\n      setSavingVeh(true);\r\n      await patchDriver({\r\n        franchiseNumber: franchiseValue.trim(),\r\n        todaName: todaValue.trim(),\r\n        sector: sectorValue.trim(),\r\n        experienceYears: expValue.trim(),\r\n        licenseId: licenseValue.trim(),\r\n      });\r\n      setVehOpen(false);\r\n    } catch (e:any) {\r\n      Alert.alert(\"Error\", e.message || \"Failed to save vehicle details\");\r\n    } finally {\r\n      setSavingVeh(false);\r\n    }\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await AsyncStorage.removeItem(\"driverId\");\r\n      await clearAuth();\r\n      Alert.alert(\"Logged out\", \"You have been logged out successfully.\");\r\n      router.replace(\"../login_and_reg/dlogin\");\r\n    } catch (error) {\r\n      console.error(\"❌ Logout error:\", error);\r\n      Alert.alert(\"Error\", \"Failed to log out. Try again.\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={styles.profileContainer}>\r\n        <View style={styles.row}>\r\n          <TouchableOpacity onPress={pickSelfieImage}>\r\n            <Image\r\n              key={(selfieUri || \"empty\") + \"\"}     \r\n              source={\r\n                selfieUri\r\n                  ? { uri: `${String(selfieUri).trim()}?t=${Date.now()}` } \r\n                  : require(\"../../assets/images/profile-placeholder.jpg\")\r\n              }\r\n              defaultSource={require(\"../../assets/images/profile-placeholder.jpg\")} \r\n              style={styles.profileImage}\r\n            />\r\n          </TouchableOpacity>\r\n          <View>\r\n            <Text style={styles.username}>\r\n              {[profile?.driverFirstName, profile?.driverLastName].filter(Boolean).join(\" \")}\r\n            </Text>\r\n            {selfieImage && (\r\n              <TouchableOpacity style={styles.uploadButton} onPress={handleUploadSelfie}>\r\n                <Text style={{ color: \"#fff\" }}>Upload Profile Pic</Text>\r\n              </TouchableOpacity>\r\n            )}\r\n          </View>\r\n        </View>\r\n      </View>\r\n\r\n      <ScrollView style={styles.accountContainer} contentContainerStyle={{ paddingBottom: 40 }}>\r\n        <Text style={styles.sectionTitle}>Personal Information</Text>\r\n\r\n        {/* Full Name */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Full Name:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[\r\n              styles.value,\r\n              { color: (profile?.driverFirstName || profile?.driverMiddleName || profile?.driverLastName) ? \"#000\" : \"#999\" }\r\n            ]}>\r\n              {profile?.driverFirstName || \"\"} {profile?.driverMiddleName || \"\"} {profile?.driverLastName || \"\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openName} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Gender */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Gender:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.gender ? \"#000\" : \"#999\" }]}>\r\n              {profile?.gender || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openGender} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Phone */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Contact Number:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.driverPhone ? \"#000\" : \"#999\" }]}>\r\n              {profile?.driverPhone || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openPhone} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Birthday */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Birthday:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.driverBirthdate ? \"#000\" : \"#999\" }]}>\r\n              {profile?.driverBirthdate ? (fmtDate(profile.driverBirthdate) || profile.driverBirthdate) : \"Not Provided\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openBday} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Email + verify */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Email Address:</Text>\r\n          <View style={{ alignItems: \"flex-end\" }}>\r\n            <Text style={[styles.value, { color: profile?.email ? \"#000\" : \"#999\" }]}>\r\n              {profile?.email || \"Set Now\"}\r\n            </Text>\r\n            <View style={{ flexDirection: \"row\", alignItems: \"center\", marginTop: 4 }}>\r\n              <View style={{\r\n                paddingHorizontal: 8, paddingVertical: 2, borderRadius: 12,\r\n                backgroundColor: profile?.isVerified ? \"#E6F7E9\" : \"#FFF4E5\",\r\n                marginRight: 8,\r\n              }}>\r\n                <Text style={{ color: profile?.isVerified ? \"#2E7D32\" : \"#B26A00\", fontSize: 12 }}>\r\n                  {profile?.isVerified ? \"Verified\" : \"Not verified\"}\r\n                </Text>\r\n              </View>\r\n              {!profile?.isVerified && (\r\n                <TouchableOpacity\r\n                  disabled={emailSending}\r\n                  onPress={resendDriverEmail}\r\n                  style={{ paddingHorizontal: 10, paddingVertical: 6, borderRadius: 8, backgroundColor: emailSending ? \"#ccc\" : \"#5089A3\" }}\r\n                >\r\n                  <Text style={{ color: \"#fff\", fontSize: 12 }}>\r\n                    {emailSending ? \"Sending...\" : \"Verify email\"}\r\n                  </Text>\r\n                </TouchableOpacity>\r\n              )}\r\n            </View>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Address */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Home Address:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.homeAddress ? \"#000\" : \"#999\" }]}>\r\n              {profile?.homeAddress || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openAddr} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        <Text style={styles.sectionTitle}>Vehicle Details</Text>\r\n\r\n        {/* License ID */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>License Number:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.licenseId ? \"#000\" : \"#999\" }]}>\r\n              {profile?.licenseId || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openVeh} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Franchise */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Franchise Number:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.franchiseNumber ? \"#000\" : \"#999\" }]}>\r\n              {profile?.franchiseNumber || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openVeh} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* TODA */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>TODA Name:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.todaName ? \"#000\" : \"#999\" }]}>\r\n              {profile?.todaName || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openVeh} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Sector */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Sector:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.sector ? \"#000\" : \"#999\" }]}>\r\n              {profile?.sector || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openVeh} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Experience */}\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Experience:</Text>\r\n          <View style={styles.row}>\r\n            <Text style={[styles.value, { color: profile?.experienceYears ? \"#000\" : \"#999\" }]}>\r\n              {profile?.experienceYears || \"Set Now\"}\r\n            </Text>\r\n            <TouchableOpacity onPress={openVeh} style={{ marginLeft: 5 }}>\r\n              <MaterialIcons name=\"edit\" size={20} color=\"#888\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n        <View style={styles.infoRow}>\r\n          <Text style={styles.label}>Payments:</Text>\r\n          <TouchableOpacity\r\n            onPress={() => navigation.navigate(\"gcashsettings\")}\r\n            style={{ flexDirection: \"row\", alignItems: \"center\" }}\r\n          >\r\n            <Ionicons name=\"card\" size={18} color=\"#5089A3\" />\r\n            <Text style={[styles.value, { marginLeft: 6, color: \"#5089A3\", fontWeight: \"600\" }]}>\r\n              GCash Settings\r\n            </Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </ScrollView>\r\n\r\n      {/* ------- Modals ------- */}\r\n\r\n      {/* Name */}\r\n      <Modal transparent visible={nameOpen} animationType=\"fade\" onRequestClose={() => !savingName && setNameOpen(false)}>\r\n        <View style={styles.modalBack}>\r\n          <View style={styles.modalCard}>\r\n            <Text style={styles.modalTitle}>Edit Name</Text>\r\n\r\n            <TextInput placeholder=\"First name\" placeholderTextColor=\"#A0A0A0\" value={firstNameEdit} onChangeText={setFirstNameEdit} style={styles.input} />\r\n            <TextInput placeholder=\"Middle name (optional)\" placeholderTextColor=\"#A0A0A0\" value={middleNameEdit} onChangeText={setMiddleNameEdit} style={styles.input} />\r\n            <TextInput placeholder=\"Last name\" placeholderTextColor=\"#A0A0A0\" value={lastNameEdit} onChangeText={setLastNameEdit} style={styles.input} />\r\n\r\n            <View style={styles.modalBtns}>\r\n              <TouchableOpacity disabled={savingName} onPress={() => setNameOpen(false)} style={styles.btnGhost}><Text>Cancel</Text></TouchableOpacity>\r\n              <TouchableOpacity disabled={savingName} onPress={saveName} style={styles.btnPrimary}>\r\n                {savingName ? <ActivityIndicator color=\"#fff\" /> : <Text style={{ color:\"#fff\" }}>Save</Text>}\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n      {/* Gender */}\r\n      <Modal transparent visible={genderOpen} animationType=\"fade\" onRequestClose={() => !savingGender && setGenderOpen(false)}>\r\n        <View style={styles.modalBack}>\r\n          <View style={styles.modalCard}>\r\n            <Text style={styles.modalTitle}>Select Gender</Text>\r\n\r\n            {[\"Male\",\"Female\",\"Nonbinary\",\"Prefer not to say\",\"Other\"].map((opt) => (\r\n              <TouchableOpacity key={opt} onPress={() => setGenderChoice(opt)} style={{ flexDirection:\"row\", alignItems:\"center\", paddingVertical:8 }}>\r\n                <View style={styles.radioOuter}>\r\n                  {genderChoice === opt ? <View style={styles.radioInner} /> : null}\r\n                </View>\r\n                <Text>{opt}</Text>\r\n              </TouchableOpacity>\r\n            ))}\r\n\r\n            {genderChoice === \"Other\" && (\r\n              <TextInput placeholder=\"Enter your gender\" placeholderTextColor=\"#A0A0A0\" value={genderOther} onChangeText={setGenderOther} style={[styles.input, { marginTop:8 }]} />\r\n            )}\r\n\r\n            <View style={styles.modalBtns}>\r\n              <TouchableOpacity disabled={savingGender} onPress={() => setGenderOpen(false)} style={styles.btnGhost}><Text>Cancel</Text></TouchableOpacity>\r\n              <TouchableOpacity disabled={savingGender} onPress={saveGender} style={styles.btnPrimary}>\r\n                {savingGender ? <ActivityIndicator color=\"#fff\" /> : <Text style={{ color:\"#fff\" }}>Save</Text>}\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n      {/* Birthday (iOS styled modal) */}\r\n      <Modal transparent visible={bdayOpen && Platform.OS === \"ios\"} animationType=\"fade\" onRequestClose={() => !savingBday && setBdayOpen(false)}>\r\n        <View style={styles.modalBack}>\r\n          <View style={styles.modalCard}>\r\n            <Text style={styles.modalTitle}>Select Birthday</Text>\r\n\r\n            {bdayValue && (\r\n              <DateTimePicker\r\n                mode=\"date\"\r\n                value={bdayValue}\r\n                display=\"spinner\"\r\n                onChange={(_, d) => d && setBdayValue(d)}\r\n                maximumDate={new Date()}\r\n              />\r\n            )}\r\n\r\n            <View style={styles.modalBtns}>\r\n              <TouchableOpacity disabled={savingBday} onPress={() => setBdayOpen(false)} style={styles.btnGhost}><Text>Cancel</Text></TouchableOpacity>\r\n              <TouchableOpacity disabled={savingBday} onPress={saveBday} style={styles.btnPrimary}>\r\n                {savingBday ? <ActivityIndicator color=\"#fff\" /> : <Text style={{ color:\"#fff\" }}>Save</Text>}\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n      {/* Android Date Picker */}\r\n      {Platform.OS === \"android\" && showAndroidBday && (\r\n        <DateTimePicker\r\n          mode=\"date\"\r\n          value={bdayValue ?? new Date()}\r\n          display=\"calendar\"\r\n          maximumDate={new Date()}\r\n          onChange={(_, date) => {\r\n            setShowAndroidBday(false);            \r\n            if (date) {\r\n              setBdayValue(date);                 \r\n              setAndroidBdayConfirmOpen(true);    \r\n            }\r\n          }}\r\n        />\r\n      )}\r\n\r\n      <Modal\r\n        transparent\r\n        visible={androidBdayConfirmOpen}\r\n        animationType=\"fade\"\r\n        onRequestClose={() => !savingBday && setAndroidBdayConfirmOpen(false)}\r\n      >\r\n        <View style={{ flex:1, backgroundColor:\"rgba(0,0,0,0.4)\", justifyContent:\"center\", alignItems:\"center\", padding:20 }}>\r\n          <View style={{ width:\"100%\", maxWidth:420, backgroundColor:\"#fff\", borderRadius:12, padding:16 }}>\r\n            <Text style={{ fontWeight:\"bold\", fontSize:16, marginBottom:12 }}>Confirm Birthday</Text>\r\n\r\n            <Text style={{ fontSize:14, marginBottom:16 }}>\r\n              {bdayValue\r\n                ? bdayValue.toLocaleDateString(undefined, { year:\"numeric\", month:\"short\", day:\"2-digit\" })\r\n                : \"—\"}\r\n            </Text>\r\n\r\n            <View style={{ flexDirection:\"row\", justifyContent:\"flex-end\" }}>\r\n              <TouchableOpacity\r\n                disabled={savingBday}\r\n                onPress={() => setAndroidBdayConfirmOpen(false)}\r\n                style={{ padding:10, marginRight:8 }}\r\n              >\r\n                <Text>Cancel</Text>\r\n              </TouchableOpacity>\r\n\r\n              <TouchableOpacity\r\n                disabled={savingBday}\r\n                onPress={async () => {\r\n                  await saveBday();                 // uses your existing saveBday()\r\n                  setAndroidBdayConfirmOpen(false); // close after save\r\n                }}\r\n                style={{ backgroundColor:\"#5089A3\", padding:10, borderRadius:8, minWidth:90, alignItems:\"center\" }}\r\n              >\r\n                {savingBday ? <ActivityIndicator color=\"#fff\" /> : <Text style={{ color:\"#fff\" }}>Save</Text>}\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n\r\n\r\n\r\n      {/* Phone */}\r\n      <Modal transparent visible={phoneOpen} animationType=\"fade\" onRequestClose={() => !savingPhone && setPhoneOpen(false)}>\r\n        <View style={styles.modalBack}>\r\n          <View style={styles.modalCard}>\r\n            <Text style={styles.modalTitle}>Edit Contact Number</Text>\r\n            <TextInput placeholder=\"Phone number\" placeholderTextColor=\"#A0A0A0\" keyboardType=\"phone-pad\" value={phoneValue} onChangeText={setPhoneValue} style={styles.input} />\r\n\r\n            <View style={styles.modalBtns}>\r\n              <TouchableOpacity disabled={savingPhone} onPress={() => setPhoneOpen(false)} style={styles.btnGhost}><Text>Cancel</Text></TouchableOpacity>\r\n              <TouchableOpacity disabled={savingPhone} onPress={savePhone} style={styles.btnPrimary}>\r\n                {savingPhone ? <ActivityIndicator color=\"#fff\" /> : <Text style={{ color:\"#fff\" }}>Save</Text>}\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n      {/* Address */}\r\n      <Modal transparent visible={addrOpen} animationType=\"fade\" onRequestClose={() => !savingAddr && setAddrOpen(false)}>\r\n        <View style={styles.modalBack}>\r\n          <View style={styles.modalCard}>\r\n            <Text style={styles.modalTitle}>Edit Home Address</Text>\r\n            <TextInput placeholder=\"Home address\" placeholderTextColor=\"#A0A0A0\" value={addrValue} onChangeText={setAddrValue} style={styles.input} />\r\n\r\n            <View style={styles.modalBtns}>\r\n              <TouchableOpacity disabled={savingAddr} onPress={() => setAddrOpen(false)} style={styles.btnGhost}><Text>Cancel</Text></TouchableOpacity>\r\n              <TouchableOpacity disabled={savingAddr} onPress={saveAddr} style={styles.btnPrimary}>\r\n                {savingAddr ? <ActivityIndicator color=\"#fff\" /> : <Text style={{ color:\"#fff\" }}>Save</Text>}\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n      {/* Vehicle details */}\r\n      <Modal transparent visible={vehOpen} animationType=\"fade\" onRequestClose={() => !savingVeh && setVehOpen(false)}>\r\n        <View style={styles.modalBack}>\r\n          <View style={styles.modalCard}>\r\n            <Text style={styles.modalTitle}>Vehicle / Franchise</Text>\r\n\r\n            <TextInput placeholder=\"License Number\" placeholderTextColor=\"#A0A0A0\" value={licenseValue} onChangeText={setLicenseValue} style={styles.input} />\r\n            <TextInput placeholder=\"Franchise Number\" placeholderTextColor=\"#A0A0A0\" value={franchiseValue} onChangeText={setFranchiseValue} style={styles.input} />\r\n            <TextInput placeholder=\"TODA Name\" placeholderTextColor=\"#A0A0A0\" value={todaValue} onChangeText={setTodaValue} style={styles.input} />\r\n\r\n            <Text style={{ marginTop: 8, marginBottom: 6, fontWeight: \"600\" }}>Sector</Text>\r\n            {SECTORS.map((s) => (\r\n              <TouchableOpacity key={s} onPress={() => setSectorValue(s)} style={{ flexDirection:\"row\", alignItems:\"center\", paddingVertical:6 }}>\r\n                <View style={styles.radioOuter}>{sectorValue === s ? <View style={styles.radioInner} /> : null}</View>\r\n                <Text>{s}</Text>\r\n              </TouchableOpacity>\r\n            ))}\r\n\r\n            <Text style={{ marginTop: 12, marginBottom: 6, fontWeight: \"600\" }}>Experience</Text>\r\n            {EXP_YEARS.map((e) => (\r\n              <TouchableOpacity key={e} onPress={() => setExpValue(e)} style={{ flexDirection:\"row\", alignItems:\"center\", paddingVertical:6 }}>\r\n                <View style={styles.radioOuter}>{expValue === e ? <View style={styles.radioInner} /> : null}</View>\r\n                <Text>{e}</Text>\r\n              </TouchableOpacity>\r\n            ))}\r\n\r\n            <View style={[styles.modalBtns, { marginTop: 12 }]}>\r\n              <TouchableOpacity disabled={savingVeh} onPress={() => setVehOpen(false)} style={styles.btnGhost}><Text>Cancel</Text></TouchableOpacity>\r\n              <TouchableOpacity disabled={savingVeh} onPress={saveVeh} style={styles.btnPrimary}>\r\n                {savingVeh ? <ActivityIndicator color=\"#fff\" /> : <Text style={{ color:\"#fff\" }}>Save</Text>}\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: { flex: 1, backgroundColor: \"#fff\" },\r\n  profileContainer: { alignItems: \"center\", paddingTop: 50, flexDirection:\"row\", marginHorizontal:20, justifyContent: \"space-between\"},\r\n  profileImage: { width: 100, height: 100, borderRadius: 50},\r\n  username: { fontSize: 18, fontWeight: \"bold\", paddingLeft:20 },\r\n  lagout: { fontSize: 14, fontWeight: \"bold\"},\r\n  uploadButton: { backgroundColor: \"#5089A3\", borderRadius: 8, padding: 10, marginTop: 10 },\r\n  accountContainer: { marginTop: 10, paddingHorizontal: 20 },\r\n  sectionTitle: { fontWeight: \"bold\", fontSize: 16, marginVertical: 10 },\r\n  infoRow: { flexDirection: \"row\", justifyContent: \"space-between\", paddingVertical: 10, borderBottomWidth: 1, borderBottomColor: \"#eee\" },\r\n  row: { flexDirection: \"row\", alignItems: \"center\", justifyContent: \"center\" },\r\n  label: { fontSize: 14, color: \"#333\" },\r\n  value: { fontSize: 14, color: \"#333\", maxWidth: width * 0.55 },\r\n\r\n  // modal\r\n  modalBack: { flex:1, backgroundColor:\"rgba(0,0,0,0.4)\", justifyContent:\"center\", alignItems:\"center\", padding:20 },\r\n  modalCard: { width:\"100%\", maxWidth:420, backgroundColor:\"#fff\", borderRadius:12, padding:16 },\r\n  modalTitle: { fontWeight:\"bold\", fontSize:16, marginBottom:8 },\r\n  input: { borderWidth:1, borderColor:\"#ddd\", borderRadius:8, paddingHorizontal:12, paddingVertical:10, marginBottom:8 },\r\n\r\n  modalBtns: { flexDirection:\"row\", justifyContent:\"flex-end\", gap: 12 },\r\n  btnGhost: { paddingVertical:10, paddingHorizontal:14 },\r\n  btnPrimary: { backgroundColor:\"#5089A3\", paddingVertical:10, paddingHorizontal:14, borderRadius:8, minWidth:90, alignItems:\"center\" },\r\n\r\n  radioOuter: { width:18, height:18, borderRadius:9, borderWidth:2, borderColor:\"#5089A3\", alignItems:\"center\", justifyContent:\"center\", marginRight:10 },\r\n  radioInner: { width:10, height:10, borderRadius:5, backgroundColor:\"#5089A3\" },\r\n});\r\n"
        }
    ]
}