{
    "sourceFile": "app/homepassenger/phistory.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 115,
            "patches": [
                {
                    "date": 1748350023769,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748350042616,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,5 +18,6 @@\n }\r\n \r\n const styles = StyleSheet.create({\r\n   container: { flex: 1, justifyContent: 'center', alignItems: 'center' },\r\n+  bottomNav: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n });\r\n"
                },
                {
                    "date": 1748350078055,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,9 @@\n // phistory.tsx\r\n import React from 'react';\r\n-import { View, Text, StyleSheet, TouchableOpacity, } from 'react-native';\r\n+import { View, Text, StyleSheet, TouchableOpacity, Dimensions } from 'react-native';\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n+const { width, height } = Dimensions.get(\"window\");\r\n \r\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n"
                },
                {
                    "date": 1748350298022,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,19 +1,20 @@\n // phistory.tsx\r\n import React from 'react';\r\n import { View, Text, StyleSheet, TouchableOpacity, Dimensions } from 'react-native';\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n+import { router } from 'expo-router'; \r\n const { width, height } = Dimensions.get(\"window\");\r\n \r\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n         <Text>Passenger History Page</Text>\r\n         <View style={styles.bottomNav}>\r\n-            <TouchableOpacity><Ionicons name=\"home\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n-            <TouchableOpacity><Ionicons name=\"document-text-outline\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n-            <TouchableOpacity><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n-            <TouchableOpacity><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text-outline\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n         </View>\r\n     </View>\r\n   );\r\n }\r\n"
                },
                {
                    "date": 1748350537514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,4 @@\n-// phistory.tsx\r\n import React from 'react';\r\n import { View, Text, StyleSheet, TouchableOpacity, Dimensions } from 'react-native';\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n import { router } from 'expo-router'; \r\n@@ -9,10 +8,10 @@\n   return (\r\n     <View style={styles.container}>\r\n         <Text>Passenger History Page</Text>\r\n         <View style={styles.bottomNav}>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text-outline\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n             <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n             <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n         </View>\r\n     </View>\r\n"
                },
                {
                    "date": 1748421784057,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,24 +1,29 @@\n import React from 'react';\r\n-import { View, Text, StyleSheet, TouchableOpacity, Dimensions } from 'react-native';\r\n+import { View, Text, StyleSheet, TouchableOpacity, Dimensions, Image } from 'react-native';\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n import { router } from 'expo-router'; \r\n const { width, height } = Dimensions.get(\"window\");\r\n \r\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n-        <Text>Passenger History Page</Text>\r\n+        <Text style={styles.heading}>History</Text>\r\n+        <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n+        <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n         <View style={styles.bottomNav}>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homedriver/dhome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homedriver/dhistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homedriver/dchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homedriver/dprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n         </View>\r\n     </View>\r\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'center', alignItems: 'center' },\r\n+  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20 },\r\n+  heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n+  chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n+  message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n   bottomNav: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n });\r\n"
                },
                {
                    "date": 1748421811017,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,12 +10,12 @@\n         <Text style={styles.heading}>History</Text>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n         <View style={styles.bottomNav}>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homedriver/dhome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homedriver/dhistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homedriver/dchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homedriver/dprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n+            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n         </View>\r\n     </View>\r\n   );\r\n }\r\n"
                },
                {
                    "date": 1748421866813,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,19 +5,22 @@\n const { width, height } = Dimensions.get(\"window\");\r\n \r\n export default function PHistory() {\r\n   return (\r\n-    <View style={styles.container}>\r\n-        <Text style={styles.heading}>History</Text>\r\n+    <View>\r\n+      <Text style={styles.heading}>History</Text>\r\n+      <View style={styles.container}>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n         <View style={styles.bottomNav}>\r\n             <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n             <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n             <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n             <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n         </View>\r\n+      </View>\r\n     </View>\r\n+    \r\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n"
                },
                {
                    "date": 1748421916972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,22 +5,21 @@\n const { width, height } = Dimensions.get(\"window\");\r\n \r\n export default function PHistory() {\r\n   return (\r\n-    <View>\r\n+    <View style={styles.container}>\r\n       <Text style={styles.heading}>History</Text>\r\n-      <View style={styles.container}>\r\n+      <View>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n-        <View style={styles.bottomNav}>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n-            <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n-        </View>\r\n       </View>\r\n+      <View style={styles.bottomNav}>\r\n+          <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n+          <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n+          <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n+          <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n+      </View>\r\n     </View>\r\n-    \r\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n"
                },
                {
                    "date": 1748421930230,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n       <Text style={styles.heading}>History</Text>\r\n-      <View>\r\n+      <View style={styles.container}>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n       </View>\r\n       <View style={styles.bottomNav}>\r\n"
                },
                {
                    "date": 1748421953595,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,8 +23,9 @@\n }\r\n \r\n const styles = StyleSheet.create({\r\n   container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20 },\r\n+  container2: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20 },\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n   bottomNav: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n"
                },
                {
                    "date": 1748421967013,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n }\r\n \r\n const styles = StyleSheet.create({\r\n   container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20 },\r\n-  container2: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20 },\r\n+  container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n   bottomNav: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n"
                },
                {
                    "date": 1748421974930,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n       <Text style={styles.heading}>History</Text>\r\n-      <View style={styles.container}>\r\n+      <View style={styles.container2}>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n       </View>\r\n       <View style={styles.bottomNav}>\r\n"
                },
                {
                    "date": 1748422015186,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20 },\r\n+  container: { flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'row', },\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422023142,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'row', },\r\n+  container: { flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422031072,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20},\r\n+  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'row',},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422039765,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'row',},\r\n+  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422048897,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n+  container: { flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422054814,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n+  container: {justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422073756,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: {justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n+  container: {height: height, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422084197,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: {height: height, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n+  container: {flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422090760,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: {flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20, flexDirection: 'column',},\r\n+  container: {flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422107297,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: {flex: 1, justifyContent: 'space-between', alignItems: 'center', paddingHorizontal: 20},\r\n+  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20},\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422209751,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,11 @@\n \r\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n-      <Text style={styles.heading}>History</Text>\r\n+      <View style={styles.header}>\r\n+        <Text style={styles.heading}>History</Text>\r\n+      </View>\r\n       <View style={styles.container2}>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n       </View>\r\n@@ -23,8 +25,9 @@\n }\r\n \r\n const styles = StyleSheet.create({\r\n   container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20},\r\n+  header: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422238676,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,8 @@\n }\r\n \r\n const styles = StyleSheet.create({\r\n   container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20},\r\n-  header: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n   container2: { justifyContent: 'center', alignItems: 'center'},\r\n   heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n"
                },
                {
                    "date": 1748422254615,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,11 +6,9 @@\n \r\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n-      <View style={styles.header}>\r\n-        <Text style={styles.heading}>History</Text>\r\n-      </View>\r\n+      <Text style={styles.heading}>History</Text>\r\n       <View style={styles.container2}>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n       </View>\r\n"
                },
                {
                    "date": 1748422796187,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,27 +6,33 @@\n \r\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n-      <Text style={styles.heading}>History</Text>\r\n+      {/* Top bar with History text */}\r\n+      <View style={styles.topBar}>\r\n+        <Text style={styles.heading}>HISTORY</Text>\r\n+      </View>\r\n+\r\n       <View style={styles.container2}>\r\n         <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n         <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n       </View>\r\n+\r\n       <View style={styles.bottomNav}>\r\n-          <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n-          <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n-          <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n-          <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n+        <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n+        <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n+        <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n+        <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n       </View>\r\n     </View>\r\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, justifyContent: 'center', alignItems: 'center', paddingHorizontal: 20},\r\n-  container2: { justifyContent: 'center', alignItems: 'center'},\r\n-  heading: { fontWeight: 'bold', fontSize: 18, marginBottom: 20 },\r\n+  container: { flex: 1, paddingHorizontal: 20 },\r\n+  topBar: { marginTop: 40, marginBottom: 20 }, // Adjust top margin as needed\r\n+  heading: { fontWeight: 'bold', fontSize: 22 },\r\n+  container2: { flex: 1, justifyContent: 'center', alignItems: 'center' },\r\n   chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n   message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n   bottomNav: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n });\r\n"
                },
                {
                    "date": 1748427018908,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,8 @@\n \r\n export default function PHistory() {\r\n   return (\r\n     <View style={styles.container}>\r\n-      {/* Top bar with History text */}\r\n       <View style={styles.topBar}>\r\n         <Text style={styles.heading}>HISTORY</Text>\r\n       </View>\r\n \r\n"
                },
                {
                    "date": 1761308543111,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,37 +1,246 @@\n-import React from 'react';\r\n-import { View, Text, StyleSheet, TouchableOpacity, Dimensions, Image } from 'react-native';\r\n+import React, { useCallback, useEffect, useState } from \"react\";\r\n+import {\r\n+  View,\r\n+  Text,\r\n+  StyleSheet,\r\n+  Dimensions,\r\n+  Image,\r\n+  FlatList,\r\n+  RefreshControl,\r\n+  TouchableOpacity,\r\n+  ActivityIndicator,\r\n+} from \"react-native\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n-import { router } from 'expo-router'; \r\n-const { width, height } = Dimensions.get(\"window\");\r\n+import { router } from \"expo-router\";\r\n+import { API_BASE_URL } from \"../../config\";\r\n+import { getAuth } from \"../utils/authStorage\";\r\n \r\n+const { width } = Dimensions.get(\"window\");\r\n+\r\n+// --- Types (adapt if your API differs) ---\r\n+type RideItem = {\r\n+  _id: string;\r\n+  pickupLabel: string;           // e.g., \"KFC, Lucena Bayan\"\r\n+  destinationLabel: string;      // e.g., \"Dalubhasaan ng Lungsod ng Lucena\"\r\n+  fare: number;                  // e.g., 147\r\n+  createdAt: string;             // ISO date\r\n+  // optional extras you may have:\r\n+  // driverName?: string;\r\n+  // distanceKm?: number;\r\n+  // status?: \"completed\" | \"cancelled\";\r\n+  // thumbnailUrl?: string;\r\n+};\r\n+\r\n export default function PHistory() {\r\n+  const [items, setItems] = useState<RideItem[]>([]);\r\n+  const [page, setPage] = useState(1);\r\n+  const [hasMore, setHasMore] = useState(true);\r\n+  const [loading, setLoading] = useState(true);\r\n+  const [refreshing, setRefreshing] = useState(false);\r\n+  const PAGE_SIZE = 10;\r\n+\r\n+  const php = (n: number) =>\r\n+    new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n+\r\n+  const when = (iso: string) => {\r\n+    try {\r\n+      const d = new Date(iso);\r\n+      return d.toLocaleString(\"en-PH\", {\r\n+        year: \"numeric\",\r\n+        month: \"long\",\r\n+        day: \"numeric\",\r\n+        hour: \"numeric\",\r\n+        minute: \"2-digit\",\r\n+      });\r\n+    } catch {\r\n+      return iso;\r\n+    }\r\n+  };\r\n+\r\n+  const fetchPage = useCallback(async (pageNum: number, replace = false) => {\r\n+    const auth = await getAuth(); // expects { user: {_id: ... , role: ...}, token? }\r\n+    const passengerId = auth?.user?._id;\r\n+\r\n+    if (!passengerId) {\r\n+      setLoading(false);\r\n+      setRefreshing(false);\r\n+      return;\r\n+    }\r\n+\r\n+    try {\r\n+      const url = `${API_BASE_URL.replace(/\\/$/, \"\")}/api/rides/history?passengerId=${passengerId}&page=${pageNum}&limit=${PAGE_SIZE}`;\r\n+      const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n+      const data = await res.json();\r\n+      // Expected shape: { items: RideItem[], total: number, hasMore: boolean }\r\n+      const list: RideItem[] = data?.items ?? [];\r\n+      setItems((prev) => (replace ? list : [...prev, ...list]));\r\n+      setHasMore(Boolean(data?.hasMore ?? list.length === PAGE_SIZE));\r\n+    } catch (e) {\r\n+      // fail soft, keep previous items\r\n+    } finally {\r\n+      setLoading(false);\r\n+      setRefreshing(false);\r\n+    }\r\n+  }, []);\r\n+\r\n+  useEffect(() => {\r\n+    fetchPage(1, true);\r\n+  }, [fetchPage]);\r\n+\r\n+  const onRefresh = useCallback(() => {\r\n+    setRefreshing(true);\r\n+    setPage(1);\r\n+    fetchPage(1, true);\r\n+  }, [fetchPage]);\r\n+\r\n+  const loadMore = useCallback(() => {\r\n+    if (loading || refreshing || !hasMore) return;\r\n+    const next = page + 1;\r\n+    setPage(next);\r\n+    fetchPage(next, false);\r\n+  }, [page, hasMore, loading, refreshing, fetchPage]);\r\n+\r\n+  // Empty state (your original)\r\n+  if (!loading && items.length === 0) {\r\n+    return (\r\n+      <View style={styles.container}>\r\n+        <View style={styles.topBar}>\r\n+          <Text style={styles.heading}>HISTORY</Text>\r\n+        </View>\r\n+        <View style={styles.emptyWrap}>\r\n+          <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.emptyImage} />\r\n+          <Text style={styles.emptyMsg}>Mag Book na para mag ka history ka.</Text>\r\n+        </View>\r\n+      </View>\r\n+    );\r\n+  }\r\n+\r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.topBar}>\r\n         <Text style={styles.heading}>HISTORY</Text>\r\n       </View>\r\n \r\n-      <View style={styles.container2}>\r\n-        <Image source={require('../../assets/images/tricycle.png')} style={styles.chatImage} />\r\n-        <Text style={styles.message}>Mag Book na para mag ka history ka.</Text>\r\n+      {loading && items.length === 0 ? (\r\n+        <View style={{ paddingHorizontal: 16 }}>\r\n+          <SkeletonCard />\r\n+          <SkeletonCard />\r\n+          <SkeletonCard />\r\n+        </View>\r\n+      ) : (\r\n+        <FlatList\r\n+          data={items}\r\n+          keyExtractor={(it) => it._id}\r\n+          contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 24 }}\r\n+          refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n+          renderItem={({ item }) => <HistoryCard item={item} php={php} when={when} />}\r\n+          onEndReachedThreshold={0.2}\r\n+          onEndReached={loadMore}\r\n+          ListFooterComponent={\r\n+            hasMore ? (\r\n+              <View style={{ paddingVertical: 16 }}>\r\n+                <ActivityIndicator />\r\n+              </View>\r\n+            ) : null\r\n+          }\r\n+        />\r\n+      )}\r\n+    </View>\r\n+  );\r\n+}\r\n+\r\n+// --- Card component (matches your mock UI) ---\r\n+function HistoryCard({\r\n+  item,\r\n+  php,\r\n+  when,\r\n+}: {\r\n+  item: RideItem;\r\n+  php: (n: number) => string;\r\n+  when: (iso: string) => string;\r\n+}) {\r\n+  return (\r\n+    <TouchableOpacity\r\n+      activeOpacity={0.8}\r\n+      style={styles.card}\r\n+      onPress={() => {\r\n+        // optional: go to details\r\n+        // router.push({ pathname: \"/homepassenger/rideDetails\", params: { rideId: item._id }});\r\n+      }}\r\n+    >\r\n+      <View style={styles.row}>\r\n+        <Image\r\n+          source={require(\"../../assets/images/tricycle.png\")}\r\n+          style={styles.thumb}\r\n+        />\r\n+        <View style={{ flex: 1, paddingRight: 8 }}>\r\n+          <View style={styles.row}>\r\n+            <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n+            <Text style={styles.mainText} numberOfLines={1}>\r\n+              {item.pickupLabel}\r\n+            </Text>\r\n+          </View>\r\n+\r\n+          <View style={[styles.row, { marginTop: 2 }]}>\r\n+            <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n+            <Text style={styles.subText} numberOfLines={1}>\r\n+              {item.destinationLabel}\r\n+            </Text>\r\n+          </View>\r\n+\r\n+          <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n+        </View>\r\n+\r\n+        <Text style={styles.priceText}>{php(item.fare)}</Text>\r\n       </View>\r\n+    </TouchableOpacity>\r\n+  );\r\n+}\r\n \r\n-      <View style={styles.bottomNav}>\r\n-        <TouchableOpacity onPress={() => router.push(\"/homepassenger/phome\")}><Ionicons name=\"home-outline\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n-        <TouchableOpacity onPress={() => router.push(\"/homepassenger/phistory\")}><Ionicons name=\"document-text\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n-        <TouchableOpacity onPress={() => router.push(\"/homepassenger/pchats\")}><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n-        <TouchableOpacity onPress={() => router.push(\"/homepassenger/pprofile\")}><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n+// --- lightweight skeleton (no libs) ---\r\n+function SkeletonCard() {\r\n+  return (\r\n+    <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n+      <View style={styles.row}>\r\n+        <View style={{ width: 48, height: 48, borderRadius: 8, backgroundColor: \"#eee\" }} />\r\n+        <View style={{ flex: 1, marginLeft: 12 }}>\r\n+          <View style={{ height: 12, backgroundColor: \"#eee\", borderRadius: 6, width: \"70%\" }} />\r\n+          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"60%\", marginTop: 8 }} />\r\n+          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"40%\", marginTop: 8 }} />\r\n+        </View>\r\n+        <View style={{ width: 60, height: 14, backgroundColor: \"#eee\", borderRadius: 7 }} />\r\n       </View>\r\n     </View>\r\n   );\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n-  container: { flex: 1, paddingHorizontal: 20 },\r\n-  topBar: { marginTop: 40, marginBottom: 20 }, // Adjust top margin as needed\r\n-  heading: { fontWeight: 'bold', fontSize: 22 },\r\n-  container2: { flex: 1, justifyContent: 'center', alignItems: 'center' },\r\n-  chatImage: { width: 150, height: 150, marginBottom: 20, resizeMode: 'contain' },\r\n-  message: { textAlign: 'center', fontSize: 14, color: '#333' },\r\n-  bottomNav: { position: \"absolute\", bottom: 0, flexDirection: \"row\", justifyContent: \"space-around\", width: width, height: 70, backgroundColor: \"white\", borderTopLeftRadius: 30, borderTopRightRadius: 30, alignItems: \"center\", borderWidth: 1, borderColor: \"black\" },\r\n+  container: { flex: 1, backgroundColor: \"#fff\" },\r\n+  topBar: { paddingTop: 40, paddingHorizontal: 20, paddingBottom: 12 },\r\n+  heading: { fontWeight: \"bold\", fontSize: 22 },\r\n+\r\n+  emptyWrap: { flex: 1, justifyContent: \"center\", alignItems: \"center\", paddingHorizontal: 20 },\r\n+  emptyImage: { width: 150, height: 150, marginBottom: 20, resizeMode: \"contain\" },\r\n+  emptyMsg: { textAlign: \"center\", fontSize: 14, color: \"#333\" },\r\n+\r\n+  card: {\r\n+    backgroundColor: \"#fff\",\r\n+    borderRadius: 16,\r\n+    padding: 14,\r\n+    marginTop: 12,\r\n+    // soft shadow\r\n+    shadowColor: \"#000\",\r\n+    shadowOpacity: 0.08,\r\n+    shadowRadius: 8,\r\n+    shadowOffset: { width: 0, height: 4 },\r\n+    elevation: 3,\r\n+    borderWidth: 0.5,\r\n+    borderColor: \"#eee\",\r\n+  },\r\n+  row: { flexDirection: \"row\", alignItems: \"center\" },\r\n+  thumb: { width: 48, height: 48, marginRight: 12, resizeMode: \"contain\" },\r\n+  mainText: { marginLeft: 6, fontSize: 14, fontWeight: \"600\", color: \"#111\", flexShrink: 1 },\r\n+  subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n+  timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n+  priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n });\r\n"
                },
                {
                    "date": 1761308645644,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,10 +57,9 @@\n     }\r\n   };\r\n \r\n   const fetchPage = useCallback(async (pageNum: number, replace = false) => {\r\n-    const auth = await getAuth(); // expects { user: {_id: ... , role: ...}, token? }\r\n-    const passengerId = auth?.user?._id;\r\n+    const passengerId = \"YOUR_PASSENGER_ID\"; \r\n \r\n     if (!passengerId) {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n@@ -70,20 +69,21 @@\n     try {\r\n       const url = `${API_BASE_URL.replace(/\\/$/, \"\")}/api/rides/history?passengerId=${passengerId}&page=${pageNum}&limit=${PAGE_SIZE}`;\r\n       const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n       const data = await res.json();\r\n-      // Expected shape: { items: RideItem[], total: number, hasMore: boolean }\r\n-      const list: RideItem[] = data?.items ?? [];\r\n+\r\n+      const list = data?.items ?? [];\r\n       setItems((prev) => (replace ? list : [...prev, ...list]));\r\n       setHasMore(Boolean(data?.hasMore ?? list.length === PAGE_SIZE));\r\n     } catch (e) {\r\n-      // fail soft, keep previous items\r\n+      console.log(\"fetch history error\", e);\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n     }\r\n   }, []);\r\n \r\n+\r\n   useEffect(() => {\r\n     fetchPage(1, true);\r\n   }, [fetchPage]);\r\n \r\n"
                },
                {
                    "date": 1761311577795,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,204 +1,139 @@\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n-  View,\r\n-  Text,\r\n-  StyleSheet,\r\n-  Dimensions,\r\n-  Image,\r\n-  FlatList,\r\n-  RefreshControl,\r\n-  TouchableOpacity,\r\n-  ActivityIndicator,\r\n+  View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n+  RefreshControl, TouchableOpacity, ActivityIndicator\r\n } from \"react-native\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n-import { router } from \"expo-router\";\r\n import { API_BASE_URL } from \"../../config\";\r\n-import { getAuth } from \"../utils/authStorage\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n-// --- Types (adapt if your API differs) ---\r\n type RideItem = {\r\n   _id: string;\r\n-  pickupLabel: string;           // e.g., \"KFC, Lucena Bayan\"\r\n-  destinationLabel: string;      // e.g., \"Dalubhasaan ng Lungsod ng Lucena\"\r\n-  fare: number;                  // e.g., 147\r\n-  createdAt: string;             // ISO date\r\n-  // optional extras you may have:\r\n-  // driverName?: string;\r\n-  // distanceKm?: number;\r\n-  // status?: \"completed\" | \"cancelled\";\r\n-  // thumbnailUrl?: string;\r\n+  pickupLabel: string;\r\n+  destinationLabel: string;\r\n+  fare: number;\r\n+  createdAt: string;\r\n };\r\n \r\n export default function PHistory() {\r\n-  const [items, setItems] = useState<RideItem[]>([]);\r\n-  const [page, setPage] = useState(1);\r\n-  const [hasMore, setHasMore] = useState(true);\r\n+  const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n+  const [visible, setVisible] = useState(10); // initial count shown\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n-  const PAGE_SIZE = 10;\r\n \r\n+  // TODO: replace with your real passengerId (from login/context)\r\n+  const passengerId = \"YOUR_PASSENGER_ID_FOR_NOW\";\r\n+\r\n   const php = (n: number) =>\r\n     new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n+  const when = (iso: string) =>\r\n+    new Date(iso).toLocaleString(\"en-PH\", {\r\n+      year: \"numeric\",\r\n+      month: \"long\",\r\n+      day: \"numeric\",\r\n+      hour: \"numeric\",\r\n+      minute: \"2-digit\",\r\n+    });\r\n \r\n-  const when = (iso: string) => {\r\n+  const fetchAll = useCallback(async () => {\r\n+    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n-      const d = new Date(iso);\r\n-      return d.toLocaleString(\"en-PH\", {\r\n-        year: \"numeric\",\r\n-        month: \"long\",\r\n-        day: \"numeric\",\r\n-        hour: \"numeric\",\r\n-        minute: \"2-digit\",\r\n-      });\r\n-    } catch {\r\n-      return iso;\r\n-    }\r\n-  };\r\n-\r\n-  const fetchPage = useCallback(async (pageNum: number, replace = false) => {\r\n-    const passengerId = \"YOUR_PASSENGER_ID\"; \r\n-\r\n-    if (!passengerId) {\r\n-      setLoading(false);\r\n-      setRefreshing(false);\r\n-      return;\r\n-    }\r\n-\r\n-    try {\r\n-      const url = `${API_BASE_URL.replace(/\\/$/, \"\")}/api/rides/history?passengerId=${passengerId}&page=${pageNum}&limit=${PAGE_SIZE}`;\r\n+      const url = `${API_BASE_URL.replace(/\\/$/, \"\")}/api/ridehistory?passengerId=${passengerId}`;\r\n       const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n       const data = await res.json();\r\n-\r\n-      const list = data?.items ?? [];\r\n-      setItems((prev) => (replace ? list : [...prev, ...list]));\r\n-      setHasMore(Boolean(data?.hasMore ?? list.length === PAGE_SIZE));\r\n+      const items: RideItem[] = data?.items ?? [];\r\n+      setAllItems(items);\r\n+      setVisible(Math.min(10, items.length)); // reset visible count\r\n     } catch (e) {\r\n-      console.log(\"fetch history error\", e);\r\n+      console.log(\"history fetch error\", e);\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n     }\r\n-  }, []);\r\n+  }, [passengerId]);\r\n \r\n+  useEffect(() => { fetchAll(); }, [fetchAll]);\r\n \r\n-  useEffect(() => {\r\n-    fetchPage(1, true);\r\n-  }, [fetchPage]);\r\n-\r\n   const onRefresh = useCallback(() => {\r\n     setRefreshing(true);\r\n-    setPage(1);\r\n-    fetchPage(1, true);\r\n-  }, [fetchPage]);\r\n+    fetchAll();\r\n+  }, [fetchAll]);\r\n \r\n-  const loadMore = useCallback(() => {\r\n-    if (loading || refreshing || !hasMore) return;\r\n-    const next = page + 1;\r\n-    setPage(next);\r\n-    fetchPage(next, false);\r\n-  }, [page, hasMore, loading, refreshing, fetchPage]);\r\n-\r\n-  // Empty state (your original)\r\n-  if (!loading && items.length === 0) {\r\n+  // Empty state\r\n+  if (!loading && allItems.length === 0) {\r\n     return (\r\n       <View style={styles.container}>\r\n-        <View style={styles.topBar}>\r\n-          <Text style={styles.heading}>HISTORY</Text>\r\n-        </View>\r\n+        <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n         <View style={styles.emptyWrap}>\r\n           <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.emptyImage} />\r\n           <Text style={styles.emptyMsg}>Mag Book na para mag ka history ka.</Text>\r\n         </View>\r\n       </View>\r\n     );\r\n   }\r\n \r\n+  const dataToShow = allItems.slice(0, visible);\r\n+  const hasMoreLocal = visible < allItems.length;\r\n+\r\n   return (\r\n     <View style={styles.container}>\r\n-      <View style={styles.topBar}>\r\n-        <Text style={styles.heading}>HISTORY</Text>\r\n-      </View>\r\n+      <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n \r\n-      {loading && items.length === 0 ? (\r\n+      {loading && allItems.length === 0 ? (\r\n         <View style={{ paddingHorizontal: 16 }}>\r\n-          <SkeletonCard />\r\n-          <SkeletonCard />\r\n-          <SkeletonCard />\r\n+          <SkeletonCard /><SkeletonCard /><SkeletonCard />\r\n         </View>\r\n       ) : (\r\n         <FlatList\r\n-          data={items}\r\n+          data={dataToShow}\r\n           keyExtractor={(it) => it._id}\r\n           contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 24 }}\r\n           refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n           renderItem={({ item }) => <HistoryCard item={item} php={php} when={when} />}\r\n-          onEndReachedThreshold={0.2}\r\n-          onEndReached={loadMore}\r\n           ListFooterComponent={\r\n-            hasMore ? (\r\n-              <View style={{ paddingVertical: 16 }}>\r\n-                <ActivityIndicator />\r\n-              </View>\r\n+            hasMoreLocal ? (\r\n+              <TouchableOpacity\r\n+                style={styles.viewMoreBtn}\r\n+                onPress={() => setVisible((v) => Math.min(v + 10, allItems.length))}\r\n+              >\r\n+                <Text style={styles.viewMoreText}>View more</Text>\r\n+              </TouchableOpacity>\r\n+            ) : allItems.length > 0 ? (\r\n+              <Text style={styles.noMoreText}>End of history</Text>\r\n             ) : null\r\n           }\r\n         />\r\n       )}\r\n     </View>\r\n   );\r\n }\r\n \r\n-// --- Card component (matches your mock UI) ---\r\n function HistoryCard({\r\n-  item,\r\n-  php,\r\n-  when,\r\n-}: {\r\n-  item: RideItem;\r\n-  php: (n: number) => string;\r\n-  when: (iso: string) => string;\r\n-}) {\r\n+  item, php, when,\r\n+}: { item: RideItem; php: (n: number) => string; when: (iso: string) => string }) {\r\n   return (\r\n-    <TouchableOpacity\r\n-      activeOpacity={0.8}\r\n-      style={styles.card}\r\n-      onPress={() => {\r\n-        // optional: go to details\r\n-        // router.push({ pathname: \"/homepassenger/rideDetails\", params: { rideId: item._id }});\r\n-      }}\r\n-    >\r\n+    <TouchableOpacity activeOpacity={0.8} style={styles.card}>\r\n       <View style={styles.row}>\r\n-        <Image\r\n-          source={require(\"../../assets/images/tricycle.png\")}\r\n-          style={styles.thumb}\r\n-        />\r\n+        <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n         <View style={{ flex: 1, paddingRight: 8 }}>\r\n           <View style={styles.row}>\r\n             <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n-            <Text style={styles.mainText} numberOfLines={1}>\r\n-              {item.pickupLabel}\r\n-            </Text>\r\n+            <Text style={styles.mainText} numberOfLines={1}>{item.pickupLabel}</Text>\r\n           </View>\r\n-\r\n           <View style={[styles.row, { marginTop: 2 }]}>\r\n             <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n-            <Text style={styles.subText} numberOfLines={1}>\r\n-              {item.destinationLabel}\r\n-            </Text>\r\n+            <Text style={styles.subText} numberOfLines={1}>{item.destinationLabel}</Text>\r\n           </View>\r\n-\r\n           <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n         </View>\r\n-\r\n         <Text style={styles.priceText}>{php(item.fare)}</Text>\r\n       </View>\r\n     </TouchableOpacity>\r\n   );\r\n }\r\n \r\n-// --- lightweight skeleton (no libs) ---\r\n function SkeletonCard() {\r\n   return (\r\n     <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n       <View style={styles.row}>\r\n@@ -227,9 +162,8 @@\n     backgroundColor: \"#fff\",\r\n     borderRadius: 16,\r\n     padding: 14,\r\n     marginTop: 12,\r\n-    // soft shadow\r\n     shadowColor: \"#000\",\r\n     shadowOpacity: 0.08,\r\n     shadowRadius: 8,\r\n     shadowOffset: { width: 0, height: 4 },\r\n@@ -242,5 +176,17 @@\n   mainText: { marginLeft: 6, fontSize: 14, fontWeight: \"600\", color: \"#111\", flexShrink: 1 },\r\n   subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n   timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n   priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n+\r\n+  viewMoreBtn: {\r\n+    marginTop: 12,\r\n+    alignSelf: \"center\",\r\n+    paddingHorizontal: 16,\r\n+    paddingVertical: 10,\r\n+    borderRadius: 999,\r\n+    borderWidth: 1,\r\n+    borderColor: \"#ddd\",\r\n+  },\r\n+  viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n+  noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n });\r\n"
                },
                {
                    "date": 1761313260721,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,276 @@\n+import React, { useCallback, useEffect, useState } from \"react\";\r\n+import {\r\n+  View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n+  RefreshControl, TouchableOpacity, ActivityIndicator\r\n+} from \"react-native\";\r\n+import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n+import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n+import { API_BASE_URL } from \"../../config\";\r\n+\r\n+const { width } = Dimensions.get(\"window\");\r\n+\r\n+type RideItem = {\r\n+  _id: string;\r\n+  pickupLabel: string;\r\n+  destinationLabel: string;\r\n+  fare: number;\r\n+  createdAt: string;\r\n+};\r\n+\r\n+export default function PHistory() {\r\n+  const [passengerId, setPassengerId] = useState<string | null>(null);\r\n+  const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n+  const [visible, setVisible] = useState(10);\r\n+  const [loading, setLoading] = useState(true);\r\n+  const [refreshing, setRefreshing] = useState(false);\r\n+  const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n+  const [debug, setDebug] = useState<string>(\"\");\r\n+\r\n+  // 1) Load passengerId like PProfile does\r\n+  useEffect(() => {\r\n+    (async () => {\r\n+      const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n+      setPassengerId(pid || null);\r\n+    })();\r\n+  }, []);\r\n+\r\n+  const php = (n: number) =>\r\n+    new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n+\r\n+  const when = (iso: string) =>\r\n+    new Date(iso).toLocaleString(\"en-PH\", {\r\n+      year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n+    });\r\n+\r\n+  const normalize = (raw: any[]): RideItem[] =>\r\n+    (raw || []).map((r: any) => {\r\n+      const pickupLabel =\r\n+        r.pickupLabel ??\r\n+        (Number.isFinite(r.pickupLat) && Number.isFinite(r.pickupLng)\r\n+          ? `${Number(r.pickupLat).toFixed(5)}, ${Number(r.pickupLng).toFixed(5)}`\r\n+          : \"Pickup\");\r\n+      const destinationLabel =\r\n+        r.destinationLabel ??\r\n+        (Number.isFinite(r.destinationLat) && Number.isFinite(r.destinationLng)\r\n+          ? `${Number(r.destinationLat).toFixed(5)}, ${Number(r.destinationLng).toFixed(5)}`\r\n+          : \"Destination\"); // (fixed: was using destinationLat twice)\r\n+      return {\r\n+        _id: String(r._id),\r\n+        pickupLabel,\r\n+        destinationLabel,\r\n+        fare: Number(r.fare || 0),\r\n+        createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n+      };\r\n+    });\r\n+\r\n+  const fetchAll = useCallback(async () => {\r\n+    setErrorMsg(null);\r\n+    setDebug(\"\");\r\n+    if (!passengerId) {\r\n+      setLoading(false);\r\n+      setRefreshing(false);\r\n+      const msg = \"Missing passengerId from AsyncStorage.\";\r\n+      setErrorMsg(msg);\r\n+      setDebug(msg);\r\n+      return;\r\n+    }\r\n+    try {\r\n+      const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n+\r\n+      // Prefer /ridehistory (mounted with or without /api). Fallback to /rides (array) and filter client-side.\r\n+      const paths = [\r\n+        `/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n+        `/api/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n+        `/rides`,\r\n+        `/api/rides`,\r\n+      ];\r\n+\r\n+      let got: RideItem[] | null = null;\r\n+\r\n+      for (let i = 0; i < paths.length; i++) {\r\n+        const url = `${base}${paths[i]}`;\r\n+        const filterLocally = i >= 2;\r\n+        setDebug((d) => `${d}\\n GET ${url}`);\r\n+\r\n+        try {\r\n+          const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n+          const status = res.status;\r\n+          const text = await res.text();\r\n+          setDebug((d) => `${d}\\n  status: ${status}\\n  body: ${text.slice(0, 160)}...`);\r\n+\r\n+          let data: any;\r\n+          try { data = JSON.parse(text); } catch { throw new Error(\"Non-JSON response\"); }\r\n+\r\n+          let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n+          if (filterLocally) {\r\n+            raw = raw.filter((r: any) => String(r.passengerId) === String(passengerId));\r\n+          }\r\n+\r\n+          got = normalize(raw);\r\n+          setDebug((d) => `${d}\\n   items: ${got?.length ?? 0}`);\r\n+          break;\r\n+        } catch (e: any) {\r\n+          setDebug((d) => `${d}\\n   ${e?.message || e}`);\r\n+          // try next path\r\n+        }\r\n+      }\r\n+\r\n+      if (!got) throw new Error(\"All history endpoints failed.\");\r\n+\r\n+      setAllItems(got);\r\n+      setVisible(Math.min(10, got.length));\r\n+    } catch (e: any) {\r\n+      setErrorMsg(e?.message || \"Failed to load history.\");\r\n+      setDebug((d) => `${d}\\nFATAL: ${e?.message || e}`);\r\n+    } finally {\r\n+      setLoading(false);\r\n+      setRefreshing(false);\r\n+    }\r\n+  }, [passengerId]);\r\n+\r\n+  useEffect(() => { fetchAll(); }, [fetchAll]);\r\n+\r\n+  const onRefresh = useCallback(() => {\r\n+    setRefreshing(true);\r\n+    fetchAll();\r\n+  }, [fetchAll]);\r\n+\r\n+  const dataToShow = allItems.slice(0, visible);\r\n+  const hasMoreLocal = visible < allItems.length;\r\n+\r\n+  // Empty state\r\n+  if (!loading && allItems.length === 0) {\r\n+    return (\r\n+      <View style={styles.container}>\r\n+        <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n+        {debug ? <DebugPanel text={debug} /> : null}\r\n+        <View style={styles.emptyWrap}>\r\n+          <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.emptyImage} />\r\n+          <Text style={styles.emptyMsg}>{errorMsg || \"Mag Book na para mag ka history ka.\"}</Text>\r\n+          <TouchableOpacity style={styles.viewMoreBtn} onPress={onRefresh}>\r\n+            <Text style={styles.viewMoreText}>Reload</Text>\r\n+          </TouchableOpacity>\r\n+        </View>\r\n+      </View>\r\n+    );\r\n+  }\r\n+\r\n+  return (\r\n+    <View style={styles.container}>\r\n+      <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n+      {debug ? <DebugPanel text={debug} /> : null}\r\n+\r\n+      {loading && allItems.length === 0 ? (\r\n+        <View style={{ paddingHorizontal: 16 }}>\r\n+          <SkeletonCard /><SkeletonCard /><SkeletonCard />\r\n+        </View>\r\n+      ) : (\r\n+        <FlatList\r\n+          data={dataToShow}\r\n+          keyExtractor={(it) => it._id}\r\n+          contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 24 }}\r\n+          refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n+          renderItem={({ item }) => <HistoryCard item={item} php={php} when={when} />}\r\n+          ListFooterComponent={\r\n+            hasMoreLocal ? (\r\n+              <TouchableOpacity\r\n+                style={styles.viewMoreBtn}\r\n+                onPress={() => setVisible((v) => Math.min(v + 10, allItems.length))}\r\n+              >\r\n+                <Text style={styles.viewMoreText}>View more</Text>\r\n+              </TouchableOpacity>\r\n+            ) : allItems.length > 0 ? (\r\n+              <Text style={styles.noMoreText}>End of history</Text>\r\n+            ) : null\r\n+          }\r\n+        />\r\n+      )}\r\n+    </View>\r\n+  );\r\n+}\r\n+\r\n+function DebugPanel({ text }: { text: string }) {\r\n+  const [open, setOpen] = useState(true);\r\n+  if (!text) return null;\r\n+  return (\r\n+    <TouchableOpacity onPress={() => setOpen(!open)} style={{\r\n+      marginHorizontal: 16, marginBottom: 8, backgroundColor: \"#f5f5f5\",\r\n+      borderRadius: 8, borderWidth: 1, borderColor: \"#e5e5e5\", padding: 8\r\n+    }}>\r\n+      <Text style={{ fontWeight: \"700\", marginBottom: 4 }}>Debug</Text>\r\n+      {open ? <Text style={{ fontFamily: \"monospace\", fontSize: 12 }} selectable>{text}</Text> : <Text></Text>}\r\n+    </TouchableOpacity>\r\n+  );\r\n+}\r\n+\r\n+function HistoryCard({\r\n+  item, php, when,\r\n+}: { item: RideItem; php: (n: number) => string; when: (iso: string) => string }) {\r\n+  return (\r\n+    <TouchableOpacity activeOpacity={0.8} style={styles.card}>\r\n+      <View style={styles.row}>\r\n+        <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n+        <View style={{ flex: 1, paddingRight: 8 }}>\r\n+          <View style={styles.row}>\r\n+            <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n+            <Text style={styles.mainText} numberOfLines={1}>{item.pickupLabel}</Text>\r\n+          </View>\r\n+          <View style={[styles.row, { marginTop: 2 }]}>\r\n+            <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n+            <Text style={styles.subText} numberOfLines={1}>{item.destinationLabel}</Text>\r\n+          </View>\r\n+          <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n+        </View>\r\n+        <Text style={styles.priceText}>{php(item.fare)}</Text>\r\n+      </View>\r\n+    </TouchableOpacity>\r\n+  );\r\n+}\r\n+\r\n+function SkeletonCard() {\r\n+  return (\r\n+    <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n+      <View style={styles.row}>\r\n+        <View style={{ width: 48, height: 48, borderRadius: 8, backgroundColor: \"#eee\" }} />\r\n+        <View style={{ flex: 1, marginLeft: 12 }}>\r\n+          <View style={{ height: 12, backgroundColor: \"#eee\", borderRadius: 6, width: \"70%\" }} />\r\n+          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"60%\", marginTop: 8 }} />\r\n+          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"40%\", marginTop: 8 }} />\r\n+        </View>\r\n+        <View style={{ width: 60, height: 14, backgroundColor: \"#eee\", borderRadius: 7 }} />\r\n+      </View>\r\n+    </View>\r\n+  );\r\n+}\r\n+\r\n+const styles = StyleSheet.create({\r\n+  container: { flex: 1, backgroundColor: \"#fff\" },\r\n+  topBar: { paddingTop: 40, paddingHorizontal: 20, paddingBottom: 12 },\r\n+  heading: { fontWeight: \"bold\", fontSize: 22 },\r\n+\r\n+  emptyWrap: { flex: 1, justifyContent: \"center\", alignItems: \"center\", paddingHorizontal: 20 },\r\n+  emptyImage: { width: 150, height: 150, marginBottom: 20, resizeMode: \"contain\" },\r\n+  emptyMsg: { textAlign: \"center\", fontSize: 14, color: \"#333\", marginBottom: 8 },\r\n+\r\n+  card: {\r\n+    backgroundColor: \"#fff\",\r\n+    borderRadius: 16,\r\n+    padding: 14,\r\n+    marginTop: 12,\r\n+    shadowColor: \"#000\", shadowOpacity: 0.08, shadowRadius: 8, shadowOffset: { width: 0, height: 4 },\r\n+    elevation: 3, borderWidth: 0.5, borderColor: \"#eee\",\r\n+  },\r\n+  row: { flexDirection: \"row\", alignItems: \"center\" },\r\n+  thumb: { width: 48, height: 48, marginRight: 12, resizeMode: \"contain\" },\r\n+  mainText: { marginLeft: 6, fontSize: 14, fontWeight: \"600\", color: \"#111\", flexShrink: 1 },\r\n+  subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n+  timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n+  priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n+\r\n+  viewMoreBtn: {\r\n+    marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10,\r\n+    borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\",\r\n+  },\r\n+  viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n+  noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n+});\r\n"
                },
                {
                    "date": 1761313541049,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,11 +23,9 @@\n   const [visible, setVisible] = useState(10);\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n   const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n-  const [debug, setDebug] = useState<string>(\"\");\r\n \r\n-  // 1) Load passengerId like PProfile does\r\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n@@ -52,9 +50,9 @@\n       const destinationLabel =\r\n         r.destinationLabel ??\r\n         (Number.isFinite(r.destinationLat) && Number.isFinite(r.destinationLng)\r\n           ? `${Number(r.destinationLat).toFixed(5)}, ${Number(r.destinationLng).toFixed(5)}`\r\n-          : \"Destination\"); // (fixed: was using destinationLat twice)\r\n+          : \"Destination\");\r\n       return {\r\n         _id: String(r._id),\r\n         pickupLabel,\r\n         destinationLabel,\r\n@@ -64,21 +62,11 @@\n     });\r\n \r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n-    setDebug(\"\");\r\n-    if (!passengerId) {\r\n-      setLoading(false);\r\n-      setRefreshing(false);\r\n-      const msg = \"Missing passengerId from AsyncStorage.\";\r\n-      setErrorMsg(msg);\r\n-      setDebug(msg);\r\n-      return;\r\n-    }\r\n+    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n       const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n-\r\n-      // Prefer /ridehistory (mounted with or without /api). Fallback to /rides (array) and filter client-side.\r\n       const paths = [\r\n         `/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n         `/api/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n         `/rides`,\r\n@@ -89,40 +77,26 @@\n \r\n       for (let i = 0; i < paths.length; i++) {\r\n         const url = `${base}${paths[i]}`;\r\n         const filterLocally = i >= 2;\r\n-        setDebug((d) => `${d}\\n GET ${url}`);\r\n-\r\n         try {\r\n           const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n-          const status = res.status;\r\n           const text = await res.text();\r\n-          setDebug((d) => `${d}\\n  status: ${status}\\n  body: ${text.slice(0, 160)}...`);\r\n-\r\n           let data: any;\r\n-          try { data = JSON.parse(text); } catch { throw new Error(\"Non-JSON response\"); }\r\n+          try { data = JSON.parse(text); } catch { continue; }\r\n \r\n           let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n-          if (filterLocally) {\r\n-            raw = raw.filter((r: any) => String(r.passengerId) === String(passengerId));\r\n-          }\r\n+          if (filterLocally) raw = raw.filter((r: any) => String(r.passengerId) === String(passengerId));\r\n \r\n           got = normalize(raw);\r\n-          setDebug((d) => `${d}\\n   items: ${got?.length ?? 0}`);\r\n           break;\r\n-        } catch (e: any) {\r\n-          setDebug((d) => `${d}\\n   ${e?.message || e}`);\r\n-          // try next path\r\n-        }\r\n+        } catch {}\r\n       }\r\n \r\n-      if (!got) throw new Error(\"All history endpoints failed.\");\r\n+      if (!got) got = [];\r\n \r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n-    } catch (e: any) {\r\n-      setErrorMsg(e?.message || \"Failed to load history.\");\r\n-      setDebug((d) => `${d}\\nFATAL: ${e?.message || e}`);\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n     }\r\n@@ -137,14 +111,12 @@\n \r\n   const dataToShow = allItems.slice(0, visible);\r\n   const hasMoreLocal = visible < allItems.length;\r\n \r\n-  // Empty state\r\n   if (!loading && allItems.length === 0) {\r\n     return (\r\n       <View style={styles.container}>\r\n         <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n-        {debug ? <DebugPanel text={debug} /> : null}\r\n         <View style={styles.emptyWrap}>\r\n           <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.emptyImage} />\r\n           <Text style={styles.emptyMsg}>{errorMsg || \"Mag Book na para mag ka history ka.\"}</Text>\r\n           <TouchableOpacity style={styles.viewMoreBtn} onPress={onRefresh}>\r\n@@ -157,9 +129,8 @@\n \r\n   return (\r\n     <View style={styles.container}>\r\n       <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n-      {debug ? <DebugPanel text={debug} /> : null}\r\n \r\n       {loading && allItems.length === 0 ? (\r\n         <View style={{ paddingHorizontal: 16 }}>\r\n           <SkeletonCard /><SkeletonCard /><SkeletonCard />\r\n@@ -188,22 +159,8 @@\n     </View>\r\n   );\r\n }\r\n \r\n-function DebugPanel({ text }: { text: string }) {\r\n-  const [open, setOpen] = useState(true);\r\n-  if (!text) return null;\r\n-  return (\r\n-    <TouchableOpacity onPress={() => setOpen(!open)} style={{\r\n-      marginHorizontal: 16, marginBottom: 8, backgroundColor: \"#f5f5f5\",\r\n-      borderRadius: 8, borderWidth: 1, borderColor: \"#e5e5e5\", padding: 8\r\n-    }}>\r\n-      <Text style={{ fontWeight: \"700\", marginBottom: 4 }}>Debug</Text>\r\n-      {open ? <Text style={{ fontFamily: \"monospace\", fontSize: 12 }} selectable>{text}</Text> : <Text></Text>}\r\n-    </TouchableOpacity>\r\n-  );\r\n-}\r\n-\r\n function HistoryCard({\r\n   item, php, when,\r\n }: { item: RideItem; php: (n: number) => string; when: (iso: string) => string }) {\r\n   return (\r\n@@ -252,12 +209,9 @@\n   emptyImage: { width: 150, height: 150, marginBottom: 20, resizeMode: \"contain\" },\r\n   emptyMsg: { textAlign: \"center\", fontSize: 14, color: \"#333\", marginBottom: 8 },\r\n \r\n   card: {\r\n-    backgroundColor: \"#fff\",\r\n-    borderRadius: 16,\r\n-    padding: 14,\r\n-    marginTop: 12,\r\n+    backgroundColor: \"#fff\", borderRadius: 16, padding: 14, marginTop: 12,\r\n     shadowColor: \"#000\", shadowOpacity: 0.08, shadowRadius: 8, shadowOffset: { width: 0, height: 4 },\r\n     elevation: 3, borderWidth: 0.5, borderColor: \"#eee\",\r\n   },\r\n   row: { flexDirection: \"row\", alignItems: \"center\" },\r\n@@ -273,196 +227,4 @@\n   },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n });\r\n-import React, { useCallback, useEffect, useState } from \"react\";\r\n-import {\r\n-  View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n-  RefreshControl, TouchableOpacity, ActivityIndicator\r\n-} from \"react-native\";\r\n-import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n-import { API_BASE_URL } from \"../../config\";\r\n-\r\n-const { width } = Dimensions.get(\"window\");\r\n-\r\n-type RideItem = {\r\n-  _id: string;\r\n-  pickupLabel: string;\r\n-  destinationLabel: string;\r\n-  fare: number;\r\n-  createdAt: string;\r\n-};\r\n-\r\n-export default function PHistory() {\r\n-  const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n-  const [visible, setVisible] = useState(10); // initial count shown\r\n-  const [loading, setLoading] = useState(true);\r\n-  const [refreshing, setRefreshing] = useState(false);\r\n-\r\n-  // TODO: replace with your real passengerId (from login/context)\r\n-  const passengerId = \"YOUR_PASSENGER_ID_FOR_NOW\";\r\n-\r\n-  const php = (n: number) =>\r\n-    new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n-  const when = (iso: string) =>\r\n-    new Date(iso).toLocaleString(\"en-PH\", {\r\n-      year: \"numeric\",\r\n-      month: \"long\",\r\n-      day: \"numeric\",\r\n-      hour: \"numeric\",\r\n-      minute: \"2-digit\",\r\n-    });\r\n-\r\n-  const fetchAll = useCallback(async () => {\r\n-    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n-    try {\r\n-      const url = `${API_BASE_URL.replace(/\\/$/, \"\")}/api/ridehistory?passengerId=${passengerId}`;\r\n-      const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n-      const data = await res.json();\r\n-      const items: RideItem[] = data?.items ?? [];\r\n-      setAllItems(items);\r\n-      setVisible(Math.min(10, items.length)); // reset visible count\r\n-    } catch (e) {\r\n-      console.log(\"history fetch error\", e);\r\n-    } finally {\r\n-      setLoading(false);\r\n-      setRefreshing(false);\r\n-    }\r\n-  }, [passengerId]);\r\n-\r\n-  useEffect(() => { fetchAll(); }, [fetchAll]);\r\n-\r\n-  const onRefresh = useCallback(() => {\r\n-    setRefreshing(true);\r\n-    fetchAll();\r\n-  }, [fetchAll]);\r\n-\r\n-  // Empty state\r\n-  if (!loading && allItems.length === 0) {\r\n-    return (\r\n-      <View style={styles.container}>\r\n-        <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n-        <View style={styles.emptyWrap}>\r\n-          <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.emptyImage} />\r\n-          <Text style={styles.emptyMsg}>Mag Book na para mag ka history ka.</Text>\r\n-        </View>\r\n-      </View>\r\n-    );\r\n-  }\r\n-\r\n-  const dataToShow = allItems.slice(0, visible);\r\n-  const hasMoreLocal = visible < allItems.length;\r\n-\r\n-  return (\r\n-    <View style={styles.container}>\r\n-      <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n-\r\n-      {loading && allItems.length === 0 ? (\r\n-        <View style={{ paddingHorizontal: 16 }}>\r\n-          <SkeletonCard /><SkeletonCard /><SkeletonCard />\r\n-        </View>\r\n-      ) : (\r\n-        <FlatList\r\n-          data={dataToShow}\r\n-          keyExtractor={(it) => it._id}\r\n-          contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 24 }}\r\n-          refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n-          renderItem={({ item }) => <HistoryCard item={item} php={php} when={when} />}\r\n-          ListFooterComponent={\r\n-            hasMoreLocal ? (\r\n-              <TouchableOpacity\r\n-                style={styles.viewMoreBtn}\r\n-                onPress={() => setVisible((v) => Math.min(v + 10, allItems.length))}\r\n-              >\r\n-                <Text style={styles.viewMoreText}>View more</Text>\r\n-              </TouchableOpacity>\r\n-            ) : allItems.length > 0 ? (\r\n-              <Text style={styles.noMoreText}>End of history</Text>\r\n-            ) : null\r\n-          }\r\n-        />\r\n-      )}\r\n-    </View>\r\n-  );\r\n-}\r\n-\r\n-function HistoryCard({\r\n-  item, php, when,\r\n-}: { item: RideItem; php: (n: number) => string; when: (iso: string) => string }) {\r\n-  return (\r\n-    <TouchableOpacity activeOpacity={0.8} style={styles.card}>\r\n-      <View style={styles.row}>\r\n-        <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n-        <View style={{ flex: 1, paddingRight: 8 }}>\r\n-          <View style={styles.row}>\r\n-            <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n-            <Text style={styles.mainText} numberOfLines={1}>{item.pickupLabel}</Text>\r\n-          </View>\r\n-          <View style={[styles.row, { marginTop: 2 }]}>\r\n-            <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n-            <Text style={styles.subText} numberOfLines={1}>{item.destinationLabel}</Text>\r\n-          </View>\r\n-          <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n-        </View>\r\n-        <Text style={styles.priceText}>{php(item.fare)}</Text>\r\n-      </View>\r\n-    </TouchableOpacity>\r\n-  );\r\n-}\r\n-\r\n-function SkeletonCard() {\r\n-  return (\r\n-    <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n-      <View style={styles.row}>\r\n-        <View style={{ width: 48, height: 48, borderRadius: 8, backgroundColor: \"#eee\" }} />\r\n-        <View style={{ flex: 1, marginLeft: 12 }}>\r\n-          <View style={{ height: 12, backgroundColor: \"#eee\", borderRadius: 6, width: \"70%\" }} />\r\n-          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"60%\", marginTop: 8 }} />\r\n-          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"40%\", marginTop: 8 }} />\r\n-        </View>\r\n-        <View style={{ width: 60, height: 14, backgroundColor: \"#eee\", borderRadius: 7 }} />\r\n-      </View>\r\n-    </View>\r\n-  );\r\n-}\r\n-\r\n-const styles = StyleSheet.create({\r\n-  container: { flex: 1, backgroundColor: \"#fff\" },\r\n-  topBar: { paddingTop: 40, paddingHorizontal: 20, paddingBottom: 12 },\r\n-  heading: { fontWeight: \"bold\", fontSize: 22 },\r\n-\r\n-  emptyWrap: { flex: 1, justifyContent: \"center\", alignItems: \"center\", paddingHorizontal: 20 },\r\n-  emptyImage: { width: 150, height: 150, marginBottom: 20, resizeMode: \"contain\" },\r\n-  emptyMsg: { textAlign: \"center\", fontSize: 14, color: \"#333\" },\r\n-\r\n-  card: {\r\n-    backgroundColor: \"#fff\",\r\n-    borderRadius: 16,\r\n-    padding: 14,\r\n-    marginTop: 12,\r\n-    shadowColor: \"#000\",\r\n-    shadowOpacity: 0.08,\r\n-    shadowRadius: 8,\r\n-    shadowOffset: { width: 0, height: 4 },\r\n-    elevation: 3,\r\n-    borderWidth: 0.5,\r\n-    borderColor: \"#eee\",\r\n-  },\r\n-  row: { flexDirection: \"row\", alignItems: \"center\" },\r\n-  thumb: { width: 48, height: 48, marginRight: 12, resizeMode: \"contain\" },\r\n-  mainText: { marginLeft: 6, fontSize: 14, fontWeight: \"600\", color: \"#111\", flexShrink: 1 },\r\n-  subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n-  timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n-  priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n-\r\n-  viewMoreBtn: {\r\n-    marginTop: 12,\r\n-    alignSelf: \"center\",\r\n-    paddingHorizontal: 16,\r\n-    paddingVertical: 10,\r\n-    borderRadius: 999,\r\n-    borderWidth: 1,\r\n-    borderColor: \"#ddd\",\r\n-  },\r\n-  viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n-  noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n-});\r\n"
                },
                {
                    "date": 1761319778887,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n-  RefreshControl, TouchableOpacity, ActivityIndicator\r\n+  RefreshControl, TouchableOpacity, ActivityIndicator, Alert, TextInput, Modal\r\n } from \"react-native\";\r\n import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n import { API_BASE_URL } from \"../../config\";\r\n@@ -10,12 +10,25 @@\n const { width } = Dimensions.get(\"window\");\r\n \r\n type RideItem = {\r\n   _id: string;\r\n-  pickupLabel: string;\r\n-  destinationLabel: string;\r\n+  bookingId?: string;\r\n+  pickupLabel?: string;\r\n+  pickupPlace?: string;\r\n+  pickupAddress?: string;\r\n+  pickupName?: string;\r\n+  destinationLabel?: string;\r\n+  destinationPlace?: string;\r\n+  destinationAddress?: string;\r\n+  destinationName?: string;\r\n+  pickupLat?: number; pickupLng?: number;\r\n+  destinationLat?: number; destinationLng?: number;\r\n   fare: number;\r\n   createdAt: string;\r\n+  paymentMethod?: string;\r\n+  notes?: string;\r\n+  driverId?: string;\r\n+  driverName?: string; // if you add later\r\n };\r\n \r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n@@ -23,8 +36,10 @@\n   const [visible, setVisible] = useState(10);\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n   const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n+  const [expanded, setExpanded] = useState<Set<string>>(new Set());\r\n+  const [reportOpen, setReportOpen] = useState<{ id: string | null; text: string }>({ id: null, text: \"\" });\r\n \r\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n@@ -39,28 +54,34 @@\n     new Date(iso).toLocaleString(\"en-PH\", {\r\n       year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n     });\r\n \r\n+  const placeName = (r: any, kind: \"pickup\" | \"destination\") => {\r\n+    const fields = [\r\n+      `${kind}Place`, `${kind}Label`, `${kind}Name`, `${kind}Address`,\r\n+    ];\r\n+    for (const f of fields) {\r\n+      if (r[f] && String(r[f]).trim()) return String(r[f]);\r\n+    }\r\n+    // No coords shown; just a friendly fallback\r\n+    return kind === \"pickup\" ? \"Pickup location\" : \"Destination\";\r\n+  };\r\n+\r\n   const normalize = (raw: any[]): RideItem[] =>\r\n-    (raw || []).map((r: any) => {\r\n-      const pickupLabel =\r\n-        r.pickupLabel ??\r\n-        (Number.isFinite(r.pickupLat) && Number.isFinite(r.pickupLng)\r\n-          ? `${Number(r.pickupLat).toFixed(5)}, ${Number(r.pickupLng).toFixed(5)}`\r\n-          : \"Pickup\");\r\n-      const destinationLabel =\r\n-        r.destinationLabel ??\r\n-        (Number.isFinite(r.destinationLat) && Number.isFinite(r.destinationLng)\r\n-          ? `${Number(r.destinationLat).toFixed(5)}, ${Number(r.destinationLng).toFixed(5)}`\r\n-          : \"Destination\");\r\n-      return {\r\n-        _id: String(r._id),\r\n-        pickupLabel,\r\n-        destinationLabel,\r\n-        fare: Number(r.fare || 0),\r\n-        createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n-      };\r\n-    });\r\n+    (raw || []).map((r: any) => ({\r\n+      _id: String(r._id),\r\n+      bookingId: r.bookingId,\r\n+      pickupLabel: placeName(r, \"pickup\"),\r\n+      destinationLabel: placeName(r, \"destination\"),\r\n+      fare: Number(r.fare || 0),\r\n+      createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n+      paymentMethod: r.paymentMethod || \"\",\r\n+      notes: r.notes || \"\",\r\n+      driverId: r.driverId,\r\n+      driverName: r.driverName, // if backend adds it later, itll render\r\n+      pickupPlace: r.pickupPlace, destinationPlace: r.destinationPlace,\r\n+      pickupAddress: r.pickupAddress, destinationAddress: r.destinationAddress,\r\n+    }));\r\n \r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n@@ -71,9 +92,8 @@\n         `/api/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n         `/rides`,\r\n         `/api/rides`,\r\n       ];\r\n-\r\n       let got: RideItem[] | null = null;\r\n \r\n       for (let i = 0; i < paths.length; i++) {\r\n         const url = `${base}${paths[i]}`;\r\n@@ -82,19 +102,15 @@\n           const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n           const text = await res.text();\r\n           let data: any;\r\n           try { data = JSON.parse(text); } catch { continue; }\r\n-\r\n           let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n-          if (filterLocally) raw = raw.filter((r: any) => String(r.passengerId) === String(passengerId));\r\n-\r\n+          if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n           got = normalize(raw);\r\n           break;\r\n         } catch {}\r\n       }\r\n-\r\n       if (!got) got = [];\r\n-\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n     } finally {\r\n       setLoading(false);\r\n@@ -111,8 +127,61 @@\n \r\n   const dataToShow = allItems.slice(0, visible);\r\n   const hasMoreLocal = visible < allItems.length;\r\n \r\n+  const toggleExpand = (id: string) => {\r\n+    setExpanded((prev) => {\r\n+      const n = new Set(prev);\r\n+      n.has(id) ? n.delete(id) : n.add(id);\r\n+      return n;\r\n+    });\r\n+  };\r\n+\r\n+  const tryDelete = async (id: string) => {\r\n+    Alert.alert(\"Delete ride\", \"Are you sure you want to delete this history item?\", [\r\n+      { text: \"Cancel\", style: \"cancel\" },\r\n+      {\r\n+        text: \"Delete\",\r\n+        style: \"destructive\",\r\n+        onPress: async () => {\r\n+          // optimistic UI\r\n+          setAllItems((list) => list.filter((x) => x._id !== id));\r\n+          try {\r\n+            const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n+            const urls = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n+            for (const u of urls) {\r\n+              try {\r\n+                await fetch(u, { method: \"DELETE\" });\r\n+                break;\r\n+              } catch {}\r\n+            }\r\n+          } catch {}\r\n+        },\r\n+      },\r\n+    ]);\r\n+  };\r\n+\r\n+  const tryReport = async (id: string) => {\r\n+    setReportOpen({ id, text: \"\" });\r\n+  };\r\n+  const submitReport = async () => {\r\n+    const id = reportOpen.id;\r\n+    if (!id) return setReportOpen({ id: null, text: \"\" });\r\n+    const reason = reportOpen.text.trim();\r\n+    if (!reason) { Alert.alert(\"Report\", \"Please enter a short reason.\"); return; }\r\n+    try {\r\n+      const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n+      const body = JSON.stringify({ reason });\r\n+      const opts = { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body };\r\n+      const urls = [`${base}/ridehistory/${id}/report`, `${base}/api/ridehistory/${id}/report`];\r\n+      for (const u of urls) {\r\n+        try { await fetch(u, opts); break; } catch {}\r\n+      }\r\n+      Alert.alert(\"Report sent\", \"Thanks for the report. Well review it.\");\r\n+    } catch {}\r\n+    setReportOpen({ id: null, text: \"\" });\r\n+  };\r\n+\r\n   if (!loading && allItems.length === 0) {\r\n     return (\r\n       <View style={styles.container}>\r\n         <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n@@ -140,9 +209,19 @@\n           data={dataToShow}\r\n           keyExtractor={(it) => it._id}\r\n           contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 24 }}\r\n           refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n-          renderItem={({ item }) => <HistoryCard item={item} php={php} when={when} />}\r\n+          renderItem={({ item }) => (\r\n+            <HistoryCard\r\n+              item={item}\r\n+              php={php}\r\n+              when={when}\r\n+              expanded={expanded.has(item._id)}\r\n+              onToggle={() => toggleExpand(item._id)}\r\n+              onDelete={() => tryDelete(item._id)}\r\n+              onReport={() => tryReport(item._id)}\r\n+            />\r\n+          )}\r\n           ListFooterComponent={\r\n             hasMoreLocal ? (\r\n               <TouchableOpacity\r\n                 style={styles.viewMoreBtn}\r\n@@ -155,17 +234,50 @@\n             ) : null\r\n           }\r\n         />\r\n       )}\r\n+\r\n+      {/* Report modal */}\r\n+      <Modal visible={!!reportOpen.id} transparent animationType=\"fade\" onRequestClose={() => setReportOpen({ id: null, text: \"\" })}>\r\n+        <View style={styles.modalWrap}>\r\n+          <View style={styles.modalCard}>\r\n+            <Text style={{ fontWeight: \"700\", fontSize: 16, marginBottom: 8 }}>Report this ride</Text>\r\n+            <TextInput\r\n+              placeholder=\"What went wrong?\"\r\n+              placeholderTextColor=\"#999\"\r\n+              value={reportOpen.text}\r\n+              onChangeText={(t) => setReportOpen((p) => ({ ...p, text: t }))}\r\n+              style={styles.input}\r\n+              multiline\r\n+            />\r\n+            <View style={{ flexDirection: \"row\", justifyContent: \"flex-end\" }}>\r\n+              <TouchableOpacity onPress={() => setReportOpen({ id: null, text: \"\" })} style={{ padding: 10, marginRight: 8 }}>\r\n+                <Text>Cancel</Text>\r\n+              </TouchableOpacity>\r\n+              <TouchableOpacity onPress={submitReport} style={styles.reportBtn}>\r\n+                <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>Submit</Text>\r\n+              </TouchableOpacity>\r\n+            </View>\r\n+          </View>\r\n+        </View>\r\n+      </Modal>\r\n     </View>\r\n   );\r\n }\r\n \r\n function HistoryCard({\r\n-  item, php, when,\r\n-}: { item: RideItem; php: (n: number) => string; when: (iso: string) => string }) {\r\n+  item, php, when, expanded, onToggle, onDelete, onReport,\r\n+}: {\r\n+  item: RideItem;\r\n+  php: (n: number) => string;\r\n+  when: (iso: string) => string;\r\n+  expanded: boolean;\r\n+  onToggle: () => void;\r\n+  onDelete: () => void;\r\n+  onReport: () => void;\r\n+}) {\r\n   return (\r\n-    <TouchableOpacity activeOpacity={0.8} style={styles.card}>\r\n+    <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n         <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n         <View style={{ flex: 1, paddingRight: 8 }}>\r\n           <View style={styles.row}>\r\n@@ -179,8 +291,39 @@\n           <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n         </View>\r\n         <Text style={styles.priceText}>{php(item.fare)}</Text>\r\n       </View>\r\n+\r\n+      {expanded && (\r\n+        <View style={styles.expandBox}>\r\n+          {/* Driver */}\r\n+          <Text style={styles.expandTitle}>\r\n+            Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || item.driverId || \"\"}</Text>\r\n+          </Text>\r\n+\r\n+          {/* Note */}\r\n+          {item.notes ? (\r\n+            <Text style={styles.expandNote} numberOfLines={3}>Note: {item.notes}</Text>\r\n+          ) : null}\r\n+\r\n+          {/* Meta row + actions */}\r\n+          <View style={styles.expandFooter}>\r\n+            <View style={{ flex: 1 }}>\r\n+              {!!item.bookingId && <Text style={styles.meta}>Booking: {item.bookingId}</Text>}\r\n+              {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n+            </View>\r\n+\r\n+            <View style={styles.actionsRow}>\r\n+              <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000\" />\r\n+              </TouchableOpacity>\r\n+              <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n+                <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n+              </TouchableOpacity>\r\n+            </View>\r\n+          </View>\r\n+        </View>\r\n+      )}\r\n     </TouchableOpacity>\r\n   );\r\n }\r\n \r\n@@ -220,11 +363,35 @@\n   subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n   timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n   priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n \r\n+  expandBox: {\r\n+    marginTop: 10, paddingTop: 10, borderTopWidth: 1, borderTopColor: \"#eee\",\r\n+  },\r\n+  expandTitle: { fontSize: 14, marginBottom: 6, color: \"#111\" },\r\n+  expandNote: { fontSize: 13, color: \"#333\", marginBottom: 8 },\r\n+  expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n+  meta: { fontSize: 12, color: \"#666\" },\r\n+\r\n+  actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n+  warnBtn: {\r\n+    borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\",\r\n+    padding: 8, borderRadius: 12,\r\n+  },\r\n+  trashBtn: {\r\n+    borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\",\r\n+    padding: 8, borderRadius: 12,\r\n+  },\r\n+\r\n   viewMoreBtn: {\r\n     marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10,\r\n     borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\",\r\n   },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n+\r\n+  // modal\r\n+  modalWrap: { flex: 1, backgroundColor: \"rgba(0,0,0,0.4)\", alignItems: \"center\", justifyContent: \"center\", padding: 20 },\r\n+  modalCard: { width: \"100%\", maxWidth: 420, backgroundColor: \"#fff\", borderRadius: 12, padding: 16 },\r\n+  input: { borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10, marginVertical: 12, minHeight: 80, textAlignVertical: \"top\" },\r\n+  reportBtn: { backgroundColor: \"#b00000\", paddingVertical: 10, paddingHorizontal: 14, borderRadius: 8, minWidth: 90, alignItems: \"center\" },\r\n });\r\n"
                },
                {
                    "date": 1761321634677,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,9 @@\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n-  RefreshControl, TouchableOpacity, ActivityIndicator, Alert, TextInput, Modal\r\n+  RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n+  Modal, TextInput\r\n } from \"react-native\";\r\n import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n import { API_BASE_URL } from \"../../config\";\r\n@@ -11,36 +12,49 @@\n \r\n type RideItem = {\r\n   _id: string;\r\n   bookingId?: string;\r\n+  passengerId?: string;\r\n+  driverId?: string;\r\n+  driverName?: string;\r\n   pickupLabel?: string;\r\n   pickupPlace?: string;\r\n   pickupAddress?: string;\r\n   pickupName?: string;\r\n   destinationLabel?: string;\r\n   destinationPlace?: string;\r\n   destinationAddress?: string;\r\n   destinationName?: string;\r\n-  pickupLat?: number; pickupLng?: number;\r\n-  destinationLat?: number; destinationLng?: number;\r\n   fare: number;\r\n   createdAt: string;\r\n   paymentMethod?: string;\r\n   notes?: string;\r\n-  driverId?: string;\r\n-  driverName?: string; // if you add later\r\n };\r\n \r\n+const REPORT_OPTIONS = [\r\n+  \"Overcharging\",\r\n+  \"Harassment\",\r\n+  \"Unproper Attire\",\r\n+  \"Refusal to Convey Passenger\",\r\n+  \"Other\",\r\n+];\r\n+\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n   const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n   const [expanded, setExpanded] = useState<Set<string>>(new Set());\r\n-  const [reportOpen, setReportOpen] = useState<{ id: string | null; text: string }>({ id: null, text: \"\" });\r\n \r\n+  // report modal state (same style/logic you use in pHome)\r\n+  const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string; driverId?: string }>({ id: null });\r\n+  const [reportType, setReportType] = useState(\"\");\r\n+  const [otherReport, setOtherReport] = useState(\"\");\r\n+  const [showDropdown, setShowDropdown] = useState(false);\r\n+  const [sendingReport, setSendingReport] = useState(false);\r\n+\r\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n@@ -55,30 +69,26 @@\n       year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n     });\r\n \r\n   const placeName = (r: any, kind: \"pickup\" | \"destination\") => {\r\n-    const fields = [\r\n-      `${kind}Place`, `${kind}Label`, `${kind}Name`, `${kind}Address`,\r\n-    ];\r\n-    for (const f of fields) {\r\n-      if (r[f] && String(r[f]).trim()) return String(r[f]);\r\n-    }\r\n-    // No coords shown; just a friendly fallback\r\n+    const fields = [`${kind}Place`, `${kind}Label`, `${kind}Name`, `${kind}Address`];\r\n+    for (const f of fields) if (r[f] && String(r[f]).trim()) return String(r[f]);\r\n     return kind === \"pickup\" ? \"Pickup location\" : \"Destination\";\r\n   };\r\n \r\n   const normalize = (raw: any[]): RideItem[] =>\r\n     (raw || []).map((r: any) => ({\r\n       _id: String(r._id),\r\n       bookingId: r.bookingId,\r\n+      passengerId: r.passengerId,\r\n+      driverId: r.driverId,\r\n+      driverName: r.driverName,\r\n       pickupLabel: placeName(r, \"pickup\"),\r\n       destinationLabel: placeName(r, \"destination\"),\r\n       fare: Number(r.fare || 0),\r\n       createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n       paymentMethod: r.paymentMethod || \"\",\r\n       notes: r.notes || \"\",\r\n-      driverId: r.driverId,\r\n-      driverName: r.driverName, // if backend adds it later, itll render\r\n       pickupPlace: r.pickupPlace, destinationPlace: r.destinationPlace,\r\n       pickupAddress: r.pickupAddress, destinationAddress: r.destinationAddress,\r\n     }));\r\n \r\n@@ -135,9 +145,9 @@\n       return n;\r\n     });\r\n   };\r\n \r\n-  const tryDelete = async (id: string) => {\r\n+  const askDelete = (id: string) => {\r\n     Alert.alert(\"Delete ride\", \"Are you sure you want to delete this history item?\", [\r\n       { text: \"Cancel\", style: \"cancel\" },\r\n       {\r\n         text: \"Delete\",\r\n@@ -148,38 +158,51 @@\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n             const urls = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n             for (const u of urls) {\r\n-              try {\r\n-                await fetch(u, { method: \"DELETE\" });\r\n-                break;\r\n-              } catch {}\r\n+              try { await fetch(u, { method: \"DELETE\" }); break; } catch {}\r\n             }\r\n           } catch {}\r\n         },\r\n       },\r\n     ]);\r\n   };\r\n \r\n-  const tryReport = async (id: string) => {\r\n-    setReportOpen({ id, text: \"\" });\r\n+  const openReport = (item: RideItem) => {\r\n+    setReportType(\"\");\r\n+    setOtherReport(\"\");\r\n+    setShowDropdown(false);\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverId });\r\n   };\r\n+\r\n   const submitReport = async () => {\r\n-    const id = reportOpen.id;\r\n-    if (!id) return setReportOpen({ id: null, text: \"\" });\r\n-    const reason = reportOpen.text.trim();\r\n-    if (!reason) { Alert.alert(\"Report\", \"Please enter a short reason.\"); return; }\r\n+    if (!reportOpen.id || !passengerId) return;\r\n+    if (!reportType) return Alert.alert(\"Report\", \"Please select a violation.\");\r\n+    if (reportType === \"Other\" && !otherReport.trim())\r\n+      return Alert.alert(\"Report\", \"Please describe the issue.\");\r\n+\r\n     try {\r\n-      const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n-      const body = JSON.stringify({ reason });\r\n-      const opts = { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body };\r\n-      const urls = [`${base}/ridehistory/${id}/report`, `${base}/api/ridehistory/${id}/report`];\r\n-      for (const u of urls) {\r\n-        try { await fetch(u, opts); break; } catch {}\r\n-      }\r\n-      Alert.alert(\"Report sent\", \"Thanks for the report. Well review it.\");\r\n-    } catch {}\r\n-    setReportOpen({ id: null, text: \"\" });\r\n+      setSendingReport(true);\r\n+      const res = await fetch(`${API_BASE_URL.replace(/\\/$/, \"\")}/api/feedback/submit-report`, {\r\n+        method: \"POST\",\r\n+        headers: { \"Content-Type\": \"application/json\" },\r\n+        body: JSON.stringify({\r\n+          bookingId: reportOpen.bookingId,\r\n+          passengerId,\r\n+          driverId: reportOpen.driverId,\r\n+          reportType,\r\n+          otherReport,\r\n+        }),\r\n+      });\r\n+      const j = await res.json().catch(() => ({}));\r\n+      if (!res.ok) throw new Error(j?.message || \"Failed to submit report.\");\r\n+      Alert.alert(\"Success\", \"Report submitted!\");\r\n+      setReportOpen({ id: null });\r\n+    } catch (e: any) {\r\n+      Alert.alert(\"Error\", e?.message || \"Something went wrong.\");\r\n+    } finally {\r\n+      setSendingReport(false);\r\n+    }\r\n   };\r\n \r\n   if (!loading && allItems.length === 0) {\r\n     return (\r\n@@ -216,10 +239,10 @@\n               php={php}\r\n               when={when}\r\n               expanded={expanded.has(item._id)}\r\n               onToggle={() => toggleExpand(item._id)}\r\n-              onDelete={() => tryDelete(item._id)}\r\n-              onReport={() => tryReport(item._id)}\r\n+              onDelete={() => askDelete(item._id)}\r\n+              onReport={() => openReport(item)}\r\n             />\r\n           )}\r\n           ListFooterComponent={\r\n             hasMoreLocal ? (\r\n@@ -235,29 +258,57 @@\n           }\r\n         />\r\n       )}\r\n \r\n-      {/* Report modal */}\r\n-      <Modal visible={!!reportOpen.id} transparent animationType=\"fade\" onRequestClose={() => setReportOpen({ id: null, text: \"\" })}>\r\n-        <View style={styles.modalWrap}>\r\n-          <View style={styles.modalCard}>\r\n-            <Text style={{ fontWeight: \"700\", fontSize: 16, marginBottom: 8 }}>Report this ride</Text>\r\n-            <TextInput\r\n-              placeholder=\"What went wrong?\"\r\n-              placeholderTextColor=\"#999\"\r\n-              value={reportOpen.text}\r\n-              onChangeText={(t) => setReportOpen((p) => ({ ...p, text: t }))}\r\n-              style={styles.input}\r\n-              multiline\r\n-            />\r\n-            <View style={{ flexDirection: \"row\", justifyContent: \"flex-end\" }}>\r\n-              <TouchableOpacity onPress={() => setReportOpen({ id: null, text: \"\" })} style={{ padding: 10, marginRight: 8 }}>\r\n-                <Text>Cancel</Text>\r\n+      {/* Report modal (same UX as your pHome) */}\r\n+      <Modal visible={!!reportOpen.id} transparent animationType=\"fade\" onRequestClose={() => setReportOpen({ id: null })}>\r\n+        <View style={styles.modalOverlay}>\r\n+          <View style={[styles.modalCard, { alignItems: \"stretch\" }]}>\r\n+            <TouchableOpacity style={styles.dismissButton} onPress={() => setReportOpen({ id: null })}>\r\n+              <Ionicons name=\"close\" size={24} color=\"gray\" />\r\n+            </TouchableOpacity>\r\n+\r\n+            <Text style={styles.modalTitle}>Report Driver</Text>\r\n+\r\n+            <Text style={styles.modalLabel}>Select Report Type:</Text>\r\n+            <View style={styles.dropdownContainer}>\r\n+              <TouchableOpacity style={styles.dropdownButton} onPress={() => setShowDropdown(!showDropdown)}>\r\n+                <Text style={{ color: reportType ? \"#000\" : \"#999\" }}>{reportType || \"Select a violation\"}</Text>\r\n+                <Ionicons name={showDropdown ? \"chevron-up\" : \"chevron-down\"} size={20} color=\"#999\" />\r\n               </TouchableOpacity>\r\n-              <TouchableOpacity onPress={submitReport} style={styles.reportBtn}>\r\n-                <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>Submit</Text>\r\n-              </TouchableOpacity>\r\n+\r\n+              {showDropdown && (\r\n+                <View style={styles.dropdownMenu}>\r\n+                  {REPORT_OPTIONS.map((opt) => (\r\n+                    <TouchableOpacity\r\n+                      key={opt}\r\n+                      style={styles.dropdownItem}\r\n+                      onPress={() => { setReportType(opt); setShowDropdown(false); }}\r\n+                    >\r\n+                      <Text style={{ color: \"#000\" }}>{opt}</Text>\r\n+                    </TouchableOpacity>\r\n+                  ))}\r\n+                </View>\r\n+              )}\r\n             </View>\r\n+\r\n+            {reportType === \"Other\" && (\r\n+              <TextInput\r\n+                style={styles.feedbackInput}\r\n+                placeholder=\"Describe the issue\"\r\n+                placeholderTextColor=\"#A0A0A0\"\r\n+                multiline numberOfLines={3}\r\n+                value={otherReport} onChangeText={setOtherReport}\r\n+              />\r\n+            )}\r\n+\r\n+            <TouchableOpacity\r\n+              style={[styles.submitButton, { backgroundColor: \"#4CAF50\", opacity: sendingReport ? 0.6 : 1 }]}\r\n+              onPress={submitReport}\r\n+              disabled={sendingReport}\r\n+            >\r\n+              <Text style={styles.submitButtonText}>{sendingReport ? \"Submitting...\" : \"Submit Report\"}</Text>\r\n+            </TouchableOpacity>\r\n           </View>\r\n         </View>\r\n       </Modal>\r\n     </View>\r\n@@ -294,19 +345,14 @@\n       </View>\r\n \r\n       {expanded && (\r\n         <View style={styles.expandBox}>\r\n-          {/* Driver */}\r\n           <Text style={styles.expandTitle}>\r\n             Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || item.driverId || \"\"}</Text>\r\n           </Text>\r\n \r\n-          {/* Note */}\r\n-          {item.notes ? (\r\n-            <Text style={styles.expandNote} numberOfLines={3}>Note: {item.notes}</Text>\r\n-          ) : null}\r\n+          {!!item.notes && <Text style={styles.expandNote} numberOfLines={3}>Note: {item.notes}</Text>}\r\n \r\n-          {/* Meta row + actions */}\r\n           <View style={styles.expandFooter}>\r\n             <View style={{ flex: 1 }}>\r\n               {!!item.bookingId && <Text style={styles.meta}>Booking: {item.bookingId}</Text>}\r\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n@@ -363,35 +409,32 @@\n   subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n   timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n   priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n \r\n-  expandBox: {\r\n-    marginTop: 10, paddingTop: 10, borderTopWidth: 1, borderTopColor: \"#eee\",\r\n-  },\r\n+  expandBox: { marginTop: 10, paddingTop: 10, borderTopWidth: 1, borderTopColor: \"#eee\" },\r\n   expandTitle: { fontSize: 14, marginBottom: 6, color: \"#111\" },\r\n   expandNote: { fontSize: 13, color: \"#333\", marginBottom: 8 },\r\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: {\r\n-    borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\",\r\n-    padding: 8, borderRadius: 12,\r\n-  },\r\n-  trashBtn: {\r\n-    borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\",\r\n-    padding: 8, borderRadius: 12,\r\n-  },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n-  viewMoreBtn: {\r\n-    marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10,\r\n-    borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\",\r\n-  },\r\n+  viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n \r\n-  // modal\r\n-  modalWrap: { flex: 1, backgroundColor: \"rgba(0,0,0,0.4)\", alignItems: \"center\", justifyContent: \"center\", padding: 20 },\r\n+  // Report modal (mirrors your pHome UX)\r\n+  modalOverlay: { flex: 1, backgroundColor: \"rgba(0,0,0,0.4)\", justifyContent: \"center\", alignItems: \"center\", padding: 20 },\r\n   modalCard: { width: \"100%\", maxWidth: 420, backgroundColor: \"#fff\", borderRadius: 12, padding: 16 },\r\n-  input: { borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10, marginVertical: 12, minHeight: 80, textAlignVertical: \"top\" },\r\n-  reportBtn: { backgroundColor: \"#b00000\", paddingVertical: 10, paddingHorizontal: 14, borderRadius: 8, minWidth: 90, alignItems: \"center\" },\r\n+  dismissButton: { position: \"absolute\", right: 8, top: 8, padding: 8, zIndex: 1 },\r\n+  modalTitle: { fontWeight: \"700\", fontSize: 16, textAlign: \"center\", marginBottom: 12, marginTop: 12 },\r\n+  modalLabel: { marginBottom: 6 },\r\n+  dropdownContainer: { marginBottom: 10 },\r\n+  dropdownButton: { flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10 },\r\n+  dropdownMenu: { marginTop: 6, borderRadius: 8, borderWidth: 1, borderColor: \"#ddd\", backgroundColor: \"#fff\", overflow: \"hidden\" },\r\n+  dropdownItem: { paddingHorizontal: 12, paddingVertical: 10, borderBottomWidth: 1, borderBottomColor: \"#eee\" },\r\n+  feedbackInput: { borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10, minHeight: 80, textAlignVertical: \"top\" },\r\n+  submitButton: { marginTop: 8, borderRadius: 8, paddingVertical: 10, alignItems: \"center\" },\r\n+  submitButtonText: { color: \"#fff\", fontWeight: \"600\" },\r\n });\r\n"
                },
                {
                    "date": 1761324774381,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -89,10 +89,15 @@\n       paymentMethod: r.paymentMethod || \"\",\r\n       notes: r.notes || \"\",\r\n       pickupPlace: r.pickupPlace, destinationPlace: r.destinationPlace,\r\n       pickupAddress: r.pickupAddress, destinationAddress: r.destinationAddress,\r\n-    }));\r\n+    })\r\n+  );\r\n+  \r\n+  const normalized = normalize(raw);\r\n+  console.log(\" Normalized rides:\", normalized);\r\n \r\n+\r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n@@ -118,8 +123,9 @@\n           got = normalize(raw);\r\n           break;\r\n         } catch {}\r\n       }\r\n+      console.log(\" Raw data fetched from backend:\", got);\r\n       if (!got) got = [];\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n     } finally {\r\n"
                },
                {
                    "date": 1761324799364,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -91,11 +91,8 @@\n       pickupPlace: r.pickupPlace, destinationPlace: r.destinationPlace,\r\n       pickupAddress: r.pickupAddress, destinationAddress: r.destinationAddress,\r\n     })\r\n   );\r\n-  \r\n-  const normalized = normalize(raw);\r\n-  console.log(\" Normalized rides:\", normalized);\r\n \r\n \r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n"
                },
                {
                    "date": 1761336844194,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,9 +92,11 @@\n       pickupAddress: r.pickupAddress, destinationAddress: r.destinationAddress,\r\n     })\r\n   );\r\n \r\n+  \r\n \r\n+\r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n@@ -156,21 +158,46 @@\n         text: \"Delete\",\r\n         style: \"destructive\",\r\n         onPress: async () => {\r\n           // optimistic UI\r\n+          const prev = allItems;\r\n           setAllItems((list) => list.filter((x) => x._id !== id));\r\n+\r\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n-            const urls = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n-            for (const u of urls) {\r\n-              try { await fetch(u, { method: \"DELETE\" }); break; } catch {}\r\n+            const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n+\r\n+            let success = false;\r\n+            for (const url of candidates) {\r\n+              try {\r\n+                console.log(\" calling\", url);\r\n+                const res = await fetch(url, { method: \"DELETE\" });\r\n+                const text = await res.text();\r\n+                console.log(\" delete response\", res.status, text);\r\n+                if (res.ok) { success = true; break; }\r\n+              } catch (e) {\r\n+                console.log(\" delete fetch failed\", e);\r\n+              }\r\n             }\r\n-          } catch {}\r\n+\r\n+            if (!success) {\r\n+              // rollback + tell user + hard refresh to be safe\r\n+              setAllItems(prev);\r\n+              Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n+              await fetchAll();\r\n+            }\r\n+          } catch (e) {\r\n+            console.log(\" delete unexpected error\", e);\r\n+            setAllItems(prev);\r\n+            Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n+            await fetchAll();\r\n+          }\r\n         },\r\n       },\r\n     ]);\r\n   };\r\n \r\n+\r\n   const openReport = (item: RideItem) => {\r\n     setReportType(\"\");\r\n     setOtherReport(\"\");\r\n     setShowDropdown(false);\r\n"
                },
                {
                    "date": 1761339678553,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n   RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n-  Modal, TextInput\r\n+  Modal, TextInput, LayoutAnimation, Platform, UIManager,\r\n } from \"react-native\";\r\n import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n import { API_BASE_URL } from \"../../config\";\r\n"
                },
                {
                    "date": 1761339811452,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,35 +9,35 @@\n import { API_BASE_URL } from \"../../config\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n+const REPORT_OPTIONS = [\r\n+  \"Overcharging\",\r\n+  \"Harassment\",\r\n+  \"Unproper Attire\",\r\n+  \"Refusal to Convey Passenger\",\r\n+  \"Other\",\r\n+];\r\n+if (Platform.OS === \"android\" && UIManager.setLayoutAnimationEnabledExperimental) {\r\n+  UIManager.setLayoutAnimationEnabledExperimental(true);\r\n+}\r\n+\r\n type RideItem = {\r\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n-  driverId?: string;\r\n   driverName?: string;\r\n-  pickupLabel?: string;\r\n-  pickupPlace?: string;\r\n-  pickupAddress?: string;\r\n-  pickupName?: string;\r\n-  destinationLabel?: string;\r\n-  destinationPlace?: string;\r\n-  destinationAddress?: string;\r\n-  destinationName?: string;\r\n-  fare: number;\r\n+  pickupPlace?: string; pickupAddress?: string; pickupLabel?: string; pickupName?: string;\r\n+  destinationPlace?: string; destinationAddress?: string; destinationLabel?: string; destinationName?: string;\r\n+  fare: number;          // legacy fare\r\n+  totalFare?: number;    // NEW preferred fare\r\n+  bookingType?: \"Classic\" | \"Group\" | \"Solo\"; // NEW\r\n+  groupCount?: number;   // NEW\r\n   createdAt: string;\r\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n-const REPORT_OPTIONS = [\r\n-  \"Overcharging\",\r\n-  \"Harassment\",\r\n-  \"Unproper Attire\",\r\n-  \"Refusal to Convey Passenger\",\r\n-  \"Other\",\r\n-];\r\n \r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n@@ -200,9 +200,9 @@\n   const openReport = (item: RideItem) => {\r\n     setReportType(\"\");\r\n     setOtherReport(\"\");\r\n     setShowDropdown(false);\r\n-    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverId });\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId});\r\n   };\r\n \r\n   const submitReport = async () => {\r\n     if (!reportOpen.id || !passengerId) return;\r\n@@ -376,9 +376,9 @@\n \r\n       {expanded && (\r\n         <View style={styles.expandBox}>\r\n           <Text style={styles.expandTitle}>\r\n-            Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || item.driverId || \"\"}</Text>\r\n+            Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName|| \"\"}</Text>\r\n           </Text>\r\n \r\n           {!!item.notes && <Text style={styles.expandNote} numberOfLines={3}>Note: {item.notes}</Text>}\r\n \r\n"
                },
                {
                    "date": 1761341068944,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,9 +44,9 @@\n   const [visible, setVisible] = useState(10);\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n   const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n-  const [expanded, setExpanded] = useState<Set<string>>(new Set());\r\n+  const [expanded, setExpanded] = useState<string | null>(null);\r\n \r\n   // report modal state (same style/logic you use in pHome)\r\n   const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string; driverId?: string }>({ id: null });\r\n   const [reportType, setReportType] = useState(\"\");\r\n@@ -70,9 +70,9 @@\n     });\r\n \r\n   const placeName = (r: any, kind: \"pickup\" | \"destination\") => {\r\n     const fields = [`${kind}Place`, `${kind}Label`, `${kind}Name`, `${kind}Address`];\r\n-    for (const f of fields) if (r[f] && String(r[f]).trim()) return String(r[f]);\r\n+    for (const f of fields) if (r[f] && String(r[f]).trim()) return String(r[f]).trim();\r\n     return kind === \"pickup\" ? \"Pickup location\" : \"Destination\";\r\n   };\r\n \r\n   const normalize = (raw: any[]): RideItem[] =>\r\n"
                },
                {
                    "date": 1761343013820,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n-  RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n-  Modal, TextInput, LayoutAnimation, Platform, UIManager,\r\n+  RefreshControl, TouchableOpacity, Alert, Modal, TextInput,\r\n+  LayoutAnimation, Platform, UIManager,\r\n } from \"react-native\";\r\n import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n import { API_BASE_URL } from \"../../config\";\r\n@@ -16,8 +16,10 @@\n   \"Unproper Attire\",\r\n   \"Refusal to Convey Passenger\",\r\n   \"Other\",\r\n ];\r\n+\r\n+// Enable layout animation on Android\r\n if (Platform.OS === \"android\" && UIManager.setLayoutAnimationEnabledExperimental) {\r\n   UIManager.setLayoutAnimationEnabledExperimental(true);\r\n }\r\n \r\n@@ -25,10 +27,12 @@\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n   driverName?: string;\r\n+\r\n   pickupPlace?: string; pickupAddress?: string; pickupLabel?: string; pickupName?: string;\r\n   destinationPlace?: string; destinationAddress?: string; destinationLabel?: string; destinationName?: string;\r\n+\r\n   fare: number;          // legacy fare\r\n   totalFare?: number;    // NEW preferred fare\r\n   bookingType?: \"Classic\" | \"Group\" | \"Solo\"; // NEW\r\n   groupCount?: number;   // NEW\r\n@@ -36,19 +40,20 @@\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n-\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n   const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n-  const [expanded, setExpanded] = useState<string | null>(null);\r\n \r\n-  // report modal state (same style/logic you use in pHome)\r\n+  // Single expanded card\r\n+  const [expandedId, setExpandedId] = useState<string | null>(null);\r\n+\r\n+  // Report modal state\r\n   const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string; driverId?: string }>({ id: null });\r\n   const [reportType, setReportType] = useState(\"\");\r\n   const [otherReport, setOtherReport] = useState(\"\");\r\n   const [showDropdown, setShowDropdown] = useState(false);\r\n@@ -79,24 +84,23 @@\n     (raw || []).map((r: any) => ({\r\n       _id: String(r._id),\r\n       bookingId: r.bookingId,\r\n       passengerId: r.passengerId,\r\n-      driverId: r.driverId,\r\n       driverName: r.driverName,\r\n-      pickupLabel: placeName(r, \"pickup\"),\r\n-      destinationLabel: placeName(r, \"destination\"),\r\n+\r\n+      pickupPlace: r.pickupPlace, pickupAddress: r.pickupAddress, pickupLabel: r.pickupLabel, pickupName: r.pickupName,\r\n+      destinationPlace: r.destinationPlace, destinationAddress: r.destinationAddress, destinationLabel: r.destinationLabel, destinationName: r.destinationName,\r\n+\r\n       fare: Number(r.fare || 0),\r\n+      totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n+      bookingType: r.bookingType,\r\n+      groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n+\r\n       createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n       paymentMethod: r.paymentMethod || \"\",\r\n       notes: r.notes || \"\",\r\n-      pickupPlace: r.pickupPlace, destinationPlace: r.destinationPlace,\r\n-      pickupAddress: r.pickupAddress, destinationAddress: r.destinationAddress,\r\n-    })\r\n-  );\r\n+    }));\r\n \r\n-  \r\n-\r\n-\r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n@@ -143,13 +147,10 @@\n   const dataToShow = allItems.slice(0, visible);\r\n   const hasMoreLocal = visible < allItems.length;\r\n \r\n   const toggleExpand = (id: string) => {\r\n-    setExpanded((prev) => {\r\n-      const n = new Set(prev);\r\n-      n.has(id) ? n.delete(id) : n.add(id);\r\n-      return n;\r\n-    });\r\n+    LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);\r\n+    setExpandedId((cur) => (cur === id ? null : id));\r\n   };\r\n \r\n   const askDelete = (id: string) => {\r\n     Alert.alert(\"Delete ride\", \"Are you sure you want to delete this history item?\", [\r\n@@ -160,8 +161,9 @@\n         onPress: async () => {\r\n           // optimistic UI\r\n           const prev = allItems;\r\n           setAllItems((list) => list.filter((x) => x._id !== id));\r\n+          if (expandedId === id) setExpandedId(null);\r\n \r\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n             const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n@@ -195,14 +197,13 @@\n       },\r\n     ]);\r\n   };\r\n \r\n-\r\n   const openReport = (item: RideItem) => {\r\n     setReportType(\"\");\r\n     setOtherReport(\"\");\r\n     setShowDropdown(false);\r\n-    setReportOpen({ id: item._id, bookingId: item.bookingId});\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId });\r\n   };\r\n \r\n   const submitReport = async () => {\r\n     if (!reportOpen.id || !passengerId) return;\r\n@@ -217,9 +218,9 @@\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n           bookingId: reportOpen.bookingId,\r\n           passengerId,\r\n-          driverId: reportOpen.driverId,\r\n+          // driverId intentionally omitted for privacy (send if your backend requires)\r\n           reportType,\r\n           otherReport,\r\n         }),\r\n       });\r\n@@ -267,9 +268,9 @@\n             <HistoryCard\r\n               item={item}\r\n               php={php}\r\n               when={when}\r\n-              expanded={expanded.has(item._id)}\r\n+              expanded={expandedId === item._id}\r\n               onToggle={() => toggleExpand(item._id)}\r\n               onDelete={() => askDelete(item._id)}\r\n               onReport={() => openReport(item)}\r\n             />\r\n@@ -344,8 +345,10 @@\n     </View>\r\n   );\r\n }\r\n \r\n+/* ---------- Card components ---------- */\r\n+\r\n function HistoryCard({\r\n   item, php, when, expanded, onToggle, onDelete, onReport,\r\n }: {\r\n   item: RideItem;\r\n@@ -355,40 +358,64 @@\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n+  const pickup = item.pickupPlace || item.pickupLabel || item.pickupName || item.pickupAddress || \"Pickup location\";\r\n+  const dest = item.destinationPlace || item.destinationLabel || item.destinationName || item.destinationAddress || \"Destination\";\r\n+  const price = item.totalFare != null ? item.totalFare : item.fare;\r\n+\r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n         <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n         <View style={{ flex: 1, paddingRight: 8 }}>\r\n-          <View style={styles.row}>\r\n-            <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n-            <Text style={styles.mainText} numberOfLines={1}>{item.pickupLabel}</Text>\r\n+          <View style={[styles.row, { justifyContent: \"space-between\" }]}>\r\n+            <View style={styles.row}>\r\n+              <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n+              <Text style={styles.mainText} numberOfLines={1}>{pickup}</Text>\r\n+            </View>\r\n+\r\n+            {!!item.bookingType && (\r\n+              <View style={[styles.typeChip, typeChipStyle(item.bookingType)]}>\r\n+                <Text style={styles.typeChipText}>{item.bookingType}</Text>\r\n+              </View>\r\n+            )}\r\n           </View>\r\n+\r\n           <View style={[styles.row, { marginTop: 2 }]}>\r\n             <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n-            <Text style={styles.subText} numberOfLines={1}>{item.destinationLabel}</Text>\r\n+            <Text style={styles.subText} numberOfLines={1}>{dest}</Text>\r\n           </View>\r\n-          <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n+\r\n+          <View style={[styles.row, { marginTop: 4, justifyContent: \"space-between\" }]}>\r\n+            <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n+\r\n+            {item.bookingType === \"Group\" && typeof item.groupCount === \"number\" && (\r\n+              <View style={styles.groupChip}>\r\n+                <Ionicons name=\"people-outline\" size={14} color=\"#333\" />\r\n+                <Text style={{ marginLeft: 4, fontSize: 12, color: \"#333\" }}>\r\n+                  {item.groupCount} pax\r\n+                </Text>\r\n+              </View>\r\n+            )}\r\n+          </View>\r\n         </View>\r\n-        <Text style={styles.priceText}>{php(item.fare)}</Text>\r\n+\r\n+        <Text style={styles.priceText}>{php(price)}</Text>\r\n       </View>\r\n \r\n       {expanded && (\r\n         <View style={styles.expandBox}>\r\n           <Text style={styles.expandTitle}>\r\n-            Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName|| \"\"}</Text>\r\n+            Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || \"\"}</Text>\r\n           </Text>\r\n+          {!!item.notes && <Text style={styles.expandNote} numberOfLines={4}>Note: {item.notes}</Text>}\r\n \r\n-          {!!item.notes && <Text style={styles.expandNote} numberOfLines={3}>Note: {item.notes}</Text>}\r\n-\r\n           <View style={styles.expandFooter}>\r\n             <View style={{ flex: 1 }}>\r\n               {!!item.bookingId && <Text style={styles.meta}>Booking: {item.bookingId}</Text>}\r\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n-\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n                 <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n@@ -418,13 +445,28 @@\n     </View>\r\n   );\r\n }\r\n \r\n+/* ---------- Styles & helpers ---------- */\r\n+\r\n+function typeChipStyle(t?: string) {\r\n+  switch (t) {\r\n+    case \"Solo\":   return { borderColor: \"#c9e7ff\", backgroundColor: \"#f2f9ff\" };\r\n+    case \"Group\":  return { borderColor: \"#ffe2b6\", backgroundColor: \"#fff7e9\" };\r\n+    case \"Classic\":\r\n+    default:       return { borderColor: \"#e0e0e0\", backgroundColor: \"#f7f7f7\" };\r\n+  }\r\n+}\r\n+\r\n const styles = StyleSheet.create({\r\n   container: { flex: 1, backgroundColor: \"#fff\" },\r\n   topBar: { paddingTop: 40, paddingHorizontal: 20, paddingBottom: 12 },\r\n   heading: { fontWeight: \"bold\", fontSize: 22 },\r\n \r\n+  typeChip: { paddingHorizontal: 10, paddingVertical: 4, borderRadius: 999, borderWidth: 1 },\r\n+  typeChipText: { fontSize: 11, fontWeight: \"700\" },\r\n+  groupChip: { flexDirection: \"row\", alignItems: \"center\", borderWidth: 1, borderColor: \"#ddd\", borderRadius: 999, paddingHorizontal: 8, paddingVertical: 2 },\r\n+\r\n   emptyWrap: { flex: 1, justifyContent: \"center\", alignItems: \"center\", paddingHorizontal: 20 },\r\n   emptyImage: { width: 150, height: 150, marginBottom: 20, resizeMode: \"contain\" },\r\n   emptyMsg: { textAlign: \"center\", fontSize: 14, color: \"#333\", marginBottom: 8 },\r\n \r\n@@ -453,9 +495,9 @@\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n \r\n-  // Report modal (mirrors your pHome UX)\r\n+  // Report modal\r\n   modalOverlay: { flex: 1, backgroundColor: \"rgba(0,0,0,0.4)\", justifyContent: \"center\", alignItems: \"center\", padding: 20 },\r\n   modalCard: { width: \"100%\", maxWidth: 420, backgroundColor: \"#fff\", borderRadius: 12, padding: 16 },\r\n   dismissButton: { position: \"absolute\", right: 8, top: 8, padding: 8, zIndex: 1 },\r\n   modalTitle: { fontWeight: \"700\", fontSize: 16, textAlign: \"center\", marginBottom: 12, marginTop: 12 },\r\n"
                },
                {
                    "date": 1761346152279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,8 +58,17 @@\n   const [otherReport, setOtherReport] = useState(\"\");\r\n   const [showDropdown, setShowDropdown] = useState(false);\r\n   const [sendingReport, setSendingReport] = useState(false);\r\n \r\n+  const toNiceType = (t?: string) => {\r\n+    const up = String(t||\"\").toUpperCase();\r\n+    if (up === \"GROUP\") return \"Group\";\r\n+    if (up === \"SOLO\")  return \"Solo\";\r\n+    if (up === \"CLASSIC\") return \"Classic\";\r\n+    return t as any;\r\n+  };\r\n+\r\n+\r\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n"
                },
                {
                    "date": 1761347213919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#d6de00ff\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n"
                },
                {
                    "date": 1761347220367,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#d6de00ff\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#f8ff31ff\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n"
                },
                {
                    "date": 1761347231683,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#f8ff31ff\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#505300ff\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n"
                },
                {
                    "date": 1761347241832,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#505300ff\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#f8ff22ff\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n"
                },
                {
                    "date": 1761347253805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#626262ff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347261287,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#626262ff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#beafafff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347268591,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#beafafff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#edfd5bff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347283480,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#edfd5bff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#f1efb0ff\", backgroundColor: \"#edfd5bff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347298640,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#f8ff22ff\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#8e9302ff\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#f1efb0ff\", backgroundColor: \"#edfd5bff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#edfd5bff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347321095,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#edfd5bff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#f4ff92ff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347328994,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#f4ff92ff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#f9ffc1ff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347437907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#f9ffc1ff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#ff2727ff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347445475,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#ff2727ff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#c02626ff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347456774,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,9 +497,9 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#c9c9c6ff\", backgroundColor: \"#c02626ff\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#000000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n   trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n"
                },
                {
                    "date": 1761347466677,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#8e9302ff\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#946262ff\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n"
                },
                {
                    "date": 1761347473460,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#946262ff\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#ffb6b6ff\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n"
                },
                {
                    "date": 1761347545276,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,12 +425,12 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#ffb6b6ff\" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000 \" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n-                <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n+                <Ionicons name=\"trash-bin-outline\" size={22} color=\"#ffb6b6ff\" />\r\n               </TouchableOpacity>\r\n             </View>\r\n           </View>\r\n         </View>\r\n"
                },
                {
                    "date": 1761347560314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,10 +497,10 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#000000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n-  trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#000000ff\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#c83232ff \", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n"
                },
                {
                    "date": 1761347569018,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -497,10 +497,10 @@\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#000000ff\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n-  trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#c83232ff \", padding: 8, borderRadius: 12 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#000000ff \", backgroundColor: \"#c83232ff \", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n"
                },
                {
                    "date": 1761347583586,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -498,9 +498,9 @@\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n   warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n-  trashBtn: { borderWidth: 1, borderColor: \"#000000ff \", backgroundColor: \"#c83232ff \", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#000000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n"
                },
                {
                    "date": 1761347601036,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -425,9 +425,9 @@\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n             </View>\r\n             <View style={styles.actionsRow}>\r\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000 \" />\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n                 <Ionicons name=\"trash-bin-outline\" size={22} color=\"#ffb6b6ff\" />\r\n               </TouchableOpacity>\r\n"
                },
                {
                    "date": 1761347616956,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -498,9 +498,9 @@\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n   warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n-  trashBtn: { borderWidth: 1, borderColor: \"#000000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#540000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n"
                },
                {
                    "date": 1761347666709,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -498,9 +498,9 @@\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n   warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n-  trashBtn: { borderWidth: 1, borderColor: \"#540000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#890000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n"
                },
                {
                    "date": 1761347688747,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,13 +17,14 @@\n   \"Refusal to Convey Passenger\",\r\n   \"Other\",\r\n ];\r\n \r\n-// Enable layout animation on Android\r\n if (Platform.OS === \"android\" && UIManager.setLayoutAnimationEnabledExperimental) {\r\n   UIManager.setLayoutAnimationEnabledExperimental(true);\r\n }\r\n \r\n+type BookingType = \"Classic\" | \"Group\" | \"Solo\";\r\n+\r\n type RideItem = {\r\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n@@ -31,44 +32,46 @@\n \r\n   pickupPlace?: string; pickupAddress?: string; pickupLabel?: string; pickupName?: string;\r\n   destinationPlace?: string; destinationAddress?: string; destinationLabel?: string; destinationName?: string;\r\n \r\n-  fare: number;          // legacy fare\r\n-  totalFare?: number;    // NEW preferred fare\r\n-  bookingType?: \"Classic\" | \"Group\" | \"Solo\"; // NEW\r\n-  groupCount?: number;   // NEW\r\n+  fare: number;           // base/legacy fare (per seat)\r\n+  totalFare?: number;     // preferred total (Group = fare * groupCount)\r\n+  bookingType?: BookingType;\r\n+  groupCount?: number;\r\n+\r\n   createdAt: string;\r\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n+// Title-case normalizer (handles \"CLASSIC\"/\"GROUP\"/\"SOLO\" too)\r\n+const niceType = (t?: string): BookingType | undefined => {\r\n+  if (!t) return undefined;\r\n+  const up = String(t).toUpperCase();\r\n+  if (up === \"GROUP\") return \"Group\";\r\n+  if (up === \"SOLO\") return \"Solo\";\r\n+  if (up === \"CLASSIC\") return \"Classic\";\r\n+  return (t as BookingType);\r\n+};\r\n+\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n   const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n+  const [expandedId, setExpandedId] = useState<string | null>(null); // single expand\r\n \r\n-  // Single expanded card\r\n-  const [expandedId, setExpandedId] = useState<string | null>(null);\r\n-\r\n-  // Report modal state\r\n-  const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string; driverId?: string }>({ id: null });\r\n+  // report modal state\r\n+  const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string }>(\r\n+    { id: null }\r\n+  );\r\n   const [reportType, setReportType] = useState(\"\");\r\n   const [otherReport, setOtherReport] = useState(\"\");\r\n   const [showDropdown, setShowDropdown] = useState(false);\r\n   const [sendingReport, setSendingReport] = useState(false);\r\n \r\n-  const toNiceType = (t?: string) => {\r\n-    const up = String(t||\"\").toUpperCase();\r\n-    if (up === \"GROUP\") return \"Group\";\r\n-    if (up === \"SOLO\")  return \"Solo\";\r\n-    if (up === \"CLASSIC\") return \"Classic\";\r\n-    return t as any;\r\n-  };\r\n-\r\n-\r\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n@@ -100,9 +103,9 @@\n       destinationPlace: r.destinationPlace, destinationAddress: r.destinationAddress, destinationLabel: r.destinationLabel, destinationName: r.destinationName,\r\n \r\n       fare: Number(r.fare || 0),\r\n       totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n-      bookingType: r.bookingType,\r\n+      bookingType: niceType(r.bookingType),\r\n       groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n \r\n       createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n       paymentMethod: r.paymentMethod || \"\",\r\n@@ -135,9 +138,8 @@\n           got = normalize(raw);\r\n           break;\r\n         } catch {}\r\n       }\r\n-      console.log(\" Raw data fetched from backend:\", got);\r\n       if (!got) got = [];\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n     } finally {\r\n@@ -157,9 +159,9 @@\n   const hasMoreLocal = visible < allItems.length;\r\n \r\n   const toggleExpand = (id: string) => {\r\n     LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);\r\n-    setExpandedId((cur) => (cur === id ? null : id));\r\n+    setExpandedId(cur => (cur === id ? null : id));\r\n   };\r\n \r\n   const askDelete = (id: string) => {\r\n     Alert.alert(\"Delete ride\", \"Are you sure you want to delete this history item?\", [\r\n@@ -167,38 +169,26 @@\n       {\r\n         text: \"Delete\",\r\n         style: \"destructive\",\r\n         onPress: async () => {\r\n-          // optimistic UI\r\n           const prev = allItems;\r\n-          setAllItems((list) => list.filter((x) => x._id !== id));\r\n-          if (expandedId === id) setExpandedId(null);\r\n-\r\n+          setAllItems(list => list.filter(x => x._id !== id));\r\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n             const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n-\r\n             let success = false;\r\n             for (const url of candidates) {\r\n               try {\r\n-                console.log(\" calling\", url);\r\n                 const res = await fetch(url, { method: \"DELETE\" });\r\n-                const text = await res.text();\r\n-                console.log(\" delete response\", res.status, text);\r\n                 if (res.ok) { success = true; break; }\r\n-              } catch (e) {\r\n-                console.log(\" delete fetch failed\", e);\r\n-              }\r\n+              } catch {}\r\n             }\r\n-\r\n             if (!success) {\r\n-              // rollback + tell user + hard refresh to be safe\r\n               setAllItems(prev);\r\n               Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n               await fetchAll();\r\n             }\r\n-          } catch (e) {\r\n-            console.log(\" delete unexpected error\", e);\r\n+          } catch {\r\n             setAllItems(prev);\r\n             Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n             await fetchAll();\r\n           }\r\n@@ -227,9 +217,8 @@\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n           bookingId: reportOpen.bookingId,\r\n           passengerId,\r\n-          // driverId intentionally omitted for privacy (send if your backend requires)\r\n           reportType,\r\n           otherReport,\r\n         }),\r\n       });\r\n@@ -277,9 +266,9 @@\n             <HistoryCard\r\n               item={item}\r\n               php={php}\r\n               when={when}\r\n-              expanded={expandedId === item._id}\r\n+              expanded={expandedId === item._id}                  {/*  single expand */}\r\n               onToggle={() => toggleExpand(item._id)}\r\n               onDelete={() => askDelete(item._id)}\r\n               onReport={() => openReport(item)}\r\n             />\r\n@@ -298,9 +287,9 @@\n           }\r\n         />\r\n       )}\r\n \r\n-      {/* Report modal (same UX as your pHome) */}\r\n+      {/* Report modal */}\r\n       <Modal visible={!!reportOpen.id} transparent animationType=\"fade\" onRequestClose={() => setReportOpen({ id: null })}>\r\n         <View style={styles.modalOverlay}>\r\n           <View style={[styles.modalCard, { alignItems: \"stretch\" }]}>\r\n             <TouchableOpacity style={styles.dismissButton} onPress={() => setReportOpen({ id: null })}>\r\n@@ -354,10 +343,9 @@\n     </View>\r\n   );\r\n }\r\n \r\n-/* ---------- Card components ---------- */\r\n-\r\n+/* ---------- Card ---------- */\r\n function HistoryCard({\r\n   item, php, when, expanded, onToggle, onDelete, onReport,\r\n }: {\r\n   item: RideItem;\r\n@@ -368,37 +356,42 @@\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n   const pickup = item.pickupPlace || item.pickupLabel || item.pickupName || item.pickupAddress || \"Pickup location\";\r\n-  const dest = item.destinationPlace || item.destinationLabel || item.destinationName || item.destinationAddress || \"Destination\";\r\n-  const price = item.totalFare != null ? item.totalFare : item.fare;\r\n+  const dest   = item.destinationPlace || item.destinationLabel || item.destinationName || item.destinationAddress || \"Destination\";\r\n \r\n+  const baseFare  = Number.isFinite(item.fare) ? item.fare : 0;\r\n+  const pax       = item.bookingType === \"Group\" && typeof item.groupCount === \"number\" ? item.groupCount : 1;\r\n+  const computedTotal = item.bookingType === \"Group\" ? baseFare * pax : baseFare;\r\n+  const totalFare = item.totalFare != null ? item.totalFare : computedTotal;\r\n+\r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n         <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n         <View style={{ flex: 1, paddingRight: 8 }}>\r\n+          {/* top row: from + type chip */}\r\n           <View style={[styles.row, { justifyContent: \"space-between\" }]}>\r\n             <View style={styles.row}>\r\n               <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n               <Text style={styles.mainText} numberOfLines={1}>{pickup}</Text>\r\n             </View>\r\n-\r\n             {!!item.bookingType && (\r\n               <View style={[styles.typeChip, typeChipStyle(item.bookingType)]}>\r\n                 <Text style={styles.typeChipText}>{item.bookingType}</Text>\r\n               </View>\r\n             )}\r\n           </View>\r\n \r\n+          {/* to */}\r\n           <View style={[styles.row, { marginTop: 2 }]}>\r\n             <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n             <Text style={styles.subText} numberOfLines={1}>{dest}</Text>\r\n           </View>\r\n \r\n+          {/* time + pax chip (if Group) */}\r\n           <View style={[styles.row, { marginTop: 4, justifyContent: \"space-between\" }]}>\r\n             <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n-\r\n             {item.bookingType === \"Group\" && typeof item.groupCount === \"number\" && (\r\n               <View style={styles.groupChip}>\r\n                 <Ionicons name=\"people-outline\" size={14} color=\"#333\" />\r\n                 <Text style={{ marginLeft: 4, fontSize: 12, color: \"#333\" }}>\r\n@@ -406,18 +399,42 @@\n                 </Text>\r\n               </View>\r\n             )}\r\n           </View>\r\n+\r\n+          {/* (NEW) inline fare breakdown for Group */}\r\n+          {item.bookingType === \"Group\" && (\r\n+            <Text style={styles.groupFareLine}>\r\n+              Fare: {php(baseFare)}  {pax} = <Text style={{ fontWeight: \"700\" }}>{php(totalFare)}</Text>\r\n+            </Text>\r\n+          )}\r\n         </View>\r\n \r\n-        <Text style={styles.priceText}>{php(price)}</Text>\r\n+        {/* price shown at the right = total */}\r\n+        <Text style={styles.priceText}>{php(totalFare)}</Text>\r\n       </View>\r\n \r\n       {expanded && (\r\n         <View style={styles.expandBox}>\r\n           <Text style={styles.expandTitle}>\r\n             Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || \"\"}</Text>\r\n           </Text>\r\n+\r\n+          {/* Expanded fare breakdown & meta */}\r\n+          <View style={{ marginBottom: 8 }}>\r\n+            {item.bookingType === \"Group\" ? (\r\n+              <>\r\n+                <Text style={styles.meta}>Booking Type: Group</Text>\r\n+                <Text style={styles.meta}>Passengers: {pax}</Text>\r\n+                <Text style={styles.meta}>\r\n+                  Fare Breakdown: {php(baseFare)}  {pax} = <Text style={{ fontWeight: \"700\" }}>{php(totalFare)}</Text>\r\n+                </Text>\r\n+              </>\r\n+            ) : (\r\n+              <Text style={styles.meta}>Booking Type: {item.bookingType || \"Classic\"}</Text>\r\n+            )}\r\n+          </View>\r\n+\r\n           {!!item.notes && <Text style={styles.expandNote} numberOfLines={4}>Note: {item.notes}</Text>}\r\n \r\n           <View style={styles.expandFooter}>\r\n             <View style={{ flex: 1 }}>\r\n@@ -428,9 +445,9 @@\n               <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n                 <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n               <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n-                <Ionicons name=\"trash-bin-outline\" size={22} color=\"#ffb6b6ff\" />\r\n+                <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n               </TouchableOpacity>\r\n             </View>\r\n           </View>\r\n         </View>\r\n@@ -438,8 +455,9 @@\n     </TouchableOpacity>\r\n   );\r\n }\r\n \r\n+/* ---------- Skeleton ---------- */\r\n function SkeletonCard() {\r\n   return (\r\n     <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n       <View style={styles.row}>\r\n@@ -454,10 +472,9 @@\n     </View>\r\n   );\r\n }\r\n \r\n-/* ---------- Styles & helpers ---------- */\r\n-\r\n+/* ---------- Styles ---------- */\r\n function typeChipStyle(t?: string) {\r\n   switch (t) {\r\n     case \"Solo\":   return { borderColor: \"#c9e7ff\", backgroundColor: \"#f2f9ff\" };\r\n     case \"Group\":  return { borderColor: \"#ffe2b6\", backgroundColor: \"#fff7e9\" };\r\n@@ -490,17 +507,20 @@\n   subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n   timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n   priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n \r\n+  // extra line for group breakdown\r\n+  groupFareLine: { marginTop: 6, fontSize: 12, color: \"#111\" },\r\n+\r\n   expandBox: { marginTop: 10, paddingTop: 10, borderTopWidth: 1, borderTopColor: \"#eee\" },\r\n   expandTitle: { fontSize: 14, marginBottom: 6, color: \"#111\" },\r\n   expandNote: { fontSize: 13, color: \"#333\", marginBottom: 8 },\r\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n   meta: { fontSize: 12, color: \"#666\" },\r\n \r\n   actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n   warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n-  trashBtn: { borderWidth: 1, borderColor: \"#890000ff\", backgroundColor: \"#c83232ff\", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n \r\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n"
                },
                {
                    "date": 1761347709173,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -266,9 +266,9 @@\n             <HistoryCard\r\n               item={item}\r\n               php={php}\r\n               when={when}\r\n-              expanded={expandedId === item._id}                  {/*  single expand */}\r\n+              expanded={expandedId === item._id}      \r\n               onToggle={() => toggleExpand(item._id)}\r\n               onDelete={() => askDelete(item._id)}\r\n               onReport={() => openReport(item)}\r\n             />\r\n"
                },
                {
                    "date": 1761347806322,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -433,10 +433,8 @@\n               <Text style={styles.meta}>Booking Type: {item.bookingType || \"Classic\"}</Text>\r\n             )}\r\n           </View>\r\n \r\n-          {!!item.notes && <Text style={styles.expandNote} numberOfLines={4}>Note: {item.notes}</Text>}\r\n-\r\n           <View style={styles.expandFooter}>\r\n             <View style={{ flex: 1 }}>\r\n               {!!item.bookingId && <Text style={styles.meta}>Booking: {item.bookingId}</Text>}\r\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n"
                },
                {
                    "date": 1761348769972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,9 +110,12 @@\n       createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n       paymentMethod: r.paymentMethod || \"\",\r\n       notes: r.notes || \"\",\r\n     }));\r\n+  \r\n \r\n+  console.log(normalize);\r\n+\r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n@@ -433,8 +436,10 @@\n               <Text style={styles.meta}>Booking Type: {item.bookingType || \"Classic\"}</Text>\r\n             )}\r\n           </View>\r\n \r\n+          {!!item.notes && <Text style={styles.expandNote} numberOfLines={4}>Note: {item.notes}</Text>}\r\n+\r\n           <View style={styles.expandFooter}>\r\n             <View style={{ flex: 1 }}>\r\n               {!!item.bookingId && <Text style={styles.meta}>Booking: {item.bookingId}</Text>}\r\n               {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n"
                },
                {
                    "date": 1761348860226,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -112,9 +112,8 @@\n       notes: r.notes || \"\",\r\n     }));\r\n   \r\n \r\n-  console.log(normalize);\r\n \r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n@@ -357,11 +356,13 @@\n   expanded: boolean;\r\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n-}) {\r\n+}) \r\n+{\r\n   const pickup = item.pickupPlace || item.pickupLabel || item.pickupName || item.pickupAddress || \"Pickup location\";\r\n   const dest   = item.destinationPlace || item.destinationLabel || item.destinationName || item.destinationAddress || \"Destination\";\r\n+  console.log(item);\r\n \r\n   const baseFare  = Number.isFinite(item.fare) ? item.fare : 0;\r\n   const pax       = item.bookingType === \"Group\" && typeof item.groupCount === \"number\" ? item.groupCount : 1;\r\n   const computedTotal = item.bookingType === \"Group\" ? baseFare * pax : baseFare;\r\n"
                },
                {
                    "date": 1761348879181,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -360,9 +360,8 @@\n }) \r\n {\r\n   const pickup = item.pickupPlace || item.pickupLabel || item.pickupName || item.pickupAddress || \"Pickup location\";\r\n   const dest   = item.destinationPlace || item.destinationLabel || item.destinationName || item.destinationAddress || \"Destination\";\r\n-  console.log(item);\r\n \r\n   const baseFare  = Number.isFinite(item.fare) ? item.fare : 0;\r\n   const pax       = item.bookingType === \"Group\" && typeof item.groupCount === \"number\" ? item.groupCount : 1;\r\n   const computedTotal = item.bookingType === \"Group\" ? baseFare * pax : baseFare;\r\n"
                },
                {
                    "date": 1761400693778,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,14 @@\n+// PHistory.tsx (updated)  paste over your current PHistory file\r\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n-  RefreshControl, TouchableOpacity, Alert, Modal, TextInput,\r\n-  LayoutAnimation, Platform, UIManager,\r\n+  RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n+  Modal, TextInput, LayoutAnimation, Platform, UIManager,\r\n } from \"react-native\";\r\n import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n+import * as Location from \"expo-location\";\r\n import { API_BASE_URL } from \"../../config\";\r\n \r\n const { width } = Dimensions.get(\"window\");\r\n \r\n@@ -16,62 +18,54 @@\n   \"Unproper Attire\",\r\n   \"Refusal to Convey Passenger\",\r\n   \"Other\",\r\n ];\r\n-\r\n if (Platform.OS === \"android\" && UIManager.setLayoutAnimationEnabledExperimental) {\r\n   UIManager.setLayoutAnimationEnabledExperimental(true);\r\n }\r\n \r\n-type BookingType = \"Classic\" | \"Group\" | \"Solo\";\r\n-\r\n type RideItem = {\r\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n   driverName?: string;\r\n-\r\n-  pickupPlace?: string; pickupAddress?: string; pickupLabel?: string; pickupName?: string;\r\n-  destinationPlace?: string; destinationAddress?: string; destinationLabel?: string; destinationName?: string;\r\n-\r\n-  fare: number;           // base/legacy fare (per seat)\r\n-  totalFare?: number;     // preferred total (Group = fare * groupCount)\r\n-  bookingType?: BookingType;\r\n+  // coords (may be present in backend)\r\n+  pickupLat?: number; pickupLng?: number;\r\n+  destinationLat?: number; destinationLng?: number;\r\n+  // optional human names (may be null for older records)\r\n+  pickupPlace?: string | null;\r\n+  destinationPlace?: string | null;\r\n+  // UI-friendly labels computed locally\r\n+  pickupLabel?: string;\r\n+  destinationLabel?: string;\r\n+  fare: number;\r\n+  totalFare?: number;\r\n+  bookingType?: \"Classic\" | \"Group\" | \"Solo\" | string;\r\n   groupCount?: number;\r\n-\r\n   createdAt: string;\r\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n-// Title-case normalizer (handles \"CLASSIC\"/\"GROUP\"/\"SOLO\" too)\r\n-const niceType = (t?: string): BookingType | undefined => {\r\n-  if (!t) return undefined;\r\n-  const up = String(t).toUpperCase();\r\n-  if (up === \"GROUP\") return \"Group\";\r\n-  if (up === \"SOLO\") return \"Solo\";\r\n-  if (up === \"CLASSIC\") return \"Classic\";\r\n-  return (t as BookingType);\r\n-};\r\n-\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n   const [loading, setLoading] = useState(true);\r\n   const [refreshing, setRefreshing] = useState(false);\r\n   const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n-  const [expandedId, setExpandedId] = useState<string | null>(null); // single expand\r\n+  const [expandedId, setExpandedId] = useState<string | null>(null);\r\n \r\n   // report modal state\r\n-  const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string }>(\r\n-    { id: null }\r\n-  );\r\n+  const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string; driverId?: string }>({ id: null });\r\n   const [reportType, setReportType] = useState(\"\");\r\n   const [otherReport, setOtherReport] = useState(\"\");\r\n   const [showDropdown, setShowDropdown] = useState(false);\r\n   const [sendingReport, setSendingReport] = useState(false);\r\n \r\n+  // simple in-memory cache for reverse geocode results\r\n+  const reverseCache = React.useRef<Map<string, string>>(new Map());\r\n+\r\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n@@ -85,36 +79,133 @@\n     new Date(iso).toLocaleString(\"en-PH\", {\r\n       year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n     });\r\n \r\n-  const placeName = (r: any, kind: \"pickup\" | \"destination\") => {\r\n-    const fields = [`${kind}Place`, `${kind}Label`, `${kind}Name`, `${kind}Address`];\r\n-    for (const f of fields) if (r[f] && String(r[f]).trim()) return String(r[f]).trim();\r\n-    return kind === \"pickup\" ? \"Pickup location\" : \"Destination\";\r\n+  // helper to format a coordinate key\r\n+  const coordKey = (lat?: number, lng?: number) =>\r\n+    lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n+\r\n+  // attempt reverse geocode for one coordinate pair (with caching)\r\n+  const geocodeCoord = async (lat?: number, lng?: number) => {\r\n+    const key = coordKey(lat, lng);\r\n+    if (!key) return null;\r\n+\r\n+    const cached = reverseCache.current.get(key);\r\n+    if (cached) return cached;\r\n+\r\n+    try {\r\n+      const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n+      if (Array.isArray(res) && res.length > 0) {\r\n+        const a = res[0];\r\n+        const pieces = [\r\n+          a.name, // POI name if available\r\n+          a.street,\r\n+          a.subregion || a.city || a.region,\r\n+        ].filter(Boolean);\r\n+        const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n+        reverseCache.current.set(key, label);\r\n+        return label;\r\n+      }\r\n+    } catch (e) {\r\n+      // fail silently, we'll fallback to coordinates or default text\r\n+      console.warn(\"Reverse geocode failed for\", key, e);\r\n+    }\r\n+    // fallback to coords text\r\n+    const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n+    reverseCache.current.set(key, coordLabel);\r\n+    return coordLabel;\r\n   };\r\n \r\n-  const normalize = (raw: any[]): RideItem[] =>\r\n-    (raw || []).map((r: any) => ({\r\n-      _id: String(r._id),\r\n-      bookingId: r.bookingId,\r\n-      passengerId: r.passengerId,\r\n-      driverName: r.driverName,\r\n+  // resolve missing pickup/destination names for all items (limited concurrency)\r\n+  const resolvePlaceNames = async (items: RideItem[]) => {\r\n+    // collect tasks only for missing places but having coords\r\n+    const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n-      pickupPlace: r.pickupPlace, pickupAddress: r.pickupAddress, pickupLabel: r.pickupLabel, pickupName: r.pickupName,\r\n-      destinationPlace: r.destinationPlace, destinationAddress: r.destinationAddress, destinationLabel: r.destinationLabel, destinationName: r.destinationName,\r\n+    for (const it of items) {\r\n+      const needPickup = !it.pickupPlace && (it.pickupLat != null && it.pickupLng != null);\r\n+      const needDest = !it.destinationPlace && (it.destinationLat != null && it.destinationLng != null);\r\n+      if (!needPickup && !needDest) continue;\r\n \r\n-      fare: Number(r.fare || 0),\r\n-      totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n-      bookingType: niceType(r.bookingType),\r\n-      groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n+      tasks.push(async () => {\r\n+        const out: any = { id: it._id };\r\n+        if (needPickup) {\r\n+          out.pickupLabel = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+        }\r\n+        if (needDest) {\r\n+          out.destinationLabel = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+        }\r\n+        return out;\r\n+      });\r\n+    }\r\n \r\n-      createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n-      paymentMethod: r.paymentMethod || \"\",\r\n-      notes: r.notes || \"\",\r\n-    }));\r\n-  \r\n+    if (tasks.length === 0) return;\r\n \r\n+    // concurrency limiter\r\n+    const CONCURRENCY = 5;\r\n+    const results: any[] = [];\r\n+    let idx = 0;\r\n \r\n+    const runner = async () => {\r\n+      while (idx < tasks.length) {\r\n+        const i = idx++;\r\n+        try {\r\n+          const r = await tasks[i]();\r\n+          results.push(r);\r\n+        } catch (e) {\r\n+          console.warn(\"geocode task fail\", e);\r\n+        }\r\n+      }\r\n+    };\r\n+\r\n+    const workers = [];\r\n+    for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n+    await Promise.all(workers);\r\n+\r\n+    if (results.length === 0) return;\r\n+\r\n+    // apply results to items\r\n+    setAllItems((prev) => {\r\n+      const byId = new Map(prev.map((p) => [p._id, { ...p }]));\r\n+      for (const r of results) {\r\n+        const entry = byId.get(r.id);\r\n+        if (!entry) continue;\r\n+        if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n+        if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n+        // ensure we keep original place fields if present\r\n+        if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n+        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n+      }\r\n+      return Array.from(byId.values());\r\n+    });\r\n+  };\r\n+\r\n+  const normalize = (raw: any[]): RideItem[] =>\r\n+    (raw || []).map((r: any) => {\r\n+      const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n+      const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n+      return {\r\n+        _id: String(r._id),\r\n+        bookingId: r.bookingId,\r\n+        passengerId: r.passengerId,\r\n+        driverName: r.driverName,\r\n+        pickupLat: Number.isFinite(r.pickupLat) ? Number(r.pickupLat) : undefined,\r\n+        pickupLng: Number.isFinite(r.pickupLng) ? Number(r.pickupLng) : undefined,\r\n+        destinationLat: Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : undefined,\r\n+        destinationLng: Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : undefined,\r\n+        pickupPlace: r.pickupPlace ?? null,\r\n+        destinationPlace: r.destinationPlace ?? null,\r\n+        pickupLabel, // may be undefined; we'll resolve later\r\n+        destinationLabel,\r\n+        fare: Number(r.fare || 0),\r\n+        totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n+        bookingType: r.bookingType,\r\n+        groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n+        createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n+        paymentMethod: r.paymentMethod || \"\",\r\n+        notes: r.notes || \"\",\r\n+      } as RideItem;\r\n+    });\r\n+\r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n@@ -138,13 +229,28 @@\n           let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n           if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n           got = normalize(raw);\r\n           break;\r\n-        } catch {}\r\n+        } catch (e) {\r\n+          // continue trying other endpoints\r\n+          console.warn(\"fetch attempt failed for\", paths[i], e);\r\n+        }\r\n       }\r\n       if (!got) got = [];\r\n+      // set basic items first (fast UI)\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n+\r\n+      // resolve missing place names using coords (async, non-blocking)\r\n+      // only for items missing pickup/destination label\r\n+      const needResolve = got.filter(it =>\r\n+        (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n+        (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n+      );\r\n+      if (needResolve.length > 0) {\r\n+        // do not block the UI  run in background, but update state when done\r\n+        resolvePlaceNames(got).catch((e) => console.warn(\"resolvePlaceNames failed\", e));\r\n+      }\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n     }\r\n@@ -161,9 +267,9 @@\n   const hasMoreLocal = visible < allItems.length;\r\n \r\n   const toggleExpand = (id: string) => {\r\n     LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);\r\n-    setExpandedId(cur => (cur === id ? null : id));\r\n+    setExpandedId((cur) => (cur === id ? null : id));\r\n   };\r\n \r\n   const askDelete = (id: string) => {\r\n     Alert.alert(\"Delete ride\", \"Are you sure you want to delete this history item?\", [\r\n@@ -172,25 +278,34 @@\n         text: \"Delete\",\r\n         style: \"destructive\",\r\n         onPress: async () => {\r\n           const prev = allItems;\r\n-          setAllItems(list => list.filter(x => x._id !== id));\r\n+          setAllItems((list) => list.filter((x) => x._id !== id));\r\n+\r\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n             const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n+\r\n             let success = false;\r\n             for (const url of candidates) {\r\n               try {\r\n+                console.log(\" calling\", url);\r\n                 const res = await fetch(url, { method: \"DELETE\" });\r\n+                const text = await res.text();\r\n+                console.log(\" delete response\", res.status, text);\r\n                 if (res.ok) { success = true; break; }\r\n-              } catch {}\r\n+              } catch (e) {\r\n+                console.log(\" delete fetch failed\", e);\r\n+              }\r\n             }\r\n+\r\n             if (!success) {\r\n               setAllItems(prev);\r\n               Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n               await fetchAll();\r\n             }\r\n-          } catch {\r\n+          } catch (e) {\r\n+            console.log(\" delete unexpected error\", e);\r\n             setAllItems(prev);\r\n             Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n             await fetchAll();\r\n           }\r\n@@ -202,9 +317,9 @@\n   const openReport = (item: RideItem) => {\r\n     setReportType(\"\");\r\n     setOtherReport(\"\");\r\n     setShowDropdown(false);\r\n-    setReportOpen({ id: item._id, bookingId: item.bookingId });\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverName ? undefined : undefined });\r\n   };\r\n \r\n   const submitReport = async () => {\r\n     if (!reportOpen.id || !passengerId) return;\r\n@@ -219,8 +334,9 @@\n         headers: { \"Content-Type\": \"application/json\" },\r\n         body: JSON.stringify({\r\n           bookingId: reportOpen.bookingId,\r\n           passengerId,\r\n+          driverId: reportOpen.driverId,\r\n           reportType,\r\n           otherReport,\r\n         }),\r\n       });\r\n@@ -268,9 +384,9 @@\n             <HistoryCard\r\n               item={item}\r\n               php={php}\r\n               when={when}\r\n-              expanded={expandedId === item._id}      \r\n+              expanded={expandedId === item._id}\r\n               onToggle={() => toggleExpand(item._id)}\r\n               onDelete={() => askDelete(item._id)}\r\n               onReport={() => openReport(item)}\r\n             />\r\n@@ -345,9 +461,8 @@\n     </View>\r\n   );\r\n }\r\n \r\n-/* ---------- Card ---------- */\r\n function HistoryCard({\r\n   item, php, when, expanded, onToggle, onDelete, onReport,\r\n }: {\r\n   item: RideItem;\r\n@@ -356,88 +471,54 @@\n   expanded: boolean;\r\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n-}) \r\n-{\r\n-  const pickup = item.pickupPlace || item.pickupLabel || item.pickupName || item.pickupAddress || \"Pickup location\";\r\n-  const dest   = item.destinationPlace || item.destinationLabel || item.destinationName || item.destinationAddress || \"Destination\";\r\n+}) {\r\n+  const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n+  const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n+  const price = item.totalFare != null ? item.totalFare : item.fare;\r\n \r\n-  const baseFare  = Number.isFinite(item.fare) ? item.fare : 0;\r\n-  const pax       = item.bookingType === \"Group\" && typeof item.groupCount === \"number\" ? item.groupCount : 1;\r\n-  const computedTotal = item.bookingType === \"Group\" ? baseFare * pax : baseFare;\r\n-  const totalFare = item.totalFare != null ? item.totalFare : computedTotal;\r\n-\r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n         <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n         <View style={{ flex: 1, paddingRight: 8 }}>\r\n-          {/* top row: from + type chip */}\r\n           <View style={[styles.row, { justifyContent: \"space-between\" }]}>\r\n             <View style={styles.row}>\r\n               <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n               <Text style={styles.mainText} numberOfLines={1}>{pickup}</Text>\r\n             </View>\r\n+\r\n             {!!item.bookingType && (\r\n               <View style={[styles.typeChip, typeChipStyle(item.bookingType)]}>\r\n-                <Text style={styles.typeChipText}>{item.bookingType}</Text>\r\n+                <Text style={styles.typeChipText}>{String(item.bookingType).replace(/CLASSIC/i,'Classic').replace(/GROUP/i,'Group').replace(/SOLO/i,'Solo')}</Text>\r\n               </View>\r\n             )}\r\n           </View>\r\n \r\n-          {/* to */}\r\n           <View style={[styles.row, { marginTop: 2 }]}>\r\n             <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n             <Text style={styles.subText} numberOfLines={1}>{dest}</Text>\r\n           </View>\r\n \r\n-          {/* time + pax chip (if Group) */}\r\n           <View style={[styles.row, { marginTop: 4, justifyContent: \"space-between\" }]}>\r\n             <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n+\r\n             {item.bookingType === \"Group\" && typeof item.groupCount === \"number\" && (\r\n               <View style={styles.groupChip}>\r\n                 <Ionicons name=\"people-outline\" size={14} color=\"#333\" />\r\n-                <Text style={{ marginLeft: 4, fontSize: 12, color: \"#333\" }}>\r\n-                  {item.groupCount} pax\r\n-                </Text>\r\n+                <Text style={{ marginLeft: 4, fontSize: 12, color: \"#333\" }}>{item.groupCount} pax</Text>\r\n               </View>\r\n             )}\r\n           </View>\r\n-\r\n-          {/* (NEW) inline fare breakdown for Group */}\r\n-          {item.bookingType === \"Group\" && (\r\n-            <Text style={styles.groupFareLine}>\r\n-              Fare: {php(baseFare)}  {pax} = <Text style={{ fontWeight: \"700\" }}>{php(totalFare)}</Text>\r\n-            </Text>\r\n-          )}\r\n         </View>\r\n \r\n-        {/* price shown at the right = total */}\r\n-        <Text style={styles.priceText}>{php(totalFare)}</Text>\r\n+        <Text style={styles.priceText}>{php(price)}</Text>\r\n       </View>\r\n \r\n       {expanded && (\r\n         <View style={styles.expandBox}>\r\n-          <Text style={styles.expandTitle}>\r\n-            Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || \"\"}</Text>\r\n-          </Text>\r\n-\r\n-          {/* Expanded fare breakdown & meta */}\r\n-          <View style={{ marginBottom: 8 }}>\r\n-            {item.bookingType === \"Group\" ? (\r\n-              <>\r\n-                <Text style={styles.meta}>Booking Type: Group</Text>\r\n-                <Text style={styles.meta}>Passengers: {pax}</Text>\r\n-                <Text style={styles.meta}>\r\n-                  Fare Breakdown: {php(baseFare)}  {pax} = <Text style={{ fontWeight: \"700\" }}>{php(totalFare)}</Text>\r\n-                </Text>\r\n-              </>\r\n-            ) : (\r\n-              <Text style={styles.meta}>Booking Type: {item.bookingType || \"Classic\"}</Text>\r\n-            )}\r\n-          </View>\r\n-\r\n+          <Text style={styles.expandTitle}>Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || \"\"}</Text></Text>\r\n           {!!item.notes && <Text style={styles.expandNote} numberOfLines={4}>Note: {item.notes}</Text>}\r\n \r\n           <View style={styles.expandFooter}>\r\n             <View style={{ flex: 1 }}>\r\n@@ -458,9 +539,8 @@\n     </TouchableOpacity>\r\n   );\r\n }\r\n \r\n-/* ---------- Skeleton ---------- */\r\n function SkeletonCard() {\r\n   return (\r\n     <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n       <View style={styles.row}>\r\n@@ -475,23 +555,21 @@\n     </View>\r\n   );\r\n }\r\n \r\n-/* ---------- Styles ---------- */\r\n function typeChipStyle(t?: string) {\r\n-  switch (t) {\r\n-    case \"Solo\":   return { borderColor: \"#c9e7ff\", backgroundColor: \"#f2f9ff\" };\r\n-    case \"Group\":  return { borderColor: \"#ffe2b6\", backgroundColor: \"#fff7e9\" };\r\n-    case \"Classic\":\r\n+  switch (String(t || \"\").toLowerCase()) {\r\n+    case \"solo\":   return { borderColor: \"#c9e7ff\", backgroundColor: \"#f2f9ff\" };\r\n+    case \"group\":  return { borderColor: \"#ffe2b6\", backgroundColor: \"#fff7e9\" };\r\n+    case \"classic\":\r\n     default:       return { borderColor: \"#e0e0e0\", backgroundColor: \"#f7f7f7\" };\r\n   }\r\n }\r\n \r\n const styles = StyleSheet.create({\r\n   container: { flex: 1, backgroundColor: \"#fff\" },\r\n   topBar: { paddingTop: 40, paddingHorizontal: 20, paddingBottom: 12 },\r\n   heading: { fontWeight: \"bold\", fontSize: 22 },\r\n-\r\n   typeChip: { paddingHorizontal: 10, paddingVertical: 4, borderRadius: 999, borderWidth: 1 },\r\n   typeChipText: { fontSize: 11, fontWeight: \"700\" },\r\n   groupChip: { flexDirection: \"row\", alignItems: \"center\", borderWidth: 1, borderColor: \"#ddd\", borderRadius: 999, paddingHorizontal: 8, paddingVertical: 2 },\r\n \r\n@@ -510,11 +588,8 @@\n   subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n   timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n   priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n \r\n-  // extra line for group breakdown\r\n-  groupFareLine: { marginTop: 6, fontSize: 12, color: \"#111\" },\r\n-\r\n   expandBox: { marginTop: 10, paddingTop: 10, borderTopWidth: 1, borderTopColor: \"#eee\" },\r\n   expandTitle: { fontSize: 14, marginBottom: 6, color: \"#111\" },\r\n   expandNote: { fontSize: 13, color: \"#333\", marginBottom: 8 },\r\n   expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n@@ -527,9 +602,8 @@\n   viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n   viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n   noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n \r\n-  // Report modal\r\n   modalOverlay: { flex: 1, backgroundColor: \"rgba(0,0,0,0.4)\", justifyContent: \"center\", alignItems: \"center\", padding: 20 },\r\n   modalCard: { width: \"100%\", maxWidth: 420, backgroundColor: \"#fff\", borderRadius: 12, padding: 16 },\r\n   dismissButton: { position: \"absolute\", right: 8, top: 8, padding: 8, zIndex: 1 },\r\n   modalTitle: { fontWeight: \"700\", fontSize: 16, textAlign: \"center\", marginBottom: 12, marginTop: 12 },\r\n"
                },
                {
                    "date": 1761400889053,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -172,9 +172,11 @@\n         if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n         // ensure we keep original place fields if present\r\n         if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n         if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n+        console.log(entry.pickupLabel)\r\n       }\r\n+      \r\n       return Array.from(byId.values());\r\n     });\r\n   };\r\n \r\n"
                },
                {
                    "date": 1761400894701,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -171,9 +171,9 @@\n         if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n         if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n         // ensure we keep original place fields if present\r\n         if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n-        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n+        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"No\";\r\n         console.log(entry.pickupLabel)\r\n       }\r\n       \r\n       return Array.from(byId.values());\r\n"
                },
                {
                    "date": 1761400904665,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -171,10 +171,9 @@\n         if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n         if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n         // ensure we keep original place fields if present\r\n         if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n-        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"No\";\r\n-        console.log(entry.pickupLabel)\r\n+        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n       }\r\n       \r\n       return Array.from(byId.values());\r\n     });\r\n"
                },
                {
                    "date": 1761400910939,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -173,9 +173,8 @@\n         // ensure we keep original place fields if present\r\n         if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n         if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n       }\r\n-      \r\n       return Array.from(byId.values());\r\n     });\r\n   };\r\n \r\n"
                },
                {
                    "date": 1761400960463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -472,10 +472,10 @@\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n-  const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n-  const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n+  const pickup = item.pickupLabel || item.pickupPlace;\r\n+  const dest = item.destinationLabel || item.destinationPlace;\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n"
                },
                {
                    "date": 1761400984333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -472,10 +472,10 @@\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n-  const pickup = item.pickupLabel || item.pickupPlace;\r\n-  const dest = item.destinationLabel || item.destinationPlace;\r\n+  const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n+  const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n"
                },
                {
                    "date": 1761401095717,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -472,10 +472,10 @@\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n-  const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n-  const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n+  const pickup = item.pickupLabel || item.pickupPlace;\r\n+  const dest = item.destinationLabel || item.destinationPlace;\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n"
                },
                {
                    "date": 1761401699359,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -45,8 +45,9 @@\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n+\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n@@ -113,8 +114,9 @@\n     const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n     reverseCache.current.set(key, coordLabel);\r\n     return coordLabel;\r\n   };\r\n+  \r\n \r\n   // resolve missing pickup/destination names for all items (limited concurrency)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n     // collect tasks only for missing places but having coords\r\n"
                },
                {
                    "date": 1761402019859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -118,9 +118,8 @@\n   \r\n \r\n   // resolve missing pickup/destination names for all items (limited concurrency)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n-    // collect tasks only for missing places but having coords\r\n     const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n     for (const it of items) {\r\n       const needPickup = !it.pickupPlace && (it.pickupLat != null && it.pickupLng != null);\r\n@@ -129,20 +128,21 @@\n \r\n       tasks.push(async () => {\r\n         const out: any = { id: it._id };\r\n         if (needPickup) {\r\n-          out.pickupLabel = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+          const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+          out.pickupLabel = label || \"Pickup Location\";\r\n         }\r\n         if (needDest) {\r\n-          out.destinationLabel = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+          const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+          out.destinationLabel = label || \"Destination\";\r\n         }\r\n         return out;\r\n       });\r\n     }\r\n \r\n     if (tasks.length === 0) return;\r\n \r\n-    // concurrency limiter\r\n     const CONCURRENCY = 5;\r\n     const results: any[] = [];\r\n     let idx = 0;\r\n \r\n@@ -161,26 +161,22 @@\n     const workers = [];\r\n     for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n     await Promise.all(workers);\r\n \r\n-    if (results.length === 0) return;\r\n-\r\n-    // apply results to items\r\n+    // apply results and ensure defaults\r\n     setAllItems((prev) => {\r\n-      const byId = new Map(prev.map((p) => [p._id, { ...p }]));\r\n-      for (const r of results) {\r\n-        const entry = byId.get(r.id);\r\n-        if (!entry) continue;\r\n-        if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n-        if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n-        // ensure we keep original place fields if present\r\n-        if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n-        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n-      }\r\n-      return Array.from(byId.values());\r\n+      return prev.map((p) => {\r\n+        const found = results.find((r) => r.id === p._id);\r\n+        return {\r\n+          ...p,\r\n+          pickupLabel: found?.pickupLabel || p.pickupLabel || p.pickupPlace || \"Pickup Location\",\r\n+          destinationLabel: found?.destinationLabel || p.destinationLabel || p.destinationPlace || \"Destination\",\r\n+        };\r\n+      });\r\n     });\r\n   };\r\n \r\n+\r\n   const normalize = (raw: any[]): RideItem[] =>\r\n     (raw || []).map((r: any) => {\r\n       const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n       const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n"
                },
                {
                    "date": 1761402633867,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,616 @@\n+// PHistory.tsx (updated)  paste over your current PHistory file\r\n+import React, { useCallback, useEffect, useState } from \"react\";\r\n+import {\r\n+  View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n+  RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n+  Modal, TextInput, LayoutAnimation, Platform, UIManager,\r\n+} from \"react-native\";\r\n+import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n+import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n+import * as Location from \"expo-location\";\r\n+import { API_BASE_URL } from \"../../config\";\r\n+\r\n+const { width } = Dimensions.get(\"window\");\r\n+\r\n+const REPORT_OPTIONS = [\r\n+  \"Overcharging\",\r\n+  \"Harassment\",\r\n+  \"Unproper Attire\",\r\n+  \"Refusal to Convey Passenger\",\r\n+  \"Other\",\r\n+];\r\n+if (Platform.OS === \"android\" && UIManager.setLayoutAnimationEnabledExperimental) {\r\n+  UIManager.setLayoutAnimationEnabledExperimental(true);\r\n+}\r\n+\r\n+type RideItem = {\r\n+  _id: string;\r\n+  bookingId?: string;\r\n+  passengerId?: string;\r\n+  driverName?: string;\r\n+  // coords (may be present in backend)\r\n+  pickupLat?: number; pickupLng?: number;\r\n+  destinationLat?: number; destinationLng?: number;\r\n+  // optional human names (may be null for older records)\r\n+  pickupPlace?: string | null;\r\n+  destinationPlace?: string | null;\r\n+  // UI-friendly labels computed locally\r\n+  pickupLabel?: string;\r\n+  destinationLabel?: string;\r\n+  fare: number;\r\n+  totalFare?: number;\r\n+  bookingType?: \"Classic\" | \"Group\" | \"Solo\" | string;\r\n+  groupCount?: number;\r\n+  createdAt: string;\r\n+  paymentMethod?: string;\r\n+  notes?: string;\r\n+};\r\n+\r\n+\r\n+export default function PHistory() {\r\n+  const [passengerId, setPassengerId] = useState<string | null>(null);\r\n+  const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n+  const [visible, setVisible] = useState(10);\r\n+  const [loading, setLoading] = useState(true);\r\n+  const [refreshing, setRefreshing] = useState(false);\r\n+  const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n+  const [expandedId, setExpandedId] = useState<string | null>(null);\r\n+\r\n+  // report modal state\r\n+  const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string; driverId?: string }>({ id: null });\r\n+  const [reportType, setReportType] = useState(\"\");\r\n+  const [otherReport, setOtherReport] = useState(\"\");\r\n+  const [showDropdown, setShowDropdown] = useState(false);\r\n+  const [sendingReport, setSendingReport] = useState(false);\r\n+\r\n+  // simple in-memory cache for reverse geocode results\r\n+  const reverseCache = React.useRef<Map<string, string>>(new Map());\r\n+\r\n+  useEffect(() => {\r\n+    (async () => {\r\n+      const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n+      setPassengerId(pid || null);\r\n+    })();\r\n+  }, []);\r\n+\r\n+  const php = (n: number) =>\r\n+    new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n+\r\n+  const when = (iso: string) =>\r\n+    new Date(iso).toLocaleString(\"en-PH\", {\r\n+      year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n+    });\r\n+\r\n+  // helper to format a coordinate key\r\n+  const coordKey = (lat?: number, lng?: number) =>\r\n+    lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n+\r\n+  // attempt reverse geocode for one coordinate pair (with caching)\r\n+  const geocodeCoord = async (lat?: number, lng?: number) => {\r\n+    const key = coordKey(lat, lng);\r\n+    if (!key) return null;\r\n+\r\n+    const cached = reverseCache.current.get(key);\r\n+    if (cached) return cached;\r\n+\r\n+    try {\r\n+      const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n+      if (Array.isArray(res) && res.length > 0) {\r\n+        const a = res[0];\r\n+        const pieces = [\r\n+          a.name, // POI name if available\r\n+          a.street,\r\n+          a.subregion || a.city || a.region,\r\n+        ].filter(Boolean);\r\n+        const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n+        reverseCache.current.set(key, label);\r\n+        return label;\r\n+      }\r\n+    } catch (e) {\r\n+      // fail silently, we'll fallback to coordinates or default text\r\n+      console.warn(\"Reverse geocode failed for\", key, e);\r\n+    }\r\n+    // fallback to coords text\r\n+    const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n+    reverseCache.current.set(key, coordLabel);\r\n+    return coordLabel;\r\n+  };\r\n+  \r\n+\r\n+  // resolve missing pickup/destination names for all items (limited concurrency)\r\n+  const resolvePlaceNames = async (items: RideItem[]) => {\r\n+    const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n+\r\n+    for (const it of items) {\r\n+      const needPickup = !it.pickupPlace && (it.pickupLat != null && it.pickupLng != null);\r\n+      const needDest = !it.destinationPlace && (it.destinationLat != null && it.destinationLng != null);\r\n+      if (!needPickup && !needDest) continue;\r\n+\r\n+      tasks.push(async () => {\r\n+        const out: any = { id: it._id };\r\n+        if (needPickup) {\r\n+          const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+          out.pickupLabel = label || \"Pickup Location\";\r\n+        }\r\n+        if (needDest) {\r\n+          const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+          out.destinationLabel = label || \"Destination\";\r\n+        }\r\n+        return out;\r\n+      });\r\n+    }\r\n+\r\n+    if (tasks.length === 0) return;\r\n+\r\n+    const CONCURRENCY = 5;\r\n+    const results: any[] = [];\r\n+    let idx = 0;\r\n+\r\n+    const runner = async () => {\r\n+      while (idx < tasks.length) {\r\n+        const i = idx++;\r\n+        try {\r\n+          const r = await tasks[i]();\r\n+          results.push(r);\r\n+        } catch (e) {\r\n+          console.warn(\"geocode task fail\", e);\r\n+        }\r\n+      }\r\n+    };\r\n+\r\n+    const workers = [];\r\n+    for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n+    await Promise.all(workers);\r\n+\r\n+    // apply results and ensure defaults\r\n+    setAllItems((prev) => {\r\n+      return prev.map((p) => {\r\n+        const found = results.find((r) => r.id === p._id);\r\n+        return {\r\n+          ...p,\r\n+          pickupLabel: found?.pickupLabel || p.pickupLabel || p.pickupPlace || \"Pickup Location\",\r\n+          destinationLabel: found?.destinationLabel || p.destinationLabel || p.destinationPlace || \"Destination\",\r\n+        };\r\n+      });\r\n+    });\r\n+  };\r\n+\r\n+\r\n+  const normalize = (raw: any[]): RideItem[] =>\r\n+    (raw || []).map((r: any) => {\r\n+      const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n+      const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n+      return {\r\n+        _id: String(r._id),\r\n+        bookingId: r.bookingId,\r\n+        passengerId: r.passengerId,\r\n+        driverName: r.driverName,\r\n+        pickupLat: Number.isFinite(r.pickupLat) ? Number(r.pickupLat) : undefined,\r\n+        pickupLng: Number.isFinite(r.pickupLng) ? Number(r.pickupLng) : undefined,\r\n+        destinationLat: Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : undefined,\r\n+        destinationLng: Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : undefined,\r\n+        pickupPlace: r.pickupPlace ?? null,\r\n+        destinationPlace: r.destinationPlace ?? null,\r\n+        pickupLabel, // may be undefined; we'll resolve later\r\n+        destinationLabel,\r\n+        fare: Number(r.fare || 0),\r\n+        totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n+        bookingType: r.bookingType,\r\n+        groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n+        createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n+        paymentMethod: r.paymentMethod || \"\",\r\n+        notes: r.notes || \"\",\r\n+      } as RideItem;\r\n+    });\r\n+\r\n+  const fetchAll = useCallback(async () => {\r\n+    setErrorMsg(null);\r\n+    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n+    try {\r\n+      const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n+      const paths = [\r\n+        `/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n+        `/api/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n+        `/rides`,\r\n+        `/api/rides`,\r\n+      ];\r\n+      let got: RideItem[] | null = null;\r\n+\r\n+      for (let i = 0; i < paths.length; i++) {\r\n+        const url = `${base}${paths[i]}`;\r\n+        const filterLocally = i >= 2;\r\n+        try {\r\n+          const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n+          const text = await res.text();\r\n+          let data: any;\r\n+          try { data = JSON.parse(text); } catch { continue; }\r\n+          let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n+          if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n+          got = normalize(raw);\r\n+          break;\r\n+        } catch (e) {\r\n+          // continue trying other endpoints\r\n+          console.warn(\"fetch attempt failed for\", paths[i], e);\r\n+        }\r\n+      }\r\n+      if (!got) got = [];\r\n+      // set basic items first (fast UI)\r\n+      setAllItems(got);\r\n+      setVisible(Math.min(10, got.length));\r\n+\r\n+      // resolve missing place names using coords (async, non-blocking)\r\n+      // only for items missing pickup/destination label\r\n+      const needResolve = got.filter(it =>\r\n+        (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n+        (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n+      );\r\n+      if (needResolve.length > 0) {\r\n+        // do not block the UI  run in background, but update state when done\r\n+        resolvePlaceNames(got).catch((e) => console.warn(\"resolvePlaceNames failed\", e));\r\n+      }\r\n+    } finally {\r\n+      setLoading(false);\r\n+      setRefreshing(false);\r\n+    }\r\n+  }, [passengerId]);\r\n+\r\n+  useEffect(() => { fetchAll(); }, [fetchAll]);\r\n+\r\n+  const onRefresh = useCallback(() => {\r\n+    setRefreshing(true);\r\n+    fetchAll();\r\n+  }, [fetchAll]);\r\n+\r\n+  const dataToShow = allItems.slice(0, visible);\r\n+  const hasMoreLocal = visible < allItems.length;\r\n+\r\n+  const toggleExpand = (id: string) => {\r\n+    LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);\r\n+    setExpandedId((cur) => (cur === id ? null : id));\r\n+  };\r\n+\r\n+  const askDelete = (id: string) => {\r\n+    Alert.alert(\"Delete ride\", \"Are you sure you want to delete this history item?\", [\r\n+      { text: \"Cancel\", style: \"cancel\" },\r\n+      {\r\n+        text: \"Delete\",\r\n+        style: \"destructive\",\r\n+        onPress: async () => {\r\n+          const prev = allItems;\r\n+          setAllItems((list) => list.filter((x) => x._id !== id));\r\n+\r\n+          try {\r\n+            const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n+            const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n+\r\n+            let success = false;\r\n+            for (const url of candidates) {\r\n+              try {\r\n+                console.log(\" calling\", url);\r\n+                const res = await fetch(url, { method: \"DELETE\" });\r\n+                const text = await res.text();\r\n+                console.log(\" delete response\", res.status, text);\r\n+                if (res.ok) { success = true; break; }\r\n+              } catch (e) {\r\n+                console.log(\" delete fetch failed\", e);\r\n+              }\r\n+            }\r\n+\r\n+            if (!success) {\r\n+              setAllItems(prev);\r\n+              Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n+              await fetchAll();\r\n+            }\r\n+          } catch (e) {\r\n+            console.log(\" delete unexpected error\", e);\r\n+            setAllItems(prev);\r\n+            Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n+            await fetchAll();\r\n+          }\r\n+        },\r\n+      },\r\n+    ]);\r\n+  };\r\n+\r\n+  const openReport = (item: RideItem) => {\r\n+    setReportType(\"\");\r\n+    setOtherReport(\"\");\r\n+    setShowDropdown(false);\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverName ? undefined : undefined });\r\n+  };\r\n+\r\n+  const submitReport = async () => {\r\n+    if (!reportOpen.id || !passengerId) return;\r\n+    if (!reportType) return Alert.alert(\"Report\", \"Please select a violation.\");\r\n+    if (reportType === \"Other\" && !otherReport.trim())\r\n+      return Alert.alert(\"Report\", \"Please describe the issue.\");\r\n+\r\n+    try {\r\n+      setSendingReport(true);\r\n+      const res = await fetch(`${API_BASE_URL.replace(/\\/$/, \"\")}/api/feedback/submit-report`, {\r\n+        method: \"POST\",\r\n+        headers: { \"Content-Type\": \"application/json\" },\r\n+        body: JSON.stringify({\r\n+          bookingId: reportOpen.bookingId,\r\n+          passengerId,\r\n+          driverId: reportOpen.driverId,\r\n+          reportType,\r\n+          otherReport,\r\n+        }),\r\n+      });\r\n+      const j = await res.json().catch(() => ({}));\r\n+      if (!res.ok) throw new Error(j?.message || \"Failed to submit report.\");\r\n+      Alert.alert(\"Success\", \"Report submitted!\");\r\n+      setReportOpen({ id: null });\r\n+    } catch (e: any) {\r\n+      Alert.alert(\"Error\", e?.message || \"Something went wrong.\");\r\n+    } finally {\r\n+      setSendingReport(false);\r\n+    }\r\n+  };\r\n+\r\n+  if (!loading && allItems.length === 0) {\r\n+    return (\r\n+      <View style={styles.container}>\r\n+        <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n+        <View style={styles.emptyWrap}>\r\n+          <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.emptyImage} />\r\n+          <Text style={styles.emptyMsg}>{errorMsg || \"Mag Book na para mag ka history ka.\"}</Text>\r\n+          <TouchableOpacity style={styles.viewMoreBtn} onPress={onRefresh}>\r\n+            <Text style={styles.viewMoreText}>Reload</Text>\r\n+          </TouchableOpacity>\r\n+        </View>\r\n+      </View>\r\n+    );\r\n+  }\r\n+\r\n+  return (\r\n+    <View style={styles.container}>\r\n+      <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n+\r\n+      {loading && allItems.length === 0 ? (\r\n+        <View style={{ paddingHorizontal: 16 }}>\r\n+          <SkeletonCard /><SkeletonCard /><SkeletonCard />\r\n+        </View>\r\n+      ) : (\r\n+        <FlatList\r\n+          data={dataToShow}\r\n+          keyExtractor={(it) => it._id}\r\n+          contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 24 }}\r\n+          refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n+          renderItem={({ item }) => (\r\n+            <HistoryCard\r\n+              item={item}\r\n+              php={php}\r\n+              when={when}\r\n+              expanded={expandedId === item._id}\r\n+              onToggle={() => toggleExpand(item._id)}\r\n+              onDelete={() => askDelete(item._id)}\r\n+              onReport={() => openReport(item)}\r\n+            />\r\n+          )}\r\n+          ListFooterComponent={\r\n+            hasMoreLocal ? (\r\n+              <TouchableOpacity\r\n+                style={styles.viewMoreBtn}\r\n+                onPress={() => setVisible((v) => Math.min(v + 10, allItems.length))}\r\n+              >\r\n+                <Text style={styles.viewMoreText}>View more</Text>\r\n+              </TouchableOpacity>\r\n+            ) : allItems.length > 0 ? (\r\n+              <Text style={styles.noMoreText}>End of history</Text>\r\n+            ) : null\r\n+          }\r\n+        />\r\n+      )}\r\n+\r\n+      {/* Report modal */}\r\n+      <Modal visible={!!reportOpen.id} transparent animationType=\"fade\" onRequestClose={() => setReportOpen({ id: null })}>\r\n+        <View style={styles.modalOverlay}>\r\n+          <View style={[styles.modalCard, { alignItems: \"stretch\" }]}>\r\n+            <TouchableOpacity style={styles.dismissButton} onPress={() => setReportOpen({ id: null })}>\r\n+              <Ionicons name=\"close\" size={24} color=\"gray\" />\r\n+            </TouchableOpacity>\r\n+\r\n+            <Text style={styles.modalTitle}>Report Driver</Text>\r\n+\r\n+            <Text style={styles.modalLabel}>Select Report Type:</Text>\r\n+            <View style={styles.dropdownContainer}>\r\n+              <TouchableOpacity style={styles.dropdownButton} onPress={() => setShowDropdown(!showDropdown)}>\r\n+                <Text style={{ color: reportType ? \"#000\" : \"#999\" }}>{reportType || \"Select a violation\"}</Text>\r\n+                <Ionicons name={showDropdown ? \"chevron-up\" : \"chevron-down\"} size={20} color=\"#999\" />\r\n+              </TouchableOpacity>\r\n+\r\n+              {showDropdown && (\r\n+                <View style={styles.dropdownMenu}>\r\n+                  {REPORT_OPTIONS.map((opt) => (\r\n+                    <TouchableOpacity\r\n+                      key={opt}\r\n+                      style={styles.dropdownItem}\r\n+                      onPress={() => { setReportType(opt); setShowDropdown(false); }}\r\n+                    >\r\n+                      <Text style={{ color: \"#000\" }}>{opt}</Text>\r\n+                    </TouchableOpacity>\r\n+                  ))}\r\n+                </View>\r\n+              )}\r\n+            </View>\r\n+\r\n+            {reportType === \"Other\" && (\r\n+              <TextInput\r\n+                style={styles.feedbackInput}\r\n+                placeholder=\"Describe the issue\"\r\n+                placeholderTextColor=\"#A0A0A0\"\r\n+                multiline numberOfLines={3}\r\n+                value={otherReport} onChangeText={setOtherReport}\r\n+              />\r\n+            )}\r\n+\r\n+            <TouchableOpacity\r\n+              style={[styles.submitButton, { backgroundColor: \"#4CAF50\", opacity: sendingReport ? 0.6 : 1 }]}\r\n+              onPress={submitReport}\r\n+              disabled={sendingReport}\r\n+            >\r\n+              <Text style={styles.submitButtonText}>{sendingReport ? \"Submitting...\" : \"Submit Report\"}</Text>\r\n+            </TouchableOpacity>\r\n+          </View>\r\n+        </View>\r\n+      </Modal>\r\n+    </View>\r\n+  );\r\n+}\r\n+\r\n+function HistoryCard({\r\n+  item, php, when, expanded, onToggle, onDelete, onReport,\r\n+}: {\r\n+  item: RideItem;\r\n+  php: (n: number) => string;\r\n+  when: (iso: string) => string;\r\n+  expanded: boolean;\r\n+  onToggle: () => void;\r\n+  onDelete: () => void;\r\n+  onReport: () => void;\r\n+}) {\r\n+  const pickup = item.pickupLabel || item.pickupPlace;\r\n+  const dest = item.destinationLabel || item.destinationPlace;\r\n+  const price = item.totalFare != null ? item.totalFare : item.fare;\r\n+\r\n+  return (\r\n+    <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n+      <View style={styles.row}>\r\n+        <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n+        <View style={{ flex: 1, paddingRight: 8 }}>\r\n+          <View style={[styles.row, { justifyContent: \"space-between\" }]}>\r\n+            <View style={styles.row}>\r\n+              <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n+              <Text style={styles.mainText} numberOfLines={1}>{pickup}</Text>\r\n+            </View>\r\n+\r\n+            {!!item.bookingType && (\r\n+              <View style={[styles.typeChip, typeChipStyle(item.bookingType)]}>\r\n+                <Text style={styles.typeChipText}>{String(item.bookingType).replace(/CLASSIC/i,'Classic').replace(/GROUP/i,'Group').replace(/SOLO/i,'Solo')}</Text>\r\n+              </View>\r\n+            )}\r\n+          </View>\r\n+\r\n+          <View style={[styles.row, { marginTop: 2 }]}>\r\n+            <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n+            <Text style={styles.subText} numberOfLines={1}>{dest}</Text>\r\n+          </View>\r\n+\r\n+          <View style={[styles.row, { marginTop: 4, justifyContent: \"space-between\" }]}>\r\n+            <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n+\r\n+            {item.bookingType === \"Group\" && typeof item.groupCount === \"number\" && (\r\n+              <View style={styles.groupChip}>\r\n+                <Ionicons name=\"people-outline\" size={14} color=\"#333\" />\r\n+                <Text style={{ marginLeft: 4, fontSize: 12, color: \"#333\" }}>{item.groupCount} pax</Text>\r\n+              </View>\r\n+            )}\r\n+          </View>\r\n+        </View>\r\n+\r\n+        <Text style={styles.priceText}>{php(price)}</Text>\r\n+      </View>\r\n+\r\n+      {expanded && (\r\n+        <View style={styles.expandBox}>\r\n+          <Text style={styles.expandTitle}>Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || \"\"}</Text></Text>\r\n+          {!!item.notes && <Text style={styles.expandNote} numberOfLines={4}>Note: {item.notes}</Text>}\r\n+\r\n+          <View style={styles.expandFooter}>\r\n+            <View style={{ flex: 1 }}>\r\n+              {!!item.bookingId && <Text style={styles.meta}>Booking: {item.bookingId}</Text>}\r\n+              {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n+            </View>\r\n+            <View style={styles.actionsRow}>\r\n+              <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n+                <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000\" />\r\n+              </TouchableOpacity>\r\n+              <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n+                <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n+              </TouchableOpacity>\r\n+            </View>\r\n+          </View>\r\n+        </View>\r\n+      )}\r\n+    </TouchableOpacity>\r\n+  );\r\n+}\r\n+\r\n+function SkeletonCard() {\r\n+  return (\r\n+    <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n+      <View style={styles.row}>\r\n+        <View style={{ width: 48, height: 48, borderRadius: 8, backgroundColor: \"#eee\" }} />\r\n+        <View style={{ flex: 1, marginLeft: 12 }}>\r\n+          <View style={{ height: 12, backgroundColor: \"#eee\", borderRadius: 6, width: \"70%\" }} />\r\n+          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"60%\", marginTop: 8 }} />\r\n+          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"40%\", marginTop: 8 }} />\r\n+        </View>\r\n+        <View style={{ width: 60, height: 14, backgroundColor: \"#eee\", borderRadius: 7 }} />\r\n+      </View>\r\n+    </View>\r\n+  );\r\n+}\r\n+\r\n+function typeChipStyle(t?: string) {\r\n+  switch (String(t || \"\").toLowerCase()) {\r\n+    case \"solo\":   return { borderColor: \"#c9e7ff\", backgroundColor: \"#f2f9ff\" };\r\n+    case \"group\":  return { borderColor: \"#ffe2b6\", backgroundColor: \"#fff7e9\" };\r\n+    case \"classic\":\r\n+    default:       return { borderColor: \"#e0e0e0\", backgroundColor: \"#f7f7f7\" };\r\n+  }\r\n+}\r\n+\r\n+const styles = StyleSheet.create({\r\n+  container: { flex: 1, backgroundColor: \"#fff\" },\r\n+  topBar: { paddingTop: 40, paddingHorizontal: 20, paddingBottom: 12 },\r\n+  heading: { fontWeight: \"bold\", fontSize: 22 },\r\n+  typeChip: { paddingHorizontal: 10, paddingVertical: 4, borderRadius: 999, borderWidth: 1 },\r\n+  typeChipText: { fontSize: 11, fontWeight: \"700\" },\r\n+  groupChip: { flexDirection: \"row\", alignItems: \"center\", borderWidth: 1, borderColor: \"#ddd\", borderRadius: 999, paddingHorizontal: 8, paddingVertical: 2 },\r\n+\r\n+  emptyWrap: { flex: 1, justifyContent: \"center\", alignItems: \"center\", paddingHorizontal: 20 },\r\n+  emptyImage: { width: 150, height: 150, marginBottom: 20, resizeMode: \"contain\" },\r\n+  emptyMsg: { textAlign: \"center\", fontSize: 14, color: \"#333\", marginBottom: 8 },\r\n+\r\n+  card: {\r\n+    backgroundColor: \"#fff\", borderRadius: 16, padding: 14, marginTop: 12,\r\n+    shadowColor: \"#000\", shadowOpacity: 0.08, shadowRadius: 8, shadowOffset: { width: 0, height: 4 },\r\n+    elevation: 3, borderWidth: 0.5, borderColor: \"#eee\",\r\n+  },\r\n+  row: { flexDirection: \"row\", alignItems: \"center\" },\r\n+  thumb: { width: 48, height: 48, marginRight: 12, resizeMode: \"contain\" },\r\n+  mainText: { marginLeft: 6, fontSize: 14, fontWeight: \"600\", color: \"#111\", flexShrink: 1 },\r\n+  subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n+  timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n+  priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n+\r\n+  expandBox: { marginTop: 10, paddingTop: 10, borderTopWidth: 1, borderTopColor: \"#eee\" },\r\n+  expandTitle: { fontSize: 14, marginBottom: 6, color: \"#111\" },\r\n+  expandNote: { fontSize: 13, color: \"#333\", marginBottom: 8 },\r\n+  expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n+  meta: { fontSize: 12, color: \"#666\" },\r\n+\r\n+  actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n+  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n+  trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n+\r\n+  viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n+  viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n+  noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n+\r\n+  modalOverlay: { flex: 1, backgroundColor: \"rgba(0,0,0,0.4)\", justifyContent: \"center\", alignItems: \"center\", padding: 20 },\r\n+  modalCard: { width: \"100%\", maxWidth: 420, backgroundColor: \"#fff\", borderRadius: 12, padding: 16 },\r\n+  dismissButton: { position: \"absolute\", right: 8, top: 8, padding: 8, zIndex: 1 },\r\n+  modalTitle: { fontWeight: \"700\", fontSize: 16, textAlign: \"center\", marginBottom: 12, marginTop: 12 },\r\n+  modalLabel: { marginBottom: 6 },\r\n+  dropdownContainer: { marginBottom: 10 },\r\n+  dropdownButton: { flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10 },\r\n+  dropdownMenu: { marginTop: 6, borderRadius: 8, borderWidth: 1, borderColor: \"#ddd\", backgroundColor: \"#fff\", overflow: \"hidden\" },\r\n+  dropdownItem: { paddingHorizontal: 12, paddingVertical: 10, borderBottomWidth: 1, borderBottomColor: \"#eee\" },\r\n+  feedbackInput: { borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10, minHeight: 80, textAlignVertical: \"top\" },\r\n+  submitButton: { marginTop: 8, borderRadius: 8, paddingVertical: 10, alignItems: \"center\" },\r\n+  submitButtonText: { color: \"#fff\", fontWeight: \"600\" },\r\n+});\r\n"
                },
                {
                    "date": 1761403149400,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -473,8 +473,9 @@\n }) {\r\n   const pickup = item.pickupLabel || item.pickupPlace;\r\n   const dest = item.destinationLabel || item.destinationPlace;\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n+  const fare = item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n@@ -613,620 +614,4 @@\n   feedbackInput: { borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10, minHeight: 80, textAlignVertical: \"top\" },\r\n   submitButton: { marginTop: 8, borderRadius: 8, paddingVertical: 10, alignItems: \"center\" },\r\n   submitButtonText: { color: \"#fff\", fontWeight: \"600\" },\r\n });\r\n-// PHistory.tsx (updated)  paste over your current PHistory file\r\n-import React, { useCallback, useEffect, useState } from \"react\";\r\n-import {\r\n-  View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n-  RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n-  Modal, TextInput, LayoutAnimation, Platform, UIManager,\r\n-} from \"react-native\";\r\n-import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n-import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n-import * as Location from \"expo-location\";\r\n-import { API_BASE_URL } from \"../../config\";\r\n-\r\n-const { width } = Dimensions.get(\"window\");\r\n-\r\n-const REPORT_OPTIONS = [\r\n-  \"Overcharging\",\r\n-  \"Harassment\",\r\n-  \"Unproper Attire\",\r\n-  \"Refusal to Convey Passenger\",\r\n-  \"Other\",\r\n-];\r\n-if (Platform.OS === \"android\" && UIManager.setLayoutAnimationEnabledExperimental) {\r\n-  UIManager.setLayoutAnimationEnabledExperimental(true);\r\n-}\r\n-\r\n-type RideItem = {\r\n-  _id: string;\r\n-  bookingId?: string;\r\n-  passengerId?: string;\r\n-  driverName?: string;\r\n-  // coords (may be present in backend)\r\n-  pickupLat?: number; pickupLng?: number;\r\n-  destinationLat?: number; destinationLng?: number;\r\n-  // optional human names (may be null for older records)\r\n-  pickupPlace?: string | null;\r\n-  destinationPlace?: string | null;\r\n-  // UI-friendly labels computed locally\r\n-  pickupLabel?: string;\r\n-  destinationLabel?: string;\r\n-  fare: number;\r\n-  totalFare?: number;\r\n-  bookingType?: \"Classic\" | \"Group\" | \"Solo\" | string;\r\n-  groupCount?: number;\r\n-  createdAt: string;\r\n-  paymentMethod?: string;\r\n-  notes?: string;\r\n-};\r\n-\r\n-\r\n-export default function PHistory() {\r\n-  const [passengerId, setPassengerId] = useState<string | null>(null);\r\n-  const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n-  const [visible, setVisible] = useState(10);\r\n-  const [loading, setLoading] = useState(true);\r\n-  const [refreshing, setRefreshing] = useState(false);\r\n-  const [errorMsg, setErrorMsg] = useState<string | null>(null);\r\n-  const [expandedId, setExpandedId] = useState<string | null>(null);\r\n-\r\n-  // report modal state\r\n-  const [reportOpen, setReportOpen] = useState<{ id: string | null; bookingId?: string; driverId?: string }>({ id: null });\r\n-  const [reportType, setReportType] = useState(\"\");\r\n-  const [otherReport, setOtherReport] = useState(\"\");\r\n-  const [showDropdown, setShowDropdown] = useState(false);\r\n-  const [sendingReport, setSendingReport] = useState(false);\r\n-\r\n-  // simple in-memory cache for reverse geocode results\r\n-  const reverseCache = React.useRef<Map<string, string>>(new Map());\r\n-\r\n-  useEffect(() => {\r\n-    (async () => {\r\n-      const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n-      setPassengerId(pid || null);\r\n-    })();\r\n-  }, []);\r\n-\r\n-  const php = (n: number) =>\r\n-    new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n-\r\n-  const when = (iso: string) =>\r\n-    new Date(iso).toLocaleString(\"en-PH\", {\r\n-      year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n-    });\r\n-\r\n-  // helper to format a coordinate key\r\n-  const coordKey = (lat?: number, lng?: number) =>\r\n-    lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n-\r\n-  // attempt reverse geocode for one coordinate pair (with caching)\r\n-  const geocodeCoord = async (lat?: number, lng?: number) => {\r\n-    const key = coordKey(lat, lng);\r\n-    if (!key) return null;\r\n-\r\n-    const cached = reverseCache.current.get(key);\r\n-    if (cached) return cached;\r\n-\r\n-    try {\r\n-      const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n-      if (Array.isArray(res) && res.length > 0) {\r\n-        const a = res[0];\r\n-        const pieces = [\r\n-          a.name, // POI name if available\r\n-          a.street,\r\n-          a.subregion || a.city || a.region,\r\n-        ].filter(Boolean);\r\n-        const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n-        reverseCache.current.set(key, label);\r\n-        return label;\r\n-      }\r\n-    } catch (e) {\r\n-      // fail silently, we'll fallback to coordinates or default text\r\n-      console.warn(\"Reverse geocode failed for\", key, e);\r\n-    }\r\n-    // fallback to coords text\r\n-    const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n-    reverseCache.current.set(key, coordLabel);\r\n-    return coordLabel;\r\n-  };\r\n-  \r\n-\r\n-  // resolve missing pickup/destination names for all items (limited concurrency)\r\n-  const resolvePlaceNames = async (items: RideItem[]) => {\r\n-    const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n-\r\n-    for (const it of items) {\r\n-      const needPickup = !it.pickupPlace && (it.pickupLat != null && it.pickupLng != null);\r\n-      const needDest = !it.destinationPlace && (it.destinationLat != null && it.destinationLng != null);\r\n-      if (!needPickup && !needDest) continue;\r\n-\r\n-      tasks.push(async () => {\r\n-        const out: any = { id: it._id };\r\n-        if (needPickup) {\r\n-          const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n-          out.pickupLabel = label || \"Pickup Location\";\r\n-        }\r\n-        if (needDest) {\r\n-          const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n-          out.destinationLabel = label || \"Destination\";\r\n-        }\r\n-        return out;\r\n-      });\r\n-    }\r\n-\r\n-    if (tasks.length === 0) return;\r\n-\r\n-    const CONCURRENCY = 5;\r\n-    const results: any[] = [];\r\n-    let idx = 0;\r\n-\r\n-    const runner = async () => {\r\n-      while (idx < tasks.length) {\r\n-        const i = idx++;\r\n-        try {\r\n-          const r = await tasks[i]();\r\n-          results.push(r);\r\n-        } catch (e) {\r\n-          console.warn(\"geocode task fail\", e);\r\n-        }\r\n-      }\r\n-    };\r\n-\r\n-    const workers = [];\r\n-    for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n-    await Promise.all(workers);\r\n-\r\n-    // apply results and ensure defaults\r\n-    setAllItems((prev) => {\r\n-      return prev.map((p) => {\r\n-        const found = results.find((r) => r.id === p._id);\r\n-        return {\r\n-          ...p,\r\n-          pickupLabel: found?.pickupLabel || p.pickupLabel || p.pickupPlace || \"Pickup Location\",\r\n-          destinationLabel: found?.destinationLabel || p.destinationLabel || p.destinationPlace || \"Destination\",\r\n-        };\r\n-      });\r\n-    });\r\n-  };\r\n-\r\n-\r\n-  const normalize = (raw: any[]): RideItem[] =>\r\n-    (raw || []).map((r: any) => {\r\n-      const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n-      const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n-      return {\r\n-        _id: String(r._id),\r\n-        bookingId: r.bookingId,\r\n-        passengerId: r.passengerId,\r\n-        driverName: r.driverName,\r\n-        pickupLat: Number.isFinite(r.pickupLat) ? Number(r.pickupLat) : undefined,\r\n-        pickupLng: Number.isFinite(r.pickupLng) ? Number(r.pickupLng) : undefined,\r\n-        destinationLat: Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : undefined,\r\n-        destinationLng: Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : undefined,\r\n-        pickupPlace: r.pickupPlace ?? null,\r\n-        destinationPlace: r.destinationPlace ?? null,\r\n-        pickupLabel, // may be undefined; we'll resolve later\r\n-        destinationLabel,\r\n-        fare: Number(r.fare || 0),\r\n-        totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n-        bookingType: r.bookingType,\r\n-        groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n-        createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n-        paymentMethod: r.paymentMethod || \"\",\r\n-        notes: r.notes || \"\",\r\n-      } as RideItem;\r\n-    });\r\n-\r\n-  const fetchAll = useCallback(async () => {\r\n-    setErrorMsg(null);\r\n-    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n-    try {\r\n-      const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n-      const paths = [\r\n-        `/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n-        `/api/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n-        `/rides`,\r\n-        `/api/rides`,\r\n-      ];\r\n-      let got: RideItem[] | null = null;\r\n-\r\n-      for (let i = 0; i < paths.length; i++) {\r\n-        const url = `${base}${paths[i]}`;\r\n-        const filterLocally = i >= 2;\r\n-        try {\r\n-          const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n-          const text = await res.text();\r\n-          let data: any;\r\n-          try { data = JSON.parse(text); } catch { continue; }\r\n-          let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n-          if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n-          got = normalize(raw);\r\n-          break;\r\n-        } catch (e) {\r\n-          // continue trying other endpoints\r\n-          console.warn(\"fetch attempt failed for\", paths[i], e);\r\n-        }\r\n-      }\r\n-      if (!got) got = [];\r\n-      // set basic items first (fast UI)\r\n-      setAllItems(got);\r\n-      setVisible(Math.min(10, got.length));\r\n-\r\n-      // resolve missing place names using coords (async, non-blocking)\r\n-      // only for items missing pickup/destination label\r\n-      const needResolve = got.filter(it =>\r\n-        (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n-        (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n-      );\r\n-      if (needResolve.length > 0) {\r\n-        // do not block the UI  run in background, but update state when done\r\n-        resolvePlaceNames(got).catch((e) => console.warn(\"resolvePlaceNames failed\", e));\r\n-      }\r\n-    } finally {\r\n-      setLoading(false);\r\n-      setRefreshing(false);\r\n-    }\r\n-  }, [passengerId]);\r\n-\r\n-  useEffect(() => { fetchAll(); }, [fetchAll]);\r\n-\r\n-  const onRefresh = useCallback(() => {\r\n-    setRefreshing(true);\r\n-    fetchAll();\r\n-  }, [fetchAll]);\r\n-\r\n-  const dataToShow = allItems.slice(0, visible);\r\n-  const hasMoreLocal = visible < allItems.length;\r\n-\r\n-  const toggleExpand = (id: string) => {\r\n-    LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);\r\n-    setExpandedId((cur) => (cur === id ? null : id));\r\n-  };\r\n-\r\n-  const askDelete = (id: string) => {\r\n-    Alert.alert(\"Delete ride\", \"Are you sure you want to delete this history item?\", [\r\n-      { text: \"Cancel\", style: \"cancel\" },\r\n-      {\r\n-        text: \"Delete\",\r\n-        style: \"destructive\",\r\n-        onPress: async () => {\r\n-          const prev = allItems;\r\n-          setAllItems((list) => list.filter((x) => x._id !== id));\r\n-\r\n-          try {\r\n-            const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n-            const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n-\r\n-            let success = false;\r\n-            for (const url of candidates) {\r\n-              try {\r\n-                console.log(\" calling\", url);\r\n-                const res = await fetch(url, { method: \"DELETE\" });\r\n-                const text = await res.text();\r\n-                console.log(\" delete response\", res.status, text);\r\n-                if (res.ok) { success = true; break; }\r\n-              } catch (e) {\r\n-                console.log(\" delete fetch failed\", e);\r\n-              }\r\n-            }\r\n-\r\n-            if (!success) {\r\n-              setAllItems(prev);\r\n-              Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n-              await fetchAll();\r\n-            }\r\n-          } catch (e) {\r\n-            console.log(\" delete unexpected error\", e);\r\n-            setAllItems(prev);\r\n-            Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n-            await fetchAll();\r\n-          }\r\n-        },\r\n-      },\r\n-    ]);\r\n-  };\r\n-\r\n-  const openReport = (item: RideItem) => {\r\n-    setReportType(\"\");\r\n-    setOtherReport(\"\");\r\n-    setShowDropdown(false);\r\n-    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverName ? undefined : undefined });\r\n-  };\r\n-\r\n-  const submitReport = async () => {\r\n-    if (!reportOpen.id || !passengerId) return;\r\n-    if (!reportType) return Alert.alert(\"Report\", \"Please select a violation.\");\r\n-    if (reportType === \"Other\" && !otherReport.trim())\r\n-      return Alert.alert(\"Report\", \"Please describe the issue.\");\r\n-\r\n-    try {\r\n-      setSendingReport(true);\r\n-      const res = await fetch(`${API_BASE_URL.replace(/\\/$/, \"\")}/api/feedback/submit-report`, {\r\n-        method: \"POST\",\r\n-        headers: { \"Content-Type\": \"application/json\" },\r\n-        body: JSON.stringify({\r\n-          bookingId: reportOpen.bookingId,\r\n-          passengerId,\r\n-          driverId: reportOpen.driverId,\r\n-          reportType,\r\n-          otherReport,\r\n-        }),\r\n-      });\r\n-      const j = await res.json().catch(() => ({}));\r\n-      if (!res.ok) throw new Error(j?.message || \"Failed to submit report.\");\r\n-      Alert.alert(\"Success\", \"Report submitted!\");\r\n-      setReportOpen({ id: null });\r\n-    } catch (e: any) {\r\n-      Alert.alert(\"Error\", e?.message || \"Something went wrong.\");\r\n-    } finally {\r\n-      setSendingReport(false);\r\n-    }\r\n-  };\r\n-\r\n-  if (!loading && allItems.length === 0) {\r\n-    return (\r\n-      <View style={styles.container}>\r\n-        <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n-        <View style={styles.emptyWrap}>\r\n-          <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.emptyImage} />\r\n-          <Text style={styles.emptyMsg}>{errorMsg || \"Mag Book na para mag ka history ka.\"}</Text>\r\n-          <TouchableOpacity style={styles.viewMoreBtn} onPress={onRefresh}>\r\n-            <Text style={styles.viewMoreText}>Reload</Text>\r\n-          </TouchableOpacity>\r\n-        </View>\r\n-      </View>\r\n-    );\r\n-  }\r\n-\r\n-  return (\r\n-    <View style={styles.container}>\r\n-      <View style={styles.topBar}><Text style={styles.heading}>HISTORY</Text></View>\r\n-\r\n-      {loading && allItems.length === 0 ? (\r\n-        <View style={{ paddingHorizontal: 16 }}>\r\n-          <SkeletonCard /><SkeletonCard /><SkeletonCard />\r\n-        </View>\r\n-      ) : (\r\n-        <FlatList\r\n-          data={dataToShow}\r\n-          keyExtractor={(it) => it._id}\r\n-          contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 24 }}\r\n-          refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n-          renderItem={({ item }) => (\r\n-            <HistoryCard\r\n-              item={item}\r\n-              php={php}\r\n-              when={when}\r\n-              expanded={expandedId === item._id}\r\n-              onToggle={() => toggleExpand(item._id)}\r\n-              onDelete={() => askDelete(item._id)}\r\n-              onReport={() => openReport(item)}\r\n-            />\r\n-          )}\r\n-          ListFooterComponent={\r\n-            hasMoreLocal ? (\r\n-              <TouchableOpacity\r\n-                style={styles.viewMoreBtn}\r\n-                onPress={() => setVisible((v) => Math.min(v + 10, allItems.length))}\r\n-              >\r\n-                <Text style={styles.viewMoreText}>View more</Text>\r\n-              </TouchableOpacity>\r\n-            ) : allItems.length > 0 ? (\r\n-              <Text style={styles.noMoreText}>End of history</Text>\r\n-            ) : null\r\n-          }\r\n-        />\r\n-      )}\r\n-\r\n-      {/* Report modal */}\r\n-      <Modal visible={!!reportOpen.id} transparent animationType=\"fade\" onRequestClose={() => setReportOpen({ id: null })}>\r\n-        <View style={styles.modalOverlay}>\r\n-          <View style={[styles.modalCard, { alignItems: \"stretch\" }]}>\r\n-            <TouchableOpacity style={styles.dismissButton} onPress={() => setReportOpen({ id: null })}>\r\n-              <Ionicons name=\"close\" size={24} color=\"gray\" />\r\n-            </TouchableOpacity>\r\n-\r\n-            <Text style={styles.modalTitle}>Report Driver</Text>\r\n-\r\n-            <Text style={styles.modalLabel}>Select Report Type:</Text>\r\n-            <View style={styles.dropdownContainer}>\r\n-              <TouchableOpacity style={styles.dropdownButton} onPress={() => setShowDropdown(!showDropdown)}>\r\n-                <Text style={{ color: reportType ? \"#000\" : \"#999\" }}>{reportType || \"Select a violation\"}</Text>\r\n-                <Ionicons name={showDropdown ? \"chevron-up\" : \"chevron-down\"} size={20} color=\"#999\" />\r\n-              </TouchableOpacity>\r\n-\r\n-              {showDropdown && (\r\n-                <View style={styles.dropdownMenu}>\r\n-                  {REPORT_OPTIONS.map((opt) => (\r\n-                    <TouchableOpacity\r\n-                      key={opt}\r\n-                      style={styles.dropdownItem}\r\n-                      onPress={() => { setReportType(opt); setShowDropdown(false); }}\r\n-                    >\r\n-                      <Text style={{ color: \"#000\" }}>{opt}</Text>\r\n-                    </TouchableOpacity>\r\n-                  ))}\r\n-                </View>\r\n-              )}\r\n-            </View>\r\n-\r\n-            {reportType === \"Other\" && (\r\n-              <TextInput\r\n-                style={styles.feedbackInput}\r\n-                placeholder=\"Describe the issue\"\r\n-                placeholderTextColor=\"#A0A0A0\"\r\n-                multiline numberOfLines={3}\r\n-                value={otherReport} onChangeText={setOtherReport}\r\n-              />\r\n-            )}\r\n-\r\n-            <TouchableOpacity\r\n-              style={[styles.submitButton, { backgroundColor: \"#4CAF50\", opacity: sendingReport ? 0.6 : 1 }]}\r\n-              onPress={submitReport}\r\n-              disabled={sendingReport}\r\n-            >\r\n-              <Text style={styles.submitButtonText}>{sendingReport ? \"Submitting...\" : \"Submit Report\"}</Text>\r\n-            </TouchableOpacity>\r\n-          </View>\r\n-        </View>\r\n-      </Modal>\r\n-    </View>\r\n-  );\r\n-}\r\n-\r\n-function HistoryCard({\r\n-  item, php, when, expanded, onToggle, onDelete, onReport,\r\n-}: {\r\n-  item: RideItem;\r\n-  php: (n: number) => string;\r\n-  when: (iso: string) => string;\r\n-  expanded: boolean;\r\n-  onToggle: () => void;\r\n-  onDelete: () => void;\r\n-  onReport: () => void;\r\n-}) {\r\n-  const pickup = item.pickupLabel || item.pickupPlace;\r\n-  const dest = item.destinationLabel || item.destinationPlace;\r\n-  const price = item.totalFare != null ? item.totalFare : item.fare;\r\n-\r\n-  return (\r\n-    <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n-      <View style={styles.row}>\r\n-        <Image source={require(\"../../assets/images/tricycle.png\")} style={styles.thumb} />\r\n-        <View style={{ flex: 1, paddingRight: 8 }}>\r\n-          <View style={[styles.row, { justifyContent: \"space-between\" }]}>\r\n-            <View style={styles.row}>\r\n-              <Ionicons name=\"location-outline\" size={16} color=\"#444\" style={{ marginTop: 1 }} />\r\n-              <Text style={styles.mainText} numberOfLines={1}>{pickup}</Text>\r\n-            </View>\r\n-\r\n-            {!!item.bookingType && (\r\n-              <View style={[styles.typeChip, typeChipStyle(item.bookingType)]}>\r\n-                <Text style={styles.typeChipText}>{String(item.bookingType).replace(/CLASSIC/i,'Classic').replace(/GROUP/i,'Group').replace(/SOLO/i,'Solo')}</Text>\r\n-              </View>\r\n-            )}\r\n-          </View>\r\n-\r\n-          <View style={[styles.row, { marginTop: 2 }]}>\r\n-            <MaterialIcons name=\"route\" size={16} color=\"#444\" />\r\n-            <Text style={styles.subText} numberOfLines={1}>{dest}</Text>\r\n-          </View>\r\n-\r\n-          <View style={[styles.row, { marginTop: 4, justifyContent: \"space-between\" }]}>\r\n-            <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n-\r\n-            {item.bookingType === \"Group\" && typeof item.groupCount === \"number\" && (\r\n-              <View style={styles.groupChip}>\r\n-                <Ionicons name=\"people-outline\" size={14} color=\"#333\" />\r\n-                <Text style={{ marginLeft: 4, fontSize: 12, color: \"#333\" }}>{item.groupCount} pax</Text>\r\n-              </View>\r\n-            )}\r\n-          </View>\r\n-        </View>\r\n-\r\n-        <Text style={styles.priceText}>{php(price)}</Text>\r\n-      </View>\r\n-\r\n-      {expanded && (\r\n-        <View style={styles.expandBox}>\r\n-          <Text style={styles.expandTitle}>Driver: <Text style={{ fontWeight: \"600\" }}>{item.driverName || \"\"}</Text></Text>\r\n-          {!!item.notes && <Text style={styles.expandNote} numberOfLines={4}>Note: {item.notes}</Text>}\r\n-\r\n-          <View style={styles.expandFooter}>\r\n-            <View style={{ flex: 1 }}>\r\n-              {!!item.bookingId && <Text style={styles.meta}>Booking: {item.bookingId}</Text>}\r\n-              {!!item.paymentMethod && <Text style={styles.meta}>Payment: {item.paymentMethod}</Text>}\r\n-            </View>\r\n-            <View style={styles.actionsRow}>\r\n-              <TouchableOpacity onPress={onReport} style={styles.warnBtn}>\r\n-                <MaterialIcons name=\"warning-amber\" size={22} color=\"#b00000\" />\r\n-              </TouchableOpacity>\r\n-              <TouchableOpacity onPress={onDelete} style={styles.trashBtn}>\r\n-                <Ionicons name=\"trash-bin-outline\" size={22} color=\"#b00000\" />\r\n-              </TouchableOpacity>\r\n-            </View>\r\n-          </View>\r\n-        </View>\r\n-      )}\r\n-    </TouchableOpacity>\r\n-  );\r\n-}\r\n-\r\n-function SkeletonCard() {\r\n-  return (\r\n-    <View style={[styles.card, { overflow: \"hidden\" }]}>\r\n-      <View style={styles.row}>\r\n-        <View style={{ width: 48, height: 48, borderRadius: 8, backgroundColor: \"#eee\" }} />\r\n-        <View style={{ flex: 1, marginLeft: 12 }}>\r\n-          <View style={{ height: 12, backgroundColor: \"#eee\", borderRadius: 6, width: \"70%\" }} />\r\n-          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"60%\", marginTop: 8 }} />\r\n-          <View style={{ height: 10, backgroundColor: \"#eee\", borderRadius: 5, width: \"40%\", marginTop: 8 }} />\r\n-        </View>\r\n-        <View style={{ width: 60, height: 14, backgroundColor: \"#eee\", borderRadius: 7 }} />\r\n-      </View>\r\n-    </View>\r\n-  );\r\n-}\r\n-\r\n-function typeChipStyle(t?: string) {\r\n-  switch (String(t || \"\").toLowerCase()) {\r\n-    case \"solo\":   return { borderColor: \"#c9e7ff\", backgroundColor: \"#f2f9ff\" };\r\n-    case \"group\":  return { borderColor: \"#ffe2b6\", backgroundColor: \"#fff7e9\" };\r\n-    case \"classic\":\r\n-    default:       return { borderColor: \"#e0e0e0\", backgroundColor: \"#f7f7f7\" };\r\n-  }\r\n-}\r\n-\r\n-const styles = StyleSheet.create({\r\n-  container: { flex: 1, backgroundColor: \"#fff\" },\r\n-  topBar: { paddingTop: 40, paddingHorizontal: 20, paddingBottom: 12 },\r\n-  heading: { fontWeight: \"bold\", fontSize: 22 },\r\n-  typeChip: { paddingHorizontal: 10, paddingVertical: 4, borderRadius: 999, borderWidth: 1 },\r\n-  typeChipText: { fontSize: 11, fontWeight: \"700\" },\r\n-  groupChip: { flexDirection: \"row\", alignItems: \"center\", borderWidth: 1, borderColor: \"#ddd\", borderRadius: 999, paddingHorizontal: 8, paddingVertical: 2 },\r\n-\r\n-  emptyWrap: { flex: 1, justifyContent: \"center\", alignItems: \"center\", paddingHorizontal: 20 },\r\n-  emptyImage: { width: 150, height: 150, marginBottom: 20, resizeMode: \"contain\" },\r\n-  emptyMsg: { textAlign: \"center\", fontSize: 14, color: \"#333\", marginBottom: 8 },\r\n-\r\n-  card: {\r\n-    backgroundColor: \"#fff\", borderRadius: 16, padding: 14, marginTop: 12,\r\n-    shadowColor: \"#000\", shadowOpacity: 0.08, shadowRadius: 8, shadowOffset: { width: 0, height: 4 },\r\n-    elevation: 3, borderWidth: 0.5, borderColor: \"#eee\",\r\n-  },\r\n-  row: { flexDirection: \"row\", alignItems: \"center\" },\r\n-  thumb: { width: 48, height: 48, marginRight: 12, resizeMode: \"contain\" },\r\n-  mainText: { marginLeft: 6, fontSize: 14, fontWeight: \"600\", color: \"#111\", flexShrink: 1 },\r\n-  subText: { marginLeft: 6, fontSize: 13, color: \"#333\", flexShrink: 1 },\r\n-  timeText: { marginTop: 6, fontSize: 12, color: \"#666\" },\r\n-  priceText: { fontSize: 14, fontWeight: \"700\", color: \"#111\" },\r\n-\r\n-  expandBox: { marginTop: 10, paddingTop: 10, borderTopWidth: 1, borderTopColor: \"#eee\" },\r\n-  expandTitle: { fontSize: 14, marginBottom: 6, color: \"#111\" },\r\n-  expandNote: { fontSize: 13, color: \"#333\", marginBottom: 8 },\r\n-  expandFooter: { flexDirection: \"row\", alignItems: \"center\", gap: 10 },\r\n-  meta: { fontSize: 12, color: \"#666\" },\r\n-\r\n-  actionsRow: { flexDirection: \"row\", alignItems: \"center\", gap: 8 },\r\n-  warnBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n-  trashBtn: { borderWidth: 1, borderColor: \"#f1b0b0\", backgroundColor: \"#fff5f5\", padding: 8, borderRadius: 12 },\r\n-\r\n-  viewMoreBtn: { marginTop: 12, alignSelf: \"center\", paddingHorizontal: 16, paddingVertical: 10, borderRadius: 999, borderWidth: 1, borderColor: \"#ddd\" },\r\n-  viewMoreText: { fontWeight: \"600\", color: \"#111\" },\r\n-  noMoreText: { textAlign: \"center\", color: \"#666\", marginTop: 12 },\r\n-\r\n-  modalOverlay: { flex: 1, backgroundColor: \"rgba(0,0,0,0.4)\", justifyContent: \"center\", alignItems: \"center\", padding: 20 },\r\n-  modalCard: { width: \"100%\", maxWidth: 420, backgroundColor: \"#fff\", borderRadius: 12, padding: 16 },\r\n-  dismissButton: { position: \"absolute\", right: 8, top: 8, padding: 8, zIndex: 1 },\r\n-  modalTitle: { fontWeight: \"700\", fontSize: 16, textAlign: \"center\", marginBottom: 12, marginTop: 12 },\r\n-  modalLabel: { marginBottom: 6 },\r\n-  dropdownContainer: { marginBottom: 10 },\r\n-  dropdownButton: { flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10 },\r\n-  dropdownMenu: { marginTop: 6, borderRadius: 8, borderWidth: 1, borderColor: \"#ddd\", backgroundColor: \"#fff\", overflow: \"hidden\" },\r\n-  dropdownItem: { paddingHorizontal: 12, paddingVertical: 10, borderBottomWidth: 1, borderBottomColor: \"#eee\" },\r\n-  feedbackInput: { borderWidth: 1, borderColor: \"#ddd\", borderRadius: 8, paddingHorizontal: 12, paddingVertical: 10, minHeight: 80, textAlignVertical: \"top\" },\r\n-  submitButton: { marginTop: 8, borderRadius: 8, paddingVertical: 10, alignItems: \"center\" },\r\n-  submitButtonText: { color: \"#fff\", fontWeight: \"600\" },\r\n-});\r\n"
                },
                {
                    "date": 1761404280931,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-// PHistory.tsx (updated)  paste over your current PHistory file\r\n+// PHistory.tsx (with debug logging)\r\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n   RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n@@ -27,15 +27,12 @@\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n   driverName?: string;\r\n-  // coords (may be present in backend)\r\n   pickupLat?: number; pickupLng?: number;\r\n   destinationLat?: number; destinationLng?: number;\r\n-  // optional human names (may be null for older records)\r\n   pickupPlace?: string | null;\r\n   destinationPlace?: string | null;\r\n-  // UI-friendly labels computed locally\r\n   pickupLabel?: string;\r\n   destinationLabel?: string;\r\n   fare: number;\r\n   totalFare?: number;\r\n@@ -45,9 +42,8 @@\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n-\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n@@ -69,8 +65,9 @@\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n+      console.log(\"[PHistory] loaded passengerId:\", pid);\r\n     })();\r\n   }, []);\r\n \r\n   const php = (n: number) =>\r\n@@ -80,19 +77,22 @@\n     new Date(iso).toLocaleString(\"en-PH\", {\r\n       year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n     });\r\n \r\n-  // helper to format a coordinate key\r\n   const coordKey = (lat?: number, lng?: number) =>\r\n     lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n \r\n-  // attempt reverse geocode for one coordinate pair (with caching)\r\n+  // geocode a coordinate pair (with caching) using expo-location reverseGeocodeAsync\r\n   const geocodeCoord = async (lat?: number, lng?: number) => {\r\n     const key = coordKey(lat, lng);\r\n     if (!key) return null;\r\n \r\n     const cached = reverseCache.current.get(key);\r\n-    if (cached) return cached;\r\n+    if (cached) {\r\n+      console.log(\"[PHistory][geocodeCoord] cache HIT:\", key, \"->\", cached);\r\n+      return cached;\r\n+    }\r\n+    console.log(\"[PHistory][geocodeCoord] cache MISS, calling reverseGeocodeAsync for:\", key);\r\n \r\n     try {\r\n       const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n       if (Array.isArray(res) && res.length > 0) {\r\n@@ -103,46 +103,62 @@\n           a.subregion || a.city || a.region,\r\n         ].filter(Boolean);\r\n         const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n         reverseCache.current.set(key, label);\r\n+        console.log(\"[PHistory][geocodeCoord] reverse geocode success:\", key, \"->\", label);\r\n         return label;\r\n+      } else {\r\n+        console.warn(\"[PHistory][geocodeCoord] reverseGeocodeAsync returned empty for:\", key);\r\n       }\r\n     } catch (e) {\r\n-      // fail silently, we'll fallback to coordinates or default text\r\n-      console.warn(\"Reverse geocode failed for\", key, e);\r\n+      console.warn(\"[PHistory][geocodeCoord] reverse geocode failed for\", key, e);\r\n     }\r\n-    // fallback to coords text\r\n+\r\n     const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n     reverseCache.current.set(key, coordLabel);\r\n+    console.log(\"[PHistory][geocodeCoord] fallback to coord label:\", key, \"->\", coordLabel);\r\n     return coordLabel;\r\n   };\r\n-  \r\n \r\n   // resolve missing pickup/destination names for all items (limited concurrency)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n+    console.log(\"[PHistory][resolvePlaceNames] starting, items length:\", items.length);\r\n+    // collect tasks only for items needing resolution\r\n     const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n     for (const it of items) {\r\n-      const needPickup = !it.pickupPlace && (it.pickupLat != null && it.pickupLng != null);\r\n-      const needDest = !it.destinationPlace && (it.destinationLat != null && it.destinationLng != null);\r\n+      const needPickup = !it.pickupPlace && !it.pickupLabel && (it.pickupLat != null && it.pickupLng != null);\r\n+      const needDest = !it.destinationPlace && !it.destinationLabel && (it.destinationLat != null && it.destinationLng != null);\r\n       if (!needPickup && !needDest) continue;\r\n \r\n       tasks.push(async () => {\r\n         const out: any = { id: it._id };\r\n         if (needPickup) {\r\n-          const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n-          out.pickupLabel = label || \"Pickup Location\";\r\n+          try {\r\n+            const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+            out.pickupLabel = label || \"Pickup Location\";\r\n+          } catch (e) {\r\n+            console.warn(\"[PHistory][resolvePlaceNames] geocode pickup failed for\", it._id, e);\r\n+            out.pickupLabel = \"Pickup Location\";\r\n+          }\r\n         }\r\n         if (needDest) {\r\n-          const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n-          out.destinationLabel = label || \"Destination\";\r\n+          try {\r\n+            const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+            out.destinationLabel = label || \"Destination\";\r\n+          } catch (e) {\r\n+            console.warn(\"[PHistory][resolvePlaceNames] geocode destination failed for\", it._id, e);\r\n+            out.destinationLabel = \"Destination\";\r\n+          }\r\n         }\r\n         return out;\r\n       });\r\n     }\r\n \r\n+    console.log(\"[PHistory][resolvePlaceNames] tasks queued:\", tasks.length);\r\n     if (tasks.length === 0) return;\r\n \r\n+    // concurrency limiter\r\n     const CONCURRENCY = 5;\r\n     const results: any[] = [];\r\n     let idx = 0;\r\n \r\n@@ -151,32 +167,40 @@\n         const i = idx++;\r\n         try {\r\n           const r = await tasks[i]();\r\n           results.push(r);\r\n+          console.log(\"[PHistory][resolvePlaceNames] task done:\", r.id);\r\n         } catch (e) {\r\n-          console.warn(\"geocode task fail\", e);\r\n+          console.warn(\"[PHistory][resolvePlaceNames] task error:\", e);\r\n         }\r\n       }\r\n     };\r\n \r\n     const workers = [];\r\n     for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n     await Promise.all(workers);\r\n \r\n-    // apply results and ensure defaults\r\n+    console.log(\"[PHistory][resolvePlaceNames] all tasks finished, results:\", results.length);\r\n+\r\n+    if (results.length === 0) return;\r\n+\r\n+    // apply results\r\n     setAllItems((prev) => {\r\n-      return prev.map((p) => {\r\n-        const found = results.find((r) => r.id === p._id);\r\n-        return {\r\n-          ...p,\r\n-          pickupLabel: found?.pickupLabel || p.pickupLabel || p.pickupPlace || \"Pickup Location\",\r\n-          destinationLabel: found?.destinationLabel || p.destinationLabel || p.destinationPlace || \"Destination\",\r\n-        };\r\n-      });\r\n+      const byId = new Map(prev.map((p) => [p._id, { ...p }]));\r\n+      for (const r of results) {\r\n+        const entry = byId.get(r.id);\r\n+        if (!entry) continue;\r\n+        if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n+        if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n+        // ensure defaults\r\n+        if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n+        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n+      }\r\n+      console.log(\"[PHistory][resolvePlaceNames] applied results to state\");\r\n+      return Array.from(byId.values());\r\n     });\r\n   };\r\n \r\n-\r\n   const normalize = (raw: any[]): RideItem[] =>\r\n     (raw || []).map((r: any) => {\r\n       const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n       const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n@@ -190,9 +214,9 @@\n         destinationLat: Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : undefined,\r\n         destinationLng: Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : undefined,\r\n         pickupPlace: r.pickupPlace ?? null,\r\n         destinationPlace: r.destinationPlace ?? null,\r\n-        pickupLabel, // may be undefined; we'll resolve later\r\n+        pickupLabel,\r\n         destinationLabel,\r\n         fare: Number(r.fare || 0),\r\n         totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n         bookingType: r.bookingType,\r\n@@ -204,9 +228,9 @@\n     });\r\n \r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n-    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n+    if (!passengerId) { setLoading(false); setRefreshing(false); console.log(\"[PHistory][fetchAll] no passengerId, abort\"); return; }\r\n     try {\r\n       const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n       const paths = [\r\n         `/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n@@ -215,43 +239,57 @@\n         `/api/rides`,\r\n       ];\r\n       let got: RideItem[] | null = null;\r\n \r\n+      console.log(\"[PHistory][fetchAll] starting, trying endpoints:\", paths);\r\n       for (let i = 0; i < paths.length; i++) {\r\n         const url = `${base}${paths[i]}`;\r\n         const filterLocally = i >= 2;\r\n         try {\r\n+          console.log(\"[PHistory][fetchAll] attempting fetch:\", url);\r\n           const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n           const text = await res.text();\r\n           let data: any;\r\n-          try { data = JSON.parse(text); } catch { continue; }\r\n+          try { data = JSON.parse(text); } catch {\r\n+            console.warn(\"[PHistory][fetchAll] response not JSON from\", url);\r\n+            continue;\r\n+          }\r\n           let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n           if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n           got = normalize(raw);\r\n+          console.log(\"[PHistory][fetchAll] success from:\", url, \"items:\", got.length);\r\n           break;\r\n         } catch (e) {\r\n-          // continue trying other endpoints\r\n-          console.warn(\"fetch attempt failed for\", paths[i], e);\r\n+          console.warn(\"[PHistory][fetchAll] fetch attempt failed for\", paths[i], e);\r\n         }\r\n       }\r\n       if (!got) got = [];\r\n+      console.log(\"[PHistory][fetchAll] final got length:\", got.length);\r\n+\r\n       // set basic items first (fast UI)\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n \r\n       // resolve missing place names using coords (async, non-blocking)\r\n-      // only for items missing pickup/destination label\r\n       const needResolve = got.filter(it =>\r\n         (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n         (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n       );\r\n+      console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length);\r\n       if (needResolve.length > 0) {\r\n-        // do not block the UI  run in background, but update state when done\r\n-        resolvePlaceNames(got).catch((e) => console.warn(\"resolvePlaceNames failed\", e));\r\n+        resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n+      } else {\r\n+        // ensure fallback labels applied for items missing place names (no coords)\r\n+        setAllItems((prev) => prev.map(p => ({\r\n+          ...p,\r\n+          pickupLabel: p.pickupLabel ?? p.pickupPlace ?? \"Pickup location\",\r\n+          destinationLabel: p.destinationLabel ?? p.destinationPlace ?? \"Destination\",\r\n+        })));\r\n       }\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n+      console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n     }\r\n   }, [passengerId]);\r\n \r\n   useEffect(() => { fetchAll(); }, [fetchAll]);\r\n@@ -277,23 +315,22 @@\n         style: \"destructive\",\r\n         onPress: async () => {\r\n           const prev = allItems;\r\n           setAllItems((list) => list.filter((x) => x._id !== id));\r\n-\r\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n             const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n \r\n             let success = false;\r\n             for (const url of candidates) {\r\n               try {\r\n-                console.log(\" calling\", url);\r\n+                console.log(\"[PHistory][delete] calling\", url);\r\n                 const res = await fetch(url, { method: \"DELETE\" });\r\n                 const text = await res.text();\r\n-                console.log(\" delete response\", res.status, text);\r\n+                console.log(\"[PHistory][delete] delete response\", res.status, text);\r\n                 if (res.ok) { success = true; break; }\r\n               } catch (e) {\r\n-                console.log(\" delete fetch failed\", e);\r\n+                console.log(\"[PHistory][delete] fetch failed\", e);\r\n               }\r\n             }\r\n \r\n             if (!success) {\r\n@@ -301,9 +338,9 @@\n               Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n               await fetchAll();\r\n             }\r\n           } catch (e) {\r\n-            console.log(\" delete unexpected error\", e);\r\n+            console.log(\"[PHistory][delete] unexpected error\", e);\r\n             setAllItems(prev);\r\n             Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n             await fetchAll();\r\n           }\r\n@@ -315,9 +352,9 @@\n   const openReport = (item: RideItem) => {\r\n     setReportType(\"\");\r\n     setOtherReport(\"\");\r\n     setShowDropdown(false);\r\n-    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverName ? undefined : undefined });\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: undefined });\r\n   };\r\n \r\n   const submitReport = async () => {\r\n     if (!reportOpen.id || !passengerId) return;\r\n@@ -470,12 +507,11 @@\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n-  const pickup = item.pickupLabel || item.pickupPlace;\r\n-  const dest = item.destinationLabel || item.destinationPlace;\r\n+  const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n+  const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n-  const fare = item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n"
                },
                {
                    "date": 1761404323364,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-// PHistory.tsx (with debug logging)\r\n+// PHistory.tsx (updated)  paste over your current PHistory file\r\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n   RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n@@ -27,12 +27,15 @@\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n   driverName?: string;\r\n+  // coords (may be present in backend)\r\n   pickupLat?: number; pickupLng?: number;\r\n   destinationLat?: number; destinationLng?: number;\r\n+  // optional human names (may be null for older records)\r\n   pickupPlace?: string | null;\r\n   destinationPlace?: string | null;\r\n+  // UI-friendly labels computed locally\r\n   pickupLabel?: string;\r\n   destinationLabel?: string;\r\n   fare: number;\r\n   totalFare?: number;\r\n@@ -42,8 +45,9 @@\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n+\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n@@ -65,9 +69,8 @@\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n-      console.log(\"[PHistory] loaded passengerId:\", pid);\r\n     })();\r\n   }, []);\r\n \r\n   const php = (n: number) =>\r\n@@ -77,22 +80,19 @@\n     new Date(iso).toLocaleString(\"en-PH\", {\r\n       year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n     });\r\n \r\n+  // helper to format a coordinate key\r\n   const coordKey = (lat?: number, lng?: number) =>\r\n     lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n \r\n-  // geocode a coordinate pair (with caching) using expo-location reverseGeocodeAsync\r\n+  // attempt reverse geocode for one coordinate pair (with caching)\r\n   const geocodeCoord = async (lat?: number, lng?: number) => {\r\n     const key = coordKey(lat, lng);\r\n     if (!key) return null;\r\n \r\n     const cached = reverseCache.current.get(key);\r\n-    if (cached) {\r\n-      console.log(\"[PHistory][geocodeCoord] cache HIT:\", key, \"->\", cached);\r\n-      return cached;\r\n-    }\r\n-    console.log(\"[PHistory][geocodeCoord] cache MISS, calling reverseGeocodeAsync for:\", key);\r\n+    if (cached) return cached;\r\n \r\n     try {\r\n       const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n       if (Array.isArray(res) && res.length > 0) {\r\n@@ -103,62 +103,46 @@\n           a.subregion || a.city || a.region,\r\n         ].filter(Boolean);\r\n         const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n         reverseCache.current.set(key, label);\r\n-        console.log(\"[PHistory][geocodeCoord] reverse geocode success:\", key, \"->\", label);\r\n         return label;\r\n-      } else {\r\n-        console.warn(\"[PHistory][geocodeCoord] reverseGeocodeAsync returned empty for:\", key);\r\n       }\r\n     } catch (e) {\r\n-      console.warn(\"[PHistory][geocodeCoord] reverse geocode failed for\", key, e);\r\n+      // fail silently, we'll fallback to coordinates or default text\r\n+      console.warn(\"Reverse geocode failed for\", key, e);\r\n     }\r\n-\r\n+    // fallback to coords text\r\n     const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n     reverseCache.current.set(key, coordLabel);\r\n-    console.log(\"[PHistory][geocodeCoord] fallback to coord label:\", key, \"->\", coordLabel);\r\n     return coordLabel;\r\n   };\r\n+  \r\n \r\n   // resolve missing pickup/destination names for all items (limited concurrency)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n-    console.log(\"[PHistory][resolvePlaceNames] starting, items length:\", items.length);\r\n-    // collect tasks only for items needing resolution\r\n     const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n     for (const it of items) {\r\n-      const needPickup = !it.pickupPlace && !it.pickupLabel && (it.pickupLat != null && it.pickupLng != null);\r\n-      const needDest = !it.destinationPlace && !it.destinationLabel && (it.destinationLat != null && it.destinationLng != null);\r\n+      const needPickup = !it.pickupPlace && (it.pickupLat != null && it.pickupLng != null);\r\n+      const needDest = !it.destinationPlace && (it.destinationLat != null && it.destinationLng != null);\r\n       if (!needPickup && !needDest) continue;\r\n \r\n       tasks.push(async () => {\r\n         const out: any = { id: it._id };\r\n         if (needPickup) {\r\n-          try {\r\n-            const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n-            out.pickupLabel = label || \"Pickup Location\";\r\n-          } catch (e) {\r\n-            console.warn(\"[PHistory][resolvePlaceNames] geocode pickup failed for\", it._id, e);\r\n-            out.pickupLabel = \"Pickup Location\";\r\n-          }\r\n+          const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+          out.pickupLabel = label || \"Pickup Location\";\r\n         }\r\n         if (needDest) {\r\n-          try {\r\n-            const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n-            out.destinationLabel = label || \"Destination\";\r\n-          } catch (e) {\r\n-            console.warn(\"[PHistory][resolvePlaceNames] geocode destination failed for\", it._id, e);\r\n-            out.destinationLabel = \"Destination\";\r\n-          }\r\n+          const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+          out.destinationLabel = label || \"Destination\";\r\n         }\r\n         return out;\r\n       });\r\n     }\r\n \r\n-    console.log(\"[PHistory][resolvePlaceNames] tasks queued:\", tasks.length);\r\n     if (tasks.length === 0) return;\r\n \r\n-    // concurrency limiter\r\n     const CONCURRENCY = 5;\r\n     const results: any[] = [];\r\n     let idx = 0;\r\n \r\n@@ -167,40 +151,32 @@\n         const i = idx++;\r\n         try {\r\n           const r = await tasks[i]();\r\n           results.push(r);\r\n-          console.log(\"[PHistory][resolvePlaceNames] task done:\", r.id);\r\n         } catch (e) {\r\n-          console.warn(\"[PHistory][resolvePlaceNames] task error:\", e);\r\n+          console.warn(\"geocode task fail\", e);\r\n         }\r\n       }\r\n     };\r\n \r\n     const workers = [];\r\n     for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n     await Promise.all(workers);\r\n \r\n-    console.log(\"[PHistory][resolvePlaceNames] all tasks finished, results:\", results.length);\r\n-\r\n-    if (results.length === 0) return;\r\n-\r\n-    // apply results\r\n+    // apply results and ensure defaults\r\n     setAllItems((prev) => {\r\n-      const byId = new Map(prev.map((p) => [p._id, { ...p }]));\r\n-      for (const r of results) {\r\n-        const entry = byId.get(r.id);\r\n-        if (!entry) continue;\r\n-        if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n-        if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n-        // ensure defaults\r\n-        if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n-        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n-      }\r\n-      console.log(\"[PHistory][resolvePlaceNames] applied results to state\");\r\n-      return Array.from(byId.values());\r\n+      return prev.map((p) => {\r\n+        const found = results.find((r) => r.id === p._id);\r\n+        return {\r\n+          ...p,\r\n+          pickupLabel: found?.pickupLabel || p.pickupLabel || p.pickupPlace || \"Pickup Location\",\r\n+          destinationLabel: found?.destinationLabel || p.destinationLabel || p.destinationPlace || \"Destination\",\r\n+        };\r\n+      });\r\n     });\r\n   };\r\n \r\n+\r\n   const normalize = (raw: any[]): RideItem[] =>\r\n     (raw || []).map((r: any) => {\r\n       const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n       const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n@@ -214,9 +190,9 @@\n         destinationLat: Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : undefined,\r\n         destinationLng: Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : undefined,\r\n         pickupPlace: r.pickupPlace ?? null,\r\n         destinationPlace: r.destinationPlace ?? null,\r\n-        pickupLabel,\r\n+        pickupLabel, // may be undefined; we'll resolve later\r\n         destinationLabel,\r\n         fare: Number(r.fare || 0),\r\n         totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n         bookingType: r.bookingType,\r\n@@ -228,9 +204,9 @@\n     });\r\n \r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n-    if (!passengerId) { setLoading(false); setRefreshing(false); console.log(\"[PHistory][fetchAll] no passengerId, abort\"); return; }\r\n+    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n     try {\r\n       const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n       const paths = [\r\n         `/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n@@ -239,57 +215,43 @@\n         `/api/rides`,\r\n       ];\r\n       let got: RideItem[] | null = null;\r\n \r\n-      console.log(\"[PHistory][fetchAll] starting, trying endpoints:\", paths);\r\n       for (let i = 0; i < paths.length; i++) {\r\n         const url = `${base}${paths[i]}`;\r\n         const filterLocally = i >= 2;\r\n         try {\r\n-          console.log(\"[PHistory][fetchAll] attempting fetch:\", url);\r\n           const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n           const text = await res.text();\r\n           let data: any;\r\n-          try { data = JSON.parse(text); } catch {\r\n-            console.warn(\"[PHistory][fetchAll] response not JSON from\", url);\r\n-            continue;\r\n-          }\r\n+          try { data = JSON.parse(text); } catch { continue; }\r\n           let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n           if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n           got = normalize(raw);\r\n-          console.log(\"[PHistory][fetchAll] success from:\", url, \"items:\", got.length);\r\n           break;\r\n         } catch (e) {\r\n-          console.warn(\"[PHistory][fetchAll] fetch attempt failed for\", paths[i], e);\r\n+          // continue trying other endpoints\r\n+          console.warn(\"fetch attempt failed for\", paths[i], e);\r\n         }\r\n       }\r\n       if (!got) got = [];\r\n-      console.log(\"[PHistory][fetchAll] final got length:\", got.length);\r\n-\r\n       // set basic items first (fast UI)\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n \r\n       // resolve missing place names using coords (async, non-blocking)\r\n+      // only for items missing pickup/destination label\r\n       const needResolve = got.filter(it =>\r\n         (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n         (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n       );\r\n-      console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length);\r\n       if (needResolve.length > 0) {\r\n-        resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n-      } else {\r\n-        // ensure fallback labels applied for items missing place names (no coords)\r\n-        setAllItems((prev) => prev.map(p => ({\r\n-          ...p,\r\n-          pickupLabel: p.pickupLabel ?? p.pickupPlace ?? \"Pickup location\",\r\n-          destinationLabel: p.destinationLabel ?? p.destinationPlace ?? \"Destination\",\r\n-        })));\r\n+        // do not block the UI  run in background, but update state when done\r\n+        resolvePlaceNames(got).catch((e) => console.warn(\"resolvePlaceNames failed\", e));\r\n       }\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n-      console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n     }\r\n   }, [passengerId]);\r\n \r\n   useEffect(() => { fetchAll(); }, [fetchAll]);\r\n@@ -315,22 +277,23 @@\n         style: \"destructive\",\r\n         onPress: async () => {\r\n           const prev = allItems;\r\n           setAllItems((list) => list.filter((x) => x._id !== id));\r\n+\r\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n             const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n \r\n             let success = false;\r\n             for (const url of candidates) {\r\n               try {\r\n-                console.log(\"[PHistory][delete] calling\", url);\r\n+                console.log(\" calling\", url);\r\n                 const res = await fetch(url, { method: \"DELETE\" });\r\n                 const text = await res.text();\r\n-                console.log(\"[PHistory][delete] delete response\", res.status, text);\r\n+                console.log(\" delete response\", res.status, text);\r\n                 if (res.ok) { success = true; break; }\r\n               } catch (e) {\r\n-                console.log(\"[PHistory][delete] fetch failed\", e);\r\n+                console.log(\" delete fetch failed\", e);\r\n               }\r\n             }\r\n \r\n             if (!success) {\r\n@@ -338,9 +301,9 @@\n               Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n               await fetchAll();\r\n             }\r\n           } catch (e) {\r\n-            console.log(\"[PHistory][delete] unexpected error\", e);\r\n+            console.log(\" delete unexpected error\", e);\r\n             setAllItems(prev);\r\n             Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n             await fetchAll();\r\n           }\r\n@@ -352,9 +315,9 @@\n   const openReport = (item: RideItem) => {\r\n     setReportType(\"\");\r\n     setOtherReport(\"\");\r\n     setShowDropdown(false);\r\n-    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: undefined });\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverName ? undefined : undefined });\r\n   };\r\n \r\n   const submitReport = async () => {\r\n     if (!reportOpen.id || !passengerId) return;\r\n@@ -507,11 +470,12 @@\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n-  const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n-  const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n+  const pickup = item.pickupLabel || item.pickupPlace;\r\n+  const dest = item.destinationLabel || item.destinationPlace;\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n+  const fare = item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n@@ -545,9 +509,9 @@\n               </View>\r\n             )}\r\n           </View>\r\n         </View>\r\n-\r\n+        {item.bookingType === \"Group\"}\r\n         <Text style={styles.priceText}>{php(price)}</Text>\r\n       </View>\r\n \r\n       {expanded && (\r\n"
                },
                {
                    "date": 1761404832543,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-// PHistory.tsx (updated)  paste over your current PHistory file\r\n+// PHistory.tsx (with debug logging)\r\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n   RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n@@ -27,15 +27,12 @@\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n   driverName?: string;\r\n-  // coords (may be present in backend)\r\n   pickupLat?: number; pickupLng?: number;\r\n   destinationLat?: number; destinationLng?: number;\r\n-  // optional human names (may be null for older records)\r\n   pickupPlace?: string | null;\r\n   destinationPlace?: string | null;\r\n-  // UI-friendly labels computed locally\r\n   pickupLabel?: string;\r\n   destinationLabel?: string;\r\n   fare: number;\r\n   totalFare?: number;\r\n@@ -45,9 +42,8 @@\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n-\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n@@ -69,8 +65,9 @@\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n+      console.log(\"[PHistory] loaded passengerId:\", pid);\r\n     })();\r\n   }, []);\r\n \r\n   const php = (n: number) =>\r\n@@ -80,19 +77,22 @@\n     new Date(iso).toLocaleString(\"en-PH\", {\r\n       year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n     });\r\n \r\n-  // helper to format a coordinate key\r\n   const coordKey = (lat?: number, lng?: number) =>\r\n     lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n \r\n-  // attempt reverse geocode for one coordinate pair (with caching)\r\n+  // geocode a coordinate pair (with caching) using expo-location reverseGeocodeAsync\r\n   const geocodeCoord = async (lat?: number, lng?: number) => {\r\n     const key = coordKey(lat, lng);\r\n     if (!key) return null;\r\n \r\n     const cached = reverseCache.current.get(key);\r\n-    if (cached) return cached;\r\n+    if (cached) {\r\n+      console.log(\"[PHistory][geocodeCoord] cache HIT:\", key, \"->\", cached);\r\n+      return cached;\r\n+    }\r\n+    console.log(\"[PHistory][geocodeCoord] cache MISS, calling reverseGeocodeAsync for:\", key);\r\n \r\n     try {\r\n       const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n       if (Array.isArray(res) && res.length > 0) {\r\n@@ -103,46 +103,62 @@\n           a.subregion || a.city || a.region,\r\n         ].filter(Boolean);\r\n         const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n         reverseCache.current.set(key, label);\r\n+        console.log(\"[PHistory][geocodeCoord] reverse geocode success:\", key, \"->\", label);\r\n         return label;\r\n+      } else {\r\n+        console.warn(\"[PHistory][geocodeCoord] reverseGeocodeAsync returned empty for:\", key);\r\n       }\r\n     } catch (e) {\r\n-      // fail silently, we'll fallback to coordinates or default text\r\n-      console.warn(\"Reverse geocode failed for\", key, e);\r\n+      console.warn(\"[PHistory][geocodeCoord] reverse geocode failed for\", key, e);\r\n     }\r\n-    // fallback to coords text\r\n+\r\n     const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n     reverseCache.current.set(key, coordLabel);\r\n+    console.log(\"[PHistory][geocodeCoord] fallback to coord label:\", key, \"->\", coordLabel);\r\n     return coordLabel;\r\n   };\r\n-  \r\n \r\n   // resolve missing pickup/destination names for all items (limited concurrency)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n+    console.log(\"[PHistory][resolvePlaceNames] starting, items length:\", items.length);\r\n+    // collect tasks only for items needing resolution\r\n     const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n     for (const it of items) {\r\n-      const needPickup = !it.pickupPlace && (it.pickupLat != null && it.pickupLng != null);\r\n-      const needDest = !it.destinationPlace && (it.destinationLat != null && it.destinationLng != null);\r\n+      const needPickup = !it.pickupPlace && !it.pickupLabel && (it.pickupLat != null && it.pickupLng != null);\r\n+      const needDest = !it.destinationPlace && !it.destinationLabel && (it.destinationLat != null && it.destinationLng != null);\r\n       if (!needPickup && !needDest) continue;\r\n \r\n       tasks.push(async () => {\r\n         const out: any = { id: it._id };\r\n         if (needPickup) {\r\n-          const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n-          out.pickupLabel = label || \"Pickup Location\";\r\n+          try {\r\n+            const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+            out.pickupLabel = label || \"Pickup Location\";\r\n+          } catch (e) {\r\n+            console.warn(\"[PHistory][resolvePlaceNames] geocode pickup failed for\", it._id, e);\r\n+            out.pickupLabel = \"Pickup Location\";\r\n+          }\r\n         }\r\n         if (needDest) {\r\n-          const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n-          out.destinationLabel = label || \"Destination\";\r\n+          try {\r\n+            const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+            out.destinationLabel = label || \"Destination\";\r\n+          } catch (e) {\r\n+            console.warn(\"[PHistory][resolvePlaceNames] geocode destination failed for\", it._id, e);\r\n+            out.destinationLabel = \"Destination\";\r\n+          }\r\n         }\r\n         return out;\r\n       });\r\n     }\r\n \r\n+    console.log(\"[PHistory][resolvePlaceNames] tasks queued:\", tasks.length);\r\n     if (tasks.length === 0) return;\r\n \r\n+    // concurrency limiter\r\n     const CONCURRENCY = 5;\r\n     const results: any[] = [];\r\n     let idx = 0;\r\n \r\n@@ -151,32 +167,40 @@\n         const i = idx++;\r\n         try {\r\n           const r = await tasks[i]();\r\n           results.push(r);\r\n+          console.log(\"[PHistory][resolvePlaceNames] task done:\", r.id);\r\n         } catch (e) {\r\n-          console.warn(\"geocode task fail\", e);\r\n+          console.warn(\"[PHistory][resolvePlaceNames] task error:\", e);\r\n         }\r\n       }\r\n     };\r\n \r\n     const workers = [];\r\n     for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n     await Promise.all(workers);\r\n \r\n-    // apply results and ensure defaults\r\n+    console.log(\"[PHistory][resolvePlaceNames] all tasks finished, results:\", results.length);\r\n+\r\n+    if (results.length === 0) return;\r\n+\r\n+    // apply results\r\n     setAllItems((prev) => {\r\n-      return prev.map((p) => {\r\n-        const found = results.find((r) => r.id === p._id);\r\n-        return {\r\n-          ...p,\r\n-          pickupLabel: found?.pickupLabel || p.pickupLabel || p.pickupPlace || \"Pickup Location\",\r\n-          destinationLabel: found?.destinationLabel || p.destinationLabel || p.destinationPlace || \"Destination\",\r\n-        };\r\n-      });\r\n+      const byId = new Map(prev.map((p) => [p._id, { ...p }]));\r\n+      for (const r of results) {\r\n+        const entry = byId.get(r.id);\r\n+        if (!entry) continue;\r\n+        if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n+        if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n+        // ensure defaults\r\n+        if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n+        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n+      }\r\n+      console.log(\"[PHistory][resolvePlaceNames] applied results to state\");\r\n+      return Array.from(byId.values());\r\n     });\r\n   };\r\n \r\n-\r\n   const normalize = (raw: any[]): RideItem[] =>\r\n     (raw || []).map((r: any) => {\r\n       const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n       const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n@@ -190,9 +214,9 @@\n         destinationLat: Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : undefined,\r\n         destinationLng: Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : undefined,\r\n         pickupPlace: r.pickupPlace ?? null,\r\n         destinationPlace: r.destinationPlace ?? null,\r\n-        pickupLabel, // may be undefined; we'll resolve later\r\n+        pickupLabel,\r\n         destinationLabel,\r\n         fare: Number(r.fare || 0),\r\n         totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n         bookingType: r.bookingType,\r\n@@ -204,9 +228,9 @@\n     });\r\n \r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n-    if (!passengerId) { setLoading(false); setRefreshing(false); return; }\r\n+    if (!passengerId) { setLoading(false); setRefreshing(false); console.log(\"[PHistory][fetchAll] no passengerId, abort\"); return; }\r\n     try {\r\n       const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n       const paths = [\r\n         `/ridehistory?passengerId=${encodeURIComponent(passengerId)}`,\r\n@@ -215,43 +239,57 @@\n         `/api/rides`,\r\n       ];\r\n       let got: RideItem[] | null = null;\r\n \r\n+      console.log(\"[PHistory][fetchAll] starting, trying endpoints:\", paths);\r\n       for (let i = 0; i < paths.length; i++) {\r\n         const url = `${base}${paths[i]}`;\r\n         const filterLocally = i >= 2;\r\n         try {\r\n+          console.log(\"[PHistory][fetchAll] attempting fetch:\", url);\r\n           const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n           const text = await res.text();\r\n           let data: any;\r\n-          try { data = JSON.parse(text); } catch { continue; }\r\n+          try { data = JSON.parse(text); } catch {\r\n+            console.warn(\"[PHistory][fetchAll] response not JSON from\", url);\r\n+            continue;\r\n+          }\r\n           let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n           if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n           got = normalize(raw);\r\n+          console.log(\"[PHistory][fetchAll] success from:\", url, \"items:\", got.length);\r\n           break;\r\n         } catch (e) {\r\n-          // continue trying other endpoints\r\n-          console.warn(\"fetch attempt failed for\", paths[i], e);\r\n+          console.warn(\"[PHistory][fetchAll] fetch attempt failed for\", paths[i], e);\r\n         }\r\n       }\r\n       if (!got) got = [];\r\n+      console.log(\"[PHistory][fetchAll] final got length:\", got.length);\r\n+\r\n       // set basic items first (fast UI)\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n \r\n       // resolve missing place names using coords (async, non-blocking)\r\n-      // only for items missing pickup/destination label\r\n       const needResolve = got.filter(it =>\r\n         (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n         (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n       );\r\n+      console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length);\r\n       if (needResolve.length > 0) {\r\n-        // do not block the UI  run in background, but update state when done\r\n-        resolvePlaceNames(got).catch((e) => console.warn(\"resolvePlaceNames failed\", e));\r\n+        resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n+      } else {\r\n+        // ensure fallback labels applied for items missing place names (no coords)\r\n+        setAllItems((prev) => prev.map(p => ({\r\n+          ...p,\r\n+          pickupLabel: p.pickupLabel ?? p.pickupPlace ?? \"Pickup location\",\r\n+          destinationLabel: p.destinationLabel ?? p.destinationPlace ?? \"Destination\",\r\n+        })));\r\n       }\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n+      console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n     }\r\n   }, [passengerId]);\r\n \r\n   useEffect(() => { fetchAll(); }, [fetchAll]);\r\n@@ -277,23 +315,22 @@\n         style: \"destructive\",\r\n         onPress: async () => {\r\n           const prev = allItems;\r\n           setAllItems((list) => list.filter((x) => x._id !== id));\r\n-\r\n           try {\r\n             const base = API_BASE_URL.replace(/\\/$/, \"\");\r\n             const candidates = [`${base}/ridehistory/${id}`, `${base}/api/ridehistory/${id}`];\r\n \r\n             let success = false;\r\n             for (const url of candidates) {\r\n               try {\r\n-                console.log(\" calling\", url);\r\n+                console.log(\"[PHistory][delete] calling\", url);\r\n                 const res = await fetch(url, { method: \"DELETE\" });\r\n                 const text = await res.text();\r\n-                console.log(\" delete response\", res.status, text);\r\n+                console.log(\"[PHistory][delete] delete response\", res.status, text);\r\n                 if (res.ok) { success = true; break; }\r\n               } catch (e) {\r\n-                console.log(\" delete fetch failed\", e);\r\n+                console.log(\"[PHistory][delete] fetch failed\", e);\r\n               }\r\n             }\r\n \r\n             if (!success) {\r\n@@ -301,9 +338,9 @@\n               Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n               await fetchAll();\r\n             }\r\n           } catch (e) {\r\n-            console.log(\" delete unexpected error\", e);\r\n+            console.log(\"[PHistory][delete] unexpected error\", e);\r\n             setAllItems(prev);\r\n             Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n             await fetchAll();\r\n           }\r\n@@ -315,9 +352,9 @@\n   const openReport = (item: RideItem) => {\r\n     setReportType(\"\");\r\n     setOtherReport(\"\");\r\n     setShowDropdown(false);\r\n-    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: item.driverName ? undefined : undefined });\r\n+    setReportOpen({ id: item._id, bookingId: item.bookingId, driverId: undefined });\r\n   };\r\n \r\n   const submitReport = async () => {\r\n     if (!reportOpen.id || !passengerId) return;\r\n@@ -470,12 +507,11 @@\n   onToggle: () => void;\r\n   onDelete: () => void;\r\n   onReport: () => void;\r\n }) {\r\n-  const pickup = item.pickupLabel || item.pickupPlace;\r\n-  const dest = item.destinationLabel || item.destinationPlace;\r\n+  const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n+  const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n-  const fare = item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n@@ -509,9 +545,9 @@\n               </View>\r\n             )}\r\n           </View>\r\n         </View>\r\n-        {item.bookingType === \"Group\"}\r\n+\r\n         <Text style={styles.priceText}>{php(price)}</Text>\r\n       </View>\r\n \r\n       {expanded && (\r\n"
                },
                {
                    "date": 1761404899315,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -510,8 +510,9 @@\n }) {\r\n   const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n   const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n+  const fare = item.fare;\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n"
                },
                {
                    "date": 1761405009207,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -546,9 +546,11 @@\n               </View>\r\n             )}\r\n           </View>\r\n         </View>\r\n-\r\n+        {item.bookingType === \"Group\" && (\r\n+          <Text style={styles.priceText}>{php(fare)}</Text>\r\n+        )}\r\n         <Text style={styles.priceText}>{php(price)}</Text>\r\n       </View>\r\n \r\n       {expanded && (\r\n"
                },
                {
                    "date": 1761405298513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -547,11 +547,17 @@\n             )}\r\n           </View>\r\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n-          <Text style={styles.priceText}>{php(fare)}</Text>\r\n+          <View style={{flexDirection: \"row\"}}>\r\n+            <Text style={styles.priceText}>{php(fare)}</Text>\r\n+            <Text style={styles.priceText}>{php(price)}</Text>\r\n+          </View>\r\n         )}\r\n-        <Text style={styles.priceText}>{php(price)}</Text>\r\n+        {item.bookingType !== \"Group\" && (\r\n+          <Text style={styles.priceText}>{php(price)}</Text>\r\n+        )}\r\n+        \r\n       </View>\r\n \r\n       {expanded && (\r\n         <View style={styles.expandBox}>\r\n"
                },
                {
                    "date": 1761405515942,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,15 +549,13 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View style={{flexDirection: \"row\"}}>\r\n             <Text style={styles.priceText}>{php(fare)}</Text>\r\n-            <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n           <Text style={styles.priceText}>{php(price)}</Text>\r\n         )}\r\n-        \r\n       </View>\r\n \r\n       {expanded && (\r\n         <View style={styles.expandBox}>\r\n"
                },
                {
                    "date": 1761405526919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -547,10 +547,11 @@\n             )}\r\n           </View>\r\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n-          <View style={{flexDirection: \"row\"}}>\r\n+          <View style={{flexDirection: \"column\"}}>\r\n             <Text style={styles.priceText}>{php(fare)}</Text>\r\n+            <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n           <Text style={styles.priceText}>{php(price)}</Text>\r\n"
                },
                {
                    "date": 1761405534279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -547,9 +547,9 @@\n             )}\r\n           </View>\r\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n-          <View style={{flexDirection: \"column\"}}>\r\n+          <View>\r\n             <Text style={styles.priceText}>{php(fare)}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n"
                },
                {
                    "date": 1761405587514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,8 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text style={styles.priceText}>{php(fare)}</Text>\r\n+            <Text>x >{item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761405597474,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text style={styles.priceText}>{php(fare)}</Text>\r\n-            <Text>x >{item.groupCount}</Text>\r\n+            <Text>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761405617073,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -548,9 +548,9 @@\n           </View>\r\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n-            <Text style={styles.priceText}>{php(fare)}</Text>\r\n+            <Text>{php(fare)}</Text>\r\n             <Text>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n"
                },
                {
                    "date": 1761405662526,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text>{php(fare)}</Text>\r\n-            <Text>x {item.groupCount}</Text>\r\n+            <Text style={{width: \"100%\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761405678032,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{width: \"100%\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761405693011,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{width: \"100%\", justifyContent:\"flex-end\", alignItems:\"flex-end\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761405875981,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{width: \"100%\", justifyContent:\"flex-end\", alignItems:\"flex-end\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761405907491,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761406295838,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"center\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761406311246,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View>\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"center\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"flex-start\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761406591088,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -547,11 +547,11 @@\n             )}\r\n           </View>\r\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n-          <View>\r\n+          <View >\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"flex-start\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761406630969,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View >\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{display: \"flex\",width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{paddingLeft:10, display: \"flex\",width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761406773219,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View >\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{paddingLeft:10, display: \"flex\",width: \"100%\", justifyContent:\"flex-end\"}}>x {item.groupCount}</Text>\r\n+            <Text style={{paddingLeft:50}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761406778577,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -549,9 +549,9 @@\n         </View>\r\n         {item.bookingType === \"Group\" && (\r\n           <View >\r\n             <Text>{php(fare)}</Text>\r\n-            <Text style={{paddingLeft:50}}>x {item.groupCount}</Text>\r\n+            <Text style={{paddingLeft:30}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n         {item.bookingType !== \"Group\" && (\r\n"
                },
                {
                    "date": 1761407298585,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,5 @@\n-// PHistory.tsx (with debug logging)\r\n+// PHistory.tsx (with expanded debug logging + permission check)\r\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n   RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n@@ -80,22 +80,55 @@\n \r\n   const coordKey = (lat?: number, lng?: number) =>\r\n     lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n \r\n+  // Check/request location permission before reverse geocode\r\n+  const ensureLocationPermission = async () => {\r\n+    try {\r\n+      const statusObj = await Location.getForegroundPermissionsAsync();\r\n+      console.log(\"[PHistory][perm] current permission:\", statusObj);\r\n+      if (statusObj.status !== \"granted\") {\r\n+        console.log(\"[PHistory][perm] requesting permission...\");\r\n+        const req = await Location.requestForegroundPermissionsAsync();\r\n+        console.log(\"[PHistory][perm] request result:\", req);\r\n+        return req.status === \"granted\";\r\n+      }\r\n+      return true;\r\n+    } catch (e) {\r\n+      console.warn(\"[PHistory][perm] permission check/request failed:\", e);\r\n+      return false;\r\n+    }\r\n+  };\r\n+\r\n   // geocode a coordinate pair (with caching) using expo-location reverseGeocodeAsync\r\n   const geocodeCoord = async (lat?: number, lng?: number) => {\r\n     const key = coordKey(lat, lng);\r\n-    if (!key) return null;\r\n+    if (!key) {\r\n+      console.log(\"[PHistory][geocodeCoord] no coords provided\");\r\n+      return null;\r\n+    }\r\n \r\n     const cached = reverseCache.current.get(key);\r\n     if (cached) {\r\n       console.log(\"[PHistory][geocodeCoord] cache HIT:\", key, \"->\", cached);\r\n       return cached;\r\n     }\r\n-    console.log(\"[PHistory][geocodeCoord] cache MISS, calling reverseGeocodeAsync for:\", key);\r\n+    console.log(\"[PHistory][geocodeCoord] cache MISS for:\", key);\r\n \r\n+    // Ensure permission (and log outcome)\r\n+    const hasPerm = await ensureLocationPermission();\r\n+    console.log(\"[PHistory][geocodeCoord] permission granted:\", hasPerm);\r\n+    if (!hasPerm) {\r\n+      console.warn(\"[PHistory][geocodeCoord] no location permission, falling back to coord label for\", key);\r\n+      const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n+      reverseCache.current.set(key, coordLabel);\r\n+      return coordLabel;\r\n+    }\r\n+\r\n     try {\r\n+      console.log(\"[PHistory][geocodeCoord] calling reverseGeocodeAsync for\", key);\r\n       const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n+      console.log(\"[PHistory][geocodeCoord] reverseGeocodeAsync result count:\", Array.isArray(res) ? res.length : 0);\r\n       if (Array.isArray(res) && res.length > 0) {\r\n         const a = res[0];\r\n         const pieces = [\r\n           a.name, // POI name if available\r\n@@ -121,33 +154,39 @@\n \r\n   // resolve missing pickup/destination names for all items (limited concurrency)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n     console.log(\"[PHistory][resolvePlaceNames] starting, items length:\", items.length);\r\n+\r\n     // collect tasks only for items needing resolution\r\n     const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n     for (const it of items) {\r\n       const needPickup = !it.pickupPlace && !it.pickupLabel && (it.pickupLat != null && it.pickupLng != null);\r\n       const needDest = !it.destinationPlace && !it.destinationLabel && (it.destinationLat != null && it.destinationLng != null);\r\n+\r\n+      console.log(`[PHistory][resolvePlaceNames] item ${it._id} needs pickup? ${needPickup}, needs dest? ${needDest}, coords: pickup(${it.pickupLat},${it.pickupLng}) dest(${it.destinationLat},${it.destinationLng})`);\r\n+\r\n       if (!needPickup && !needDest) continue;\r\n \r\n       tasks.push(async () => {\r\n         const out: any = { id: it._id };\r\n         if (needPickup) {\r\n           try {\r\n             const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n-            out.pickupLabel = label || \"Pickup Location\";\r\n+            out.pickupLabel = label || \"Pickup location\";\r\n+            console.log(\"[PHistory][resolvePlaceNames] pickup resolved for\", it._id, \"->\", out.pickupLabel);\r\n           } catch (e) {\r\n-            console.warn(\"[PHistory][resolvePlaceNames] geocode pickup failed for\", it._id, e);\r\n-            out.pickupLabel = \"Pickup Location\";\r\n+            console.warn(\"[PHistory][resolvePlaceNames] pickup geocode failed for\", it._id, e);\r\n+            out.pickupLabel = \"Pickup location\";\r\n           }\r\n         }\r\n         if (needDest) {\r\n           try {\r\n             const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n             out.destinationLabel = label || \"Destination\";\r\n+            console.log(\"[PHistory][resolvePlaceNames] dest resolved for\", it._id, \"->\", out.destinationLabel);\r\n           } catch (e) {\r\n-            console.warn(\"[PHistory][resolvePlaceNames] geocode destination failed for\", it._id, e);\r\n+            console.warn(\"[PHistory][resolvePlaceNames] destination geocode failed for\", it._id, e);\r\n             out.destinationLabel = \"Destination\";\r\n           }\r\n         }\r\n         return out;\r\n@@ -167,9 +206,9 @@\n         const i = idx++;\r\n         try {\r\n           const r = await tasks[i]();\r\n           results.push(r);\r\n-          console.log(\"[PHistory][resolvePlaceNames] task done:\", r.id);\r\n+          console.log(\"[PHistory][resolvePlaceNames] task done:\", r.id, r);\r\n         } catch (e) {\r\n           console.warn(\"[PHistory][resolvePlaceNames] task error:\", e);\r\n         }\r\n       }\r\n@@ -178,26 +217,33 @@\n     const workers = [];\r\n     for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n     await Promise.all(workers);\r\n \r\n-    console.log(\"[PHistory][resolvePlaceNames] all tasks finished, results:\", results.length);\r\n+    console.log(\"[PHistory][resolvePlaceNames] all tasks finished, results count:\", results.length);\r\n \r\n-    if (results.length === 0) return;\r\n+    if (results.length === 0) {\r\n+      console.warn(\"[PHistory][resolvePlaceNames] no results produced\");\r\n+      return;\r\n+    }\r\n \r\n     // apply results\r\n     setAllItems((prev) => {\r\n       const byId = new Map(prev.map((p) => [p._id, { ...p }]));\r\n       for (const r of results) {\r\n         const entry = byId.get(r.id);\r\n-        if (!entry) continue;\r\n+        if (!entry) {\r\n+          console.warn(\"[PHistory][resolvePlaceNames] result id not found in current state:\", r.id);\r\n+          continue;\r\n+        }\r\n         if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n         if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n         // ensure defaults\r\n         if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n         if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n       }\r\n-      console.log(\"[PHistory][resolvePlaceNames] applied results to state\");\r\n-      return Array.from(byId.values());\r\n+      const out = Array.from(byId.values());\r\n+      console.log(\"[PHistory][resolvePlaceNames] applied results to state; new sample[0]:\", out[0]);\r\n+      return out;\r\n     });\r\n   };\r\n \r\n   const normalize = (raw: any[]): RideItem[] =>\r\n@@ -273,10 +319,12 @@\n       const needResolve = got.filter(it =>\r\n         (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n         (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n       );\r\n-      console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length);\r\n+      console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length, \"sample:\", needResolve.slice(0,2));\r\n+\r\n       if (needResolve.length > 0) {\r\n+        // run resolve; we don't block UI but we log results when done\r\n         resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n       } else {\r\n         // ensure fallback labels applied for items missing place names (no coords)\r\n         setAllItems((prev) => prev.map(p => ({\r\n@@ -538,24 +586,24 @@\n \r\n           <View style={[styles.row, { marginTop: 4, justifyContent: \"space-between\" }]}>\r\n             <Text style={styles.timeText}>{when(item.createdAt)}</Text>\r\n \r\n-            {item.bookingType === \"Group\" && typeof item.groupCount === \"number\" && (\r\n+            {String(item.bookingType).toLowerCase() === \"group\" && typeof item.groupCount === \"number\" && (\r\n               <View style={styles.groupChip}>\r\n                 <Ionicons name=\"people-outline\" size={14} color=\"#333\" />\r\n                 <Text style={{ marginLeft: 4, fontSize: 12, color: \"#333\" }}>{item.groupCount} pax</Text>\r\n               </View>\r\n             )}\r\n           </View>\r\n         </View>\r\n-        {item.bookingType === \"Group\" && (\r\n+        {String(item.bookingType).toLowerCase() === \"group\" && (\r\n           <View >\r\n             <Text>{php(fare)}</Text>\r\n             <Text style={{paddingLeft:30}}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n         )}\r\n-        {item.bookingType !== \"Group\" && (\r\n+        {String(item.bookingType).toLowerCase() !== \"group\" && (\r\n           <Text style={styles.priceText}>{php(price)}</Text>\r\n         )}\r\n       </View>\r\n \r\n"
                },
                {
                    "date": 1761408071289,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,8 +69,10 @@\n       console.log(\"[PHistory] loaded passengerId:\", pid);\r\n     })();\r\n   }, []);\r\n \r\n+  \r\n+\r\n   const php = (n: number) =>\r\n     new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n \r\n   const when = (iso: string) =>\r\n@@ -245,8 +247,10 @@\n       return out;\r\n     });\r\n   };\r\n \r\n+  \r\n+\r\n   const normalize = (raw: any[]): RideItem[] =>\r\n     (raw || []).map((r: any) => {\r\n       const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n       const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n"
                },
                {
                    "date": 1761408124120,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -324,20 +324,9 @@\n         (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n         (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n       );\r\n       console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length, \"sample:\", needResolve.slice(0,2));\r\n-\r\n-      if (needResolve.length > 0) {\r\n-        // run resolve; we don't block UI but we log results when done\r\n-        resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n-      } else {\r\n-        // ensure fallback labels applied for items missing place names (no coords)\r\n-        setAllItems((prev) => prev.map(p => ({\r\n-          ...p,\r\n-          pickupLabel: p.pickupLabel ?? p.pickupPlace ?? \"Pickup location\",\r\n-          destinationLabel: p.destinationLabel ?? p.destinationPlace ?? \"Destination\",\r\n-        })));\r\n-      }\r\n+      resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n       console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n"
                },
                {
                    "date": 1761408158875,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -324,9 +324,20 @@\n         (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n         (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n       );\r\n       console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length, \"sample:\", needResolve.slice(0,2));\r\n-      resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n+\r\n+      if (needResolve.length > 0) {\r\n+        // run resolve; we don't block UI but we log results when done\r\n+        resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n+      } else {\r\n+        // ensure fallback labels applied for items missing place names (no coords)\r\n+        setAllItems((prev) => prev.map(p => ({\r\n+          ...p,\r\n+          pickupLabel: p.pickupLabel ?? p.pickupPlace ?? \"Pickup location\",\r\n+          destinationLabel: p.destinationLabel ?? p.destinationPlace ?? \"Destination\",\r\n+        })));\r\n+      }\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n       console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n"
                },
                {
                    "date": 1761408386766,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -325,19 +325,25 @@\n         (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n       );\r\n       console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length, \"sample:\", needResolve.slice(0,2));\r\n \r\n-      if (needResolve.length > 0) {\r\n-        // run resolve; we don't block UI but we log results when done\r\n-        resolvePlaceNames(got).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n+      const coordsToResolve = got.filter(\r\n+        (p) =>\r\n+          p.pickupLat &&\r\n+          p.pickupLng &&\r\n+          p.destinationLat &&\r\n+          p.destinationLng\r\n+      );\r\n+\r\n+      if (coordsToResolve.length > 0) {\r\n+        console.log(\"[PHistory][fetchAll] Forcing resolve for all items:\", coordsToResolve.length);\r\n+        resolvePlaceNames(coordsToResolve)\r\n+          .then(() => console.log(\"[PHistory][fetchAll] All coordinates resolved\"))\r\n+          .catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n       } else {\r\n-        // ensure fallback labels applied for items missing place names (no coords)\r\n-        setAllItems((prev) => prev.map(p => ({\r\n-          ...p,\r\n-          pickupLabel: p.pickupLabel ?? p.pickupPlace ?? \"Pickup location\",\r\n-          destinationLabel: p.destinationLabel ?? p.destinationPlace ?? \"Destination\",\r\n-        })));\r\n+        console.log(\"[PHistory][fetchAll] No valid coordinates found to resolve\");\r\n       }\r\n+\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n       console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n"
                },
                {
                    "date": 1761408629448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,8 +42,10 @@\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n+\r\n+\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n@@ -569,8 +571,9 @@\n   const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n   const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n   const fare = item.fare;\r\n+  console.log(item)\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n"
                },
                {
                    "date": 1761408681544,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -571,9 +571,8 @@\n   const pickup = item.pickupLabel || item.pickupPlace || \"Pickup location\";\r\n   const dest = item.destinationLabel || item.destinationPlace || \"Destination\";\r\n   const price = item.totalFare != null ? item.totalFare : item.fare;\r\n   const fare = item.fare;\r\n-  console.log(item)\r\n \r\n   return (\r\n     <TouchableOpacity activeOpacity={0.9} style={styles.card} onPress={onToggle}>\r\n       <View style={styles.row}>\r\n"
                },
                {
                    "date": 1761409456853,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,10 @@\n-// PHistory.tsx (with expanded debug logging + permission check)\r\n+// PHistory.tsx (FULL updated)\r\n import React, { useCallback, useEffect, useState } from \"react\";\r\n import {\r\n   View, Text, StyleSheet, Dimensions, Image, FlatList,\r\n-  RefreshControl, TouchableOpacity, ActivityIndicator, Alert,\r\n-  Modal, TextInput, LayoutAnimation, Platform, UIManager,\r\n+  RefreshControl, TouchableOpacity, Alert, Modal, TextInput,\r\n+  LayoutAnimation, Platform, UIManager,\r\n } from \"react-native\";\r\n import AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n import { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n import * as Location from \"expo-location\";\r\n@@ -27,25 +27,33 @@\n   _id: string;\r\n   bookingId?: string;\r\n   passengerId?: string;\r\n   driverName?: string;\r\n-  pickupLat?: number; pickupLng?: number;\r\n-  destinationLat?: number; destinationLng?: number;\r\n+\r\n+  // coordinate fields (may be undefined)\r\n+  pickupLat?: number | undefined;\r\n+  pickupLng?: number | undefined;\r\n+  destinationLat?: number | undefined;\r\n+  destinationLng?: number | undefined;\r\n+\r\n+  // original place fields from backend (may be null)\r\n   pickupPlace?: string | null;\r\n   destinationPlace?: string | null;\r\n-  pickupLabel?: string;\r\n-  destinationLabel?: string;\r\n+\r\n+  // unprocessed labels (can be either coords string or human label)\r\n+  pickupLabel?: string | undefined | null;\r\n+  destinationLabel?: string | undefined | null;\r\n+\r\n+  // computed UI fields\r\n   fare: number;\r\n   totalFare?: number;\r\n-  bookingType?: \"Classic\" | \"Group\" | \"Solo\" | string;\r\n+  bookingType?: string;\r\n   groupCount?: number;\r\n   createdAt: string;\r\n   paymentMethod?: string;\r\n   notes?: string;\r\n };\r\n \r\n-\r\n-\r\n export default function PHistory() {\r\n   const [passengerId, setPassengerId] = useState<string | null>(null);\r\n   const [allItems, setAllItems] = useState<RideItem[]>([]);\r\n   const [visible, setVisible] = useState(10);\r\n@@ -60,9 +68,9 @@\n   const [otherReport, setOtherReport] = useState(\"\");\r\n   const [showDropdown, setShowDropdown] = useState(false);\r\n   const [sendingReport, setSendingReport] = useState(false);\r\n \r\n-  // simple in-memory cache for reverse geocode results\r\n+  // reverse geocode cache (coordKey -> label)\r\n   const reverseCache = React.useRef<Map<string, string>>(new Map());\r\n \r\n   useEffect(() => {\r\n     (async () => {\r\n@@ -71,74 +79,57 @@\n       console.log(\"[PHistory] loaded passengerId:\", pid);\r\n     })();\r\n   }, []);\r\n \r\n-  \r\n-\r\n   const php = (n: number) =>\r\n     new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(n);\r\n \r\n   const when = (iso: string) =>\r\n     new Date(iso).toLocaleString(\"en-PH\", {\r\n       year: \"numeric\", month: \"long\", day: \"numeric\", hour: \"numeric\", minute: \"2-digit\",\r\n     });\r\n \r\n+  // --- Helpers ---\r\n+\r\n+  // parse \"lat, lng\" from a string label if it looks like coordinates\r\n+  const parseCoordsFromLabel = (s?: string | null) => {\r\n+    if (!s || typeof s !== \"string\") return null;\r\n+    // trim and allow variations: \"13.92741, 121.62298\" or \"13.92741,121.62298\"\r\n+    const m = s.trim().match(/^(-?\\d+(?:\\.\\d+)?)[,\\s]+(-?\\d+(?:\\.\\d+)?)$/);\r\n+    if (!m) return null;\r\n+    const lat = Number(m[1]);\r\n+    const lng = Number(m[2]);\r\n+    if (!Number.isFinite(lat) || !Number.isFinite(lng)) return null;\r\n+    return { lat, lng };\r\n+  };\r\n+\r\n   const coordKey = (lat?: number, lng?: number) =>\r\n     lat == null || lng == null ? null : `${lat.toFixed(6)},${lng.toFixed(6)}`;\r\n \r\n-  // Check/request location permission before reverse geocode\r\n-  const ensureLocationPermission = async () => {\r\n-    try {\r\n-      const statusObj = await Location.getForegroundPermissionsAsync();\r\n-      console.log(\"[PHistory][perm] current permission:\", statusObj);\r\n-      if (statusObj.status !== \"granted\") {\r\n-        console.log(\"[PHistory][perm] requesting permission...\");\r\n-        const req = await Location.requestForegroundPermissionsAsync();\r\n-        console.log(\"[PHistory][perm] request result:\", req);\r\n-        return req.status === \"granted\";\r\n-      }\r\n-      return true;\r\n-    } catch (e) {\r\n-      console.warn(\"[PHistory][perm] permission check/request failed:\", e);\r\n-      return false;\r\n-    }\r\n-  };\r\n-\r\n-  // geocode a coordinate pair (with caching) using expo-location reverseGeocodeAsync\r\n+  // reverse geocode a lat/lng to a readable label (expo-location reverseGeocodeAsync)\r\n   const geocodeCoord = async (lat?: number, lng?: number) => {\r\n     const key = coordKey(lat, lng);\r\n-    if (!key) {\r\n-      console.log(\"[PHistory][geocodeCoord] no coords provided\");\r\n-      return null;\r\n-    }\r\n+    if (!key) return null;\r\n \r\n     const cached = reverseCache.current.get(key);\r\n     if (cached) {\r\n       console.log(\"[PHistory][geocodeCoord] cache HIT:\", key, \"->\", cached);\r\n       return cached;\r\n     }\r\n-    console.log(\"[PHistory][geocodeCoord] cache MISS for:\", key);\r\n \r\n-    // Ensure permission (and log outcome)\r\n-    const hasPerm = await ensureLocationPermission();\r\n-    console.log(\"[PHistory][geocodeCoord] permission granted:\", hasPerm);\r\n-    if (!hasPerm) {\r\n-      console.warn(\"[PHistory][geocodeCoord] no location permission, falling back to coord label for\", key);\r\n-      const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n-      reverseCache.current.set(key, coordLabel);\r\n-      return coordLabel;\r\n-    }\r\n+    console.log(\"[PHistory][geocodeCoord] cache MISS, calling reverseGeocodeAsync for:\", key);\r\n \r\n     try {\r\n-      console.log(\"[PHistory][geocodeCoord] calling reverseGeocodeAsync for\", key);\r\n+      // Note: reverseGeocodeAsync doesn't require your app's server, it uses device/location services.\r\n+      // On some devices/OS it might need location permissions; we attempt it and gracefully fallback.\r\n       const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n-      console.log(\"[PHistory][geocodeCoord] reverseGeocodeAsync result count:\", Array.isArray(res) ? res.length : 0);\r\n       if (Array.isArray(res) && res.length > 0) {\r\n         const a = res[0];\r\n+        // Compose a useful label: prefer name/poi, then street + city/subregion\r\n         const pieces = [\r\n-          a.name, // POI name if available\r\n-          a.street,\r\n-          a.subregion || a.city || a.region,\r\n+          a.name || undefined,\r\n+          a.street || undefined,\r\n+          a.subregion || a.city || a.region || undefined,\r\n         ].filter(Boolean);\r\n         const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n         reverseCache.current.set(key, label);\r\n         console.log(\"[PHistory][geocodeCoord] reverse geocode success:\", key, \"->\", label);\r\n@@ -149,49 +140,88 @@\n     } catch (e) {\r\n       console.warn(\"[PHistory][geocodeCoord] reverse geocode failed for\", key, e);\r\n     }\r\n \r\n+    // fallback to the coordinate string\r\n     const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n     reverseCache.current.set(key, coordLabel);\r\n     console.log(\"[PHistory][geocodeCoord] fallback to coord label:\", key, \"->\", coordLabel);\r\n     return coordLabel;\r\n   };\r\n \r\n-  // resolve missing pickup/destination names for all items (limited concurrency)\r\n+  // convert an array of raw records into RideItem shape, and *extract coords from labels if present*\r\n+  const normalize = (raw: any[]): RideItem[] =>\r\n+    (raw || []).map((r: any) => {\r\n+      // initial raw labels from backend (could be coordinates string)\r\n+      const rawPickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || null;\r\n+      const rawDestLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || null;\r\n+\r\n+      // parse coords if present inside labels\r\n+      const parsedPickup = parseCoordsFromLabel(typeof rawPickupLabel === \"string\" ? rawPickupLabel : null);\r\n+      const parsedDest = parseCoordsFromLabel(typeof rawDestLabel === \"string\" ? rawDestLabel : null);\r\n+\r\n+      const pickupLat = Number.isFinite(r.pickupLat) ? Number(r.pickupLat) : (parsedPickup ? parsedPickup.lat : undefined);\r\n+      const pickupLng = Number.isFinite(r.pickupLng) ? Number(r.pickupLng) : (parsedPickup ? parsedPickup.lng : undefined);\r\n+      const destinationLat = Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : (parsedDest ? parsedDest.lat : undefined);\r\n+      const destinationLng = Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : (parsedDest ? parsedDest.lng : undefined);\r\n+\r\n+      // If label was just coordinates, we null out pickupLabel/destinationLabel so resolver will produce a human label.\r\n+      // If the label is not coordinates (a real string), keep it.\r\n+      const pickupLabel = parsedPickup ? undefined : (rawPickupLabel ?? undefined);\r\n+      const destinationLabel = parsedDest ? undefined : (rawDestLabel ?? undefined);\r\n+\r\n+      return {\r\n+        _id: String(r._id),\r\n+        bookingId: r.bookingId,\r\n+        passengerId: r.passengerId,\r\n+        driverName: r.driverName,\r\n+        pickupLat,\r\n+        pickupLng,\r\n+        destinationLat,\r\n+        destinationLng,\r\n+        pickupPlace: r.pickupPlace ?? null,\r\n+        destinationPlace: r.destinationPlace ?? null,\r\n+        pickupLabel,\r\n+        destinationLabel,\r\n+        fare: Number(r.fare || 0),\r\n+        totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n+        bookingType: r.bookingType,\r\n+        groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n+        createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n+        paymentMethod: r.paymentMethod || \"\",\r\n+        notes: r.notes || \"\",\r\n+      } as RideItem;\r\n+    });\r\n+\r\n+  // Resolve labels (reverse geocode) for any item that has coordinates (either native fields or parsed from label)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n-    console.log(\"[PHistory][resolvePlaceNames] starting, items length:\", items.length);\r\n-\r\n-    // collect tasks only for items needing resolution\r\n+    console.log(\"[PHistory][resolvePlaceNames] start, items:\", items.length);\r\n+    // Build tasks for items that either (a) do not have human label yet, AND (b) have coordinates\r\n     const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n     for (const it of items) {\r\n-      const needPickup = !it.pickupPlace && !it.pickupLabel && (it.pickupLat != null && it.pickupLng != null);\r\n-      const needDest = !it.destinationPlace && !it.destinationLabel && (it.destinationLat != null && it.destinationLng != null);\r\n+      const needsPickup = (!it.pickupLabel || it.pickupLabel === \"\") && (it.pickupLat != null && it.pickupLng != null);\r\n+      const needsDest = (!it.destinationLabel || it.destinationLabel === \"\") && (it.destinationLat != null && it.destinationLng != null);\r\n+      if (!needsPickup && !needsDest) continue;\r\n \r\n-      console.log(`[PHistory][resolvePlaceNames] item ${it._id} needs pickup? ${needPickup}, needs dest? ${needDest}, coords: pickup(${it.pickupLat},${it.pickupLng}) dest(${it.destinationLat},${it.destinationLng})`);\r\n-\r\n-      if (!needPickup && !needDest) continue;\r\n-\r\n       tasks.push(async () => {\r\n         const out: any = { id: it._id };\r\n-        if (needPickup) {\r\n+        if (needsPickup) {\r\n           try {\r\n-            const label = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n-            out.pickupLabel = label || \"Pickup location\";\r\n-            console.log(\"[PHistory][resolvePlaceNames] pickup resolved for\", it._id, \"->\", out.pickupLabel);\r\n+            const lbl = await geocodeCoord(it.pickupLat, it.pickupLng);\r\n+            out.pickupLabel = lbl || (it.pickupPlace || \"Pickup location\");\r\n           } catch (e) {\r\n-            console.warn(\"[PHistory][resolvePlaceNames] pickup geocode failed for\", it._id, e);\r\n-            out.pickupLabel = \"Pickup location\";\r\n+            console.warn(\"[PHistory][resolvePlaceNames] pickup geocode failed\", it._id, e);\r\n+            out.pickupLabel = it.pickupPlace || \"Pickup location\";\r\n           }\r\n         }\r\n-        if (needDest) {\r\n+        if (needsDest) {\r\n           try {\r\n-            const label = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n-            out.destinationLabel = label || \"Destination\";\r\n-            console.log(\"[PHistory][resolvePlaceNames] dest resolved for\", it._id, \"->\", out.destinationLabel);\r\n+            const lbl = await geocodeCoord(it.destinationLat, it.destinationLng);\r\n+            out.destinationLabel = lbl || (it.destinationPlace || \"Destination\");\r\n           } catch (e) {\r\n-            console.warn(\"[PHistory][resolvePlaceNames] destination geocode failed for\", it._id, e);\r\n-            out.destinationLabel = \"Destination\";\r\n+            console.warn(\"[PHistory][resolvePlaceNames] dest geocode failed\", it._id, e);\r\n+            out.destinationLabel = it.destinationPlace || \"Destination\";\r\n           }\r\n         }\r\n         return out;\r\n       });\r\n@@ -210,76 +240,42 @@\n         const i = idx++;\r\n         try {\r\n           const r = await tasks[i]();\r\n           results.push(r);\r\n-          console.log(\"[PHistory][resolvePlaceNames] task done:\", r.id, r);\r\n+          console.log(\"[PHistory][resolvePlaceNames] task done for id:\", r.id);\r\n         } catch (e) {\r\n-          console.warn(\"[PHistory][resolvePlaceNames] task error:\", e);\r\n+          console.warn(\"[PHistory][resolvePlaceNames] task error\", e);\r\n         }\r\n       }\r\n     };\r\n \r\n     const workers = [];\r\n     for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n     await Promise.all(workers);\r\n \r\n-    console.log(\"[PHistory][resolvePlaceNames] all tasks finished, results count:\", results.length);\r\n+    console.log(\"[PHistory][resolvePlaceNames] applying results:\", results.length);\r\n+    if (results.length === 0) return;\r\n \r\n-    if (results.length === 0) {\r\n-      console.warn(\"[PHistory][resolvePlaceNames] no results produced\");\r\n-      return;\r\n-    }\r\n-\r\n-    // apply results\r\n+    // merge results into state\r\n     setAllItems((prev) => {\r\n       const byId = new Map(prev.map((p) => [p._id, { ...p }]));\r\n       for (const r of results) {\r\n         const entry = byId.get(r.id);\r\n-        if (!entry) {\r\n-          console.warn(\"[PHistory][resolvePlaceNames] result id not found in current state:\", r.id);\r\n-          continue;\r\n-        }\r\n+        if (!entry) continue;\r\n         if (r.pickupLabel) entry.pickupLabel = r.pickupLabel;\r\n         if (r.destinationLabel) entry.destinationLabel = r.destinationLabel;\r\n-        // ensure defaults\r\n-        if (!entry.pickupLabel) entry.pickupLabel = entry.pickupPlace || \"Pickup location\";\r\n-        if (!entry.destinationLabel) entry.destinationLabel = entry.destinationPlace || \"Destination\";\r\n       }\r\n-      const out = Array.from(byId.values());\r\n-      console.log(\"[PHistory][resolvePlaceNames] applied results to state; new sample[0]:\", out[0]);\r\n-      return out;\r\n+      // ensure defaults if still undefined\r\n+      return Array.from(byId.values()).map((e) => ({\r\n+        ...e,\r\n+        pickupLabel: e.pickupLabel ?? e.pickupPlace ?? \"Pickup location\",\r\n+        destinationLabel: e.destinationLabel ?? e.destinationPlace ?? \"Destination\",\r\n+      }));\r\n     });\r\n+    console.log(\"[PHistory][resolvePlaceNames] done and state updated\");\r\n   };\r\n \r\n-  \r\n-\r\n-  const normalize = (raw: any[]): RideItem[] =>\r\n-    (raw || []).map((r: any) => {\r\n-      const pickupLabel = r.pickupPlace || r.pickupLabel || r.pickupName || r.pickupAddress || undefined;\r\n-      const destinationLabel = r.destinationPlace || r.destinationLabel || r.destinationName || r.destinationAddress || undefined;\r\n-      return {\r\n-        _id: String(r._id),\r\n-        bookingId: r.bookingId,\r\n-        passengerId: r.passengerId,\r\n-        driverName: r.driverName,\r\n-        pickupLat: Number.isFinite(r.pickupLat) ? Number(r.pickupLat) : undefined,\r\n-        pickupLng: Number.isFinite(r.pickupLng) ? Number(r.pickupLng) : undefined,\r\n-        destinationLat: Number.isFinite(r.destinationLat) ? Number(r.destinationLat) : undefined,\r\n-        destinationLng: Number.isFinite(r.destinationLng) ? Number(r.destinationLng) : undefined,\r\n-        pickupPlace: r.pickupPlace ?? null,\r\n-        destinationPlace: r.destinationPlace ?? null,\r\n-        pickupLabel,\r\n-        destinationLabel,\r\n-        fare: Number(r.fare || 0),\r\n-        totalFare: r.totalFare != null ? Number(r.totalFare) : undefined,\r\n-        bookingType: r.bookingType,\r\n-        groupCount: r.groupCount != null ? Number(r.groupCount) : undefined,\r\n-        createdAt: r.createdAt || r.completedAt || new Date().toISOString(),\r\n-        paymentMethod: r.paymentMethod || \"\",\r\n-        notes: r.notes || \"\",\r\n-      } as RideItem;\r\n-    });\r\n-\r\n+  // fetch list from backend, normalize, and force geocode any coords (including coords embedded in labels)\r\n   const fetchAll = useCallback(async () => {\r\n     setErrorMsg(null);\r\n     if (!passengerId) { setLoading(false); setRefreshing(false); console.log(\"[PHistory][fetchAll] no passengerId, abort\"); return; }\r\n     try {\r\n@@ -316,36 +312,31 @@\n       }\r\n       if (!got) got = [];\r\n       console.log(\"[PHistory][fetchAll] final got length:\", got.length);\r\n \r\n-      // set basic items first (fast UI)\r\n+      // Set items quickly to render UI\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n \r\n-      // resolve missing place names using coords (async, non-blocking)\r\n-      const needResolve = got.filter(it =>\r\n-        (!it.pickupLabel && (it.pickupLat != null && it.pickupLng != null)) ||\r\n-        (!it.destinationLabel && (it.destinationLat != null && it.destinationLng != null))\r\n+      // --- FORCE: find all items that have coordinates (either in fields or parsed from labels) and geocode them ---\r\n+      const itemsWithCoords = got.filter(it =>\r\n+        (it.pickupLat != null && it.pickupLng != null) ||\r\n+        (it.destinationLat != null && it.destinationLng != null)\r\n       );\r\n-      console.log(\"[PHistory][fetchAll] needResolve count:\", needResolve.length, \"sample:\", needResolve.slice(0,2));\r\n \r\n-      const coordsToResolve = got.filter(\r\n-        (p) =>\r\n-          p.pickupLat &&\r\n-          p.pickupLng &&\r\n-          p.destinationLat &&\r\n-          p.destinationLng\r\n-      );\r\n+      console.log(\"[PHistory][fetchAll] items with coords (for geocoding):\", itemsWithCoords.length);\r\n \r\n-      if (coordsToResolve.length > 0) {\r\n-        console.log(\"[PHistory][fetchAll] Forcing resolve for all items:\", coordsToResolve.length);\r\n-        resolvePlaceNames(coordsToResolve)\r\n-          .then(() => console.log(\"[PHistory][fetchAll] All coordinates resolved\"))\r\n-          .catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n+      if (itemsWithCoords.length > 0) {\r\n+        // resolve them (non-blocking)\r\n+        resolvePlaceNames(itemsWithCoords).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n       } else {\r\n-        console.log(\"[PHistory][fetchAll] No valid coordinates found to resolve\");\r\n+        // ensure fallback labels for items with no coords\r\n+        setAllItems((prev) => prev.map(p => ({\r\n+          ...p,\r\n+          pickupLabel: p.pickupLabel ?? p.pickupPlace ?? \"Pickup location\",\r\n+          destinationLabel: p.destinationLabel ?? p.destinationPlace ?? \"Destination\",\r\n+        })));\r\n       }\r\n-\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n       console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n@@ -520,13 +511,9 @@\n \r\n               {showDropdown && (\r\n                 <View style={styles.dropdownMenu}>\r\n                   {REPORT_OPTIONS.map((opt) => (\r\n-                    <TouchableOpacity\r\n-                      key={opt}\r\n-                      style={styles.dropdownItem}\r\n-                      onPress={() => { setReportType(opt); setShowDropdown(false); }}\r\n-                    >\r\n+                    <TouchableOpacity key={opt} style={styles.dropdownItem} onPress={() => { setReportType(opt); setShowDropdown(false); }}>\r\n                       <Text style={{ color: \"#000\" }}>{opt}</Text>\r\n                     </TouchableOpacity>\r\n                   ))}\r\n                 </View>\r\n@@ -585,9 +572,11 @@\n             </View>\r\n \r\n             {!!item.bookingType && (\r\n               <View style={[styles.typeChip, typeChipStyle(item.bookingType)]}>\r\n-                <Text style={styles.typeChipText}>{String(item.bookingType).replace(/CLASSIC/i,'Classic').replace(/GROUP/i,'Group').replace(/SOLO/i,'Solo')}</Text>\r\n+                <Text style={styles.typeChipText}>\r\n+                  {String(item.bookingType).replace(/CLASSIC/i,'Classic').replace(/GROUP/i,'Group').replace(/SOLO/i,'Solo')}\r\n+                </Text>\r\n               </View>\r\n             )}\r\n           </View>\r\n \r\n@@ -606,16 +595,16 @@\n               </View>\r\n             )}\r\n           </View>\r\n         </View>\r\n-        {String(item.bookingType).toLowerCase() === \"group\" && (\r\n-          <View >\r\n-            <Text>{php(fare)}</Text>\r\n-            <Text style={{paddingLeft:30}}>x {item.groupCount}</Text>\r\n+\r\n+        {String(item.bookingType).toLowerCase() === \"group\" && typeof item.groupCount === \"number\" ? (\r\n+          <View style={{ alignItems: \"flex-end\" }}>\r\n+            <Text style={{ fontSize: 12 }}>{php(fare)}</Text>\r\n+            <Text style={{ fontSize: 12 }}>x {item.groupCount}</Text>\r\n             <Text style={styles.priceText}>{php(price)}</Text>\r\n           </View>\r\n-        )}\r\n-        {String(item.bookingType).toLowerCase() !== \"group\" && (\r\n+        ) : (\r\n           <Text style={styles.priceText}>{php(price)}</Text>\r\n         )}\r\n       </View>\r\n \r\n"
                },
                {
                    "date": 1761410424680,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -75,9 +75,8 @@\n   useEffect(() => {\r\n     (async () => {\r\n       const pid = (await AsyncStorage.getItem(\"passengerId\")) || (await AsyncStorage.getItem(\"userId\"));\r\n       setPassengerId(pid || null);\r\n-      console.log(\"[PHistory] loaded passengerId:\", pid);\r\n     })();\r\n   }, []);\r\n \r\n   const php = (n: number) =>\r\n@@ -111,14 +110,11 @@\n     if (!key) return null;\r\n \r\n     const cached = reverseCache.current.get(key);\r\n     if (cached) {\r\n-      console.log(\"[PHistory][geocodeCoord] cache HIT:\", key, \"->\", cached);\r\n       return cached;\r\n     }\r\n \r\n-    console.log(\"[PHistory][geocodeCoord] cache MISS, calling reverseGeocodeAsync for:\", key);\r\n-\r\n     try {\r\n       // Note: reverseGeocodeAsync doesn't require your app's server, it uses device/location services.\r\n       // On some devices/OS it might need location permissions; we attempt it and gracefully fallback.\r\n       const res = await Location.reverseGeocodeAsync({ latitude: lat!, longitude: lng! });\r\n@@ -130,22 +126,18 @@\n           a.street || undefined,\r\n           a.subregion || a.city || a.region || undefined,\r\n         ].filter(Boolean);\r\n         const label = pieces.join(\", \") || `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n-        reverseCache.current.set(key, label);\r\n-        console.log(\"[PHistory][geocodeCoord] reverse geocode success:\", key, \"->\", label);\r\n+        reverseCache.current.set(key, label);;\r\n         return label;\r\n       } else {\r\n-        console.warn(\"[PHistory][geocodeCoord] reverseGeocodeAsync returned empty for:\", key);\r\n       }\r\n     } catch (e) {\r\n-      console.warn(\"[PHistory][geocodeCoord] reverse geocode failed for\", key, e);\r\n     }\r\n \r\n     // fallback to the coordinate string\r\n     const coordLabel = `${lat!.toFixed(5)}, ${lng!.toFixed(5)}`;\r\n     reverseCache.current.set(key, coordLabel);\r\n-    console.log(\"[PHistory][geocodeCoord] fallback to coord label:\", key, \"->\", coordLabel);\r\n     return coordLabel;\r\n   };\r\n \r\n   // convert an array of raw records into RideItem shape, and *extract coords from labels if present*\r\n@@ -193,10 +185,8 @@\n     });\r\n \r\n   // Resolve labels (reverse geocode) for any item that has coordinates (either native fields or parsed from label)\r\n   const resolvePlaceNames = async (items: RideItem[]) => {\r\n-    console.log(\"[PHistory][resolvePlaceNames] start, items:\", items.length);\r\n-    // Build tasks for items that either (a) do not have human label yet, AND (b) have coordinates\r\n     const tasks: Array<() => Promise<{ id: string; pickupLabel?: string; destinationLabel?: string }>> = [];\r\n \r\n     for (const it of items) {\r\n       const needsPickup = (!it.pickupLabel || it.pickupLabel === \"\") && (it.pickupLat != null && it.pickupLng != null);\r\n@@ -225,10 +215,8 @@\n         }\r\n         return out;\r\n       });\r\n     }\r\n-\r\n-    console.log(\"[PHistory][resolvePlaceNames] tasks queued:\", tasks.length);\r\n     if (tasks.length === 0) return;\r\n \r\n     // concurrency limiter\r\n     const CONCURRENCY = 5;\r\n@@ -240,20 +228,17 @@\n         const i = idx++;\r\n         try {\r\n           const r = await tasks[i]();\r\n           results.push(r);\r\n-          console.log(\"[PHistory][resolvePlaceNames] task done for id:\", r.id);\r\n         } catch (e) {\r\n-          console.warn(\"[PHistory][resolvePlaceNames] task error\", e);\r\n         }\r\n       }\r\n     };\r\n \r\n     const workers = [];\r\n     for (let i = 0; i < CONCURRENCY; i++) workers.push(runner());\r\n     await Promise.all(workers);\r\n \r\n-    console.log(\"[PHistory][resolvePlaceNames] applying results:\", results.length);\r\n     if (results.length === 0) return;\r\n \r\n     // merge results into state\r\n     setAllItems((prev) => {\r\n@@ -270,9 +255,8 @@\n         pickupLabel: e.pickupLabel ?? e.pickupPlace ?? \"Pickup location\",\r\n         destinationLabel: e.destinationLabel ?? e.destinationPlace ?? \"Destination\",\r\n       }));\r\n     });\r\n-    console.log(\"[PHistory][resolvePlaceNames] done and state updated\");\r\n   };\r\n \r\n   // fetch list from backend, normalize, and force geocode any coords (including coords embedded in labels)\r\n   const fetchAll = useCallback(async () => {\r\n@@ -287,14 +271,12 @@\n         `/api/rides`,\r\n       ];\r\n       let got: RideItem[] | null = null;\r\n \r\n-      console.log(\"[PHistory][fetchAll] starting, trying endpoints:\", paths);\r\n       for (let i = 0; i < paths.length; i++) {\r\n         const url = `${base}${paths[i]}`;\r\n         const filterLocally = i >= 2;\r\n         try {\r\n-          console.log(\"[PHistory][fetchAll] attempting fetch:\", url);\r\n           const res = await fetch(url, { headers: { \"Cache-Control\": \"no-store\" } });\r\n           const text = await res.text();\r\n           let data: any;\r\n           try { data = JSON.parse(text); } catch {\r\n@@ -303,16 +285,14 @@\n           }\r\n           let raw: any[] = Array.isArray(data) ? data : (Array.isArray(data?.items) ? data.items : []);\r\n           if (filterLocally) raw = raw.filter((x: any) => String(x.passengerId) === String(passengerId));\r\n           got = normalize(raw);\r\n-          console.log(\"[PHistory][fetchAll] success from:\", url, \"items:\", got.length);\r\n           break;\r\n         } catch (e) {\r\n           console.warn(\"[PHistory][fetchAll] fetch attempt failed for\", paths[i], e);\r\n         }\r\n       }\r\n       if (!got) got = [];\r\n-      console.log(\"[PHistory][fetchAll] final got length:\", got.length);\r\n \r\n       // Set items quickly to render UI\r\n       setAllItems(got);\r\n       setVisible(Math.min(10, got.length));\r\n@@ -322,10 +302,8 @@\n         (it.pickupLat != null && it.pickupLng != null) ||\r\n         (it.destinationLat != null && it.destinationLng != null)\r\n       );\r\n \r\n-      console.log(\"[PHistory][fetchAll] items with coords (for geocoding):\", itemsWithCoords.length);\r\n-\r\n       if (itemsWithCoords.length > 0) {\r\n         // resolve them (non-blocking)\r\n         resolvePlaceNames(itemsWithCoords).catch((e) => console.warn(\"[PHistory][fetchAll] resolvePlaceNames failed\", e));\r\n       } else {\r\n@@ -338,9 +316,8 @@\n       }\r\n     } finally {\r\n       setLoading(false);\r\n       setRefreshing(false);\r\n-      console.log(\"[PHistory][fetchAll] finished (loading=false)\");\r\n     }\r\n   }, [passengerId]);\r\n \r\n   useEffect(() => { fetchAll(); }, [fetchAll]);\r\n@@ -373,15 +350,12 @@\n \r\n             let success = false;\r\n             for (const url of candidates) {\r\n               try {\r\n-                console.log(\"[PHistory][delete] calling\", url);\r\n                 const res = await fetch(url, { method: \"DELETE\" });\r\n                 const text = await res.text();\r\n-                console.log(\"[PHistory][delete] delete response\", res.status, text);\r\n                 if (res.ok) { success = true; break; }\r\n               } catch (e) {\r\n-                console.log(\"[PHistory][delete] fetch failed\", e);\r\n               }\r\n             }\r\n \r\n             if (!success) {\r\n@@ -389,9 +363,8 @@\n               Alert.alert(\"Delete failed\", \"Could not delete from the server.\");\r\n               await fetchAll();\r\n             }\r\n           } catch (e) {\r\n-            console.log(\"[PHistory][delete] unexpected error\", e);\r\n             setAllItems(prev);\r\n             Alert.alert(\"Delete failed\", \"Unexpected error.\");\r\n             await fetchAll();\r\n           }\r\n"
                }
            ],
            "date": 1748350023769,
            "name": "Commit-0",
            "content": "// phistory.tsx\r\nimport React from 'react';\r\nimport { View, Text, StyleSheet, TouchableOpacity, } from 'react-native';\r\nimport { Ionicons, MaterialIcons } from \"@expo/vector-icons\";\r\n\r\nexport default function PHistory() {\r\n  return (\r\n    <View style={styles.container}>\r\n        <Text>Passenger History Page</Text>\r\n        <View style={styles.bottomNav}>\r\n            <TouchableOpacity><Ionicons name=\"home\" size={30} color=\"black\" /><Text>Home</Text></TouchableOpacity>\r\n            <TouchableOpacity><Ionicons name=\"document-text-outline\" size={30} color=\"black\" /><Text>History</Text></TouchableOpacity>\r\n            <TouchableOpacity><Ionicons name=\"chatbubbles-outline\" size={30} color=\"black\" /><Text>Chats</Text></TouchableOpacity>\r\n            <TouchableOpacity><Ionicons name=\"person-outline\" size={30} color=\"black\" /><Text>Profile</Text></TouchableOpacity>\r\n        </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: { flex: 1, justifyContent: 'center', alignItems: 'center' },\r\n});\r\n"
        }
    ]
}